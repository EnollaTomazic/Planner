# Repository Guidelines

This document defines expectations for the entire repository. Check for nested `AGENTS.md` files when working in subdirectories, as their instructions override the guidance here.

## Setup Commands
- Install dependencies with `pnpm install`.
- Start the local development server with `pnpm dev` (the script runs `pnpm run prebuild` first so autogenerated UI indexes stay current).
- If you need additional context or OS prerequisites, consult the [README](https://raw.githubusercontent.com/PlannerProject/Planner/main/README.md).

## Testing Instructions
- Run the combined quality gate with `pnpm run check` before committing changes.
- Execute focused commands as needed:
  - Unit tests: `pnpm test`
  - Linting: `pnpm lint`
  - Type checking: `pnpm run typecheck`
  - Pattern-specific Vitest runs: `pnpm vitest run -t "<test name>"` or `pnpm vitest related <file>` when scoping to a module.
- Use `pnpm run verify-prompts` whenever you modify prompt definitions or AI-related flows.

## Build & Deploy
- Create production builds using `pnpm run build`.
- Deploy the static export to GitHub Pages with `pnpm run deploy` (alias of `pnpm run deploy:pages`). The script prepares `out/` and pushes it to the configured Pages branch.
- Ensure the GitHub Pages environment variables are configured: `GITHUB_PAGES=true`, `BASE_PATH`, and `NEXT_PUBLIC_BASE_PATH`. Provide `GITHUB_TOKEN` and `GITHUB_REPOSITORY` in CI so the push succeeds without manual remotes.
- When metrics collection is required, set `NEXT_PUBLIC_METRICS_ENDPOINT` to the deployed collector URL so static exports keep reporting.
- For bundle analysis, run `pnpm run analyze` (copies reports to `docs/bundle-report/`).

## Code Style Guidelines
- TypeScript strict mode must remain enabled; do not relax `tsconfig.json` settings.
- Format code with single quotes, omit semicolons, and keep trailing commas where valid with 2-space indentation.
- Organize imports by grouping external dependencies before local modules.
- Follow the tokens-only design system: introduce visual changes through the design tokens in `/tokens` (and synced assets in `docs/design-system.md`) instead of ad-hoc values.
- Reuse primitives documented in `docs/design-system.md`, and add new UI primitives to `src/app/prompts/page.tsx` so the gallery stays comprehensive.

## Maintenance Tips
- Regenerate the UI component barrel with `pnpm run regen-ui` after adding, removing, or renaming components (it runs automatically during install, dev, and build).
- Update feature scaffolding exports with `pnpm run regen-feature` when feature modules change.
- Clean caches with `pnpm run clean:artifacts` if `pnpm run guard:artifacts` reports stale `node-compile-cache` or `tsx-*` directories.
- Keep `.env.local` untracked; copy from `.env.example` when setting up local development environments.

## Contribution Expectations
- Follow the branch protection and contribution guidelines in `CONTRIBUTING.md`, including running the full CI suite and using semantic PR titles.
