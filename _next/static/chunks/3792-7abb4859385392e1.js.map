{"version":3,"file":"static/chunks/3792-7abb4859385392e1.js","mappings":"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GAClB,oFCXI,IAAMC,EAAc,CACzB,YACA,mBACA,WACA,UACA,gBACA,gBACA,UACA,aACA,mBACA,mBACA,wBACA,eACA,0BACA,WACA,mBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBACA,aACA,wBACA,kBACA,YACA,uBACA,iBACA,oBACA,eACA,cACA,cACA,yBACA,UACA,gBACA,YACA,uBACA,aACA,wBACA,kBACA,yBACA,aACA,wBACA,kBACA,kBACA,cACA,aACA,cACA,cACA,cACA,cACA,oBACA,cACA,oBACA,WACA,sBACA,cACA,iBACA,oBACA,qBACA,+BACA,gCACA,6BACA,8BACA,oCACA,qCACA,iCACA,kCACA,8BACA,+BACA,qCACA,sCACA,kCACA,mCACA,4BACA,6BACA,mCACA,oCACA,gCACA,iCACA,8BACA,+BACA,qCACA,sCACA,kCACA,mCACA,sCACA,uCACA,mBACD,CAAC,EA6E2B,CAAC,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAG,CAAC,EAExC,CAClB,CAAC,KAAM,CAAEC,SAAU50B,CAAa,CAAC,EAAE,CAAE60B,OAAQ70B,CAAa,CAAC,EAAE,EAAG,CAChE,CAAC,IAAK,CAAE40B,SAAU50B,CAAa,CAAC,EAAE,CAAE60B,OAAQ70B,CAAa,CAAC,EAAG,EAAE,CAC/D,CAAC,IAAK,CAAE40B,SAAU50B,CAAa,CAAC,EAAE,CAAE60B,OAAQ70B,CAAa,CAAC,EAAE,EAAG,CAC/D,CAAC,IAAK,CAAE40B,SAA6B,IAAnB50B,CAAa,CAAC,EAAE,CAAQ60B,OAAQ70B,CAAa,CAAC,EAAG,EAAE,CACtE,CAKK80B,EAGFC,EAAY79B,MAAM,CACpB,CAACC,EAAAA,QAAK,CAACsJ,EAAM,GAKX,OAJAtJ,CAAG,CAACsJ,EAAM,CAAG,CACXm0B,SAAU,mBAAyB,OAANn0B,GAC7Bo0B,OAAQ,iBAAuB,OAANp0B,EAC3B,EACOtJ,CACT,EACA,CAAC,GAMG69B,EAGFD,EAAY79B,MAAM,CACpB,CAACC,EAAAA,QAAK,CAACsJ,EAAO,UA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","sources":["webpack://_N_E/./src/components/planner/PlannerPage.tsx","webpack://_N_E/./src/components/planner/useSelection.ts","webpack://_N_E/./src/components/planner/FocusPanel.tsx","webpack://_N_E/./src/components/planner/useDay.ts","webpack://_N_E/./src/components/planner/TaskRow.module.css","webpack://_N_E/./src/components/planner/DayRow.tsx","webpack://_N_E/./src/components/planner/dayCrud.ts","webpack://_N_E/./src/components/goals/reminders/useReminders.tsx","webpack://_N_E/./src/components/planner/plannerSerialization.ts","webpack://_N_E/./src/lib/types.ts","webpack://_N_E/./src/components/planner/TaskRow.tsx","webpack://_N_E/./src/lib/scheduling/parser.ts","webpack://_N_E/./src/lib/scheduling/index.ts","webpack://_N_E/./src/ai/safety.ts","webpack://_N_E/./src/lib/assistant/plannerAgent.ts","webpack://_N_E/./src/lib/assistant/safe-mode.ts","webpack://_N_E/./src/lib/assistant/plannerAssistantAction.ts","webpack://_N_E/./src/components/planner/PlannerFab.tsx","webpack://_N_E/./src/components/planner/useWeekData.ts","webpack://_N_E/./src/lib/observability/sentry.ts","webpack://_N_E/./src/lib/observability/boundary-error-reporter.ts","webpack://_N_E/./src/components/planner/WeekSummary.tsx","webpack://_N_E/./src/components/planner/plannerContext.tsx","webpack://_N_E/./src/components/planner/index.ts","webpack://_N_E/./src/components/planner/views/AgendaView.tsx","webpack://_N_E/./src/components/planner/TodayHero.tsx","webpack://_N_E/./src/components/planner/views/WeekView.tsx","webpack://_N_E/./src/lib/useAutoFocus.ts","webpack://_N_E/./src/components/planner/WeekPickerShell.tsx","webpack://_N_E/./src/components/home/PortraitFrame.module.css","webpack://_N_E/./src/components/planner/style.css","webpack://_N_E/./src/components/planner/useDayNotes.ts","webpack://_N_E/./src/lib/tokens.ts","webpack://_N_E/./src/components/planner/usePlannerStore.ts","webpack://_N_E/./src/components/planner/PlannerPage.module.css","webpack://_N_E/./src/components/planner/PlannerListPanel.css","webpack://_N_E/./src/components/planner/TaskReminderSettings.tsx","webpack://_N_E/./src/components/planner/useFocusDate.ts","webpack://_N_E/./src/components/planner/WeekNotes.tsx","webpack://_N_E/./src/components/planner/useTodayHeroTasks.ts","webpack://_N_E/./src/components/planner/scheduleSavingReset.ts","webpack://_N_E/./src/components/planner/TodayHeroTasks.tsx","webpack://_N_E/./src/icons/ProgressRingIcon.tsx","webpack://_N_E/./src/components/planner/DayCardHeader.tsx","webpack://_N_E/./src/components/home/PortraitFrame.tsx","webpack://_N_E/./src/components/planner/ScrollTopFloatingButton.tsx","webpack://_N_E/./src/components/planner/TodayHeroProjects.tsx","webpack://_N_E/./src/components/error/ClientErrorBoundary.tsx","webpack://_N_E/./src/components/planner/TodayHeroHeader.tsx","webpack://_N_E/./src/components/planner/WeekPicker.tsx","webpack://_N_E/./src/components/planner/PlannerListPanel.tsx","webpack://_N_E/./tokens/tokens.js","webpack://_N_E/./src/lib/filter-tokens.ts","webpack://_N_E/./src/icons/RingNoiseDefs.tsx","webpack://_N_E/./src/components/planner/ProjectList.tsx","webpack://_N_E/./src/lib/metrics/llmTokens.ts","webpack://_N_E/./src/components/planner/views/DayView.tsx","webpack://_N_E/./src/components/planner/EmptyRow.tsx","webpack://_N_E/./src/components/planner/useDayFocus.ts","webpack://_N_E/./src/components/planner/createDayTextFieldHook.ts","webpack://_N_E/./src/components/goals/goalsPersistence.ts","webpack://_N_E/./src/components/planner/useTodayHeroProjects.ts","webpack://_N_E/./src/components/planner/plannerCrud.ts","webpack://_N_E/./src/lib/date.ts","webpack://_N_E/./src/components/planner/DayCard.tsx","webpack://_N_E/./src/components/planner/TaskList.tsx","webpack://_N_E/./src/components/planner/PlannerIslandBoundary.tsx","webpack://_N_E/./src/components/planner/views/MonthView.tsx"],"sourcesContent":["// src/components/planner/PlannerPage.tsx\n\"use client\";\n\nimport \"./style.css\";\n\n/**\n * PlannerPage  Week header + TodayHero + Focus/Notes + Day list.\n * - Full-width Hero bottom via WeekPicker (uses hero-bleed-row).\n * - 12-col layout: 8 main / 4 aside, aside is sticky.\n * - Day rows are focusable anchors so WeekPicker chips can smooth-scroll to them.\n */\n\nimport * as React from \"react\";\nimport {\n  Button,\n  GlitchSegmentedButton,\n  GlitchSegmentedGroup,\n  PageHeader,\n  PageShell,\n} from \"@/components/ui\";\nimport { PortraitFrame } from \"@/components/home/PortraitFrame\";\nimport ProgressRingIcon from \"@/icons/ProgressRingIcon\";\nimport { usePrefersReducedMotion } from \"@/lib/useReducedMotion\";\nimport { useOptionalTheme } from \"@/lib/theme-context\";\nimport { cn } from \"@/lib/utils\";\nimport styles from \"./PlannerPage.module.css\";\nimport { useFocusDate, useWeek } from \"./useFocusDate\";\nimport { PlannerProvider, usePlanner, type PlannerViewMode } from \"./plannerContext\";\nimport { FOCUS_PLACEHOLDER } from \"./plannerSerialization\";\nimport { WeekPicker } from \"./WeekPicker\";\nimport { CalendarDays } from \"lucide-react\";\nimport { formatWeekRangeLabel } from \"@/lib/date\";\nimport { RemindersProvider } from \"@/components/goals/reminders/useReminders\";\nimport { PlannerIslandBoundary } from \"./PlannerIslandBoundary\";\n\nconst {\n  heroPanel,\n  heroContent,\n  heroText,\n  heroEyebrow,\n  heroHeading,\n  heroSubtitle,\n  heroDial,\n  heroRing,\n  heroRingReduced,\n  heroRingValue,\n  heroRingCaption,\n  heroSliderLabel,\n  heroSlider,\n  heroFeedback,\n  heroActions,\n  heroPortrait,\n} = styles;\n\nconst LazyDayView = React.lazy(async () => ({\n  default: (await import(\"./views/DayView\")).DayView,\n}));\nconst LazyWeekView = React.lazy(async () => ({\n  default: (await import(\"./views/WeekView\")).WeekView,\n}));\nconst LazyMonthView = React.lazy(async () => ({\n  default: (await import(\"./views/MonthView\")).MonthView,\n}));\nconst LazyAgendaView = React.lazy(async () => ({\n  default: (await import(\"./views/AgendaView\")).AgendaView,\n}));\n\nconst VIEW_MODE_OPTIONS: Array<{ value: PlannerViewMode; label: string }> = [\n  { value: \"day\", label: \"Day\" },\n  { value: \"week\", label: \"Week\" },\n  { value: \"month\", label: \"Month\" },\n  { value: \"agenda\", label: \"Agenda\" },\n];\n\nconst VIEW_TAB_ID_BASE = \"planner-view\";\nconst VIEW_COMPONENTS: Record<\n  PlannerViewMode,\n  React.LazyExoticComponent<React.ComponentType>\n> = {\n  day: LazyDayView,\n  week: LazyWeekView,\n  month: LazyMonthView,\n  agenda: LazyAgendaView,\n};\n\ntype PlannerViewFallbackProps = {\n  mode: PlannerViewMode;\n};\n\nconst VIEW_FALLBACK_CONTENT: Record<\n  PlannerViewMode,\n  { title: string; description: string }\n> = {\n  day: {\n    title: \"Loading day planner\",\n    description: \"Syncing today's focus and notes\",\n  },\n  week: {\n    title: \"Loading week overview\",\n    description: \"Pulling the sprint schedule and totals\",\n  },\n  month: {\n    title: \"Loading month planner\",\n    description: \"Rendering the expanded calendar grid\",\n  },\n  agenda: {\n    title: \"Loading agenda\",\n    description: \"Collecting tasks and reminders for the list\",\n  },\n};\n\nfunction PlannerViewFallback({ mode }: PlannerViewFallbackProps) {\n  const copy = VIEW_FALLBACK_CONTENT[mode];\n\n  return (\n    <div\n      role=\"status\"\n      aria-live=\"polite\"\n      className=\"flex min-h-[12rem] flex-col items-center justify-center gap-[var(--space-2)] rounded-lg border border-dashed border-border/60 bg-muted/20 p-[var(--space-6)] text-center text-muted-foreground\"\n    >\n      <span className=\"text-label font-medium tracking-[0.08em] uppercase\">\n        {copy.title}\n      </span>\n      <p className=\"max-w-prose text-subtle\">{copy.description}</p>\n    </div>\n  );\n}\n\n/*  Page body under provider  */\n\nfunction Inner() {\n  const { iso, today } = useFocusDate();\n  const { viewMode, setViewMode } = usePlanner();\n  const { start, end } = useWeek(iso);\n  const hydrating = today === FOCUS_PLACEHOLDER;\n  const themeContext = useOptionalTheme();\n  const themeVariant = themeContext?.[0].variant ?? \"aurora\";\n  const prefersReducedMotion = usePrefersReducedMotion();\n  const [planningEnergy, setPlanningEnergy] = React.useState(72);\n  const weekAnnouncement = React.useMemo(\n    () => (hydrating ? \"Week preview loading\" : formatWeekRangeLabel(start, end)),\n    [end, hydrating, start],\n  );\n  const labelId = React.useId();\n  const sliderId = React.useId();\n  const handleViewModeChange = React.useCallback(\n    (value: string) => {\n      if (value === viewMode) return;\n      setViewMode(value as PlannerViewMode);\n    },\n    [setViewMode, viewMode],\n  );\n\n  const heroPose = React.useMemo(() => {\n    if (themeVariant === \"noir\" || themeVariant === \"hardstuck\") {\n      return \"back-to-back\";\n    }\n    if (themeVariant === \"aurora\" || themeVariant === \"ocean\") {\n      return \"angel-leading\";\n    }\n    return \"demon-leading\";\n  }, [themeVariant]);\n\n  return (\n    <>\n      <PageShell as=\"header\" grid className=\"py-[var(--space-6)]\">\n        <section className={heroPanel} aria-labelledby=\"planner-hero-heading\">\n          <div className={heroContent}>\n            <div className={cn(heroText, \"col-span-full\")}>\n              <span className={heroEyebrow}>Planner autopilot</span>\n              <h2 id=\"planner-hero-heading\" className={heroHeading}>\n                Agnes &amp; Noxi tuned this sprint blueprint\n              </h2>\n              <p className={heroSubtitle}>\n                Tweak the focus dial before locking the week. Agnes maps the calm line, Noxi keeps the glitch guardrails on.\n                Every suggestion stays editable.\n              </p>\n              <div className={heroDial}>\n                <div\n                  className={cn(\n                    heroRing,\n                    prefersReducedMotion && heroRingReduced,\n                  )}\n                >\n                  <ProgressRingIcon pct={planningEnergy} size=\"l\" />\n                  <span className={heroRingValue}>{planningEnergy}%</span>\n                </div>\n                <span className={heroRingCaption}>Focus calibration</span>\n                <label className={heroSliderLabel} htmlFor={sliderId}>\n                  <span className=\"text-label font-medium tracking-[0.08em] uppercase\">\n                    Adjust energy\n                  </span>\n                  <input\n                    id={sliderId}\n                    type=\"range\"\n                    min={20}\n                    max={100}\n                    step={1}\n                    value={planningEnergy}\n                    onChange={(event) => setPlanningEnergy(Number(event.target.value))}\n                    className={heroSlider}\n                    aria-valuemin={20}\n                    aria-valuemax={100}\n                    aria-valuenow={planningEnergy}\n                    aria-describedby={`${sliderId}-feedback`}\n                  />\n                  <span\n                    id={`${sliderId}-feedback`}\n                    className={heroFeedback}\n                    aria-live=\"polite\"\n                  >\n                    {planningEnergy >= 75\n                      ? \"High-intensity push queued.\"\n                      : planningEnergy <= 40\n                        ? \"Keeping a low-impact tempo.\"\n                        : \"Balanced cadence engaged.\"}\n                  </span>\n                </label>\n              </div>\n              <div className={heroActions}>\n                <Button size=\"sm\" variant=\"ghost\" tone=\"accent\">\n                  Retry suggestions\n                </Button>\n                <Button size=\"sm\" variant=\"default\" tone=\"accent\">\n                  Edit draft\n                </Button>\n                <Button size=\"sm\" variant=\"ghost\">\n                  Cancel\n                </Button>\n              </div>\n            </div>\n            <div className={heroPortrait}>\n              <PortraitFrame pose={heroPose} transparentBackground />\n            </div>\n          </div>\n        </section>\n        {/* Week header (range, nav, totals, day chips) */}\n        <PageHeader\n          containerClassName=\"col-span-full\"\n          header={{\n            id: \"planner-header\",\n            tabIndex: -1,\n            eyebrow: \"Planner\",\n            heading: \"Planner for Today\",\n            subtitle: \"Plan your week\",\n            icon: <CalendarDays className=\"opacity-80\" />,\n            sticky: false,\n          }}\n          hero={{\n            sticky: false,\n            heading: \"Week controls\",\n            children: (\n              <>\n                <PlannerIslandBoundary\n                  name=\"planner:week-picker\"\n                  title=\"Week controls unavailable\"\n                  description=\"We hit an error loading the planner controls. Retry to restore the week picker.\"\n                  retryLabel=\"Retry controls\"\n                >\n                  <WeekPicker />\n                </PlannerIslandBoundary>\n                <div aria-live=\"polite\" className=\"sr-only\">\n                  {weekAnnouncement}\n                </div>\n              </>\n            ),\n          }}\n        />\n        <div className=\"col-span-full mt-[var(--space-4)] flex flex-wrap items-center justify-between gap-[var(--space-2)]\">\n          <span\n            id={labelId}\n            className=\"text-label font-medium text-muted-foreground\"\n          >\n            View\n          </span>\n          <GlitchSegmentedGroup\n            value={viewMode}\n            onChange={handleViewModeChange}\n            ariaLabelledby={labelId}\n          >\n            {VIEW_MODE_OPTIONS.map((option) => {\n              const tabId = `${VIEW_TAB_ID_BASE}-${option.value}-tab`;\n              const panelId = `${VIEW_TAB_ID_BASE}-${option.value}-panel`;\n              return (\n                <GlitchSegmentedButton\n                  key={option.value}\n                  value={option.value}\n                  id={tabId}\n                  aria-controls={panelId}\n                >\n                  {option.label}\n                </GlitchSegmentedButton>\n              );\n            })}\n          </GlitchSegmentedGroup>\n        </div>\n      </PageShell>\n\n      {VIEW_MODE_OPTIONS.map((option) => {\n        const tabId = `${VIEW_TAB_ID_BASE}-${option.value}-tab`;\n        const panelId = `${VIEW_TAB_ID_BASE}-${option.value}-panel`;\n        const isActive = viewMode === option.value;\n        const ViewComponent = VIEW_COMPONENTS[option.value];\n\n        return (\n          <div\n            key={option.value}\n            role=\"tabpanel\"\n            id={panelId}\n            aria-labelledby={tabId}\n            hidden={!isActive}\n            tabIndex={isActive ? 0 : -1}\n          >\n            {isActive ? (\n              <React.Suspense fallback={<PlannerViewFallback mode={option.value} />}>\n                <ViewComponent />\n              </React.Suspense>\n            ) : null}\n          </div>\n        );\n      })}\n    </>\n  );\n}\n\n/*  Provider shell  */\n\nexport function PlannerPage() {\n  return (\n    <RemindersProvider>\n      <PlannerProvider>\n        <Inner />\n      </PlannerProvider>\n    </RemindersProvider>\n  );\n}\n","\"use client\";\n\nimport * as React from \"react\";\nimport { useSelection as usePlannerSelection, useDays } from \"./plannerContext\";\nimport type { DayTask, ISODate, Selection } from \"./plannerTypes\";\n\nconst EMPTY_TASK_MAP: Record<string, DayTask> = {};\n\ntype SelectionGetter = (selection: Selection | undefined) => string;\ntype SelectionProducer = (\n  id: string,\n  previous: Selection | undefined,\n) => Selection;\n\ntype SelectionStrategy = {\n  getCurrentId: SelectionGetter;\n  produceSelection: SelectionProducer;\n};\n\nexport function useSelectionState(\n  iso: ISODate,\n  { getCurrentId, produceSelection }: SelectionStrategy,\n): readonly [string, (id: string) => void] {\n  const { selected, setSelected } = usePlannerSelection();\n  const current = getCurrentId(selected[iso]);\n\n  const setId = React.useCallback(\n    (id: string) => {\n      setSelected((prev) => {\n        const previousSelection = prev[iso];\n        const nextSelection = produceSelection(id, previousSelection);\n\n        if (\n          previousSelection &&\n          previousSelection.projectId === nextSelection.projectId &&\n          previousSelection.taskId === nextSelection.taskId\n        ) {\n          return prev;\n        }\n\n        return {\n          ...prev,\n          [iso]: nextSelection,\n        };\n      });\n    },\n    [iso, produceSelection, setSelected],\n  );\n\n  return [current, setId] as const;\n}\n\nconst getProjectId: SelectionGetter = (selection) =>\n  selection?.projectId ?? \"\";\n\nconst produceProjectSelection: SelectionProducer = (projectId) =>\n  projectId ? { projectId } : {};\n\n/**\n * Manages the selected project for a given day.\n * Selecting a project clears any task selection.\n * @param iso - Day ISO string.\n * @returns Tuple of current project ID and setter.\n */\nexport function useSelectedProject(iso: ISODate) {\n  const { days } = useDays();\n  const selection = useSelectionState(iso, {\n    getCurrentId: getProjectId,\n    produceSelection: produceProjectSelection,\n  });\n\n  const [selectedProjectId, setSelectedProjectId] = selection;\n  const dayProjects = days[iso]?.projects;\n\n  React.useEffect(() => {\n    if (!selectedProjectId) return;\n    if (!dayProjects?.some((project) => project.id === selectedProjectId)) {\n      setSelectedProjectId(\"\");\n    }\n  }, [dayProjects, selectedProjectId, setSelectedProjectId]);\n\n  return selection;\n}\n\nconst getTaskId: SelectionGetter = (selection) => selection?.taskId ?? \"\";\n\n/**\n * Manages the selected task for a given day.\n * Selecting a task also tracks its parent project.\n * @param iso - Day ISO string.\n * @returns Tuple of current task ID and setter.\n */\nexport function useSelectedTask(iso: ISODate) {\n  const { days, tasksById } = useDays();\n  const isoTasksById = tasksById[iso] ?? EMPTY_TASK_MAP;\n  const isoDay = days[iso];\n\n  const produceTaskSelection = React.useCallback<SelectionProducer>(\n    (taskId) => {\n      if (!taskId) return {};\n      const task =\n        isoTasksById[taskId] ??\n        isoDay?.tasksById?.[taskId] ??\n        isoDay?.tasks.find((candidate) => candidate.id === taskId);\n      const projectId = task?.projectId;\n      return { taskId, projectId };\n    },\n    [isoTasksById, isoDay],\n  );\n\n  return useSelectionState(iso, {\n    getCurrentId: getTaskId,\n    produceSelection: produceTaskSelection,\n  });\n}\n","// src/components/planner/FocusPanel.tsx\n\"use client\";\n\n/**\n * FocusPanel  focus of the day bound to day.focus (scoped by iso).\n * - Hydration-safe: local state initializes from day.focus, then syncs via effect\n * - No setState loops: setter only fires when the trimmed focus changes\n * - UX: Save disabled when unchanged; auto-saves on blur\n */\n\nimport \"./style.css\";\n\nimport * as React from \"react\";\nimport { SectionCard } from \"@/components/ui/layout/SectionCard\";\nimport { Input } from \"@/components/ui/primitives/Input\";\nimport { Button } from \"@/components/ui/primitives/Button\";\nimport { useDayFocus } from \"./useDayFocus\";\nimport type { ISODate } from \"./plannerTypes\";\n\ntype Props = { iso: ISODate };\n\nexport function FocusPanel({ iso }: Props) {\n  const { value, setValue, saving, isDirty, lastSavedRef, commit } =\n    useDayFocus(iso);\n  const headerId = React.useMemo(() => `focus-${iso}-header`, [iso]);\n\n  const onSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    void commit();\n  };\n\n  return (\n    <SectionCard className=\"card-neo-soft\">\n      <SectionCard.Header\n        id={headerId}\n        title=\"Daily Focus\"\n        titleAs=\"h6\"\n        titleClassName=\"text-title font-semibold tracking-tight\"\n      />\n      <SectionCard.Body>\n        <form onSubmit={onSubmit} className=\"flex items-center gap-[var(--space-2)]\">\n          <Input\n            placeholder=\"Whats the one thing today?\"\n            value={value}\n            onChange={(e) => setValue(e.target.value)}\n            onBlur={commit}                   // Auto-save on blur\n            name={`focus-${iso}`}\n            autoComplete=\"off\"\n            className=\"flex-1\"\n            aria-labelledby={headerId}\n          />\n          <Button\n            type=\"submit\"\n            variant=\"default\"\n            size=\"sm\"\n            disabled={!isDirty || saving}\n            aria-disabled={!isDirty || saving}\n          >\n            {saving ? \"Saving\" : \"Save\"}\n          </Button>\n        </form>\n\n        {/* Subtle status text without yelling at the user */}\n        <div className=\"mt-[var(--space-2)] text-label text-muted-foreground\" aria-live=\"polite\">\n          {saving\n            ? \"Saving changes\"\n            : isDirty\n            ? \"Unsaved changes\"\n            : lastSavedRef.current\n            ? \"All changes saved\"\n            : \"No focus set yet\"}\n        </div>\n      </SectionCard.Body>\n    </SectionCard>\n  );\n}\n","\"use client\";\n\nimport * as React from \"react\";\nimport { ensureDay } from \"./plannerSerialization\";\nimport type { ISODate } from \"./plannerTypes\";\nimport { makeCrud } from \"./plannerCrud\";\nimport { usePlannerStore } from \"./usePlannerStore\";\n\nexport function useDay(iso: ISODate) {\n  const { days, upsertDay } = usePlannerStore();\n\n  const rec = React.useMemo(() => ensureDay(days, iso), [days, iso]);\n\n  const tasks = rec.tasks;\n  const tasksById = rec.tasksById;\n  const tasksByProject = rec.tasksByProject;\n\n  const crud = React.useMemo(() => makeCrud(iso, upsertDay), [iso, upsertDay]);\n  const doneCount = rec.doneCount;\n  const totalCount = rec.totalCount;\n\n  return {\n    projects: rec.projects,\n    tasks,\n    tasksById,\n    tasksByProject,\n    addProject: crud.addProject,\n    renameProject: crud.renameProject,\n    deleteProject: crud.removeProject,\n    toggleProject: crud.toggleProject,\n    addTask: crud.addTask,\n    renameTask: crud.renameTask,\n    deleteTask: crud.removeTask,\n    toggleTask: crud.toggleTask,\n    addTaskImage: crud.addTaskImage,\n    removeTaskImage: crud.removeTaskImage,\n    updateTaskReminder: crud.updateTaskReminder,\n    doneCount,\n    totalCount,\n  } as const;\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"thumbnail\":\"TaskRow_thumbnail__MRf_B\"};","import * as React from \"react\";\nimport { DayCard } from \"./DayCard\";\nimport type { ISODate } from \"./plannerTypes\";\n\ntype DayRowProps = { iso: ISODate; isToday: boolean };\n\nconst DayRow = React.memo(\n  function DayRow({ iso, isToday }: DayRowProps) {\n    return (\n      <li\n        id={`day-${iso}`}\n        aria-label={`Day ${iso}${isToday ? \" (Today)\" : \"\"}`}\n        className=\"w-full scroll-m-[calc(var(--space-8)+var(--space-6))] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring\"\n        tabIndex={0}\n      >\n        <DayCard iso={iso} isToday={isToday} />\n      </li>\n    );\n  },\n  (a: Readonly<DayRowProps>, b: Readonly<DayRowProps>) =>\n    a.iso === b.iso && a.isToday === b.isToday,\n);\nexport { DayRow };\n","import type { DayRecord, TaskReminder } from \"./plannerTypes\";\nimport {\n  buildTaskLookups,\n  computeDayCounts,\n  sanitizeTaskReminder,\n  taskRemindersEqual,\n} from \"./plannerSerialization\";\n\ntype DayUpdates = Partial<\n  Pick<\n    DayRecord,\n    \"projects\" | \"tasks\" | \"tasksById\" | \"tasksByProject\" | \"focus\" | \"notes\"\n  >\n>;\n\nfunction finalizeDay(day: DayRecord, updates: DayUpdates = {}) {\n  const projects = updates.projects ?? day.projects;\n  const hasTaskUpdate = Object.prototype.hasOwnProperty.call(updates, \"tasks\");\n  const tasks = hasTaskUpdate ? updates.tasks ?? day.tasks : day.tasks;\n  let tasksById = day.tasksById ?? {};\n  let tasksByProject = day.tasksByProject ?? {};\n\n  if (hasTaskUpdate) {\n    const lookups = buildTaskLookups(tasks);\n    tasksById = lookups.tasksById;\n    tasksByProject = lookups.tasksByProject;\n  } else {\n    if (Object.prototype.hasOwnProperty.call(updates, \"tasksById\")) {\n      tasksById = updates.tasksById ?? {};\n    }\n    if (Object.prototype.hasOwnProperty.call(updates, \"tasksByProject\")) {\n      tasksByProject = updates.tasksByProject ?? {};\n    }\n  }\n  const { doneCount, totalCount } = computeDayCounts(projects, tasks);\n  return {\n    ...day,\n    ...updates,\n    projects,\n    tasks,\n    tasksById,\n    tasksByProject,\n    doneCount,\n    totalCount,\n  };\n}\n\nexport function addProject(day: DayRecord, id: string, name: string) {\n  const title = name.trim();\n  if (!title) return day;\n  const createdAt = Date.now();\n  const projects = [\n    ...day.projects,\n    { id, name: title, done: false, createdAt },\n  ];\n  return finalizeDay(day, { projects });\n}\n\nexport function renameProject(day: DayRecord, id: string, name: string) {\n  const title = name.trim();\n  if (!title) return day;\n  const project = day.projects.find((p) => p.id === id);\n  if (!project || project.name === title) return day;\n  return finalizeDay(day, {\n    projects: day.projects.map((p) =>\n      p.id === id ? { ...p, name: title } : p,\n    ),\n  });\n}\n\nexport function toggleProject(day: DayRecord, id: string) {\n  const wasDone = day.projects.find((p) => p.id === id)?.done ?? false;\n  const projects = day.projects.map((p) =>\n    p.id === id ? { ...p, done: !wasDone } : p,\n  );\n  const tasks = day.tasks.map((t) =>\n    t.projectId === id ? { ...t, done: !wasDone } : t,\n  );\n  return finalizeDay(day, { projects, tasks });\n}\n\nexport function removeProject(day: DayRecord, id: string) {\n  return finalizeDay(day, {\n    projects: day.projects.filter((p) => p.id !== id),\n    tasks: day.tasks.filter((t) => t.projectId !== id),\n  });\n}\n\nexport function addTask(\n  day: DayRecord,\n  id: string,\n  title: string,\n  projectId?: string,\n) {\n  const name = title.trim();\n  if (!name) return day;\n  const createdAt = Date.now();\n  const tasks = [\n    ...day.tasks,\n    { id, title: name, done: false, projectId, createdAt, images: [] },\n  ];\n  return finalizeDay(day, { tasks });\n}\n\nexport function renameTask(day: DayRecord, id: string, next: string) {\n  const title = next.trim();\n  if (!title) return day;\n  const task = day.tasks.find((t) => t.id === id);\n  if (!task || task.title === title) return day;\n  return finalizeDay(day, {\n    tasks: day.tasks.map((t) => (t.id === id ? { ...t, title } : t)),\n  });\n}\n\nexport function toggleTask(day: DayRecord, id: string) {\n  return finalizeDay(day, {\n    tasks: day.tasks.map((t) => (t.id === id ? { ...t, done: !t.done } : t)),\n  });\n}\n\nexport function removeTask(day: DayRecord, id: string) {\n  return finalizeDay(day, {\n    tasks: day.tasks.filter((t) => t.id !== id),\n  });\n}\n\nexport function updateTaskReminder(\n  day: DayRecord,\n  id: string,\n  partial: Partial<TaskReminder> | null,\n) {\n  let changed = false;\n\n  const tasks = day.tasks.map((t) => {\n    if (t.id !== id) return t;\n\n    if (partial === null) {\n      if (!t.reminder) return t;\n      changed = true;\n      const rest = { ...t };\n      delete rest.reminder;\n      return rest;\n    }\n\n    const base = t.reminder ?? {};\n    const nextReminder = sanitizeTaskReminder({ ...base, ...partial });\n\n    if (taskRemindersEqual(t.reminder, nextReminder)) {\n      return t;\n    }\n\n    changed = true;\n\n    if (!nextReminder) {\n      const rest = { ...t };\n      delete rest.reminder;\n      return rest;\n    }\n\n    return { ...t, reminder: nextReminder };\n  });\n\n  if (!changed) return day;\n\n  return finalizeDay(day, { tasks });\n}\n\nexport function addTaskImage(day: DayRecord, id: string, url: string) {\n  const u = url.trim();\n  if (!u) return day;\n  return finalizeDay(day, {\n    tasks: day.tasks.map((t) =>\n      t.id === id ? { ...t, images: [...t.images, u] } : t,\n    ),\n  });\n}\n\nexport function removeTaskImage(\n  day: DayRecord,\n  id: string,\n  url: string,\n  imageIndex?: number,\n) {\n  return finalizeDay(day, {\n    tasks: day.tasks.map((t) => {\n      if (t.id !== id) return t;\n\n      const indexToRemove =\n        imageIndex !== undefined && t.images[imageIndex] === url\n          ? imageIndex\n          : t.images.indexOf(url);\n\n      if (indexToRemove < 0) return t;\n\n      const images = t.images.slice();\n      images.splice(indexToRemove, 1);\n      return { ...t, images };\n    }),\n  });\n}\n","\"use client\";\n\nimport * as React from \"react\";\nimport { uid, usePersistentState } from \"@/lib/db\";\n\nexport type Domain = \"Life\" | \"League\" | \"Learn\";\nexport type Source = \"MLA\" | \"BLA\" | \"BrokenByConcept\" | \"Custom\";\nexport type Group = \"quick\" | \"pregame\" | \"laning\" | \"trading\" | \"tempo\" | \"review\";\n\nexport type Reminder = {\n  id: string;\n  title: string;\n  body?: string;\n  tags: string[];\n  source: Source;\n  group: Group;\n  pinned?: boolean;\n  domain?: Domain;\n  createdAt: number;\n  updatedAt: number;\n};\n\nconst STORE_KEY = \"goals.reminders.v4\";\n\nfunction createReminder(\n  title: string,\n  body: string,\n  tags: string[],\n  source: Source,\n  group: Group,\n  pinned = false,\n  domain?: Domain,\n): Reminder {\n  const now = Date.now();\n  return {\n    id: uid(\"rem\"),\n    title,\n    body,\n    tags,\n    source,\n    group,\n    pinned,\n    domain,\n    createdAt: now,\n    updatedAt: now,\n  };\n}\n\nconst SEEDS: Reminder[] = [\n  createReminder(\n    \"Hit 2 first\",\n    \"Push 3 melees  step up or respect if losing push.\",\n    [],\n    \"BLA\",\n    \"quick\",\n    true,\n    \"Learn\",\n  ),\n  createReminder(\n    \"Jungle start check\",\n    \"Track start  first gank lane  second spawn prio.\",\n    [],\n    \"BrokenByConcept\",\n    \"quick\",\n    true,\n    \"Learn\",\n  ),\n  createReminder(\n    \"3-wave plan\",\n    \"Say it: slow then crash 3 OR hold then thin/freeze.\",\n    [],\n    \"MLA\",\n    \"pregame\",\n    false,\n    \"League\",\n  ),\n  createReminder(\n    \"Ward 2:30\",\n    \"River/tri at 2:30. Sweep before shove.\",\n    [],\n    \"BrokenByConcept\",\n    \"pregame\",\n    false,\n    \"Learn\",\n  ),\n  createReminder(\n    \"Space with casters\",\n    \"Trade when your casters live; back off on enemy wave.\",\n    [],\n    \"MLA\",\n    \"laning\",\n    false,\n    \"League\",\n  ),\n  createReminder(\n    \"CD punish\",\n    \"Trade on enemy cooldown gaps; track sums.\",\n    [],\n    \"MLA\",\n    \"trading\",\n    false,\n    \"League\",\n  ),\n  createReminder(\n    \"Good recall\",\n    \"Shove  recall on spike  arrive first to river.\",\n    [],\n    \"BrokenByConcept\",\n    \"tempo\",\n    false,\n    \"Learn\",\n  ),\n  createReminder(\n    \"Death audit\",\n    \"Wave, vision, jungle, greed. Name the fix.\",\n    [],\n    \"BLA\",\n    \"review\",\n    false,\n    \"Learn\",\n  ),\n];\n\nexport const GROUPS: Array<{ key: Group; label: string; hint?: string }> = [\n  { key: \"quick\", label: \"Quick\", hint: \"Pin-worthy\" },\n  { key: \"pregame\", label: \"Pre-Game\", hint: \"Before queue\" },\n  { key: \"laning\", label: \"Laning\", hint: \"Wave & trades\" },\n  { key: \"trading\", label: \"Trading\", hint: \"Windows & sums\" },\n  { key: \"tempo\", label: \"Tempo\", hint: \"Recall & prio\" },\n  { key: \"review\", label: \"Review\", hint: \"After game\" },\n];\n\nconst SOURCE_FILTERS = [\n  \"all\",\n  \"MLA\",\n  \"BLA\",\n  \"BrokenByConcept\",\n  \"Custom\",\n] as const;\n\nexport type SourceFilter = (typeof SOURCE_FILTERS)[number];\n\nconst SOURCE_TABS = SOURCE_FILTERS.map((s) => ({\n  key: s,\n  label: s === \"all\" ? \"All\" : s,\n}));\n\nconst normalizeTitle = (value: string) => value.trim().toLowerCase();\n\nfunction makeUniqueTitle(base: string, reminders: Reminder[]) {\n  let suffix = 2;\n  let candidate = `${base} (${suffix})`;\n  while (\n    reminders.some(\n      (reminder) => normalizeTitle(reminder.title) === normalizeTitle(candidate),\n    )\n  ) {\n    suffix += 1;\n    candidate = `${base} (${suffix})`;\n  }\n  return candidate;\n}\n\nexport type RemindersContextValue = {\n  items: Reminder[];\n  filtered: Reminder[];\n  counts: Record<Group, number>;\n  domain: Domain;\n  setDomain: (value: Domain) => void;\n  group: Group;\n  setGroup: (value: Group) => void;\n  source: SourceFilter;\n  setSource: (value: SourceFilter) => void;\n  query: string;\n  setQuery: (value: string) => void;\n  onlyPinned: boolean;\n  setOnlyPinned: (value: boolean) => void;\n  quickAdd: string;\n  setQuickAdd: (value: string) => void;\n  quickAddError: string | null;\n  clearQuickAddError: () => void;\n  setQuickAddError: (message: string) => void;\n  showFilters: boolean;\n  setShowFilters: (value: boolean) => void;\n  addReminder: (initialTitle?: string) => boolean;\n  updateReminder: (id: string, partial: Partial<Reminder>) => void;\n  removeReminder: (id: string) => void;\n  toggleFilters: () => void;\n  togglePinned: () => void;\n  showGroups: boolean;\n  neonClass: string;\n  groupTabs: Array<{ key: Group; label: string; badge: number }>;\n  sourceTabs: typeof SOURCE_TABS;\n  groups: typeof GROUPS;\n};\n\nexport const RemindersContext = React.createContext<RemindersContextValue | null>(\n  null,\n);\n\nfunction inferDomain(reminder: Reminder): Domain {\n  if (reminder.domain) return reminder.domain;\n  return reminder.source === \"BLA\" || reminder.source === \"BrokenByConcept\"\n    ? \"Learn\"\n    : \"League\";\n}\n\n// Consolidated domain filtering so derived selectors share the same logic.\nfunction filterRemindersByDomain(\n  reminders: Reminder[],\n  domain: Domain,\n): Reminder[] {\n  return reminders.filter((reminder) => inferDomain(reminder) === domain);\n}\n\nfunction useRemindersState(): RemindersContextValue {\n  const [items, setItems] = usePersistentState<Reminder[]>(STORE_KEY, SEEDS);\n  const [query, setQuery] = React.useState(\"\");\n  const [onlyPinned, setOnlyPinned] = React.useState(false);\n  const [domain, setDomain] = usePersistentState<Domain>(\n    \"goals.reminders.domain.v2\",\n    \"League\",\n  );\n  const [group, setGroup] = usePersistentState<Group>(\n    \"goals.reminders.group.v1\",\n    \"quick\",\n  );\n  const [source, setSource] = usePersistentState<SourceFilter>(\n    \"goals.reminders.source.v1\",\n    \"all\",\n  );\n  const [quickAdd, setQuickAdd] = React.useState(\"\");\n  const [quickAddError, setQuickAddErrorState] = React.useState<string | null>(null);\n  const [showFilters, setShowFilters] = React.useState(false);\n  const showGroups = domain === \"League\" || domain === \"Learn\";\n\n  const domainItems = React.useMemo(\n    () => filterRemindersByDomain(items, domain),\n    [items, domain],\n  );\n\n  const clearQuickAddError = React.useCallback(() => {\n    setQuickAddErrorState(null);\n  }, [setQuickAddErrorState]);\n\n  const reportQuickAddError = React.useCallback(\n    (message: string) => {\n      setQuickAddErrorState(message);\n    },\n    [setQuickAddErrorState],\n  );\n\n  const counts = React.useMemo(() => {\n    return domainItems.reduce(\n      (acc, reminder) => {\n        acc[reminder.group] = (acc[reminder.group] ?? 0) + 1;\n        return acc;\n      },\n      {\n        quick: 0,\n        pregame: 0,\n        laning: 0,\n        trading: 0,\n        tempo: 0,\n        review: 0,\n      } as Record<Group, number>,\n    );\n  }, [domainItems]);\n\n  const filtered = React.useMemo(() => {\n    const q = query.trim().toLowerCase();\n    return domainItems\n      .filter((reminder) => (showGroups ? reminder.group === group : true))\n      .filter((reminder) => (source === \"all\" ? true : reminder.source === source))\n      .filter((reminder) => (onlyPinned ? reminder.pinned : true))\n      .filter((reminder) => {\n        if (!q) return true;\n        const haystack = [\n          reminder.title,\n          reminder.body ?? \"\",\n          reminder.tags.join(\" \"),\n          reminder.source,\n          reminder.group,\n        ]\n          .join(\" \")\n          .toLowerCase();\n        return haystack.includes(q);\n      })\n      .sort((a, b) => {\n        if (!!b.pinned === !!a.pinned) return b.updatedAt - a.updatedAt;\n        return Number(b.pinned) - Number(a.pinned);\n      });\n  }, [domainItems, group, source, onlyPinned, query, showGroups]);\n\n  const addReminder = React.useCallback(\n    (initialTitle?: string) => {\n      let added = false;\n      setItems((prev) => {\n        const now = Date.now();\n        const baseTitle = (initialTitle ?? \"New reminder\").trim() || \"New reminder\";\n        const domainScoped = filterRemindersByDomain(prev, domain);\n        const hasDuplicate = domainScoped.some(\n          (reminder) => normalizeTitle(reminder.title) === normalizeTitle(baseTitle),\n        );\n\n        if (hasDuplicate && initialTitle) {\n          reportQuickAddError(\"Reminder already exists.\");\n          setQuickAdd((prevValue) => prevValue.trim());\n          return prev;\n        }\n\n        const title = hasDuplicate\n          ? makeUniqueTitle(baseTitle, domainScoped)\n          : baseTitle;\n\n        const next: Reminder = {\n          id: uid(\"rem\"),\n          title,\n          body: \"\",\n          tags: [],\n          source: domain === \"Learn\" ? \"BLA\" : \"Custom\",\n          group,\n          domain,\n          pinned: group === \"quick\",\n          createdAt: now,\n          updatedAt: now,\n        };\n\n        clearQuickAddError();\n        added = true;\n        return [next, ...prev];\n      });\n      if (added) {\n        setQuickAdd(\"\");\n      }\n      return added;\n    },\n    [domain, group, setItems, setQuickAdd, clearQuickAddError, reportQuickAddError],\n  );\n\n  const updateReminder = React.useCallback(\n    (id: string, partial: Partial<Reminder>) => {\n      setItems((prev) =>\n        prev.map((reminder) =>\n          reminder.id === id\n            ? { ...reminder, ...partial, updatedAt: Date.now() }\n            : reminder,\n        ),\n      );\n    },\n    [setItems],\n  );\n\n  const removeReminder = React.useCallback(\n    (id: string) => {\n      setItems((prev) => prev.filter((reminder) => reminder.id !== id));\n    },\n    [setItems],\n  );\n\n  const toggleFilters = React.useCallback(() => {\n    setShowFilters((prev) => !prev);\n  }, [setShowFilters]);\n\n  const togglePinned = React.useCallback(() => {\n    setOnlyPinned((prev) => !prev);\n  }, [setOnlyPinned]);\n\n  const neonClass = domain === \"Life\" ? \"neon-life\" : \"neon-primary\";\n\n  const groupTabs = React.useMemo(\n    () => GROUPS.map((groupItem) => ({\n      key: groupItem.key,\n      label: groupItem.label,\n      badge: counts[groupItem.key],\n    })),\n    [counts],\n  );\n\n  return React.useMemo(\n    () => ({\n      items,\n      filtered,\n      counts,\n      domain,\n      setDomain,\n      group,\n      setGroup,\n      source,\n      setSource,\n      query,\n      setQuery,\n      onlyPinned,\n      setOnlyPinned,\n      quickAdd,\n      setQuickAdd,\n      quickAddError,\n      clearQuickAddError,\n      setQuickAddError: reportQuickAddError,\n      showFilters,\n      setShowFilters,\n      addReminder,\n      updateReminder,\n      removeReminder,\n      toggleFilters,\n      togglePinned,\n      showGroups,\n      neonClass,\n      groupTabs,\n      sourceTabs: SOURCE_TABS,\n      groups: GROUPS,\n    }),\n    [\n      items,\n      filtered,\n      counts,\n      domain,\n      setDomain,\n      group,\n      setGroup,\n      source,\n      setSource,\n      query,\n      setQuery,\n      onlyPinned,\n      setOnlyPinned,\n      quickAdd,\n      setQuickAdd,\n      quickAddError,\n      clearQuickAddError,\n      reportQuickAddError,\n      showFilters,\n      setShowFilters,\n      addReminder,\n      updateReminder,\n      removeReminder,\n      toggleFilters,\n      togglePinned,\n      showGroups,\n      neonClass,\n      groupTabs,\n    ],\n  );\n}\n\ntype RemindersProviderProps = {\n  children: React.ReactNode;\n};\n\nexport function RemindersProvider({ children }: RemindersProviderProps) {\n  const value = useRemindersState();\n  return <RemindersContext.Provider value={value}>{children}</RemindersContext.Provider>;\n}\n\nexport function useReminders(): RemindersContextValue {\n  const context = React.useContext(RemindersContext);\n  if (!context) {\n    throw new Error(\"useReminders must be used within a RemindersProvider\");\n  }\n  return context;\n}\n\n","import { fromISODate, toISODate } from \"@/lib/date\";\nimport type {\n  DayRecord,\n  DayTask,\n  ISODate,\n  Project,\n  TaskReminder,\n} from \"./plannerTypes\";\n\nconst TIME_24H_REGEX = /^(?:[01]\\d|2[0-3]):[0-5]\\d$/;\n\nexport function sanitizeTaskReminder(\n  reminder: Partial<TaskReminder> | TaskReminder | null | undefined,\n): TaskReminder | undefined {\n  if (!reminder) return undefined;\n\n  const rawReminderId = reminder.reminderId;\n  const reminderId =\n    typeof rawReminderId === \"string\" && rawReminderId.trim().length > 0\n      ? rawReminderId.trim()\n      : undefined;\n\n  const rawTime = reminder.time;\n  const time =\n    typeof rawTime === \"string\" && TIME_24H_REGEX.test(rawTime)\n      ? rawTime\n      : undefined;\n\n  const rawLead = reminder.leadMinutes;\n  const leadMinutes =\n    typeof rawLead === \"number\" && Number.isFinite(rawLead) && rawLead >= 0\n      ? Math.min(24 * 60, Math.round(rawLead))\n      : undefined;\n\n  const hasEnabled = typeof reminder.enabled === \"boolean\";\n  const enabled = hasEnabled\n    ? reminder.enabled === true\n    : Boolean(reminderId || time || leadMinutes !== undefined);\n\n  if (!enabled && !reminderId && !time && leadMinutes === undefined) {\n    return undefined;\n  }\n\n  return {\n    enabled,\n    ...(reminderId ? { reminderId } : {}),\n    ...(time ? { time } : {}),\n    ...(leadMinutes !== undefined ? { leadMinutes } : {}),\n  } satisfies TaskReminder;\n}\n\nexport function taskRemindersEqual(\n  a?: TaskReminder,\n  b?: TaskReminder,\n): boolean {\n  if (a === b) return true;\n  if (!a || !b) return false;\n  return (\n    a.enabled === b.enabled &&\n    (a.reminderId ?? undefined) === (b.reminderId ?? undefined) &&\n    (a.time ?? undefined) === (b.time ?? undefined) &&\n    (a.leadMinutes ?? undefined) === (b.leadMinutes ?? undefined)\n  );\n}\n\nfunction isRecord(value: unknown): value is Record<string, unknown> {\n  return typeof value === \"object\" && value !== null && !Array.isArray(value);\n}\n\nfunction decodeImages(value: unknown): string[] {\n  if (!Array.isArray(value)) return [];\n  const result: string[] = [];\n  for (const item of value) {\n    if (typeof item === \"string\") result.push(item);\n  }\n  return result;\n}\n\nfunction decodeProject(value: unknown): Project | null {\n  if (!isRecord(value)) return null;\n  const id = value[\"id\"];\n  const name = value[\"name\"];\n  const done = value[\"done\"];\n  const createdAt = value[\"createdAt\"];\n  if (typeof id !== \"string\") return null;\n  if (typeof name !== \"string\") return null;\n  if (typeof done !== \"boolean\") return null;\n  if (typeof createdAt !== \"number\" || !Number.isFinite(createdAt)) return null;\n  const disabled = value[\"disabled\"];\n  const loading = value[\"loading\"];\n  return {\n    id,\n    name,\n    done,\n    createdAt,\n    ...(typeof disabled === \"boolean\" ? { disabled } : {}),\n    ...(typeof loading === \"boolean\" ? { loading } : {}),\n  };\n}\n\nfunction decodeTask(value: unknown): DayTask | null {\n  if (!isRecord(value)) return null;\n  const id = value[\"id\"];\n  const title = value[\"title\"];\n  const done = value[\"done\"];\n  const createdAt = value[\"createdAt\"];\n  if (typeof id !== \"string\") return null;\n  if (typeof title !== \"string\") return null;\n  if (typeof done !== \"boolean\") return null;\n  if (typeof createdAt !== \"number\" || !Number.isFinite(createdAt)) return null;\n  const projectId = value[\"projectId\"];\n  const images = decodeImages(value[\"images\"]);\n  const rawReminder = value[\"reminder\"];\n  const reminder = sanitizeTaskReminder(\n    isRecord(rawReminder)\n      ? (rawReminder as Partial<TaskReminder>)\n      : undefined,\n  );\n  return {\n    id,\n    title,\n    done,\n    createdAt,\n    ...(typeof projectId === \"string\" ? { projectId } : {}),\n    images,\n    ...(reminder ? { reminder } : {}),\n  };\n}\n\nfunction decodeDayRecord(value: unknown): DayRecord | null {\n  if (!isRecord(value)) return null;\n  const rawProjects = value[\"projects\"];\n  const rawTasks = value[\"tasks\"];\n  const projects = Array.isArray(rawProjects)\n    ? rawProjects.map(decodeProject).filter((p): p is Project => p !== null)\n    : [];\n  const tasks = Array.isArray(rawTasks)\n    ? rawTasks.map(decodeTask).filter((t): t is DayTask => t !== null)\n    : [];\n  const { tasksById, tasksByProject } = buildTaskLookups(tasks);\n  const { doneCount, totalCount } = computeDayCounts(projects, tasks);\n  const focusValue = value[\"focus\"];\n  const notesValue = value[\"notes\"];\n  const hasFocus = typeof focusValue === \"string\";\n  const hasNotes = typeof notesValue === \"string\";\n  if (!projects.length && !tasks.length && !hasFocus && !hasNotes) {\n    return null;\n  }\n  const day: DayRecord = {\n    projects,\n    tasks,\n    tasksById,\n    tasksByProject,\n    doneCount,\n    totalCount,\n  };\n  if (hasFocus) day.focus = focusValue as string;\n  if (hasNotes) day.notes = notesValue as string;\n  return day;\n}\n\nexport function decodePlannerDays(value: unknown): Record<ISODate, DayRecord> {\n  if (!isRecord(value)) return {};\n  const result: Record<ISODate, DayRecord> = {};\n  for (const [iso, rawDay] of Object.entries(value)) {\n    const decoded = decodeDayRecord(rawDay);\n    if (!decoded) continue;\n    result[iso as ISODate] = decoded;\n  }\n  return result;\n}\n\nexport const FOCUS_PLACEHOLDER: ISODate = \"\";\n\n/**\n * Deterministic ISO date used while hydrating to keep SSR markup stable.\n * Chosen as a Monday so week computations remain consistent.\n */\nexport const HYDRATION_TODAY: ISODate = \"2000-01-03\";\n\nexport function decodePlannerFocus(value: unknown): ISODate | null {\n  if (typeof value !== \"string\") return null;\n  if (value === FOCUS_PLACEHOLDER) return value as ISODate;\n  return fromISODate(value) ? (value as ISODate) : null;\n}\n\nexport const DEFAULT_MAX_DAY_AGE_DAYS = 365;\n\nexport type PruneOldDaysOptions = {\n  maxAgeDays?: number;\n  now?: Date | number | string;\n};\n\nexport type PruneOldDaysReport = {\n  days: Record<ISODate, DayRecord>;\n  pruned?: ISODate[];\n};\n\nexport function pruneOldDays(\n  days: Record<ISODate, DayRecord>,\n  options: PruneOldDaysOptions = {},\n): PruneOldDaysReport {\n  const { maxAgeDays = DEFAULT_MAX_DAY_AGE_DAYS, now } = options;\n  const normalizedMaxAge = Math.floor(maxAgeDays);\n  if (!Number.isFinite(normalizedMaxAge) || normalizedMaxAge < 0) {\n    return { days, pruned: undefined };\n  }\n\n  let reference: Date;\n  if (now === undefined) {\n    reference = new Date();\n  } else if (typeof now === \"string\") {\n    reference = fromISODate(now) ?? new Date(now);\n  } else {\n    reference = new Date(now);\n  }\n  if (Number.isNaN(reference.getTime())) {\n    return { days, pruned: undefined };\n  }\n\n  const cutoff = new Date(reference.getTime());\n  cutoff.setDate(cutoff.getDate() - normalizedMaxAge);\n  cutoff.setHours(0, 0, 0, 0);\n  const cutoffTime = cutoff.getTime();\n  const ceiling = new Date(reference.getTime());\n  ceiling.setHours(23, 59, 59, 999);\n  const ceilingTime = ceiling.getTime();\n\n  const keys = Object.keys(days);\n  if (!keys.length) {\n    return { days, pruned: undefined };\n  }\n\n  type ParsedEntry = { iso: ISODate; time: number | null };\n  const parsed: ParsedEntry[] = [];\n  let hasValid = false;\n  let oldestTime = Number.POSITIVE_INFINITY;\n  let newestTime = Number.NEGATIVE_INFINITY;\n\n  for (const key of keys) {\n    const isoDate = fromISODate(key);\n    if (!isoDate) {\n      parsed.push({ iso: key as ISODate, time: null });\n      continue;\n    }\n    const time = isoDate.getTime();\n    parsed.push({ iso: key as ISODate, time });\n    hasValid = true;\n    if (time < oldestTime) {\n      oldestTime = time;\n    }\n    if (time > newestTime) {\n      newestTime = time;\n    }\n  }\n\n  if (hasValid && oldestTime >= cutoffTime && newestTime <= ceilingTime) {\n    return { days, pruned: undefined };\n  }\n\n  let result = days;\n  let mutated = false;\n  let pruned: ISODate[] | undefined;\n\n  for (const { iso, time } of parsed) {\n    if (time === null || time >= cutoffTime) {\n      continue;\n    }\n    if (!mutated) {\n      mutated = true;\n      result = { ...days };\n    }\n    delete result[iso];\n    (pruned ??= []).push(iso);\n  }\n\n  if (!mutated) {\n    return { days, pruned: undefined };\n  }\n\n  return { days: result, pruned };\n}\n\nexport function todayISO(): ISODate {\n  return toISODate(new Date());\n}\n\nexport function computeDayCounts(projects: Project[], tasks: DayTask[]) {\n  let doneCount = 0;\n  let totalCount = 0;\n  for (const project of projects) {\n    totalCount += 1;\n    if (project.done) doneCount += 1;\n  }\n  for (const task of tasks) {\n    totalCount += 1;\n    if (task.done) doneCount += 1;\n  }\n  return { doneCount, totalCount };\n}\n\nexport function buildTaskLookups(tasks: DayTask[]) {\n  const tasksByProject: Record<string, string[]> = {};\n  const tasksById: Record<string, DayTask> = {};\n  for (const task of tasks) {\n    tasksById[task.id] = task;\n    const projectId = task.projectId;\n    if (!projectId) continue;\n    (tasksByProject[projectId] ??= []).push(task.id);\n  }\n  return { tasksById, tasksByProject };\n}\n\nfunction taskMapsEqual(a: Record<string, DayTask>, b: Record<string, DayTask>) {\n  const aKeys = Object.keys(a);\n  const bKeys = Object.keys(b);\n  if (aKeys.length !== bKeys.length) return false;\n  for (const key of aKeys) {\n    if (!Object.prototype.hasOwnProperty.call(b, key)) return false;\n    if (a[key] !== b[key]) return false;\n  }\n  return true;\n}\n\nfunction projectMapsEqual(\n  a: Record<string, string[]>,\n  b: Record<string, string[]>,\n) {\n  const aKeys = Object.keys(a);\n  const bKeys = Object.keys(b);\n  if (aKeys.length !== bKeys.length) return false;\n  for (const key of aKeys) {\n    const arrA = a[key] ?? [];\n    const arrB = b[key];\n    if (!arrB || arrA.length !== arrB.length) return false;\n    for (let i = 0; i < arrA.length; i += 1) {\n      if (arrA[i] !== arrB[i]) return false;\n    }\n  }\n  return true;\n}\n\nexport function ensureDay(map: Record<ISODate, DayRecord>, date: ISODate): DayRecord {\n  const existing = map[date];\n  if (!existing)\n    return {\n      projects: [],\n      tasks: [],\n      tasksById: {},\n      tasksByProject: {},\n      doneCount: 0,\n      totalCount: 0,\n    };\n  let tasks = existing.tasks;\n  let tasksChanged = false;\n\n  for (let i = 0; i < tasks.length; i += 1) {\n    const task = tasks[i];\n    let nextTask = task;\n    let mutatedTask = false;\n\n    const rawImages = (task as { images: unknown }).images;\n    const hasValidImages =\n      Array.isArray(rawImages) &&\n      rawImages.every((image) => typeof image === \"string\");\n\n    if (!hasValidImages) {\n      const normalizedImages = decodeImages(rawImages);\n      mutatedTask = true;\n      nextTask = { ...nextTask, images: normalizedImages };\n    }\n\n    const normalizedReminder = sanitizeTaskReminder(task.reminder);\n    if (!taskRemindersEqual(task.reminder, normalizedReminder)) {\n      mutatedTask = true;\n      if (normalizedReminder) {\n        nextTask = { ...nextTask, reminder: normalizedReminder };\n      } else {\n        const rest: DayTask = { ...nextTask };\n        delete rest.reminder;\n        nextTask = rest;\n      }\n    }\n\n    if (!mutatedTask) continue;\n\n    if (!tasksChanged) {\n      tasksChanged = true;\n      tasks = tasks.slice();\n    }\n\n    tasks[i] = nextTask;\n  }\n\n  const { tasksById: nextTasksById, tasksByProject: nextTasksByProject } =\n    buildTaskLookups(tasks);\n\n  const baseTasksByProject = existing.tasksByProject ?? {};\n  const baseTasksById = existing.tasksById ?? {};\n  const tasksByProjectChanged =\n    !Object.prototype.hasOwnProperty.call(existing, \"tasksByProject\") ||\n    !projectMapsEqual(baseTasksByProject, nextTasksByProject);\n  const tasksByIdChanged =\n    !Object.prototype.hasOwnProperty.call(existing, \"tasksById\") ||\n    !taskMapsEqual(baseTasksById, nextTasksById);\n\n  const { doneCount, totalCount } = computeDayCounts(existing.projects, tasks);\n  const countsChanged =\n    existing.doneCount !== doneCount || existing.totalCount !== totalCount;\n\n  if (\n    !tasksChanged &&\n    !tasksByProjectChanged &&\n    !tasksByIdChanged &&\n    !countsChanged\n  )\n    return existing;\n\n  return {\n    ...existing,\n    ...(tasksChanged ? { tasks } : {}),\n    ...(tasksByProjectChanged ? { tasksByProject: nextTasksByProject } : {}),\n    ...(tasksByIdChanged ? { tasksById: nextTasksById } : {}),\n    doneCount,\n    totalCount,\n  };\n}\n\nexport function sanitizeDayRecord(\n  map: Record<ISODate, DayRecord>,\n  iso: ISODate,\n): DayRecord | undefined {\n  if (!Object.prototype.hasOwnProperty.call(map, iso)) return undefined;\n  const ensured = ensureDay(map, iso);\n  return ensured === map[iso] ? undefined : ensured;\n}\n","// src/lib/types.ts\r\nexport type Pillar =\r\n  | \"Wave\"\r\n  | \"Trading\"\r\n  | \"Vision\"\r\n  | \"Tempo\"\r\n  | \"Positioning\"\r\n  | \"Comms\";\r\n\r\nexport type Side = \"Blue\" | \"Red\";\r\n\r\n/** Single canonical Role type. Stop redefining this elsewhere. */\nexport type Role = \"TOP\" | \"JUNGLE\" | \"MID\" | \"BOT\" | \"SUPPORT\";\n\r\nexport type ReviewMarker = {\r\n  id: string;\r\n  time: string;     // \"MM:SS\"\r\n  seconds: number;  // canonical\r\n  note: string;\r\n  noteOnly?: boolean;\r\n};\r\n\r\nexport type Review = {\n  id: string;\n  title: string;\n  opponent?: string;\n  lane?: string;\r\n  side?: Side;\r\n  patch?: string;\r\n  duration?: string;\n  matchup?: string;\n  tags: string[];\n  pillars: Pillar[];\r\n  notes?: string;\r\n  createdAt: number;\r\n\r\n  // Extended UI fields\r\n  result?: \"Win\" | \"Loss\";\n  score?: number;            // 1..10\n  role?: Role;               // one of five, not three\n  focusOn?: boolean;\n  focus?: number;            // 1..10\n  markers?: ReviewMarker[];\n  status?: \"new\";           // transient UI flag\n};\n\r\nexport type Goal = {\n  id: string;\n  title: string;\n  pillar?: Pillar;\n  metric?: string;\n  notes?: string;\n  done: boolean;\n  createdAt: number;\n};\n\nconst PILLAR_VALUES = [\n  \"Wave\",\n  \"Trading\",\n  \"Vision\",\n  \"Tempo\",\n  \"Positioning\",\n  \"Comms\",\n] as const;\n\nconst SIDE_VALUES = [\"Blue\", \"Red\"] as const;\n\nconst ROLE_VALUES = [\"TOP\", \"JUNGLE\", \"MID\", \"BOT\", \"SUPPORT\"] as const;\n\nconst PILLAR_SET = new Set<string>(PILLAR_VALUES);\nconst SIDE_SET = new Set<string>(SIDE_VALUES);\nconst ROLE_SET = new Set<string>(ROLE_VALUES);\n\nexport function isPillar(value: unknown): value is Pillar {\n  return typeof value === \"string\" && PILLAR_SET.has(value);\n}\n\nexport function isSide(value: unknown): value is Side {\n  return typeof value === \"string\" && SIDE_SET.has(value);\n}\n\nexport function isRole(value: unknown): value is Role {\n  return typeof value === \"string\" && ROLE_SET.has(value);\n}\n","\"use client\";\n\nimport * as React from \"react\";\nimport Image from \"next/image\";\nimport { Input } from \"@/components/ui/primitives/Input\";\nimport { IconButton } from \"@/components/ui/primitives/IconButton\";\nimport { Button } from \"@/components/ui/primitives/Button\";\nimport { CheckCircle } from \"@/components/ui/toggles/CheckCircle\";\nimport { Pencil, Trash2 } from \"lucide-react\";\nimport { motion, useAnimation } from \"framer-motion\";\nimport { cn } from \"@/lib/utils\";\nimport useAutoFocus from \"@/lib/useAutoFocus\";\nimport { spacingTokens, readNumberToken } from \"@/lib/tokens\";\nimport { usePrefersReducedMotion } from \"@/lib/useReducedMotion\";\nimport { uid } from \"@/lib/db\";\nimport type { DayTask } from \"./plannerTypes\";\nimport styles from \"./TaskRow.module.css\";\n\nconst taskImageSpacingToken = 7;\nconst taskImageSize = spacingTokens[taskImageSpacingToken - 1];\nconst layoutClasses =\n  \"[overflow:visible] grid min-h-[var(--space-7)] min-w-0 grid-cols-[auto,1fr,auto] items-center gap-[var(--space-4)] pl-[var(--space-4)] pr-[var(--space-2)] py-[var(--space-2)]\";\nconst TASK_ROW_GUARD_SELECTOR = \"[data-task-row-guard='true']\";\nconst entryOffset = spacingTokens[2];\nconst bounceDistance = spacingTokens[0];\nconst DEFAULT_EASE_OUT = \"cubic-bezier(0.16, 1, 0.3, 1)\";\nconst DEFAULT_MOTION_EASE_GLITCH = \"cubic-bezier(0.2, 0.8, 0.2, 1)\";\ntype CubicBezierTuple = [number, number, number, number];\nconst DEFAULT_EASE_OUT_CURVE: CubicBezierTuple = [0.16, 1, 0.3, 1];\nconst DEFAULT_MOTION_EASE_GLITCH_CURVE: CubicBezierTuple = [\n  0.2,\n  0.8,\n  0.2,\n  1,\n];\nconst DEFAULT_MOTION_DURATION_MD = 0.22;\nconst DEFAULT_MOTION_DURATION_LG = 0.42;\n\ntype MotionTokens = {\n  easeOut: string;\n  motionEaseGlitch: string;\n  easeOutCurve: CubicBezierTuple;\n  motionEaseGlitchCurve: CubicBezierTuple;\n  durationMd: number;\n  durationLg: number;\n};\n\nconst readStringToken = (token: string, fallback: string): string => {\n  if (typeof document === \"undefined\") {\n    return fallback;\n  }\n\n  const value = getComputedStyle(document.documentElement)\n    .getPropertyValue(token)\n    .trim();\n\n  return value.length > 0 ? value : fallback;\n};\n\nconst parseCubicBezier = (\n  value: string,\n  fallback: CubicBezierTuple,\n): CubicBezierTuple => {\n  const trimmed = value.trim();\n  const match = trimmed.match(/^cubic-bezier\\(([^)]+)\\)$/i);\n  if (!match) {\n    return fallback;\n  }\n\n  const parts = match[1]\n    .split(\",\")\n    .map((segment) => Number.parseFloat(segment.trim()))\n    .filter((segment) => Number.isFinite(segment)) as number[];\n\n  return parts.length === 4\n    ? (parts as CubicBezierTuple)\n    : fallback;\n};\n\ntype Props = {\n  task: DayTask;\n  toggleTask: () => void;\n  deleteTask: () => void;\n  renameTask: (title: string) => void;\n  selectTask: () => void;\n  addImage: (url: string) => void;\n  removeImage: (url: string, index: number) => void;\n};\n\nexport function TaskRow({\n  task,\n  toggleTask,\n  deleteTask,\n  renameTask,\n  selectTask,\n  addImage,\n  removeImage,\n}: Props) {\n  const reduceMotionPreference = usePrefersReducedMotion();\n  const [forcedReduceMotion, setForcedReduceMotion] = React.useState(() => {\n    if (typeof document === \"undefined\") {\n      return false;\n    }\n\n    return document.documentElement.classList.contains(\"no-animations\");\n  });\n  const [motionTokens, setMotionTokens] = React.useState<MotionTokens>(() => ({\n    easeOut: DEFAULT_EASE_OUT,\n    motionEaseGlitch: DEFAULT_MOTION_EASE_GLITCH,\n    easeOutCurve: DEFAULT_EASE_OUT_CURVE,\n    motionEaseGlitchCurve: DEFAULT_MOTION_EASE_GLITCH_CURVE,\n    durationMd: DEFAULT_MOTION_DURATION_MD,\n    durationLg: DEFAULT_MOTION_DURATION_LG,\n  }));\n  const bounceControls = useAnimation();\n  const reduceMotion = reduceMotionPreference || forcedReduceMotion;\n\n  const [editing, setEditing] = React.useState(false);\n  const [title, setTitle] = React.useState(task.title);\n  const [imageUrl, setImageUrl] = React.useState(\"\");\n  const inputRef = React.useRef<HTMLInputElement>(null);\n  const [hasFocusWithin, setHasFocusWithin] = React.useState(false);\n  const [imageError, setImageError] = React.useState<string | null>(null);\n  const trimmedImageUrl = imageUrl.trim();\n  const canAttachImage = trimmedImageUrl.length > 0;\n  const trimmedTaskTitle = task.title.trim();\n  const accessibleTaskTitle = trimmedTaskTitle || \"Untitled task\";\n  const renameTaskLabel = `Rename task ${accessibleTaskTitle}`;\n\n  React.useEffect(() => {\n    if (typeof document === \"undefined\") {\n      return;\n    }\n\n    const root = document.documentElement;\n\n    const syncForcedReduceMotion = () => {\n      setForcedReduceMotion(root.classList.contains(\"no-animations\"));\n    };\n\n    syncForcedReduceMotion();\n\n    if (typeof MutationObserver === \"undefined\") {\n      return;\n    }\n\n    const observer = new MutationObserver(syncForcedReduceMotion);\n    observer.observe(root, { attributes: true, attributeFilter: [\"class\"] });\n\n    return () => {\n      observer.disconnect();\n    };\n  }, []);\n\n  React.useEffect(() => {\n    const easeOut = readStringToken(\"--ease-out\", DEFAULT_EASE_OUT);\n    const motionEaseGlitch = readStringToken(\n      \"--motion-ease-glitch\",\n      DEFAULT_MOTION_EASE_GLITCH,\n    );\n\n    setMotionTokens({\n      easeOut,\n      motionEaseGlitch,\n      easeOutCurve: parseCubicBezier(easeOut, DEFAULT_EASE_OUT_CURVE),\n      motionEaseGlitchCurve: parseCubicBezier(\n        motionEaseGlitch,\n        DEFAULT_MOTION_EASE_GLITCH_CURVE,\n      ),\n      durationMd:\n        readNumberToken(\n          \"--motion-duration-md\",\n          DEFAULT_MOTION_DURATION_MD * 1000,\n        ) / 1000,\n      durationLg:\n        readNumberToken(\n          \"--motion-duration-lg\",\n          DEFAULT_MOTION_DURATION_LG * 1000,\n        ) / 1000,\n    });\n  }, []);\n\n  React.useEffect(() => {\n    bounceControls.set({ y: 0, scale: 1 });\n  }, [bounceControls]);\n\n  const previousDoneRef = React.useRef(task.done);\n\n  React.useEffect(() => {\n    if (reduceMotion) {\n      bounceControls.set({ y: 0, scale: 1 });\n      previousDoneRef.current = task.done;\n      return;\n    }\n\n    if (previousDoneRef.current === task.done) {\n      previousDoneRef.current = task.done;\n      return;\n    }\n\n    const offset = task.done ? bounceDistance : -bounceDistance;\n\n    void bounceControls.start({\n      y: [0, offset, 0],\n      scale: task.done ? [1, 0.98, 1] : [1, 1.02, 1],\n      transition: {\n        duration: motionTokens.durationMd,\n        ease: motionTokens.motionEaseGlitchCurve,\n      },\n    });\n\n    previousDoneRef.current = task.done;\n  }, [\n    task.done,\n    reduceMotion,\n    bounceControls,\n    motionTokens.durationMd,\n    motionTokens.motionEaseGlitchCurve,\n  ]);\n\n  const imageEntriesRef = React.useRef<Array<{ url: string; id: string }>>([]);\n  const imageEntries = React.useMemo(() => {\n    const previousEntries = imageEntriesRef.current;\n    const used = new Set<number>();\n    const nextEntries: Array<{ url: string; id: string }> = [];\n\n    for (const url of task.images) {\n      let matchIndex = -1;\n      for (let index = 0; index < previousEntries.length; index += 1) {\n        if (used.has(index)) continue;\n        if (previousEntries[index]?.url === url) {\n          matchIndex = index;\n          break;\n        }\n      }\n\n      if (matchIndex >= 0) {\n        used.add(matchIndex);\n        nextEntries.push(previousEntries[matchIndex]!);\n      } else {\n        nextEntries.push({ url, id: `${task.id}-image-${uid()}` });\n      }\n    }\n\n    imageEntriesRef.current = nextEntries;\n    return nextEntries;\n  }, [task.id, task.images]);\n\n  const validateImageUrl = React.useCallback((value: string) => {\n    if (!value) {\n      return \"Enter an image URL.\";\n    }\n\n    try {\n      const parsed = new URL(value);\n      if (parsed.protocol !== \"https:\") {\n        return \"Image URL must start with https.\";\n      }\n    } catch {\n      return \"Enter a valid image URL.\";\n    }\n\n    return null;\n  }, []);\n\n  useAutoFocus({ ref: inputRef, when: editing });\n\n  React.useEffect(() => {\n    if (!editing) {\n      setTitle(task.title);\n    }\n  }, [editing, task.title]);\n\n  const handleFocusWithin = React.useCallback(() => {\n    setHasFocusWithin(true);\n  }, []);\n\n  const handleBlurWithin = React.useCallback(\n    (event: React.FocusEvent<HTMLElement>) => {\n      const next = event.relatedTarget as Node | null;\n      if (!next || !event.currentTarget.contains(next)) {\n        setHasFocusWithin(false);\n      }\n    },\n    [],\n  );\n\n  const handleRowClick = React.useCallback(\n    (event: React.MouseEvent<HTMLButtonElement>) => {\n      if (\n        event.target instanceof Element &&\n        event.target.closest(TASK_ROW_GUARD_SELECTOR)\n      ) {\n        return;\n      }\n      selectTask();\n    },\n    [selectTask],\n  );\n\n  const handleRowKeyDown = React.useCallback(\n    (event: React.KeyboardEvent<HTMLButtonElement>) => {\n      if (event.target !== event.currentTarget) return;\n\n      if (event.key === \"Enter\") {\n        event.preventDefault();\n        selectTask();\n      }\n\n      if (event.key === \" \" || event.key === \"Spacebar\") {\n        event.preventDefault();\n      }\n    },\n    [selectTask],\n  );\n\n  const handleRowKeyUp = React.useCallback(\n    (event: React.KeyboardEvent<HTMLButtonElement>) => {\n      if (event.target !== event.currentTarget) return;\n\n      if (event.key === \" \" || event.key === \"Spacebar\") {\n        event.preventDefault();\n        selectTask();\n      }\n    },\n    [selectTask],\n  );\n\n  function start() {\n    setEditing(true);\n  }\n  function commit() {\n    const v = title.trim();\n    setEditing(false);\n    if (!v) {\n      setTitle(task.title);\n      return;\n    }\n    if (v !== task.title) renameTask(v);\n  }\n  function cancel() {\n    setEditing(false);\n    setTitle(task.title);\n  }\n\n  function commitImage() {\n    const error = validateImageUrl(trimmedImageUrl);\n    if (error) {\n      setImageError(error);\n      return;\n    }\n\n    addImage(trimmedImageUrl);\n    setImageUrl(\"\");\n    setImageError(null);\n  }\n\n  return (\n    <motion.li\n      className=\"group\"\n      initial={\n        reduceMotion ? undefined : { opacity: 0, y: entryOffset, scale: 0.98 }\n      }\n      animate={{ opacity: 1, y: 0, scale: 1 }}\n      transition={{\n        duration: reduceMotion ? 0 : motionTokens.durationLg,\n        ease: motionTokens.easeOutCurve,\n      }}\n    >\n      <motion.div\n        className=\"relative\"\n        onFocusCapture={handleFocusWithin}\n        onBlurCapture={handleBlurWithin}\n        animate={bounceControls}\n        initial={false}\n      >\n        <button\n          type=\"button\"\n          aria-label={`Select task ${accessibleTaskTitle}`}\n          onClick={handleRowClick}\n          onKeyDown={handleRowKeyDown}\n          onKeyUp={handleRowKeyUp}\n          className={cn(\n            \"absolute inset-0 w-full cursor-pointer rounded-card r-card-lg border transition-colors\",\n            \"bg-card/55 hover:bg-card/70 focus-visible:bg-card/70 active:bg-card/80\",\n            \"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-0\",\n            \"data-[focus-within=true]:ring-2 data-[focus-within=true]:ring-ring\",\n          )}\n          data-focus-within={hasFocusWithin ? \"true\" : undefined}\n        >\n          <span className=\"sr-only\">{`Select task ${accessibleTaskTitle}`}</span>\n        </button>\n\n        <div\n          className={cn(\n            \"pointer-events-none relative z-[1]\",\n            layoutClasses,\n          )}\n        >\n          <div\n            className=\"pointer-events-auto shrink-0 ml-[var(--space-1)]\"\n            data-task-row-guard=\"true\"\n            onPointerDown={(e) => e.stopPropagation()}\n          >\n            <CheckCircle\n              checked={task.done}\n              onChange={() => {\n                if (!editing) toggleTask();\n              }}\n              aria-label={`Toggle ${accessibleTaskTitle} done`}\n              size=\"sm\"\n            />\n          </div>\n\n          <div className=\"pointer-events-auto flex-1 min-w-0 px-[var(--space-1)]\">\n            {!editing ? (\n              <button\n                type=\"button\"\n                className=\"task-tile__text block w-full text-left focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring rounded-card r-card-lg\"\n                onClick={(e) => {\n                  e.stopPropagation();\n                  toggleTask();\n                }}\n                onDoubleClick={(e) => {\n                  e.stopPropagation();\n                  start();\n                }}\n                onPointerDown={(e) => e.stopPropagation()}\n                aria-pressed={task.done}\n                title=\"Click to toggle; double-click to edit\"\n              >\n                <span\n                  className={cn(\n                    \"truncate break-words\",\n                    task.done && \"line-through-soft\",\n                  )}\n                >\n                  {task.title}\n                </span>\n              </button>\n            ) : (\n              <Input\n                name={`dc-rename-task-${task.id}`}\n                ref={inputRef}\n                value={title}\n                onChange={(e) => setTitle(e.target.value)}\n                onBlur={commit}\n                onKeyDown={(e) => {\n                  if (e.key === \"Enter\") commit();\n                  if (e.key === \"Escape\") cancel();\n                }}\n                aria-label={renameTaskLabel}\n                data-task-row-guard=\"true\"\n              />\n            )}\n          </div>\n\n          <div\n            className={cn(\n              \"pointer-events-auto flex shrink-0 items-center gap-[var(--space-2)]\",\n              editing\n                ? \"opacity-0 pointer-events-none\"\n                : \"opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto group-focus-within:opacity-100 group-focus-within:pointer-events-auto\",\n            )}\n          >\n            <IconButton\n              aria-label=\"Edit task\"\n              title=\"Edit\"\n              onClick={(e) => {\n                e.stopPropagation();\n                start();\n              }}\n              onPointerDown={(e) => e.stopPropagation()}\n              size=\"sm\"\n              iconSize=\"xs\"\n              variant=\"quiet\"\n            >\n              <Pencil />\n            </IconButton>\n            <IconButton\n              aria-label=\"Delete task\"\n              title=\"Delete\"\n              onClick={(e) => {\n                e.stopPropagation();\n                deleteTask();\n              }}\n              onPointerDown={(e) => e.stopPropagation()}\n              size=\"sm\"\n              iconSize=\"xs\"\n              variant=\"quiet\"\n            >\n              <Trash2 />\n            </IconButton>\n          </div>\n        </div>\n      </motion.div>\n      {task.images.length > 0 && (\n        <ul className=\"mt-[var(--space-2)] space-y-[var(--space-2)]\">\n          {imageEntries.map((entry, index) => (\n            <li\n              key={entry.id}\n              className=\"flex items-center gap-[var(--space-2)]\"\n            >\n              <Image\n                src={entry.url}\n                alt={`Task image for ${accessibleTaskTitle}`}\n                width={taskImageSize}\n                height={taskImageSize}\n                className={cn(\n                  styles.thumbnail,\n                  \"rounded-card r-card-md object-cover\",\n                )}\n              />\n              <IconButton\n                aria-label=\"Remove image\"\n                title=\"Remove image\"\n                onClick={() => removeImage(entry.url, index)}\n                size=\"sm\"\n                iconSize=\"xs\"\n                variant=\"quiet\"\n              >\n                <Trash2 />\n              </IconButton>\n            </li>\n          ))}\n        </ul>\n      )}\n      <form\n        onSubmit={(e) => {\n          e.preventDefault();\n          commitImage();\n        }}\n        className=\"mt-[var(--space-2)] flex items-center gap-[var(--space-2)]\"\n      >\n        <label htmlFor={`task-image-${task.id}`} className=\"sr-only\">\n          Add image URL\n        </label>\n        <Input\n          id={`task-image-${task.id}`}\n          type=\"url\"\n          value={imageUrl}\n          onChange={(e) => {\n            const nextValue = e.target.value;\n            setImageUrl(nextValue);\n            if (imageError) {\n              const trimmedValue = nextValue.trim();\n              if (!trimmedValue) {\n                setImageError(null);\n                return;\n              }\n              const nextError = validateImageUrl(trimmedValue);\n              setImageError(nextError);\n            }\n          }}\n          placeholder=\"https://example.com/image.jpg\"\n          className=\"flex-1\"\n          aria-invalid={imageError ? \"true\" : undefined}\n          aria-describedby={imageError ? `task-image-${task.id}-error` : undefined}\n        />\n        <Button\n          type=\"submit\"\n          size=\"sm\"\n          disabled={!canAttachImage}\n          className=\"shrink-0\"\n        >\n          Attach image\n        </Button>\n      </form>\n      {imageError && (\n        <p\n          id={`task-image-${task.id}-error`}\n          className=\"mt-[var(--space-1)] text-ui text-danger\"\n          role=\"alert\"\n          aria-live=\"polite\"\n        >\n          {imageError}\n        </p>\n      )}\n    </motion.li>\n  );\n}\n","import { addDays, fromISODate, toISODate } from \"@/lib/date\";\nimport type { ISODate } from \"@/components/planner\";\n\ntype PlannerEventIntent = \"task\" | \"project\";\n\nexport type PlannerRecurringFrequency = \"daily\" | \"weekly\" | \"monthly\" | \"yearly\";\n\nexport type PlannerRecurringRule = {\n  frequency: PlannerRecurringFrequency;\n  interval: number;\n  weekdays?: number[];\n};\n\nexport type PlannerEventDraft = {\n  title: string;\n  startDate?: ISODate;\n  time?: string;\n};\n\nexport type PlannerParseConfidence = \"none\" | \"low\" | \"medium\" | \"high\";\n\nexport type PlannerParseMatch = {\n  time?: string;\n  date?: string;\n  recurrence?: string[];\n  intent?: PlannerEventIntent;\n};\n\nexport type PlannerParseResult = {\n  intent: PlannerEventIntent;\n  event: PlannerEventDraft;\n  recurrence: PlannerRecurringRule | null;\n  confidence: PlannerParseConfidence;\n  matched: PlannerParseMatch;\n};\n\nexport type ParsePlannerPhraseOptions = {\n  now?: Date;\n};\n\ntype Span = { start: number; end: number };\n\nconst TIME_REGEX = /\\b(?:at\\s*)?(\\d{1,2})(?::(\\d{2}))?\\s*(am|pm)?\\b/;\nconst INTENT_PREFIX_REGEX = /^(?:create\\s+)?(?:new\\s+)?project[:\\s]/;\n\nconst MONTHS: Record<string, number> = {\n  january: 0,\n  february: 1,\n  march: 2,\n  april: 3,\n  may: 4,\n  june: 5,\n  july: 6,\n  august: 7,\n  september: 8,\n  october: 9,\n  november: 10,\n  december: 11,\n};\n\nconst WEEKDAYS: Record<string, number> = {\n  sunday: 0,\n  sun: 0,\n  monday: 1,\n  mon: 1,\n  tuesday: 2,\n  tue: 2,\n  tues: 2,\n  wednesday: 3,\n  wed: 3,\n  thursday: 4,\n  thu: 4,\n  thur: 4,\n  thurs: 4,\n  friday: 5,\n  fri: 5,\n  saturday: 6,\n  sat: 6,\n};\n\nconst RELATIVE_DATE_TOKENS: Record<string, number> = {\n  today: 0,\n  tonight: 0,\n  tomorrow: 1,\n  \"day after tomorrow\": 2,\n};\n\nfunction clampConfidence(\n  current: PlannerParseConfidence,\n  next: PlannerParseConfidence,\n): PlannerParseConfidence {\n  const order: PlannerParseConfidence[] = [\"none\", \"low\", \"medium\", \"high\"];\n  return order[Math.max(order.indexOf(current), order.indexOf(next))];\n}\n\nfunction normaliseTimeToken(match: RegExpExecArray): string | undefined {\n  const hour = Number.parseInt(match[1] ?? \"\", 10);\n  if (Number.isNaN(hour) || hour < 0 || hour > 23) return undefined;\n  const rawMinutes = match[2];\n  const suffix = match[3];\n  const hasSuffix = typeof suffix === \"string\" && suffix.length > 0;\n  const hasMinutes = typeof rawMinutes === \"string\" && rawMinutes.length > 0;\n  if (!hasSuffix && !hasMinutes) return undefined;\n  const minutes = hasMinutes ? Number.parseInt(rawMinutes, 10) : 0;\n  if (minutes < 0 || minutes > 59) return undefined;\n  let normalizedHour = hour;\n  if (suffix) {\n    const lowerSuffix = suffix.toLowerCase();\n    if (lowerSuffix === \"am\") {\n      if (hour === 12) normalizedHour = 0;\n    } else if (lowerSuffix === \"pm\") {\n      if (hour < 12) normalizedHour = hour + 12;\n    }\n  }\n  const hh = String(normalizedHour).padStart(2, \"0\");\n  const mm = String(minutes).padStart(2, \"0\");\n  return `${hh}:${mm}`;\n}\n\nfunction addSpan(spans: Span[], start: number, length: number): void {\n  if (start < 0 || length <= 0) return;\n  spans.push({ start, end: start + length });\n}\n\nfunction mergeSpans(spans: Span[]): Span[] {\n  if (!spans.length) return spans;\n  const sorted = [...spans].sort((a, b) => a.start - b.start);\n  const result: Span[] = [];\n  let current = sorted[0];\n  for (let i = 1; i < sorted.length; i += 1) {\n    const span = sorted[i];\n    if (span.start <= current.end) {\n      current = { start: current.start, end: Math.max(current.end, span.end) };\n    } else {\n      result.push(current);\n      current = span;\n    }\n  }\n  result.push(current);\n  return result;\n}\n\nfunction stripSpans(value: string, spans: Span[]): string {\n  if (!spans.length) return value.trim();\n  const merged = mergeSpans(spans);\n  let cursor = 0;\n  let output = \"\";\n  for (const span of merged) {\n    if (cursor < span.start) {\n      output += value.slice(cursor, span.start);\n    }\n    cursor = span.end;\n  }\n  if (cursor < value.length) {\n    output += value.slice(cursor);\n  }\n  return output.replace(/\\s{2,}/g, \" \").replace(/[\\s,]+$/g, \"\").trim();\n}\n\nfunction computeRelativeDate(base: Date, offset: number): Date {\n  const next = new Date(base);\n  next.setHours(0, 0, 0, 0);\n  return addDays(next, offset);\n}\n\nfunction nextWeekday(base: Date, weekday: number, includeToday = false): Date {\n  const target = new Date(base);\n  target.setHours(0, 0, 0, 0);\n  const currentWeekday = target.getDay();\n  let delta = weekday - currentWeekday;\n  if (delta < 0 || (!includeToday && delta === 0)) {\n    delta += 7;\n  }\n  if (delta === 0 && !includeToday) {\n    delta = 7;\n  }\n  return addDays(target, delta);\n}\n\nfunction parseMonthDate(\n  descriptor: string,\n  base: Date,\n): { date: Date; token: string } | null {\n  const trimmed = descriptor.replace(/,/g, \" \").trim();\n  if (!trimmed) return null;\n  const [head] = trimmed.split(/\\s+(?:at|by|from|starting|around|before|after)\\b/i);\n  const normalized = head.trim().replace(/\\s+/g, \" \");\n  const monthMatch = normalized.match(/^(\\d{1,2})\\/(\\d{1,2})(?:\\/(\\d{2,4}))?$/);\n  if (monthMatch) {\n    const monthIndex = Number.parseInt(monthMatch[1] ?? \"\", 10) - 1;\n    const day = Number.parseInt(monthMatch[2] ?? \"\", 10);\n    const yearToken = monthMatch[3];\n    if (Number.isNaN(monthIndex) || Number.isNaN(day) || monthIndex < 0) {\n      return null;\n    }\n    const date = new Date(base);\n    const year = yearToken\n      ? Number.parseInt(yearToken.length === 2 ? `20${yearToken}` : yearToken, 10)\n      : base.getFullYear();\n    date.setFullYear(year, monthIndex, day);\n    date.setHours(0, 0, 0, 0);\n    if (date.getMonth() !== monthIndex || date.getDate() !== day) {\n      return null;\n    }\n    return { date, token: monthMatch[0] ?? normalized };\n  }\n\n  const words = normalized.toLowerCase().split(/\\s+/);\n  if (!words.length) return null;\n  const maybeMonth = MONTHS[words[0]];\n  if (maybeMonth === undefined) return null;\n  const dayValue = words[1];\n  if (!dayValue) return null;\n  const day = Number.parseInt(dayValue, 10);\n  if (Number.isNaN(day) || day <= 0 || day > 31) return null;\n  const yearValue = words[2];\n  const date = new Date(base);\n  const year = yearValue\n    ? Number.parseInt(yearValue.length === 2 ? `20${yearValue}` : yearValue, 10)\n    : base.getFullYear();\n  date.setFullYear(year, maybeMonth, day);\n  date.setHours(0, 0, 0, 0);\n  if (date.getMonth() !== maybeMonth || date.getDate() !== day) {\n    return null;\n  }\n  if (!yearValue && date < base) {\n    date.setFullYear(year + 1);\n  }\n  const tokenWords = words.slice(0, yearValue ? 3 : 2).join(\" \");\n  return { date, token: tokenWords };\n}\n\nfunction normaliseWeekdays(token: string): number[] {\n  const lowerToken = token.toLowerCase();\n  if (lowerToken.includes(\"weekday\")) {\n    return [1, 2, 3, 4, 5];\n  }\n  if (lowerToken.includes(\"weekend\")) {\n    return [0, 6];\n  }\n  const matches = token.match(\n    /(?:mon(?:day)?|tue(?:s|sday)?|wed(?:nesday)?|thu(?:rsday)?|fri(?:day)?|sat(?:urday)?|sun(?:day)?)/g,\n  );\n  if (!matches) return [];\n  const result = new Set<number>();\n  for (const match of matches) {\n    const mapped = WEEKDAYS[match.replace(/[^a-z]/gi, \"\").toLowerCase()];\n    if (mapped !== undefined) {\n      result.add(mapped);\n    }\n  }\n  return Array.from(result).sort((a, b) => a - b);\n}\n\nexport function parsePlannerPhrase(\n  phrase: string,\n  options: ParsePlannerPhraseOptions = {},\n): PlannerParseResult {\n  const raw = phrase ?? \"\";\n  const value = raw.trim();\n  const now = options.now ? new Date(options.now) : new Date();\n  if (!value) {\n    return {\n      intent: \"task\",\n      event: { title: \"\" },\n      recurrence: null,\n      confidence: \"none\",\n      matched: {},\n    };\n  }\n\n  const lower = value.toLowerCase();\n  const spans: Span[] = [];\n  const matched: PlannerParseMatch = {};\n  let intent: PlannerEventIntent = \"task\";\n  let confidence: PlannerParseConfidence = \"low\";\n  let recurrence: PlannerRecurringRule | null = null;\n  let startDate: ISODate | undefined;\n  let eventTime: string | undefined;\n\n  const timeRegex = new RegExp(TIME_REGEX, \"gi\");\n  while (true) {\n    const candidate = timeRegex.exec(lower);\n    if (!candidate) break;\n    const normalized = normaliseTimeToken(candidate);\n    if (normalized) {\n      eventTime = normalized;\n      confidence = clampConfidence(confidence, \"medium\");\n      const start = candidate.index ?? 0;\n      addSpan(spans, start, candidate[0]?.length ?? 0);\n      matched.time = normalized;\n      break;\n    }\n  }\n\n  for (const [token, offset] of Object.entries(RELATIVE_DATE_TOKENS)) {\n    const index = lower.indexOf(token);\n    if (index >= 0) {\n      const date = computeRelativeDate(now, offset);\n      startDate = toISODate(date);\n      confidence = clampConfidence(confidence, \"medium\");\n      addSpan(spans, index, token.length);\n      matched.date = token;\n      break;\n    }\n  }\n\n  if (!startDate) {\n    const nextMatch = lower.match(/\\bnext\\s+(monday|tuesday|wednesday|thursday|friday|saturday|sunday)\\b/);\n    if (nextMatch?.index !== undefined) {\n      const weekday = WEEKDAYS[nextMatch[1] ?? \"\"];\n      if (weekday !== undefined) {\n        const date = nextWeekday(now, weekday, false);\n        startDate = toISODate(date);\n        addSpan(spans, nextMatch.index, nextMatch[0]?.length ?? 0);\n        matched.date = nextMatch[0] ?? nextMatch[1];\n        confidence = clampConfidence(confidence, \"medium\");\n      }\n    }\n  }\n\n  if (!startDate) {\n    const thisMatch = lower.match(/\\b(?:this|on)\\s+(monday|tuesday|wednesday|thursday|friday|saturday|sunday)\\b/);\n    if (thisMatch?.index !== undefined) {\n      const weekday = WEEKDAYS[thisMatch[1] ?? \"\"];\n      if (weekday !== undefined) {\n        const date = nextWeekday(now, weekday, true);\n        startDate = toISODate(date);\n        addSpan(spans, thisMatch.index, thisMatch[0]?.length ?? 0);\n        matched.date = thisMatch[0] ?? thisMatch[1];\n        confidence = clampConfidence(confidence, \"medium\");\n      }\n    }\n  }\n\n  if (!startDate) {\n    const explicitMatch = lower.match(/\\bon\\s+([^]+)$/);\n    if (explicitMatch?.index !== undefined && explicitMatch[1]) {\n      const parsed = parseMonthDate(explicitMatch[1].trim(), now);\n      if (parsed) {\n        startDate = toISODate(parsed.date);\n        const removalLength = (`on ${parsed.token}`).length;\n        addSpan(spans, explicitMatch.index, removalLength);\n        matched.date = startDate;\n        confidence = clampConfidence(confidence, \"high\");\n      }\n    }\n  }\n\n  if (INTENT_PREFIX_REGEX.test(lower)) {\n    intent = \"project\";\n    const match = lower.match(INTENT_PREFIX_REGEX);\n    if (match?.index !== undefined) {\n      addSpan(spans, match.index, match[0]?.length ?? 0);\n      matched.intent = \"project\";\n      confidence = clampConfidence(confidence, \"medium\");\n    }\n  }\n\n  if (intent === \"task\") {\n    const projectCue = lower.match(/\\bproject\\s+(?:named\\s+)?([\\w\\s]+)$/);\n    if (projectCue?.index !== undefined) {\n      const label = projectCue[0] ?? \"project\";\n      addSpan(spans, projectCue.index, label.length);\n      matched.intent = \"task\";\n    }\n  }\n\n  const recurrenceMatches: string[] = [];\n\n    const registerRecurrence = (\n      rule: PlannerRecurringRule,\n      token?: string,\n      priority: PlannerParseConfidence = \"medium\",\n    ): void => {\n    if (!recurrence) {\n      recurrence = rule;\n    }\n    const label = token?.trim();\n    if (label && !recurrenceMatches.includes(label)) {\n      recurrenceMatches.push(label);\n    }\n    confidence = clampConfidence(confidence, priority);\n  };\n\n  const weekdayMatch = lower.match(/\\bweekday(?:s)?\\b/);\n  if (weekdayMatch?.index !== undefined) {\n    registerRecurrence(\n      { frequency: \"weekly\", interval: 1, weekdays: [1, 2, 3, 4, 5] },\n      weekdayMatch[0] ?? \"weekdays\",\n      \"high\",\n    );\n    addSpan(spans, weekdayMatch.index, weekdayMatch[0]?.length ?? 0);\n  }\n\n  const weekendMatch = lower.match(/\\bweekend(?:s)?\\b/);\n  if (weekendMatch?.index !== undefined) {\n    registerRecurrence(\n      { frequency: \"weekly\", interval: 1, weekdays: [0, 6] },\n      weekendMatch[0] ?? \"weekends\",\n      \"high\",\n    );\n    addSpan(spans, weekendMatch.index, weekendMatch[0]?.length ?? 0);\n  }\n\n  const everyMatch = lower.match(/\\b(?:every|each)\\s+([^,.]+)(?=[$\\s,.])/);\n  if (everyMatch?.index !== undefined && everyMatch[1]) {\n    const descriptor = everyMatch[1].trim();\n    const weekdays = normaliseWeekdays(descriptor);\n    if (weekdays.length) {\n      registerRecurrence(\n        { frequency: \"weekly\", interval: 1, weekdays },\n        everyMatch[0] ?? descriptor,\n        \"high\",\n      );\n    } else {\n      const intervalMatch = descriptor.match(/(\\d+)?\\s*(day|week|month|year)s?/);\n      if (intervalMatch) {\n        const interval = Number.parseInt(intervalMatch[1] ?? \"1\", 10) || 1;\n        const unit = intervalMatch[2];\n        if (unit === \"day\") {\n          registerRecurrence(\n            { frequency: \"daily\", interval },\n            everyMatch[0] ?? descriptor,\n            \"high\",\n          );\n        } else if (unit === \"week\") {\n          registerRecurrence(\n            { frequency: \"weekly\", interval },\n            everyMatch[0] ?? descriptor,\n            \"high\",\n          );\n        } else if (unit === \"month\") {\n          registerRecurrence(\n            { frequency: \"monthly\", interval },\n            everyMatch[0] ?? descriptor,\n            \"high\",\n          );\n        } else if (unit === \"year\") {\n          registerRecurrence(\n            { frequency: \"yearly\", interval },\n            everyMatch[0] ?? descriptor,\n            \"high\",\n          );\n        }\n      }\n    }\n    addSpan(spans, everyMatch.index, (everyMatch[0] ?? \"\").length);\n  }\n\n  const dailyMatch = lower.match(/\\b(?:daily|every\\s+day|each\\s+day)\\b/);\n  if (dailyMatch?.index !== undefined) {\n    registerRecurrence({ frequency: \"daily\", interval: 1 }, dailyMatch[0] ?? \"daily\", \"high\");\n    addSpan(spans, dailyMatch.index, dailyMatch[0]?.length ?? 0);\n  }\n\n  if (!recurrence) {\n    const weeklyMatch = lower.match(/\\bweekly\\b/);\n    if (weeklyMatch?.index !== undefined) {\n      registerRecurrence({ frequency: \"weekly\", interval: 1 }, weeklyMatch[0] ?? \"weekly\");\n      addSpan(spans, weeklyMatch.index, weeklyMatch[0]?.length ?? 0);\n    }\n  }\n\n  if (!recurrence) {\n    const monthlyMatch = lower.match(/\\bmonthly\\b/);\n    if (monthlyMatch?.index !== undefined) {\n      registerRecurrence({ frequency: \"monthly\", interval: 1 }, monthlyMatch[0] ?? \"monthly\");\n      addSpan(spans, monthlyMatch.index, monthlyMatch[0]?.length ?? 0);\n    }\n  }\n\n  if (!recurrence) {\n    const yearlyMatch = lower.match(/\\byearly\\b/);\n    if (yearlyMatch?.index !== undefined) {\n      registerRecurrence({ frequency: \"yearly\", interval: 1 }, yearlyMatch[0] ?? \"yearly\");\n      addSpan(spans, yearlyMatch.index, yearlyMatch[0]?.length ?? 0);\n    }\n  }\n\n  const title = stripSpans(value, spans) || value;\n  if (!matched.intent) {\n    matched.intent = intent;\n  }\n  if (recurrenceMatches.length) {\n    matched.recurrence = recurrenceMatches;\n  }\n  if (startDate && !matched.date) {\n    matched.date = startDate;\n  }\n\n  return {\n    intent,\n    event: {\n      title,\n      ...(startDate ? { startDate } : {}),\n      ...(eventTime ? { time: eventTime } : {}),\n    },\n    recurrence,\n    confidence,\n    matched,\n  };\n}\n\nfunction toSafeDate(iso?: ISODate, fallback?: Date): Date {\n  const parsed = iso ? fromISODate(iso) : null;\n  if (parsed) return parsed;\n  return fallback ? new Date(fallback) : new Date();\n}\n\nexport type BuildOccurrencesOptions = {\n  startDate?: ISODate;\n  now?: Date;\n  count?: number;\n};\n\nfunction addMonths(date: Date, months: number): Date {\n  const next = new Date(date);\n  const originalDay = next.getDate();\n  next.setDate(1);\n  next.setMonth(next.getMonth() + months);\n  const daysInMonth = new Date(next.getFullYear(), next.getMonth() + 1, 0).getDate();\n  next.setDate(Math.min(originalDay, daysInMonth));\n  return next;\n}\n\nfunction addYears(date: Date, years: number): Date {\n  const next = new Date(date);\n  next.setFullYear(next.getFullYear() + years);\n  return next;\n}\n\nexport function buildRecurringOccurrences(\n  rule: PlannerRecurringRule,\n  options: BuildOccurrencesOptions = {},\n): ISODate[] {\n  const { startDate, now, count = 3 } = options;\n  const base = toSafeDate(startDate, now);\n  base.setHours(0, 0, 0, 0);\n  const occurrences: ISODate[] = [];\n\n  if (rule.frequency === \"daily\") {\n    const interval = Math.max(1, rule.interval);\n    for (let i = 0; i < count; i += 1) {\n      const date = addDays(base, i * interval);\n      occurrences.push(toISODate(date));\n    }\n    return occurrences;\n  }\n\n  if (rule.frequency === \"weekly\") {\n    const interval = Math.max(1, rule.interval);\n    const weekdays = rule.weekdays && rule.weekdays.length\n      ? [...rule.weekdays].sort((a, b) => a - b)\n      : [base.getDay()];\n    const start = new Date(base);\n    let dayCursor = new Date(start);\n    let iterations = 0;\n    const occurrencesPerInterval = Math.max(1, weekdays.length);\n    const intervalsNeeded = Math.max(1, Math.ceil(count / occurrencesPerInterval));\n    const searchWeeks = intervalsNeeded * interval + 1;\n    const maxIterations = Math.max(searchWeeks * 7, count * 7);\n    while (occurrences.length < count && iterations < maxIterations) {\n      const diff = Math.floor((dayCursor.getTime() - start.getTime()) / 86400000);\n      const weekOffset = Math.floor(diff / 7);\n      const inInterval = weekOffset % interval === 0;\n      if (inInterval && weekdays.includes(dayCursor.getDay())) {\n        occurrences.push(toISODate(dayCursor));\n      }\n      dayCursor = addDays(dayCursor, 1);\n      iterations += 1;\n    }\n    return occurrences;\n  }\n\n  if (rule.frequency === \"monthly\") {\n    const interval = Math.max(1, rule.interval);\n    for (let i = 0; i < count; i += 1) {\n      const date = addMonths(base, i * interval);\n      occurrences.push(toISODate(date));\n    }\n    return occurrences;\n  }\n\n  if (rule.frequency === \"yearly\") {\n    const interval = Math.max(1, rule.interval);\n    for (let i = 0; i < count; i += 1) {\n      const date = addYears(base, i * interval);\n      occurrences.push(toISODate(date));\n    }\n    return occurrences;\n  }\n\n  return occurrences;\n}\n\nexport function summariseParse(result: PlannerParseResult): string {\n  const parts: string[] = [];\n  if (result.matched.intent) {\n    parts.push(result.matched.intent === \"project\" ? \"Project\" : \"Task\");\n  }\n  if (result.event.time) {\n    parts.push(`at ${result.event.time}`);\n  }\n  if (result.event.startDate) {\n    parts.push(`on ${result.event.startDate}`);\n  }\n  if (result.recurrence) {\n    parts.push(\n      result.recurrence.frequency === \"weekly\" && result.recurrence.weekdays?.length\n        ? `weekly (${result.recurrence.weekdays.join(\",\")})`\n        : `${result.recurrence.frequency} x${result.recurrence.interval}`,\n    );\n  }\n  return parts.join(\"  \");\n}\n","export * from \"./parser\";\n","import { z } from \"zod\";\n\nimport { isSafeModeEnabled } from \"@/lib/features\";\nimport type { LlmAgentMetadata } from \"@/lib/metrics/llmTokens\";\nimport { recordLlmTokenUsage } from \"@/lib/metrics/llmTokens\";\nimport { sanitizeText } from \"@/lib/utils\";\n\nconst CONTROL_CHAR_PATTERN = /[\\u0000-\\u0008\\u000b\\u000c\\u000e-\\u001f\\u007f\\u2028\\u2029]/g;\nconst INVISIBLE_CHAR_PATTERN = /[\\u200b-\\u200f\\u202a-\\u202e\\u2060-\\u2064\\u2066-\\u2069\\ufeff]/gi;\nconst COLLAPSE_SPACES_PATTERN = /[ \\t\\f\\v]+/g;\nconst FALLBACK_MAX_INPUT_LENGTH = 16_000;\nconst FALLBACK_TOKENS_PER_CHARACTER = 4;\nconst SAFE_MODE_TOKEN_CEILING_FALLBACK = 8_000;\n\nconst SAFE_MODE_RESPONSE_RESERVE = resolveNumericEnv(\n  \"SAFE_MODE_RESPONSE_RESERVE\",\n  512,\n  {\n    min: 0,\n    integer: true,\n  },\n);\nconst SAFE_MODE_TEMPERATURE_CEILING = resolveNumericEnv(\n  \"SAFE_MODE_TEMPERATURE_CEILING\",\n  0.4,\n  {\n    min: 0,\n  },\n);\nconst SAFE_MODE_MAX_TOOL_CALLS = resolveNumericEnv(\n  \"SAFE_MODE_MAX_TOOL_CALLS\",\n  1,\n  {\n    min: 0,\n    integer: true,\n  },\n);\n\nconst warnedMessages = new Set<string>();\n\ntype IssuePathSegment = string | number;\n\nfunction normalizeIssuePath(path: ReadonlyArray<PropertyKey>): IssuePathSegment[] {\n  const normalized: IssuePathSegment[] = [];\n\n  for (const segment of path) {\n    if (typeof segment === \"string\" || typeof segment === \"number\") {\n      normalized.push(segment);\n    } else {\n      normalized.push(segment.description ?? segment.toString());\n    }\n  }\n\n  return normalized;\n}\n\nfunction normalizeIssueMessage(issue: z.ZodIssue): string {\n  if (\n    issue.code === z.ZodIssueCode.invalid_type &&\n    typeof issue.message === \"string\" &&\n    /received undefined$/u.test(issue.message)\n  ) {\n    return \"Required\";\n  }\n\n  return issue.message;\n}\n\nfunction warnOnce(key: string, message: string): void {\n  if (typeof console === \"undefined\") {\n    return;\n  }\n  if (warnedMessages.has(key)) {\n    return;\n  }\n  warnedMessages.add(key);\n  console.warn(message);\n}\n\nfunction reportTokenEstimateIssue(index: number, raw: unknown, reason: string): void {\n  const printable = typeof raw === \"number\" ? raw.toString() : JSON.stringify(raw);\n  const key = `estimate:${index}:${reason}`;\n  warnOnce(\n    key,\n    `[ai.safety] Token estimator produced ${reason} for message index ${index}; clamping \"${printable}\" to a safe integer budget.`,\n  );\n}\n\nfunction formatIssuePath(path: ReadonlyArray<IssuePathSegment>): string {\n  if (path.length === 0) {\n    return \"<root>\";\n  }\n  return path.reduce<string>((acc, segment) => {\n    if (typeof segment === \"number\") {\n      return `${acc}[${segment}]`;\n    }\n    return acc.length === 0 ? segment : `${acc}.${segment}`;\n  }, \"\");\n}\n\nfunction reportSchemaValidationFailure(label: string, error: unknown): void {\n  if (error instanceof z.ZodError) {\n    const summary = error.issues\n      .map((issue) => {\n        const path = normalizeIssuePath(issue.path);\n        const message = normalizeIssueMessage(issue);\n        return `${formatIssuePath(path)}  ${message}`;\n      })\n      .join(\"; \");\n    const key = `schema:${label}:${summary}`;\n    warnOnce(key, `[ai.safety] ${label} failed schema validation: ${summary}`);\n    return;\n  }\n\n  const description = error instanceof Error ? `${error.name}: ${error.message}` : String(error);\n  const key = `schema:${label}:${description}`;\n  warnOnce(key, `[ai.safety] ${label} validation threw: ${description}`);\n}\n\ntype SegmenterConstructor =\n  | (new (locale?: string, options?: Intl.SegmenterOptions) => Intl.Segmenter)\n  | undefined;\n\nlet cachedSegmenter: Intl.Segmenter | null | undefined;\n\nfunction getUnicodeSegments(input: string): string[] {\n  if (input.length === 0) {\n    return [];\n  }\n\n  if (cachedSegmenter === undefined) {\n    const intlApi =\n      typeof Intl !== \"undefined\"\n        ? (Intl as typeof Intl & { Segmenter?: typeof Intl.Segmenter })\n        : undefined;\n    const segmenterCtor: SegmenterConstructor = intlApi?.Segmenter;\n    cachedSegmenter =\n      typeof segmenterCtor === \"function\"\n        ? new segmenterCtor(undefined, { granularity: \"grapheme\" })\n        : null;\n  }\n\n  const segmenter = cachedSegmenter;\n\n  if (segmenter) {\n    return Array.from(segmenter.segment(input), (segment) => segment.segment);\n  }\n\n  return Array.from(input);\n}\n\nfunction unicodeLength(input: string): number {\n  return getUnicodeSegments(input).length;\n}\n\nfunction unicodeTruncate(input: string, maxLength: number): string {\n  if (maxLength <= 0) {\n    return \"\";\n  }\n\n  const segments = getUnicodeSegments(input);\n\n  if (segments.length <= maxLength) {\n    return input;\n  }\n\n  return segments.slice(0, maxLength).join(\"\");\n}\n\nconst ENABLED_FLAG_VALUES = new Set([\"1\", \"true\", \"on\", \"yes\"]);\n\ninterface NumericEnvOptions {\n  readonly min?: number;\n  readonly integer?: boolean;\n}\n\nfunction reportNumericEnvIssue(name: string, raw: string, reason: string): void {\n  const trimmed = raw.trim();\n  const key = `numeric:${name}:${reason}:${trimmed}`;\n  warnOnce(key, `[ai.safety] Ignoring ${name} value \"${trimmed}\" (${reason}).`);\n}\n\nfunction resolveNumericEnv(\n  names: string | readonly string[],\n  fallback: number,\n  options: NumericEnvOptions = {},\n): number {\n  if (typeof process === \"undefined\") {\n    return fallback;\n  }\n\n  const candidates = Array.isArray(names) ? names : [names];\n\n  for (const name of candidates) {\n    const raw = process.env[name];\n\n    if (typeof raw !== \"string\") {\n      continue;\n    }\n\n    const normalized = raw.trim();\n\n    if (normalized.length === 0) {\n      reportNumericEnvIssue(name, raw, \"empty string\");\n      continue;\n    }\n\n    const parsed = Number(normalized);\n\n    if (!Number.isFinite(parsed)) {\n      reportNumericEnvIssue(name, raw, \"non-numeric value\");\n      continue;\n    }\n\n    const value = options.integer ? Math.trunc(parsed) : parsed;\n\n    if (Number.isNaN(value)) {\n      reportNumericEnvIssue(name, raw, \"not a number\");\n      continue;\n    }\n\n    if (options.min !== undefined && value < options.min) {\n      reportNumericEnvIssue(name, raw, `below minimum ${options.min}`);\n      continue;\n    }\n\n    return value;\n  }\n\n  return fallback;\n}\n\nfunction getDefaultMaxInputLength(): number {\n  return resolveNumericEnv(\n    \"AI_MAX_INPUT_LENGTH\",\n    FALLBACK_MAX_INPUT_LENGTH,\n    {\n      min: 1,\n      integer: true,\n    },\n  );\n}\n\nfunction getDefaultTokensPerCharacter(): number {\n  return resolveNumericEnv(\n    [\"AI_TOKENS_PER_CHAR\", \"AI_TOKENS_PER_CHARACTER\"],\n    FALLBACK_TOKENS_PER_CHARACTER,\n    {\n      min: Number.EPSILON,\n    },\n  );\n}\n\nfunction getSafeModeTokenCeiling(): number {\n  return resolveNumericEnv(\n    \"SAFE_MODE_TOKEN_CEILING\",\n    SAFE_MODE_TOKEN_CEILING_FALLBACK,\n    {\n      min: 1,\n      integer: true,\n    },\n  );\n}\n\nfunction isServerSafeModeExplicitlyEnabled(): boolean {\n  if (typeof process === \"undefined\") {\n    return false;\n  }\n\n  const raw = process.env.SAFE_MODE;\n\n  if (typeof raw !== \"string\") {\n    return false;\n  }\n\n  const normalized = raw.trim().toLowerCase();\n\n  if (normalized.length === 0) {\n    return false;\n  }\n\n  return ENABLED_FLAG_VALUES.has(normalized);\n}\n\nexport interface SanitizedInputOptions {\n  readonly maxLength?: number;\n  readonly allowMarkup?: boolean;\n}\n\nexport function sanitizePrompt(\n  raw: string,\n  options: SanitizedInputOptions = {},\n): string {\n  const { maxLength = getDefaultMaxInputLength(), allowMarkup = false } = options;\n  const resolvedMaxLength = Number.isFinite(maxLength)\n    ? Math.max(Math.trunc(maxLength), 0)\n    : getDefaultMaxInputLength();\n  const normalized = raw\n    .replace(/\\r\\n?/g, \"\\n\")\n    .replace(CONTROL_CHAR_PATTERN, \"\")\n    .replace(INVISIBLE_CHAR_PATTERN, \"\")\n    .replace(/\\n{3,}/g, \"\\n\\n\")\n    .split(\"\\n\")\n    .map((line) => line.replace(COLLAPSE_SPACES_PATTERN, \" \").trimEnd())\n    .join(\"\\n\")\n    .trim();\n\n  const truncated =\n    resolvedMaxLength === 0 ? \"\" : unicodeTruncate(normalized, resolvedMaxLength);\n\n  return allowMarkup ? truncated : sanitizeText(truncated);\n}\n\nexport const sanitizePromptInput = sanitizePrompt;\n\nexport interface TokenBudgetContent {\n  readonly content: string;\n  readonly pinned?: boolean;\n}\n\nexport interface TokenBudgetOptions {\n  readonly maxTokens: number;\n  readonly reservedForResponse?: number;\n  readonly estimateTokens?: (content: string) => number;\n  readonly agent?: LlmAgentMetadata;\n}\n\nexport interface TokenBudgetResult<T extends TokenBudgetContent> {\n  readonly messages: readonly T[];\n  readonly removedCount: number;\n  readonly totalTokens: number;\n  readonly availableTokens: number;\n}\n\nfunction defaultTokenEstimator(content: string): number {\n  const tokensPerCharacter = getDefaultTokensPerCharacter();\n  const characterCount = unicodeLength(content);\n  if (characterCount === 0) {\n    return 0;\n  }\n  return Math.ceil(characterCount / tokensPerCharacter);\n}\n\nfunction normalizeTokenEstimate(raw: number, index: number): number {\n  if (!Number.isFinite(raw)) {\n    reportTokenEstimateIssue(index, raw, \"a non-finite value\");\n    return 0;\n  }\n\n  if (raw < 0) {\n    reportTokenEstimateIssue(index, raw, \"a negative value\");\n    return 0;\n  }\n\n  if (!Number.isInteger(raw)) {\n    reportTokenEstimateIssue(index, raw, \"a fractional value\");\n  }\n\n  return Math.ceil(raw);\n}\n\nfunction enforceTokenBudgetInternal<T extends TokenBudgetContent>(\n  messages: readonly T[],\n  options: TokenBudgetOptions,\n): TokenBudgetResult<T> {\n  const estimator = options.estimateTokens ?? defaultTokenEstimator;\n  const incomingReserved = options.reservedForResponse ?? 0;\n  const reserved = Number.isFinite(incomingReserved)\n    ? Math.max(Math.floor(incomingReserved), 0)\n    : 0;\n  const clientSafeMode = isSafeModeEnabled();\n  const serverSafeMode = isServerSafeModeExplicitlyEnabled();\n  const safeMode = clientSafeMode && serverSafeMode;\n  const safeReserved = safeMode\n    ? Math.max(reserved, SAFE_MODE_RESPONSE_RESERVE)\n    : reserved;\n  const incomingMaxTokens = Number.isFinite(options.maxTokens)\n    ? Math.max(Math.floor(options.maxTokens), 0)\n    : 0;\n  const safeMaxTokens = safeMode\n    ? Math.min(incomingMaxTokens, getSafeModeTokenCeiling())\n    : incomingMaxTokens;\n  const availableTokens = Math.max(safeMaxTokens - safeReserved, 0);\n\n  const kept: T[] = [];\n  let used = 0;\n  let removed = 0;\n\n  for (let index = messages.length - 1; index >= 0; index -= 1) {\n    const message = messages[index]!;\n    const estimate = estimator(message.content);\n    const tokens = normalizeTokenEstimate(estimate, index);\n    if (message.pinned) {\n      kept.push(message);\n      used += tokens;\n      continue;\n    }\n    if (used + tokens > availableTokens) {\n      removed += 1;\n      continue;\n    }\n    kept.push(message);\n    used += tokens;\n  }\n\n  kept.reverse();\n\n  const result: TokenBudgetResult<T> = {\n    messages: kept,\n    removedCount: removed,\n    totalTokens: used,\n    availableTokens,\n  };\n\n  if (options.agent) {\n    recordLlmTokenUsage(options.agent, result.totalTokens);\n  }\n\n  return result;\n}\n\nexport interface TokenCapResult {\n  readonly content: string | null;\n  readonly removed: boolean;\n  readonly totalTokens: number;\n  readonly availableTokens: number;\n}\n\nexport function capTokens(\n  content: string,\n  options: TokenBudgetOptions & { pinned?: boolean },\n): TokenCapResult;\nexport function capTokens<T extends TokenBudgetContent>(\n  messages: readonly T[],\n  options: TokenBudgetOptions,\n): TokenBudgetResult<T>;\nexport function capTokens<T extends TokenBudgetContent>(\n  input: string | readonly T[],\n  options: TokenBudgetOptions & { pinned?: boolean },\n): TokenBudgetResult<T> | TokenCapResult {\n  if (typeof input === \"string\") {\n    const { pinned, ...restOptions } = options as TokenBudgetOptions & { pinned?: boolean };\n    const result = enforceTokenBudgetInternal(\n      [\n        {\n          content: input,\n          pinned,\n        },\n      ],\n      restOptions,\n    );\n    const kept = result.messages[0];\n    return {\n      content: kept?.content ?? null,\n      removed: kept === undefined,\n      totalTokens: result.totalTokens,\n      availableTokens: result.availableTokens,\n    };\n  }\n\n  return enforceTokenBudgetInternal(input, options as TokenBudgetOptions);\n}\n\nexport function enforceTokenBudget<T extends TokenBudgetContent>(\n  messages: readonly T[],\n  options: TokenBudgetOptions,\n): TokenBudgetResult<T> {\n  return capTokens(messages, options);\n}\n\nexport interface SchemaValidationIssue {\n  readonly path: ReadonlyArray<string | number>;\n  readonly pathText: string;\n  readonly message: string;\n  readonly code?: string;\n}\n\nexport interface SchemaValidationFailure {\n  readonly label: string;\n  readonly issues: readonly SchemaValidationIssue[];\n  readonly cause?: unknown;\n}\n\nexport interface SchemaValidationOptions {\n  readonly label?: string;\n}\n\nexport interface SchemaValidationSuccess<T> {\n  readonly success: true;\n  readonly data: T;\n}\n\nexport interface SchemaValidationErrorResult {\n  readonly success: false;\n  readonly error: SchemaValidationFailure;\n}\n\nexport type SchemaValidationResult<T> =\n  | SchemaValidationSuccess<T>\n  | SchemaValidationErrorResult;\n\nexport function guardResponse<T>(\n  value: unknown,\n  schema: z.ZodType<T>,\n  options: SchemaValidationOptions = {},\n): SchemaValidationResult<T> {\n  const { label = \"AI response\" } = options;\n  try {\n    const parsed = schema.parse(value);\n    return {\n      success: true,\n      data: parsed,\n    };\n  } catch (error) {\n    reportSchemaValidationFailure(label, error);\n    if (error instanceof z.ZodError) {\n      const issues = error.issues.map<SchemaValidationIssue>((issue: z.ZodIssue) => {\n        const path = normalizeIssuePath(issue.path);\n        return {\n          path,\n          pathText: formatIssuePath(path),\n          message: normalizeIssueMessage(issue),\n          code: issue.code,\n        } satisfies SchemaValidationIssue;\n      });\n\n      return {\n        success: false,\n        error: {\n          label,\n          issues,\n          cause: error,\n        },\n      };\n    }\n\n    const message =\n      error instanceof Error ? error.message : \"Unexpected validation error\";\n\n    return {\n      success: false,\n      error: {\n        label,\n        issues: [\n          {\n            path: [],\n            pathText: formatIssuePath([]),\n            message,\n          },\n        ],\n        cause: error,\n      },\n    };\n  }\n}\n\nexport const validateSchema = guardResponse;\n\nexport interface StopSequenceOptions {\n  readonly stopSequences?: readonly string[];\n  readonly safeModeStopSequences?: readonly string[];\n}\n\nexport function withStopSequences<T extends { stopSequences?: readonly string[] }>(\n  payload: T,\n  options: StopSequenceOptions = {},\n): T & { stopSequences?: readonly string[] } {\n  const baseSequences = options.stopSequences ?? payload.stopSequences ?? [];\n  const safeModeSequences = options.safeModeStopSequences ?? baseSequences;\n  const targetSequences = isSafeModeEnabled() ? safeModeSequences : baseSequences;\n  const normalized = Array.from(\n    new Set(\n      targetSequences.filter(\n        (sequence): sequence is string =>\n          typeof sequence === \"string\" && sequence.trim().length > 0,\n      ),\n    ),\n  );\n\n  if (normalized.length === 0) {\n    const clone = { ...payload } as T & { stopSequences?: readonly string[] };\n    if (payload.stopSequences !== undefined || options.stopSequences !== undefined) {\n      clone.stopSequences = [];\n    } else {\n      delete clone.stopSequences;\n    }\n    return clone;\n  }\n\n  return {\n    ...payload,\n    stopSequences: normalized,\n  };\n}\n\nexport interface RetryOptions {\n  readonly maxAttempts?: number;\n  readonly initialDelayMs?: number;\n  readonly maxDelayMs?: number;\n  readonly jitterRatio?: number;\n  readonly signal?: AbortSignal;\n  readonly onRetry?: (context: {\n    readonly attempt: number;\n    readonly delayMs: number;\n    readonly error: unknown;\n  }) => void;\n}\n\nconst DEFAULT_MAX_ATTEMPTS = 3;\nconst DEFAULT_INITIAL_DELAY_MS = 250;\nconst DEFAULT_MAX_DELAY_MS = 4_000;\nconst DEFAULT_JITTER_RATIO = 0.25;\n\nfunction sleep(delayMs: number, signal?: AbortSignal): Promise<void> {\n  if (delayMs <= 0) return Promise.resolve();\n  return new Promise<void>((resolve, reject) => {\n    const timeout = setTimeout(() => {\n      cleanup();\n      resolve();\n    }, delayMs);\n\n    const cleanup = () => {\n      clearTimeout(timeout);\n      signal?.removeEventListener(\"abort\", handleAbort);\n    };\n\n    const handleAbort = () => {\n      cleanup();\n      reject(signal?.reason instanceof Error ? signal.reason : new Error(\"Aborted\"));\n    };\n\n    if (signal) {\n      if (signal.aborted) {\n        cleanup();\n        reject(signal.reason instanceof Error ? signal.reason : new Error(\"Aborted\"));\n        return;\n      }\n      signal.addEventListener(\"abort\", handleAbort);\n    }\n  });\n}\n\nexport async function retryWithJitter<T>(\n  operation: (context: { readonly attempt: number; readonly signal: AbortSignal }) => Promise<T>,\n  options: RetryOptions = {},\n): Promise<T> {\n  const {\n    maxAttempts = DEFAULT_MAX_ATTEMPTS,\n    initialDelayMs = DEFAULT_INITIAL_DELAY_MS,\n    maxDelayMs = DEFAULT_MAX_DELAY_MS,\n    jitterRatio = DEFAULT_JITTER_RATIO,\n    signal,\n    onRetry,\n  } = options;\n\n  let attempt = 0;\n  let delayMs = initialDelayMs;\n  const retryController = new AbortController();\n  const unlinkAbortSignals = signal\n    ? linkAbortSignals(retryController, signal)\n    : undefined;\n  const linkedSignal = retryController.signal;\n\n  try {\n    while (attempt < maxAttempts) {\n      attempt += 1;\n      try {\n        return await operation({ attempt, signal: linkedSignal });\n      } catch (error) {\n        if (linkedSignal.aborted) {\n          throw linkedSignal.reason ?? error;\n        }\n        if (attempt >= maxAttempts) {\n          throw error;\n        }\n        const jitter = 1 + (Math.random() * 2 - 1) * jitterRatio;\n        const nextDelay = Math.min(maxDelayMs, delayMs * jitter);\n        onRetry?.({ attempt, delayMs: nextDelay, error });\n        await sleep(nextDelay, linkedSignal);\n        delayMs = Math.min(maxDelayMs, nextDelay * 2);\n      }\n    }\n  } finally {\n    unlinkAbortSignals?.();\n  }\n\n  throw new Error(\"retryWithJitter exhausted all attempts without resolving\");\n}\n\nexport type ToolChoiceMode = \"auto\" | \"none\" | \"required\";\n\nexport interface ToolChoiceConfig {\n  readonly mode: ToolChoiceMode;\n  readonly maxToolCalls?: number;\n}\n\nexport interface ModelSafetyConfig {\n  readonly temperature?: number;\n  readonly topP?: number;\n  readonly toolChoice?: ToolChoiceConfig;\n}\n\nexport interface ModelSafetyResult extends ModelSafetyConfig {\n  readonly temperature: number;\n  readonly toolChoice: ToolChoiceConfig;\n  readonly safeMode: boolean;\n}\n\nconst DEFAULT_TEMPERATURE = 0.7;\nconst MIN_TEMPERATURE = 0;\nconst MAX_TEMPERATURE = 2;\nconst MIN_TOP_P = Number.EPSILON;\nconst MAX_TOP_P = 1;\n\nfunction normalizeTemperature(value: number | undefined): number {\n  if (typeof value !== \"number\" || !Number.isFinite(value)) {\n    return DEFAULT_TEMPERATURE;\n  }\n\n  const clamped = Math.min(Math.max(value, MIN_TEMPERATURE), MAX_TEMPERATURE);\n  return Number.isNaN(clamped) ? DEFAULT_TEMPERATURE : clamped;\n}\n\nfunction normalizeTopP(value: number | undefined): number | undefined {\n  if (typeof value !== \"number\" || !Number.isFinite(value)) {\n    return undefined;\n  }\n\n  const clamped = Math.min(Math.max(value, MIN_TOP_P), MAX_TOP_P);\n  return Number.isNaN(clamped) ? undefined : clamped;\n}\n\nfunction normalizeMaxToolCalls(value: number | undefined): number | undefined {\n  if (typeof value !== \"number\" || !Number.isFinite(value)) {\n    return undefined;\n  }\n\n  const rounded = Math.max(0, Math.trunc(value));\n  return Number.isNaN(rounded) ? undefined : rounded;\n}\n\nfunction normalizeToolChoice(value: ToolChoiceConfig | undefined): ToolChoiceConfig {\n  const normalizedMode =\n    value?.mode === \"auto\" || value?.mode === \"none\" || value?.mode === \"required\"\n      ? value.mode\n      : \"auto\";\n  const normalizedMax = normalizeMaxToolCalls(value?.maxToolCalls);\n\n  return {\n    mode: normalizedMode,\n    ...(normalizedMax !== undefined ? { maxToolCalls: normalizedMax } : {}),\n  } satisfies ToolChoiceConfig;\n}\n\nexport function applyModelSafety(config: ModelSafetyConfig = {}): ModelSafetyResult {\n  const safeMode = isSafeModeEnabled();\n  const temperature = normalizeTemperature(config.temperature);\n  const topP = normalizeTopP(config.topP);\n  const toolChoiceConfig = normalizeToolChoice(config.toolChoice);\n\n  const safeTemperature = safeMode\n    ? Math.min(temperature, SAFE_MODE_TEMPERATURE_CEILING)\n    : temperature;\n\n  const safeToolMax = safeMode\n    ? Math.min(\n        toolChoiceConfig.maxToolCalls ?? SAFE_MODE_MAX_TOOL_CALLS,\n        SAFE_MODE_MAX_TOOL_CALLS,\n      )\n    : toolChoiceConfig.maxToolCalls;\n\n  const toolChoice: ToolChoiceConfig = safeMode\n    ? {\n        mode: toolChoiceConfig.mode === \"none\" ? \"none\" : \"auto\",\n        ...(safeToolMax !== undefined ? { maxToolCalls: safeToolMax } : {}),\n      }\n    : {\n        mode: toolChoiceConfig.mode,\n        ...(safeToolMax !== undefined ? { maxToolCalls: safeToolMax } : {}),\n      };\n\n  return {\n    temperature: safeTemperature,\n    ...(topP !== undefined ? { topP } : {}),\n    toolChoice,\n    safeMode,\n  } satisfies ModelSafetyResult;\n}\n\nexport interface StreamingAbortController {\n  readonly signal: AbortSignal;\n  abort(reason?: unknown): void;\n  onAbort(listener: (reason: unknown) => void): () => void;\n  throwIfAborted(): void;\n}\n\nexport function createStreamingAbortController(\n  parentSignal?: AbortSignal,\n): StreamingAbortController {\n  const controller = new AbortController();\n  const listeners = new Set<(reason: unknown) => void>();\n\n  const notify = () => {\n    const reason = controller.signal.reason;\n    for (const listener of Array.from(listeners)) {\n      listener(reason);\n    }\n    listeners.clear();\n  };\n\n  controller.signal.addEventListener(\"abort\", notify, { once: true });\n\n  if (parentSignal) {\n    if (parentSignal.aborted) {\n      controller.abort(parentSignal.reason);\n    } else {\n      const handleParentAbort = () => {\n        controller.abort(parentSignal.reason);\n      };\n      parentSignal.addEventListener(\"abort\", handleParentAbort, { once: true });\n      controller.signal.addEventListener(\n        \"abort\",\n        () => parentSignal.removeEventListener(\"abort\", handleParentAbort),\n        { once: true },\n      );\n    }\n  }\n\n  return {\n    signal: controller.signal,\n    abort(reason?: unknown) {\n      if (!controller.signal.aborted) {\n        controller.abort(reason ?? new Error(\"Stream aborted\"));\n      }\n    },\n    onAbort(listener: (reason: unknown) => void) {\n      listeners.add(listener);\n      if (controller.signal.aborted) {\n        listener(controller.signal.reason);\n        listeners.delete(listener);\n        return () => undefined;\n      }\n      return () => {\n        listeners.delete(listener);\n      };\n    },\n    throwIfAborted() {\n      if (controller.signal.aborted) {\n        throw controller.signal.reason ?? new Error(\"Stream aborted\");\n      }\n    },\n  };\n}\n\nexport function linkAbortSignals(target: AbortController, ...sources: AbortSignal[]): () => void {\n  const removers: Array<() => void> = [];\n\n  for (const signal of sources) {\n    if (signal.aborted) {\n      target.abort(signal.reason);\n      continue;\n    }\n\n    const propagateAbort = () => {\n      target.abort(signal.reason);\n    };\n\n    const handleTargetAbort = () => {\n      signal.removeEventListener(\"abort\", propagateAbort);\n      target.signal.removeEventListener(\"abort\", handleTargetAbort);\n    };\n\n    signal.addEventListener(\"abort\", propagateAbort, { once: true });\n    target.signal.addEventListener(\"abort\", handleTargetAbort, { once: true });\n\n    removers.push(() => {\n      signal.removeEventListener(\"abort\", propagateAbort);\n      target.signal.removeEventListener(\"abort\", handleTargetAbort);\n    });\n  }\n\n  return () => {\n    for (const remove of removers) {\n      remove();\n    }\n  };\n}\n","import { z } from \"zod\";\n\nimport {\n  applyModelSafety,\n  enforceTokenBudget,\n  guardResponse,\n  sanitizePrompt,\n  type TokenBudgetContent,\n} from \"@/ai/safety\";\nimport type { ISODate } from \"@/components/planner\";\nimport {\n  parsePlannerPhrase,\n  summariseParse,\n  type PlannerParseConfidence,\n} from \"@/lib/scheduling\";\nimport { type LlmAgentMetadata } from \"@/lib/metrics/llmTokens\";\n\nconst SYSTEM_PROMPT = [\n  \"You are Planner, an assistant that helps people organise projects and daily tasks.\",\n  \"Extract actionable planner suggestions from the user's description and keep responses concise.\",\n  \"Prioritise clear wording and surface any detected dates, times, or recurring patterns.\",\n].join(\"\\n\");\n\nconst DEFAULT_MAX_TOKENS = 4_000;\nconst DEFAULT_RESPONSE_RESERVE = 512;\nconst SAFE_MODE_SUGGESTION_LIMIT = 3;\nconst DEFAULT_SUGGESTION_LIMIT = 5;\n\nconst ENABLED_FLAG_VALUES = new Set([\"1\", \"true\", \"on\", \"yes\"]);\n\nconst AGENT_METADATA: LlmAgentMetadata = {\n  id: \"planner.assistant\",\n  label: \"Planner Assistant\",\n  kind: \"planner\",\n};\n\nconst plannerAssistantSuggestionSchema = z.object({\n  id: z.string(),\n  title: z.string(),\n  intent: z.union([z.literal(\"task\"), z.literal(\"project\")]),\n  confidence: z.union([\n    z.literal(\"none\"),\n    z.literal(\"low\"),\n    z.literal(\"medium\"),\n    z.literal(\"high\"),\n  ]),\n  summary: z.string().nullable(),\n  schedule: z\n    .object({\n      date: z.string().optional(),\n      time: z.string().optional(),\n    })\n    .optional(),\n});\n\nconst plannerAssistantPlanSchema = z.object({\n  sanitizedPrompt: z.string(),\n  prompt: z.string(),\n  summary: z.string().nullable(),\n  suggestions: z.array(plannerAssistantSuggestionSchema),\n  safety: z.object({\n    safeMode: z.boolean(),\n    temperature: z.number(),\n    toolChoice: z.object({\n      mode: z.union([z.literal(\"auto\"), z.literal(\"none\"), z.literal(\"required\")]),\n      maxToolCalls: z.number().int().nonnegative().optional(),\n    }),\n    topP: z.number().optional(),\n  }),\n  tokenBudget: z.object({\n    totalTokens: z.number().int().nonnegative(),\n    availableTokens: z.number().int().nonnegative(),\n    removedCount: z.number().int().nonnegative(),\n  }),\n});\n\nexport type PlannerAssistantSuggestion = z.infer<\n  typeof plannerAssistantSuggestionSchema\n>;\nexport type PlannerAssistantPlan = z.infer<typeof plannerAssistantPlanSchema>;\n\nexport const plannerAssistantSuggestionValidator =\n  plannerAssistantSuggestionSchema;\nexport const plannerAssistantPlanValidator = plannerAssistantPlanSchema;\n\ntype PlannerAgentMessage = TokenBudgetContent & { role: \"system\" | \"user\" };\n\ntype PlannerAssistantIntent = \"task\" | \"project\";\n\nexport type PlannerAssistantOptions = {\n  readonly prompt: string;\n  readonly now?: Date;\n  readonly maxTokens?: number;\n  readonly reservedForResponse?: number;\n  readonly suggestionLimit?: number;\n};\n\nexport type PlannerAssistantErrorCode =\n  | \"empty_prompt\"\n  | \"budget_exhausted\"\n  | \"invalid_plan\";\n\nexport class PlannerAssistantError extends Error {\n  readonly code: PlannerAssistantErrorCode;\n\n  constructor(code: PlannerAssistantErrorCode, message: string) {\n    super(message);\n    this.code = code;\n    this.name = \"PlannerAssistantError\";\n  }\n}\n\nfunction isSafeModeFlagEnabled(value: string | undefined): boolean {\n  if (typeof value !== \"string\") {\n    return false;\n  }\n\n  const normalized = value.trim().toLowerCase();\n  if (!normalized) {\n    return false;\n  }\n\n  return ENABLED_FLAG_VALUES.has(normalized);\n}\n\nfunction createMessages(prompt: string): PlannerAgentMessage[] {\n  return [\n    {\n      role: \"system\",\n      content: SYSTEM_PROMPT,\n      pinned: true,\n    },\n    {\n      role: \"user\",\n      content: prompt,\n    },\n  ];\n}\n\nfunction extractUserPrompt(messages: readonly PlannerAgentMessage[]): string {\n  const userMessage = [...messages]\n    .reverse()\n    .find((message) => message.role === \"user\" && message.content.trim().length > 0);\n\n  return userMessage ? userMessage.content.trim() : \"\";\n}\n\nfunction splitSegments(input: string): string[] {\n  const trimmed = input.trim();\n  if (!trimmed) {\n    return [];\n  }\n\n  const segments = new Set<string>();\n  segments.add(trimmed);\n\n  const candidateLines = trimmed\n    .split(/\\n+/)\n    .map((line) => line.replace(/^[-*\\u2022]\\s*/, \"\").trim())\n    .filter((line) => line.length > 0);\n\n  for (const line of candidateLines) {\n    segments.add(line);\n  }\n\n  return Array.from(segments);\n}\n\nfunction toSuggestionId(index: number, title: string): string {\n  const normalized = title\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, \"-\")\n    .replace(/^-+|-+$/g, \"\");\n  if (!normalized) {\n    return `${index}`;\n  }\n  return `${index}-${normalized}`;\n}\n\nfunction toSchedule(\n  date?: ISODate,\n  time?: string,\n): PlannerAssistantSuggestion[\"schedule\"] {\n  if (!date && !time) {\n    return undefined;\n  }\n\n  return {\n    ...(date ? { date } : {}),\n    ...(time ? { time } : {}),\n  };\n}\n\nfunction synthesiseSuggestion(\n  text: string,\n  now: Date,\n  index: number,\n): PlannerAssistantSuggestion {\n  const parsed = parsePlannerPhrase(text, { now });\n  const title = parsed.event.title.trim() || text;\n  const summary = summariseParse(parsed);\n  const schedule = toSchedule(parsed.event.startDate, parsed.event.time);\n\n  return {\n    id: toSuggestionId(index, `${title}-${schedule?.date ?? \"\"}-${schedule?.time ?? \"\"}`),\n    title,\n    intent: parsed.intent as PlannerAssistantIntent,\n    confidence: parsed.confidence,\n    summary: summary.length > 0 ? summary : null,\n    ...(schedule ? { schedule } : {}),\n  } satisfies PlannerAssistantSuggestion;\n}\n\nfunction deduplicateSuggestions(\n  suggestions: PlannerAssistantSuggestion[],\n): PlannerAssistantSuggestion[] {\n  const seen = new Set<string>();\n  const result: PlannerAssistantSuggestion[] = [];\n\n  for (const suggestion of suggestions) {\n    const key = [\n      suggestion.intent,\n      suggestion.title.toLowerCase(),\n      suggestion.schedule?.date ?? \"\",\n      suggestion.schedule?.time ?? \"\",\n    ].join(\"|\");\n\n    if (seen.has(key)) {\n      continue;\n    }\n\n    seen.add(key);\n    result.push(suggestion);\n  }\n\n  return result;\n}\n\nexport function planWithAssistant(\n  options: PlannerAssistantOptions,\n): PlannerAssistantPlan {\n  const sanitizedPrompt = sanitizePrompt(options.prompt);\n  if (!sanitizedPrompt) {\n    throw new PlannerAssistantError(\n      \"empty_prompt\",\n      \"The planner assistant requires a non-empty prompt.\",\n    );\n  }\n\n  const safety = applyModelSafety();\n  const safeModeEnabled =\n    safety.safeMode && isSafeModeFlagEnabled(process.env.SAFE_MODE);\n\n  const messages = createMessages(sanitizedPrompt);\n  const budget = enforceTokenBudget(messages, {\n    maxTokens: options.maxTokens ?? DEFAULT_MAX_TOKENS,\n    reservedForResponse: options.reservedForResponse ?? DEFAULT_RESPONSE_RESERVE,\n    agent: AGENT_METADATA,\n  });\n\n  const finalPrompt = extractUserPrompt(budget.messages);\n  if (!finalPrompt) {\n    throw new PlannerAssistantError(\n      \"budget_exhausted\",\n      \"The planner assistant could not keep the user's prompt within the token budget.\",\n    );\n  }\n\n  const segments = splitSegments(finalPrompt);\n  const now = options.now ?? new Date();\n  const requestedLimit =\n    options.suggestionLimit ??\n    (safeModeEnabled ? SAFE_MODE_SUGGESTION_LIMIT : DEFAULT_SUGGESTION_LIMIT);\n\n  const limit = Math.max(\n    1,\n    safeModeEnabled\n      ? Math.min(requestedLimit, SAFE_MODE_SUGGESTION_LIMIT)\n      : requestedLimit,\n  );\n\n  const rawSuggestions = segments\n    .slice(0, limit * 2)\n    .map((segment, index) => synthesiseSuggestion(segment, now, index));\n  const suggestions = deduplicateSuggestions(rawSuggestions).slice(0, limit);\n\n  if (!suggestions.length) {\n    suggestions.push(\n      {\n        id: toSuggestionId(0, finalPrompt),\n        title: finalPrompt,\n        intent: \"task\",\n        confidence: \"none\" satisfies PlannerParseConfidence,\n        summary: null,\n      },\n    );\n  }\n\n  const summary = suggestions[0]?.summary ?? null;\n  const prompt = [SYSTEM_PROMPT, \"\", finalPrompt].join(\"\\n\");\n\n  const plan = {\n    sanitizedPrompt,\n    prompt,\n    summary,\n    suggestions,\n    safety: {\n      ...safety,\n      safeMode: safeModeEnabled,\n    },\n    tokenBudget: {\n      totalTokens: budget.totalTokens,\n      availableTokens: budget.availableTokens,\n      removedCount: budget.removedCount,\n    },\n  } satisfies PlannerAssistantPlan;\n\n  const validation = guardResponse(plan, plannerAssistantPlanSchema, {\n    label: \"planner assistant plan\",\n  });\n\n  if (!validation.success) {\n    throw new PlannerAssistantError(\n      \"invalid_plan\",\n      \"Planner assistant produced an invalid plan.\",\n    );\n  }\n\n  return validation.data;\n}\n","import { SAFE_MODE_FALLBACK } from '@env'\n\nconst ENABLED_FLAG_VALUES = new Set(['1', 'true', 'on', 'yes'])\nconst DISABLED_FLAG_VALUES = new Set(['0', 'false', 'off', 'no'])\n\nfunction normalizeFlag(value: string | undefined | null): boolean | null {\n  if (typeof value !== 'string') {\n    return null\n  }\n\n  const normalized = value.trim().toLowerCase()\n  if (!normalized) {\n    return null\n  }\n\n  if (ENABLED_FLAG_VALUES.has(normalized)) {\n    return true\n  }\n\n  if (DISABLED_FLAG_VALUES.has(normalized)) {\n    return false\n  }\n\n  return null\n}\n\nfunction resolveFlag(\n  primary: string | undefined,\n  secondary: string | undefined,\n): boolean {\n  return (\n    normalizeFlag(primary) ??\n    normalizeFlag(secondary) ??\n    normalizeFlag(SAFE_MODE_FALLBACK) ??\n    false\n  )\n}\n\nexport type PlannerAssistantSafeModeState = {\n  readonly server: boolean\n  readonly client: boolean\n  readonly active: boolean\n}\n\ntype PlannerAssistantSafeModeEnv = {\n  readonly SAFE_MODE?: string\n  readonly NEXT_PUBLIC_SAFE_MODE?: string\n  readonly [key: string]: string | undefined\n}\n\nexport function resolvePlannerAssistantSafeMode(\n  env: PlannerAssistantSafeModeEnv = process.env,\n): PlannerAssistantSafeModeState {\n  const server = resolveFlag(env.SAFE_MODE, env.NEXT_PUBLIC_SAFE_MODE)\n  const client = resolveFlag(env.NEXT_PUBLIC_SAFE_MODE, env.SAFE_MODE)\n\n  return {\n    server,\n    client,\n    active: server && client,\n  }\n}\n","import { z } from 'zod'\n\nimport { fromISODate } from '@/lib/date'\nimport {\n  PlannerAssistantError,\n  plannerAssistantPlanValidator,\n  planWithAssistant,\n} from '@/lib/assistant/plannerAgent'\nimport {\n  resolvePlannerAssistantSafeMode,\n  type PlannerAssistantSafeModeState,\n} from '@/lib/assistant/safe-mode'\n\nexport const plannerAssistantRequestSchema = z.object({\n  prompt: z.string(),\n  focusDate: z.string().optional(),\n  suggestionLimit: z.number().int().positive().max(10).optional(),\n})\n\nexport type PlannerAssistantActionInput = z.input<\n  typeof plannerAssistantRequestSchema\n>\n\nexport type PlannerAssistantActionSuccess = {\n  ok: true\n  plan: z.infer<typeof plannerAssistantPlanValidator>\n  safeMode: PlannerAssistantSafeModeState\n}\n\nexport type PlannerAssistantActionError = {\n  ok: false\n  error: string\n  message: string\n  safeMode: PlannerAssistantSafeModeState\n  issues?: unknown\n}\n\nexport type PlannerAssistantActionResult =\n  | PlannerAssistantActionSuccess\n  | PlannerAssistantActionError\n\nfunction formatValidationIssues(\n  issues: z.ZodIssue[],\n): Array<{ path: z.ZodIssue['path']; message: string }> {\n  return issues.map((issue) => ({\n    path: issue.path,\n    message: issue.message,\n  }))\n}\n\nexport async function planWithAssistantAction(\n  input: PlannerAssistantActionInput,\n): Promise<PlannerAssistantActionResult> {\n  const safeMode = resolvePlannerAssistantSafeMode()\n\n  if (safeMode.server !== safeMode.client) {\n    return {\n      ok: false,\n      error: 'safe_mode_mismatch',\n      message:\n        'Planner assistant is disabled because SAFE_MODE and NEXT_PUBLIC_SAFE_MODE do not match.',\n      safeMode,\n    } satisfies PlannerAssistantActionError\n  }\n\n  const parsed = plannerAssistantRequestSchema.safeParse(input)\n  if (!parsed.success) {\n    return {\n      ok: false,\n      error: 'invalid_request',\n      message: 'Invalid planner assistant request.',\n      safeMode,\n      issues: formatValidationIssues(parsed.error.issues),\n    } satisfies PlannerAssistantActionError\n  }\n\n  try {\n    const { prompt, focusDate, suggestionLimit } = parsed.data\n    const now = focusDate ? fromISODate(focusDate) ?? undefined : undefined\n    const plan = planWithAssistant({\n      prompt,\n      now,\n      suggestionLimit,\n    })\n\n    return {\n      ok: true,\n      plan,\n      safeMode,\n    } satisfies PlannerAssistantActionSuccess\n  } catch (error) {\n    if (error instanceof PlannerAssistantError) {\n      if (error.code === 'empty_prompt') {\n        return {\n          ok: false,\n          error: error.code,\n          message: 'Describe your plan before asking the assistant.',\n          safeMode,\n        } satisfies PlannerAssistantActionError\n      }\n\n      if (error.code === 'budget_exhausted') {\n        return {\n          ok: false,\n          error: error.code,\n          message: 'Planner assistant prompt exceeded the token budget.',\n          safeMode,\n        } satisfies PlannerAssistantActionError\n      }\n\n      return {\n        ok: false,\n        error: error.code,\n        message: 'Planner assistant produced an invalid response.',\n        safeMode,\n      } satisfies PlannerAssistantActionError\n    }\n\n    return {\n      ok: false,\n      error: 'internal_error',\n      message:\n        error instanceof Error ? error.message : 'Planner assistant failed.',\n      safeMode,\n    } satisfies PlannerAssistantActionError\n  }\n}\n","\"use client\";\n\nimport * as React from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { Bot, Loader2, Plus, CalendarClock, Sparkles } from \"lucide-react\";\nimport {\n  Button,\n  GlitchSegmentedButton,\n  GlitchSegmentedGroup,\n  IconButton,\n  Label,\n  NeoCard,\n  Select,\n  Textarea,\n  useDialogTrap,\n} from \"@/components/ui\";\nimport { cn } from \"@/lib/utils\";\nimport {\n  buildRecurringOccurrences,\n  parsePlannerPhrase,\n  summariseParse,\n} from \"@/lib/scheduling\";\nimport type { PlannerAssistantPlan } from \"@/lib/assistant/plannerAgent\";\nimport { planWithAssistantAction } from \"@/lib/assistant/plannerAssistantAction\";\nimport { type PlannerAssistantSafeModeState } from \"@/lib/assistant/safe-mode\";\nimport { fromISODate, toISODate } from \"@/lib/date\";\nimport {\n  usePlannerActions,\n  usePlannerStore,\n  makeCrud,\n  type ISODate,\n} from \"@/components/planner\";\n\nconst FLOATING_BUTTON_POSITION =\n  \"fixed bottom-[var(--space-8)] right-[max(var(--space-3),calc((var(--viewport-width) - var(--shell-max,var(--shell-width))) / 2 + var(--space-3)))] z-50\";\n\ntype Mode = \"task\" | \"project\";\n\nfunction describeAssistantError(error: string | undefined, fallback: string): string {\n  switch (error) {\n    case \"invalid_request\":\n      return \"Planner assistant request was invalid.\";\n    case \"safe_mode_mismatch\":\n      return \"Planner assistant is disabled until SAFE_MODE and NEXT_PUBLIC_SAFE_MODE match.\";\n    case \"empty_prompt\":\n      return \"Describe what you want before asking the planner assistant.\";\n    case \"budget_exhausted\":\n      return \"Your request is too long for the planner assistant.\";\n    default:\n      return fallback;\n  }\n}\n\nfunction formatConfidence(\n  confidence: PlannerAssistantPlan[\"suggestions\"][number][\"confidence\"],\n): string {\n  if (confidence === \"none\") {\n    return \"None\";\n  }\n  return confidence.replace(/^(.)/, (letter) => letter.toUpperCase());\n}\n\nfunction formatSchedule(\n  schedule: PlannerAssistantPlan[\"suggestions\"][number][\"schedule\"] | undefined,\n): string | null {\n  if (!schedule) {\n    return null;\n  }\n\n  if (schedule.date && schedule.time) {\n    return `${schedule.date} at ${schedule.time}`;\n  }\n\n  if (schedule.date) {\n    return schedule.date;\n  }\n\n  if (schedule.time) {\n    return schedule.time;\n  }\n\n  return null;\n}\n\ntype PlannerCreationDialogProps = {\n  open: boolean;\n  onClose: VoidFunction;\n  titleId: string;\n  descriptionId: string;\n  summaryId: string;\n  children: React.ReactNode;\n};\n\nfunction PlannerCreationDialog({\n  open,\n  onClose,\n  titleId,\n  descriptionId,\n  summaryId,\n  children,\n}: PlannerCreationDialogProps) {\n  const mountedRef = React.useRef(false);\n  const dialogRef = React.useRef<HTMLDivElement>(null);\n\n  React.useEffect(() => {\n    mountedRef.current = true;\n    return () => {\n      mountedRef.current = false;\n    };\n  }, []);\n\n  useDialogTrap({ open: open && mountedRef.current, onClose, ref: dialogRef });\n\n  if (!open || typeof document === \"undefined\") return null;\n\n  return createPortal(\n    <div className=\"fixed inset-0 z-50 flex items-end justify-center bg-[hsl(var(--bg)/0.85)] px-[var(--space-4)] pb-[var(--space-6)] pt-[var(--space-8)] sm:items-center sm:bg-[hsl(var(--bg)/0.8)]\">\n      <div\n        role=\"presentation\"\n        aria-hidden=\"true\"\n        className=\"absolute inset-0\"\n        onClick={onClose}\n      />\n      <NeoCard\n        ref={dialogRef}\n        role=\"dialog\"\n        aria-modal=\"true\"\n        aria-labelledby={titleId}\n        aria-describedby={descriptionId}\n        aria-details={summaryId}\n        className=\"relative w-full max-w-[min(calc(var(--space-16)*3+var(--space-8)),calc(var(--shell-width)*0.9))] card-pad space-y-[var(--space-5)]\"\n      >\n        <IconButton\n          aria-label=\"Close creation sheet\"\n          variant=\"quiet\"\n          tone=\"primary\"\n          size=\"sm\"\n          className=\"absolute right-[var(--space-3)] top-[var(--space-3)]\"\n          onClick={onClose}\n        >\n          <span className=\"sr-only\">Close planner creation sheet</span>\n          {/* Using Plus with rotation for consistent glyph weight */}\n          <Plus className=\"rotate-45\" />\n        </IconButton>\n        {children}\n      </NeoCard>\n    </div>,\n    document.body,\n  );\n}\n\nfunction useKeyboardShortcut(openSheet: VoidFunction) {\n  React.useEffect(() => {\n    const handle = (event: KeyboardEvent) => {\n      const key = event.key.toLowerCase();\n      const mod = event.metaKey || event.ctrlKey;\n      if (!mod) return;\n      if (event.shiftKey && key === \"n\") {\n        event.preventDefault();\n        openSheet();\n      }\n    };\n    window.addEventListener(\"keydown\", handle);\n    return () => window.removeEventListener(\"keydown\", handle);\n  }, [openSheet]);\n}\n\nconst SEGMENT_OPTIONS: Array<{ value: Mode; label: string }> = [\n  { value: \"task\", label: \"Task\" },\n  { value: \"project\", label: \"Project\" },\n];\n\nexport function PlannerFab() {\n  const { focus, getDay, upsertDay } = usePlannerStore();\n  const { createProject, createTask } = usePlannerActions();\n  const [open, setOpen] = React.useState(false);\n  const [mode, setMode] = React.useState<Mode>(\"task\");\n  const [inputValue, setInputValue] = React.useState(\"\");\n  const [selectedProjectId, setSelectedProjectId] = React.useState<string>(\"\");\n  const [error, setError] = React.useState<string | null>(null);\n  const [assistantPlan, setAssistantPlan] = React.useState<PlannerAssistantPlan | null>(null);\n  const [assistantError, setAssistantError] = React.useState<string | null>(null);\n  const [assistantSafeMode, setAssistantSafeMode] =\n    React.useState<PlannerAssistantSafeModeState | null>(null);\n  const [assistantLoading, startAssistantTransition] = React.useTransition();\n  const textareaRef = React.useRef<HTMLTextAreaElement>(null);\n  const assistantRequestIdRef = React.useRef(0);\n  const titleId = React.useId();\n  const descriptionId = React.useId();\n  const summaryId = React.useId();\n  const aiHeadingId = React.useId();\n  const aiDisclosureId = React.useId();\n\n  const focusDate = React.useMemo(() => fromISODate(focus) ?? new Date(), [focus]);\n\n  const parsed = React.useMemo(\n    () => parsePlannerPhrase(inputValue, { now: focusDate }),\n    [focusDate, inputValue],\n  );\n\n  const targetIso = React.useMemo<ISODate>(\n    () => parsed.event.startDate ?? focus,\n    [parsed.event.startDate, focus],\n  );\n\n  const targetDay = getDay(targetIso);\n  const projects = targetDay.projects;\n  const focusProjects = getDay(focus).projects;\n\n  React.useEffect(() => {\n    if (!open) return;\n    const frame = window.requestAnimationFrame(() => {\n      textareaRef.current?.focus({ preventScroll: true });\n    });\n    return () => window.cancelAnimationFrame(frame);\n  }, [open]);\n\n  React.useEffect(\n    () => () => {\n      assistantRequestIdRef.current += 1;\n    },\n    [],\n  );\n\n  React.useEffect(() => {\n    if (parsed.intent === \"project\" && parsed.confidence !== \"low\") {\n      setMode(\"project\");\n    }\n  }, [parsed.confidence, parsed.intent]);\n\n  React.useEffect(() => {\n    if (mode !== \"task\") return;\n    if (projects.some((project) => project.id === selectedProjectId)) return;\n    if (focusProjects.some((project) => project.id === selectedProjectId)) return;\n    const fallback = projects[0]?.id ?? focusProjects[0]?.id ?? \"\";\n    if (fallback !== selectedProjectId) {\n      setSelectedProjectId(fallback);\n    }\n  }, [focusProjects, mode, projects, selectedProjectId]);\n\n  React.useEffect(() => {\n    if (inputValue.trim()) {\n      return;\n    }\n    setAssistantPlan(null);\n    setAssistantError(null);\n    setAssistantSafeMode(null);\n    assistantRequestIdRef.current += 1;\n  }, [inputValue]);\n\n  React.useEffect(() => {\n    if (!open) {\n      setInputValue(\"\");\n      setError(null);\n      setMode(\"task\");\n      setAssistantPlan(null);\n      setAssistantError(null);\n      setAssistantSafeMode(null);\n      assistantRequestIdRef.current += 1;\n    }\n  }, [open]);\n\n  const recurringSuggestions = React.useMemo(() => {\n    if (!parsed.recurrence) return [] as ISODate[];\n    return buildRecurringOccurrences(parsed.recurrence, {\n      startDate: parsed.event.startDate ?? focus,\n      now: focusDate,\n      count: 3,\n    });\n  }, [focus, focusDate, parsed.event.startDate, parsed.recurrence]);\n\n  const summaryText = React.useMemo(() => summariseParse(parsed), [parsed]);\n\n  const openSheet = React.useCallback(() => {\n    setOpen(true);\n  }, []);\n\n  const closeSheet = React.useCallback(() => {\n    setOpen(false);\n  }, []);\n\n  useKeyboardShortcut(openSheet);\n\n  const handleSubmit = React.useCallback(\n    (isoOverride?: ISODate) => {\n      const trimmed = (parsed.event.title || inputValue).trim();\n      if (!trimmed) {\n        setError(\"Describe what you want to plan\");\n        return;\n      }\n      const iso = isoOverride ?? parsed.event.startDate ?? focus;\n      if (!iso) {\n        setError(\"Unable to determine a target date\");\n        return;\n      }\n\n      if (mode === \"project\" || parsed.intent === \"project\") {\n        const created = createProject({ iso, name: trimmed });\n        if (created) {\n          setError(null);\n          closeSheet();\n        } else {\n          setError(\"Enter a project name to continue\");\n        }\n        return;\n      }\n\n      const dayProjects = getDay(iso).projects;\n      let projectId = dayProjects.some((project) => project.id === selectedProjectId)\n        ? selectedProjectId\n        : dayProjects[0]?.id ?? \"\";\n      if (!projectId && selectedProjectId) {\n        const focusProjects = getDay(focus).projects;\n        const sourceProject = focusProjects.find(\n          (project) => project.id === selectedProjectId,\n        );\n        if (sourceProject) {\n          const clonedId = makeCrud(iso, upsertDay).addProject(sourceProject.name);\n          if (clonedId) {\n            projectId = clonedId;\n          }\n        }\n      }\n      if (!projectId) {\n        setError(\"Create a project for this day first\");\n        return;\n      }\n      if (projectId !== selectedProjectId) {\n        setSelectedProjectId(projectId);\n      }\n      const createdTaskId = createTask({ iso, projectId, title: trimmed });\n      if (!createdTaskId) {\n        setError(\"Unable to create a task\");\n        return;\n      }\n      if (parsed.event.time) {\n        makeCrud(iso, upsertDay).updateTaskReminder(createdTaskId, {\n          enabled: true,\n          time: parsed.event.time,\n          leadMinutes: 0,\n        });\n      }\n      setError(null);\n      closeSheet();\n    },\n    [\n      closeSheet,\n      createProject,\n      createTask,\n      focus,\n      getDay,\n      inputValue,\n      mode,\n      parsed.event.startDate,\n      parsed.event.time,\n      parsed.event.title,\n      parsed.intent,\n      selectedProjectId,\n      upsertDay,\n    ],\n  );\n\n  const handleSubmitEvent = React.useCallback(\n    (event: React.FormEvent<HTMLFormElement>) => {\n      event.preventDefault();\n      handleSubmit();\n    },\n    [handleSubmit],\n  );\n\n  const handleKeyDown = React.useCallback(\n    (event: React.KeyboardEvent<HTMLFormElement>) => {\n      if ((event.metaKey || event.ctrlKey) && event.key === \"Enter\") {\n        event.preventDefault();\n        handleSubmit();\n      }\n    },\n    [handleSubmit],\n  );\n\n  const handleAskAssistant = React.useCallback(() => {\n    const trimmed = inputValue.trim();\n    if (!trimmed) {\n      setAssistantPlan(null);\n      setAssistantError(\"Describe what you want before asking the planner assistant.\");\n      setAssistantSafeMode(null);\n      return;\n    }\n\n    setAssistantPlan(null);\n    setAssistantError(null);\n\n    const requestId = assistantRequestIdRef.current + 1;\n    assistantRequestIdRef.current = requestId;\n\n    startAssistantTransition(async () => {\n      try {\n        const result = await planWithAssistantAction({\n          prompt: trimmed,\n          focusDate: targetIso,\n        });\n\n        if (requestId !== assistantRequestIdRef.current) {\n          return;\n        }\n\n        if (result.ok) {\n          setAssistantSafeMode(result.safeMode);\n          setAssistantPlan(result.plan);\n          setAssistantError(null);\n          return;\n        }\n\n        setAssistantSafeMode(result.safeMode);\n        setAssistantPlan(null);\n        setAssistantError(\n          describeAssistantError(\n            result.error,\n            result.message ?? \"Planner assistant is unavailable.\",\n          ),\n        );\n      } catch (error) {\n        if (requestId !== assistantRequestIdRef.current) {\n          return;\n        }\n        setAssistantPlan(null);\n        setAssistantError(\n          error instanceof Error\n            ? error.message\n            : \"Planner assistant request failed.\",\n        );\n        setAssistantSafeMode(null);\n      }\n    });\n  }, [inputValue, startAssistantTransition, targetIso]);\n\n  const projectItems = React.useMemo(\n    () =>\n      projects.map((project) => ({\n        value: project.id,\n        label: project.name,\n      })),\n    [projects],\n  );\n\n  const hasRecurringSuggestions =\n    parsed.recurrence && recurringSuggestions.length > 0;\n  const showAiSuggestions = Boolean(summaryText || hasRecurringSuggestions);\n\n  return (\n    <>\n      <Button\n        aria-label=\"Open planner creation sheet\"\n        className={cn(\n          FLOATING_BUTTON_POSITION,\n          \"h-[var(--space-12)] min-w-[var(--space-12)] rounded-full px-[var(--space-5)] shadow-[var(--depth-shadow-outer-strong)]\",\n        )}\n        onClick={openSheet}\n        variant=\"default\"\n        tone=\"primary\"\n        size=\"lg\"\n      >\n        <Plus className=\"[&_path]:stroke-[2.2]\" />\n        <span className=\"sr-only\">Plan something new</span>\n      </Button>\n      <PlannerCreationDialog\n        open={open}\n        onClose={closeSheet}\n        titleId={titleId}\n        descriptionId={descriptionId}\n        summaryId={summaryId}\n      >\n        <div className=\"space-y-[var(--space-2)]\">\n          <h2\n            id={titleId}\n            className=\"text-title font-semibold tracking-[-0.01em] text-foreground\"\n          >\n            Plan something new\n          </h2>\n          <p\n            id={descriptionId}\n            className=\"text-label text-muted-foreground\"\n          >\n            Describe your plan in natural language or switch to manual mode. Press Cmd/Ctrl + Shift + N to open, Cmd/Ctrl + Enter to save.\n          </p>\n        </div>\n        <form\n          className=\"space-y-[var(--space-5)]\"\n          onSubmit={handleSubmitEvent}\n          onKeyDown={handleKeyDown}\n        >\n          <fieldset className=\"space-y-[var(--space-3)]\">\n            <legend className=\"text-label font-medium text-muted-foreground\">\n              Creation mode\n            </legend>\n            <GlitchSegmentedGroup\n              value={mode}\n              onChange={(value) => setMode(value as Mode)}\n              ariaLabelledby={undefined}\n              aria-label=\"Planner creation mode\"\n              className=\"max-w-max\"\n            >\n              {SEGMENT_OPTIONS.map((option) => (\n                <GlitchSegmentedButton key={option.value} value={option.value}>\n                  {option.label}\n                </GlitchSegmentedButton>\n              ))}\n            </GlitchSegmentedGroup>\n          </fieldset>\n          <div className=\"space-y-[var(--space-3)]\">\n            <Label htmlFor={`${titleId}-textarea`} className=\"text-label font-medium text-muted-foreground\">\n              What are you planning?\n            </Label>\n            <Textarea\n              id={`${titleId}-textarea`}\n              ref={textareaRef}\n              value={inputValue}\n              onChange={(event) => setInputValue(event.target.value)}\n              placeholder=\"Daily standup every weekday at 9am\"\n              resize=\"resize-none\"\n              rows={4}\n              className=\"[&_.textarea]:rounded-[var(--radius-card)]\"\n              textareaClassName=\"text-ui\"\n            />\n          </div>\n          {mode === \"task\" && (\n            <div className=\"space-y-[var(--space-3)]\">\n              <Label htmlFor={`${titleId}-project`} className=\"text-label font-medium text-muted-foreground\">\n                Select a project for {toISODate(targetIso)}\n              </Label>\n              <Select\n                id={`${titleId}-project`}\n                items={projectItems}\n                value={selectedProjectId}\n                onChange={setSelectedProjectId}\n                placeholder={projectItems.length ? undefined : \"No projects available\"}\n                disabled={!projectItems.length}\n                size=\"md\"\n              />\n            </div>\n          )}\n          {showAiSuggestions && (\n            <section\n              aria-labelledby={aiHeadingId}\n              aria-describedby={aiDisclosureId}\n              aria-live=\"polite\"\n              className=\"space-y-[var(--space-3)]\"\n            >\n              <div className=\"space-y-[var(--space-1)]\">\n                <p\n                  id={aiHeadingId}\n                  className=\"text-caption font-medium uppercase tracking-[0.2em] text-muted-foreground\"\n                >\n                  AI suggestions\n                </p>\n                <p className=\"sr-only\" role=\"note\">\n                  These planning suggestions are generated by AI.\n                </p>\n              </div>\n              {summaryText && (\n                <div\n                  id={summaryId}\n                  role=\"status\"\n                  aria-live=\"polite\"\n                  className=\"flex items-start gap-[var(--space-3)] rounded-[var(--radius-md)] bg-[hsl(var(--card)/0.6)] px-[var(--space-4)] py-[var(--space-3)] text-label text-muted-foreground\"\n                >\n                  <CalendarClock className=\"mt-[var(--space-0_5)] size-[var(--space-5)]\" aria-hidden />\n                  <div className=\"space-y-[var(--space-1)]\">\n                    <p className=\"text-caption font-medium uppercase tracking-[0.2em] text-muted-foreground\">\n                      AI suggestion\n                    </p>\n                    <p className=\"font-medium text-foreground\">AI-detected details</p>\n                    <p>{summaryText}</p>\n                  </div>\n                </div>\n              )}\n              {hasRecurringSuggestions && (\n                <div role=\"status\" aria-live=\"polite\" className=\"space-y-[var(--space-2)]\">\n                  <div className=\"space-y-[var(--space-1)]\">\n                    <p className=\"text-caption font-medium uppercase tracking-[0.2em] text-muted-foreground\">\n                      AI suggestion\n                    </p>\n                    <p className=\"flex items-center gap-[var(--space-2)] text-label font-medium text-muted-foreground\">\n                      <Sparkles className=\"size-[var(--space-4)]\" aria-hidden />\n                      AI upcoming occurrences\n                    </p>\n                  </div>\n                  <div className=\"flex flex-wrap gap-[var(--space-2)]\">\n                    {recurringSuggestions.map((iso) => (\n                      <Button\n                        key={iso}\n                        type=\"button\"\n                        variant=\"neo\"\n                        size=\"sm\"\n                        onClick={() => handleSubmit(iso)}\n                        className=\"rounded-full\"\n                      >\n                        {iso}\n                      </Button>\n                    ))}\n                  </div>\n                </div>\n              )}\n              <div\n                className=\"space-y-[var(--space-2)]\"\n                aria-live=\"polite\"\n              >\n                <div className=\"flex items-center gap-[var(--space-2)] text-label font-medium text-muted-foreground\">\n                  <Bot className=\"size-[var(--space-4)]\" aria-hidden />\n                  Planner assistant\n                </div>\n                {assistantPlan?.summary && (\n                  <p className=\"text-caption text-muted-foreground\">\n                    {assistantPlan.summary}\n                  </p>\n                )}\n                {assistantPlan?.suggestions.length ? (\n                  <ul className=\"space-y-[var(--space-2)]\">\n                    {assistantPlan.suggestions.map((suggestion) => {\n                      const scheduleText = formatSchedule(suggestion.schedule);\n                      return (\n                        <li\n                          key={suggestion.id}\n                          className=\"rounded-[var(--radius-md)] border border-dashed border-muted-foreground/40 px-[var(--space-4)] py-[var(--space-3)]\"\n                        >\n                          <p className=\"font-medium text-foreground\">{suggestion.title}</p>\n                          <p className=\"text-caption text-muted-foreground\">\n                            {suggestion.intent === \"project\" ? \"Project\" : \"Task\"}  Confidence {formatConfidence(suggestion.confidence)}\n                            {scheduleText ? `  ${scheduleText}` : \"\"}\n                          </p>\n                          {suggestion.summary && (\n                            <p className=\"text-label text-muted-foreground\">{suggestion.summary}</p>\n                          )}\n                        </li>\n                      );\n                    })}\n                  </ul>\n                ) : null}\n                {assistantError && (\n                  <p className=\"text-caption text-danger\" role=\"alert\">\n                    {assistantError}\n                  </p>\n                )}\n                {(assistantPlan?.safety.safeMode || assistantSafeMode?.active) && (\n                  <p className=\"text-caption text-muted-foreground\">\n                    Safe mode is active. Suggestions are limited for additional safety.\n                  </p>\n                )}\n                <Button\n                  type=\"button\"\n                  variant=\"neo\"\n                  size=\"sm\"\n                  onClick={handleAskAssistant}\n                  disabled={assistantLoading}\n                  className=\"flex items-center gap-[var(--space-2)] rounded-full\"\n                >\n                  {assistantLoading ? (\n                    <>\n                      <Loader2 className=\"size-[var(--space-4)] animate-spin\" aria-hidden />\n                      <span>Asking assistant</span>\n                    </>\n                  ) : (\n                    <>\n                      <Bot className=\"size-[var(--space-4)]\" aria-hidden />\n                      <span>Ask planner assistant</span>\n                    </>\n                  )}\n                </Button>\n              </div>\n              <p\n                id={aiDisclosureId}\n                className=\"text-caption text-muted-foreground\"\n                role=\"note\"\n              >\n                Prefer manual control? Cancel closes the composer and dismisses these AI suggestions.\n              </p>\n            </section>\n          )}\n          {error && (\n            <p className=\"text-label text-danger\" role=\"alert\">\n              {error}\n            </p>\n          )}\n          <div className=\"flex items-center justify-end gap-[var(--space-3)]\">\n            <Button\n              type=\"button\"\n              variant=\"quiet\"\n              onClick={closeSheet}\n              aria-describedby={showAiSuggestions ? aiDisclosureId : undefined}\n            >\n              Cancel\n            </Button>\n            <Button type=\"submit\" variant=\"default\" tone=\"primary\">\n              Save to planner\n            </Button>\n          </div>\n        </form>\n      </PlannerCreationDialog>\n    </>\n  );\n}\n","\"use client\";\n\nimport * as React from \"react\";\nimport { ensureDay } from \"./plannerSerialization\";\nimport type { ISODate } from \"./plannerTypes\";\nimport { usePlannerStore } from \"./usePlannerStore\";\n\nexport function useWeekData(days: ISODate[]) {\n  const { days: map } = usePlannerStore();\n\n  return React.useMemo(() => {\n    let weekDone = 0;\n    let weekTotal = 0;\n    const per = days.map((iso) => {\n      const record = ensureDay(map, iso);\n      const { doneCount, totalCount } = record;\n      weekDone += doneCount;\n      weekTotal += totalCount;\n      return { iso, done: doneCount, total: totalCount };\n    });\n    return { per, weekDone, weekTotal };\n  }, [days, map]);\n}\n","// src/lib/observability/sentry.ts\n// Lightweight Sentry wrapper with environment-based gating and structured logging.\n\nimport { observabilityLogger } from \"../logging\";\n\nconst sentryLog = observabilityLogger.child(\"sentry\");\nconst captureLog = sentryLog.child(\"capture\");\n\ntype SentryModule = typeof import(\"@sentry/nextjs\");\n\nconst rawDsn =\n  process.env.NEXT_PUBLIC_SENTRY_DSN?.trim() ||\n  process.env.SENTRY_DSN?.trim() ||\n  \"\";\nconst rawEnvironment =\n  process.env.NEXT_PUBLIC_SENTRY_ENVIRONMENT?.trim() ||\n  process.env.SENTRY_ENVIRONMENT?.trim() ||\n  process.env.NODE_ENV ||\n  \"development\";\nconst rawSampleRate =\n  process.env.NEXT_PUBLIC_SENTRY_TRACES_SAMPLE_RATE?.trim() ||\n  process.env.SENTRY_TRACES_SAMPLE_RATE?.trim() ||\n  \"\";\n\nconst isTestEnv = process.env.NODE_ENV === \"test\";\nconst sentryEnabled = Boolean(rawDsn) && !isTestEnv;\n\nlet hasInitialized = false;\nlet initializationPromise: Promise<SentryModule | null> | null = null;\nlet cachedSentry: SentryModule | null = null;\n\nfunction parseSampleRate(value: string): number | undefined {\n  if (!value) {\n    return undefined;\n  }\n  const parsed = Number.parseFloat(value);\n  if (Number.isNaN(parsed)) {\n    sentryLog.warn(\"Invalid Sentry sample rate provided\", { value });\n    return undefined;\n  }\n  return Math.min(Math.max(parsed, 0), 1);\n}\n\nconst tracesSampleRate = parseSampleRate(rawSampleRate) ?? (process.env.NODE_ENV === \"production\" ? 0.1 : 1);\n\nasync function loadSentry(): Promise<SentryModule | null> {\n  if (!sentryEnabled) {\n    return null;\n  }\n\n  if (cachedSentry) {\n    return cachedSentry;\n  }\n\n  if (!initializationPromise) {\n    initializationPromise = import(\"@sentry/nextjs\")\n      .then((sentry) => {\n        cachedSentry = sentry;\n        if (!hasInitialized) {\n          try {\n            sentry.init({\n              dsn: rawDsn,\n              environment: rawEnvironment,\n              enabled: sentryEnabled,\n              tracesSampleRate,\n              replaysSessionSampleRate: 0,\n              replaysOnErrorSampleRate: 0,\n              profilesSampleRate: 0,\n            });\n            hasInitialized = true;\n          } catch (error) {\n            sentryLog.error(\"Failed to initialize Sentry\", error);\n            return null;\n          }\n        }\n        return cachedSentry;\n      })\n      .catch((error: unknown) => {\n        sentryLog.error(\"Failed to load Sentry runtime\", error);\n        cachedSentry = null;\n        return null;\n      })\n      .finally(() => {\n        initializationPromise = null;\n      });\n  }\n\n  return initializationPromise;\n}\n\nexport type ObservabilityCaptureContext = Parameters<SentryModule[\"captureException\"]>[1];\n\nexport function isObservabilityEnabled(): boolean {\n  return sentryEnabled;\n}\n\nexport async function initializeObservability(): Promise<void> {\n  if (!sentryEnabled) {\n    return;\n  }\n\n  await loadSentry();\n}\n\nexport async function captureException(\n  error: unknown,\n  context?: ObservabilityCaptureContext,\n): Promise<void> {\n  if (!sentryEnabled) {\n    return;\n  }\n\n  const sentry = await loadSentry();\n  if (!sentry) {\n    sentryLog.warn(\"captureException skipped because Sentry is unavailable\", error);\n    return;\n  }\n\n  try {\n    sentry.captureException(error, context);\n  } catch (captureError) {\n    captureLog.error(\"Failed to capture exception with Sentry\", captureError, error);\n  }\n}\n","// src/lib/observability/boundary-error-reporter.ts\n// Centralized helper for logging and capturing error boundary exceptions.\n\nimport { observabilityLogger } from \"@/lib/logging\";\nimport { captureException } from \"./sentry\";\n\nconst boundaryLog = observabilityLogger.child(\"error-boundary\");\n\ntype BoundaryTags = Record<string, string>;\n\ntype BoundaryExtra = Record<string, unknown>;\n\ntype BoundaryInfo = Record<string, unknown>;\n\nexport type BoundaryErrorReport = {\n  boundary: string;\n  error: unknown;\n  info?: BoundaryInfo;\n  tags?: BoundaryTags;\n  extra?: BoundaryExtra;\n};\n\nexport function reportBoundaryError({\n  boundary,\n  error,\n  info,\n  tags,\n  extra,\n}: BoundaryErrorReport): void {\n  boundaryLog.error(\"Error boundary captured an exception\", {\n    boundary,\n    error,\n    info,\n    tags,\n    extra,\n  });\n\n  const boundaryTags: BoundaryTags = {\n    boundary,\n    ...(tags ?? {}),\n  };\n\n  const boundaryExtra: BoundaryExtra = {\n    boundary,\n    ...(extra ?? {}),\n  };\n\n  if (info) {\n    boundaryExtra.info = info;\n  }\n\n  void captureException(error, {\n    tags: boundaryTags,\n    extra: boundaryExtra,\n  });\n}\n","// src/components/planner/WeekSummary.tsx\n\"use client\";\nimport \"./style.css\";\n\nimport { SectionCard } from \"@/components/ui/layout/SectionCard\";\nimport { useWeek } from \"./useFocusDate\";\nimport { useWeekData } from \"./useWeekData\";\nimport type { ISODate } from \"./plannerTypes\";\nimport { cn } from \"@/lib/utils\";\nimport { formatWeekDay } from \"@/lib/date\";\n\n/**\n * WeekSummary\n * - variant=\"card\"    standalone SectionCard (default)\n * - variant=\"inline\"  compact block to embed inside other cards (no wrapper)\n *\n * Visual:\n * - Header shows range + compact total\n * - 7 tiles on xl, compress below\n * - Today = inner ring + left rail\n * - Calm zeros, tabular numbers\n *\n * Extras:\n * - bleed: when true, applies Hero-compatible full-bleed so totals reach the edge\n */\n\ntype Props = {\n  iso: ISODate;\n  variant?: \"card\" | \"inline\";\n  className?: string;\n  showLabel?: boolean;\n  /** Make content span to container edges (use inside Hero.bottom). */\n  bleed?: boolean;\n};\n\nexport function WeekSummary({\n  iso,\n  variant = \"card\",\n  className,\n  showLabel = true,\n  bleed = false,\n}: Props) {\n  const { days: weekDays, isToday } = useWeek(iso);\n  const { per: stats, weekDone: doneAll, weekTotal: totalAll } = useWeekData(weekDays);\n\n  const rangeLabel =\n    weekDays.length === 7\n      ? `${formatWeekDay(weekDays[0])}  ${formatWeekDay(weekDays[6])}`\n      : \"\";\n\n  const grid =\n    variant === \"inline\"\n      ? \"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 xl:grid-cols-7 gap-[var(--space-2)]\"\n      : \"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 xl:grid-cols-7 gap-[var(--space-3)]\";\n\n  const completionDescription = \"Completed / Total items this week\";\n\n  const completionContent = (\n    <>\n      <span className=\"badge__icon\"></span>\n      <span className=\"tabular-nums\">{doneAll}</span>/\n      <span className=\"tabular-nums\">{totalAll}</span>\n    </>\n  );\n\n  const completionBadge = (\n    <span\n      className=\"badge badge--sm\"\n      role=\"status\"\n      aria-live=\"polite\"\n      title={completionDescription}\n      aria-label={completionDescription}\n    >\n      {completionContent}\n    </span>\n  );\n\n  const inlineHeader =\n    variant === \"inline\" && showLabel ? (\n      <div className=\"mb-[var(--space-2)] flex items-start justify-between gap-[var(--space-2)]\">\n        <div className=\"flex flex-col gap-[var(--space-2)] text-label tracking-[0.02em] text-muted-foreground\">\n          <span className=\"uppercase font-semibold\">Week</span>\n          {rangeLabel ? <span className=\"font-medium\">{rangeLabel}</span> : null}\n        </div>\n        <span\n          className=\"pill pill--medium font-semibold\"\n          role=\"status\"\n          aria-live=\"polite\"\n          aria-label={completionDescription}\n          title={completionDescription}\n        >\n          {completionContent}\n        </span>\n      </div>\n    ) : null;\n\n  const tiles = (\n    <div className={grid} role=\"list\" aria-label=\"Week days summary\">\n      {stats.map((s) => {\n        const today = isToday(s.iso);\n        const empty = s.total === 0;\n        const friendlyDay = formatWeekDay(s.iso);\n        const countsLabel = `${s.done} of ${s.total} done`;\n        return (\n          <div\n            key={s.iso}\n            role=\"listitem\"\n            className={cn(\n              \"ws-tile group\",\n              variant === \"inline\"\n                ? \"p-[var(--space-2)] rounded-card r-card-lg\"\n                : \"p-[var(--space-3)] rounded-card r-card-lg\",\n              today && \"ws-tile--today\",\n              empty && \"ws-tile--empty\",\n            )}\n            data-today={today || undefined}\n            aria-label={`${friendlyDay}: ${countsLabel}`}\n          >\n            <div className=\"ws-tile__date\">{friendlyDay}</div>\n            <div\n              className={cn(\n                \"ws-tile__counts\",\n                variant === \"inline\" ? \"text-body\" : \"text-title\",\n              )}\n            >\n              <span className=\"tabular-nums\">{s.done}</span>\n              <span className=\"opacity-60\"> / </span>\n              <span className=\"tabular-nums\">{s.total}</span>\n            </div>\n            {today ? <span aria-hidden className=\"ws-rail\" /> : null}\n          </div>\n        );\n      })}\n    </div>\n  );\n\n  const content = (\n    <div className={cn(className, bleed && \"ws-bleed\")}>\n      {inlineHeader}\n      {tiles}\n    </div>\n  );\n\n  if (variant === \"inline\") return content;\n\n  return (\n    <SectionCard className=\"card-neo\">\n      <SectionCard.Header\n        className=\"items-start gap-[var(--space-3)]\"\n        titleAs=\"h6\"\n        titleClassName=\"flex flex-col gap-[var(--space-2)]\"\n        title={\n          <>\n            <span className=\"text-title font-semibold tracking-tight\">Week Summary</span>\n            {rangeLabel ? (\n              <span className=\"text-label font-medium text-muted-foreground\">\n                {rangeLabel}\n              </span>\n            ) : null}\n          </>\n        }\n        actions={completionBadge}\n      />\n      <SectionCard.Body>{content}</SectionCard.Body>\n    </SectionCard>\n  );\n}\n\n","\"use client\";\n\nimport \"./style.css\";\nimport * as React from \"react\";\nimport { uid, usePersistentState } from \"@/lib/db\";\nimport {\n  RemindersProvider,\n  RemindersContext,\n  useReminders,\n  type RemindersContextValue,\n} from \"../goals/reminders/useReminders\";\nimport { addDays, toISODate, weekRangeFromISO } from \"@/lib/date\";\nimport type { Goal } from \"@/lib/types\";\nimport { ACTIVE_CAP, decodeGoals, type AddGoalInput } from \"../goals/goalsPersistence\";\nimport {\n  decodePlannerDays,\n  decodePlannerFocus,\n  pruneOldDays,\n  sanitizeDayRecord,\n  todayISO,\n  FOCUS_PLACEHOLDER,\n  HYDRATION_TODAY,\n  ensureDay,\n} from \"./plannerSerialization\";\nimport type {\n  DayRecord,\n  DayTask,\n  ISODate,\n  Selection,\n} from \"./plannerTypes\";\nimport {\n  setFocus as applyFocusToDay,\n  setNotes as applyNotesToDay,\n} from \"./plannerCrud\";\n\ntype DaysUpdateMetadata = {\n  days: Record<ISODate, DayRecord>;\n  changed?: Iterable<ISODate>;\n};\n\ntype DaysUpdateTuple = readonly [\n  Record<ISODate, DayRecord>,\n  Iterable<ISODate>,\n];\n\ntype DaysUpdateResult =\n  | Record<ISODate, DayRecord>\n  | DaysUpdateMetadata\n  | DaysUpdateTuple;\n\ntype DaysSetStateAction =\n  | DaysUpdateResult\n  | ((current: Record<ISODate, DayRecord>) => DaysUpdateResult);\n\ntype DaysDispatch = (action: DaysSetStateAction) => void;\n\nfunction isPlainObject(value: unknown): value is Record<string, unknown> {\n  return typeof value === \"object\" && value !== null && !Array.isArray(value);\n}\n\nfunction isDaysUpdateMetadata(value: DaysUpdateResult): value is DaysUpdateMetadata {\n  if (!isPlainObject(value)) return false;\n  if (!Object.prototype.hasOwnProperty.call(value, \"days\")) return false;\n  const candidate = (value as { days?: unknown }).days;\n  return isPlainObject(candidate);\n}\n\nfunction normalizeChangedList(\n  changed?: Iterable<ISODate>,\n): ISODate[] | undefined {\n  if (!changed) return undefined;\n  if (typeof changed === \"string\") {\n    return [changed as ISODate];\n  }\n  const seen = new Set<ISODate>();\n  for (const iso of changed) {\n    if (typeof iso === \"string\") {\n      seen.add(iso as ISODate);\n    }\n  }\n  return seen.size ? Array.from(seen) : undefined;\n}\n\nfunction extractDaysUpdate(update: DaysUpdateResult) {\n  if (Array.isArray(update)) {\n    const [days, changed] = update;\n    return { days, changed: normalizeChangedList(changed) };\n  }\n  if (isDaysUpdateMetadata(update)) {\n    return {\n      days: update.days,\n      changed: normalizeChangedList(update.changed),\n    };\n  }\n  return { days: update as Record<ISODate, DayRecord>, changed: undefined };\n}\n\ntype SelectionMap = Partial<Record<ISODate, Selection>>;\n\nfunction cleanupSelections(\n  selected: SelectionMap,\n  days: Record<ISODate, DayRecord>,\n): SelectionMap {\n  let result = selected;\n  let mutated = false;\n\n  for (const iso of Object.keys(selected)) {\n    const selection = selected[iso];\n    const day = days[iso];\n    const projectId = selection?.projectId;\n    const taskId = selection?.taskId;\n\n    if (!day || (!projectId && !taskId)) {\n      if (!mutated) {\n        mutated = true;\n        result = { ...result };\n      }\n      delete result[iso];\n      continue;\n    }\n\n    if (\n      projectId &&\n      !day.projects.some((project) => project.id === projectId)\n    ) {\n      if (!mutated) {\n        mutated = true;\n        result = { ...result };\n      }\n      delete result[iso];\n      continue;\n    }\n\n    if (\n      taskId &&\n      !(day.tasksById?.[taskId] ?? day.tasks.find((task) => task.id === taskId))\n    ) {\n      if (!mutated) {\n        mutated = true;\n        result = { ...result };\n      }\n      delete result[iso];\n    }\n  }\n\n  return mutated ? result : selected;\n}\n\ntype TaskIdMap = Record<ISODate, Record<string, DayTask>>;\n\ntype DaysState = {\n  days: Record<ISODate, DayRecord>;\n  setDays: DaysDispatch;\n  tasksById: TaskIdMap;\n};\n\ntype FocusState = {\n  focus: ISODate;\n  setFocus: React.Dispatch<React.SetStateAction<ISODate>>;\n  today: ISODate;\n};\n\ntype SelectionState = {\n  selected: SelectionMap;\n  setSelected: React.Dispatch<React.SetStateAction<SelectionMap>>;\n};\n\ntype PlannerWeek = {\n  start: Date;\n  end: Date;\n  days: ISODate[];\n  isToday: (iso: ISODate) => boolean;\n};\n\ntype PlannerGoalsState = {\n  goals: Goal[];\n  err: string | null;\n  setErr: React.Dispatch<React.SetStateAction<string | null>>;\n  lastDeleted: Goal | null;\n  addGoal: (input: AddGoalInput) => boolean;\n  toggleDone: (id: string) => void;\n  removeGoal: (id: string) => void;\n  updateGoal: (\n    id: string,\n    updates: Pick<Goal, \"title\" | \"metric\" | \"notes\">\n  ) => boolean;\n  undoRemove: VoidFunction;\n  clearGoals: VoidFunction;\n};\n\ntype PlannerState = {\n  iso: ISODate;\n  today: ISODate;\n  hydrated: boolean;\n  setIso: React.Dispatch<React.SetStateAction<ISODate>>;\n  viewMode: PlannerViewMode;\n  setViewMode: React.Dispatch<React.SetStateAction<PlannerViewMode>>;\n  week: PlannerWeek;\n  goals: PlannerGoalsState;\n  reminders: RemindersContextValue;\n  getFocus: (iso: ISODate) => string;\n  updateFocus: (iso: ISODate, value: string) => void;\n  getNote: (iso: ISODate) => string;\n  updateNote: (iso: ISODate, value: string) => void;\n};\n\nexport type PlannerViewMode = \"day\" | \"week\" | \"month\" | \"agenda\";\n\nconst DaysContext = React.createContext<DaysState | null>(null);\nconst FocusContext = React.createContext<FocusState | null>(null);\nconst SelectionContext = React.createContext<SelectionState | null>(null);\nconst PlannerStateContext = React.createContext<PlannerState | null>(null);\nconst PlannerRemindersContext = React.createContext<\n  RemindersContextValue | null\n>(null);\n\nfunction PlannerProviderInner({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  const [rawDays, setRawDays] = usePersistentState<Record<ISODate, DayRecord>>(\n    \"planner:days\",\n    {},\n    { decode: decodePlannerDays },\n  );\n  const [focus, setFocus] = usePersistentState<ISODate>(\n    \"planner:focus\",\n    FOCUS_PLACEHOLDER,\n    { decode: decodePlannerFocus },\n  );\n  const [selectedState, setSelectedState] = usePersistentState<SelectionMap>(\n    \"planner:selected\",\n    {},\n  );\n  const [viewMode, setViewMode] = usePersistentState<PlannerViewMode>(\n    \"planner:view-mode\",\n    \"day\",\n  );\n  const [today, setToday] = React.useState<ISODate>(FOCUS_PLACEHOLDER);\n  const [goalList, setGoalList] = usePersistentState<Goal[]>(\"goals.v2\", [], {\n    decode: decodeGoals,\n  });\n  const [goalErr, setGoalErr] = React.useState<string | null>(null);\n  const [lastDeletedGoal, setLastDeletedGoal] = React.useState<Goal | null>(\n    null,\n  );\n  const goalUndoTimer = React.useRef<ReturnType<typeof setTimeout> | null>(\n    null,\n  );\n  const reminders = useReminders();\n  const [hydrated, setHydrated] = React.useState(false);\n\n  const days = rawDays;\n  const [tasksById, setTasksById] = React.useState<TaskIdMap>(() => {\n    const initial: TaskIdMap = {};\n    for (const [iso, record] of Object.entries(rawDays)) {\n      initial[iso as ISODate] = record.tasksById ?? {};\n    }\n    return initial;\n  });\n  const tasksByIdRef = React.useRef<TaskIdMap>(tasksById);\n  const rawDaysRef = React.useRef(rawDays);\n\n  React.useEffect(() => {\n    tasksByIdRef.current = tasksById;\n  }, [tasksById]);\n\n  React.useEffect(() => {\n    rawDaysRef.current = rawDays;\n  }, [rawDays]);\n\n  React.useEffect(() => {\n    if (typeof window === \"undefined\") return;\n    const localToday = todayISO();\n    setToday((prev) => (prev === localToday ? prev : localToday));\n    setFocus((prev) => {\n      if (prev === FOCUS_PLACEHOLDER || prev === HYDRATION_TODAY) {\n        return localToday;\n      }\n      return prev;\n    });\n  }, [setFocus]);\n\n  const markHydrated = React.useCallback(() => {\n    setHydrated((prev) => (prev ? prev : true));\n  }, []);\n\n  React.useEffect(() => {\n    if (hydrated) return;\n    if (today !== FOCUS_PLACEHOLDER) {\n      markHydrated();\n    }\n  }, [hydrated, markHydrated, today]);\n\n  React.useEffect(() => {\n    if (hydrated) return;\n    if (focus !== FOCUS_PLACEHOLDER && focus !== HYDRATION_TODAY) {\n      markHydrated();\n    }\n  }, [focus, hydrated, markHydrated]);\n\n  React.useEffect(() => {\n    return () => {\n      if (goalUndoTimer.current) {\n        clearTimeout(goalUndoTimer.current);\n        goalUndoTimer.current = null;\n      }\n    };\n  }, []);\n\n  const addGoal = React.useCallback(\n    ({ title, metric, notes, pillar }: AddGoalInput) => {\n      setGoalErr(null);\n      const trimmedTitle = title.trim();\n      if (!trimmedTitle) {\n        setGoalErr(\"Title required.\");\n        return false;\n      }\n      const normalizedTitle = trimmedTitle.toLowerCase();\n      const hasDuplicate = goalList.some(\n        (goal) => goal.title.trim().toLowerCase() === normalizedTitle,\n      );\n      if (hasDuplicate) {\n        setGoalErr(\"Goal already exists.\");\n        return false;\n      }\n      const currentActive = goalList.filter((goal) => !goal.done).length;\n      if (currentActive >= ACTIVE_CAP) {\n        setGoalErr(\"Cap reached. Mark something done first.\");\n        return false;\n      }\n      const nextGoal: Goal = {\n        id: uid(),\n        title: trimmedTitle,\n        ...(pillar ? { pillar } : {}),\n        metric: metric.trim() || undefined,\n        notes: notes.trim() || undefined,\n        done: false,\n        createdAt: Date.now(),\n      };\n      setGoalList((prev) => [nextGoal, ...prev]);\n      return true;\n    },\n    [goalList, setGoalErr, setGoalList],\n  );\n\n  const toggleGoalDone = React.useCallback(\n    (id: string) => {\n      setGoalErr(null);\n      setGoalList((prev) => {\n        let activeCount = 0;\n        let found = false;\n        let targetWasDone = false;\n\n        const next = prev.map((goal) => {\n          if (goal.id === id) {\n            found = true;\n            targetWasDone = goal.done;\n            const nextDone = !goal.done;\n            if (!nextDone) {\n              activeCount += 1;\n            }\n            return { ...goal, done: nextDone };\n          }\n\n          if (!goal.done) {\n            activeCount += 1;\n          }\n          return goal;\n        });\n\n        if (!found) {\n          return prev;\n        }\n\n        if (targetWasDone && activeCount > ACTIVE_CAP) {\n          setGoalErr(\"Cap is 3 active. Complete or delete another first.\");\n          return prev;\n        }\n\n        return next;\n      });\n    },\n    [setGoalErr, setGoalList],\n  );\n\n  const removeGoal = React.useCallback(\n    (id: string) => {\n      setGoalErr(null);\n      setGoalList((prev) => {\n        let removed: Goal | null = null;\n        const next = prev.filter((entry) => {\n          if (entry.id === id) {\n            removed = entry;\n            return false;\n          }\n          return true;\n        });\n        if (!removed) {\n          return prev;\n        }\n        setLastDeletedGoal(removed);\n        if (goalUndoTimer.current) {\n          clearTimeout(goalUndoTimer.current);\n          goalUndoTimer.current = null;\n        }\n        goalUndoTimer.current = setTimeout(() => {\n          setLastDeletedGoal(null);\n          goalUndoTimer.current = null;\n        }, 5000);\n        return next;\n      });\n    },\n    [setGoalErr, setGoalList],\n  );\n\n  const clearGoals = React.useCallback(() => {\n    setGoalErr(null);\n    setGoalList(() => []);\n    setLastDeletedGoal(null);\n    if (goalUndoTimer.current) {\n      clearTimeout(goalUndoTimer.current);\n      goalUndoTimer.current = null;\n    }\n  }, [setGoalList]);\n\n  const updateGoal = React.useCallback(\n    (id: string, updates: Pick<Goal, \"title\" | \"metric\" | \"notes\">) => {\n      let updated = false;\n      setGoalList((prev) => {\n        const index = prev.findIndex((goal) => goal.id === id);\n        if (index === -1) {\n          return prev;\n        }\n\n        const current = prev[index];\n        const next = { ...current };\n\n        const hasTitleUpdate = Object.prototype.hasOwnProperty.call(\n          updates,\n          \"title\",\n        );\n        if (hasTitleUpdate) {\n          const trimmedTitle = updates.title.trim();\n          if (!trimmedTitle) {\n            setGoalErr(\"Title required.\");\n            return prev;\n          }\n          const normalizedTitle = trimmedTitle.toLowerCase();\n          const duplicate = prev.some(\n            (goal, goalIndex) =>\n              goalIndex !== index &&\n              goal.title.trim().toLowerCase() === normalizedTitle,\n          );\n          if (duplicate) {\n            setGoalErr(\"Goal already exists.\");\n            return prev;\n          }\n          next.title = trimmedTitle;\n        }\n\n        const metricDefined = Object.prototype.hasOwnProperty.call(\n          updates,\n          \"metric\",\n        );\n        if (metricDefined) {\n          const trimmedMetric = updates.metric?.trim();\n          next.metric = trimmedMetric ? trimmedMetric : undefined;\n        }\n\n        const notesDefined = Object.prototype.hasOwnProperty.call(\n          updates,\n          \"notes\",\n        );\n        if (notesDefined) {\n          const trimmedNotes = updates.notes?.trim();\n          next.notes = trimmedNotes ? trimmedNotes : undefined;\n        }\n\n        const didChange =\n          next.title !== current.title ||\n          next.metric !== current.metric ||\n          next.notes !== current.notes;\n\n        if (!didChange) {\n          setGoalErr(null);\n          updated = true;\n          return prev;\n        }\n\n        setGoalErr(null);\n        updated = true;\n        const copy = [...prev];\n        copy[index] = next;\n        return copy;\n      });\n      return updated;\n    },\n    [setGoalErr, setGoalList],\n  );\n\n  const undoRemoveGoal = React.useCallback(() => {\n    if (!lastDeletedGoal) return;\n    setGoalList((prev) => [lastDeletedGoal, ...prev]);\n    setLastDeletedGoal(null);\n    if (goalUndoTimer.current) {\n      clearTimeout(goalUndoTimer.current);\n      goalUndoTimer.current = null;\n    }\n  }, [lastDeletedGoal, setGoalList]);\n\n  React.useEffect(() => {\n    if (typeof window === \"undefined\") return;\n\n    let cancelled = false;\n\n    const updateForNewDay = () => {\n      if (cancelled) return;\n      const nextToday = todayISO();\n\n      setToday((prevToday) => {\n        setFocus((prevFocus) => {\n          if (\n            prevFocus === FOCUS_PLACEHOLDER ||\n            prevFocus === HYDRATION_TODAY ||\n            prevFocus === prevToday\n          ) {\n            return nextToday;\n          }\n          return prevFocus;\n        });\n\n        return nextToday;\n      });\n    };\n\n    const scheduleNextTick = () => {\n      const now = new Date();\n      const next = new Date(now);\n      next.setDate(now.getDate() + 1);\n      next.setHours(0, 0, 0, 0);\n      const delay = Math.max(0, next.getTime() - now.getTime());\n      return setTimeout(() => {\n        updateForNewDay();\n        timeoutId = scheduleNextTick();\n      }, delay);\n    };\n\n    let timeoutId: ReturnType<typeof setTimeout> = scheduleNextTick();\n\n    return () => {\n      cancelled = true;\n      clearTimeout(timeoutId);\n    };\n  }, [setFocus, setToday]);\n\n  const selected = React.useMemo(\n    () => cleanupSelections(selectedState, days),\n    [selectedState, days],\n  );\n\n  React.useEffect(() => {\n    if (!Object.is(selected, selectedState)) {\n      setSelectedState(selected);\n    }\n  }, [selected, selectedState, setSelectedState]);\n\n  React.useEffect(() => {\n    if (!Object.is(rawDays, days)) {\n      setRawDays(days);\n    }\n  }, [rawDays, days, setRawDays]);\n\n  const setDays = React.useCallback<DaysDispatch>(\n    (action) => {\n      const prev = rawDaysRef.current;\n      const currentTasksById = tasksByIdRef.current;\n\n      const resolved =\n        typeof action === \"function\"\n          ? (action as (\n              current: Record<ISODate, DayRecord>,\n            ) => DaysUpdateResult)(prev)\n          : action;\n\n      const { days: next, changed } = extractDaysUpdate(resolved);\n\n      const { days: prunedDays, pruned } = pruneOldDays(next);\n      let result = prunedDays;\n      let mutated = !Object.is(result, next);\n\n      const impactedIsos = new Set<ISODate>();\n      const newIsos = new Set<ISODate>();\n      const removedIsos = new Set<ISODate>();\n\n      const explicitChanges = changed ? new Set(changed) : undefined;\n\n      if (changed) {\n        for (const iso of changed) {\n          impactedIsos.add(iso);\n        }\n      } else {\n        for (const iso of Object.keys(result) as ISODate[]) {\n          impactedIsos.add(iso);\n        }\n      }\n\n      if (pruned) {\n        for (const iso of pruned) {\n          removedIsos.add(iso);\n          impactedIsos.add(iso);\n        }\n      }\n\n      if (!changed) {\n        for (const iso of Object.keys(prev) as ISODate[]) {\n          if (Object.prototype.hasOwnProperty.call(result, iso)) {\n            continue;\n          }\n          removedIsos.add(iso);\n          impactedIsos.add(iso as ISODate);\n        }\n      }\n\n      for (const iso of impactedIsos) {\n        const hadPrev = Object.prototype.hasOwnProperty.call(prev, iso);\n        const hasNext = Object.prototype.hasOwnProperty.call(result, iso);\n        if (!hasNext) {\n          if (hadPrev) {\n            removedIsos.add(iso);\n          }\n          continue;\n        }\n\n        const prevRecord = prev[iso];\n        const nextRecord = result[iso];\n        const isNewIso = !hadPrev;\n        const pointerChanged = prevRecord !== nextRecord;\n        const explicitlyChanged = explicitChanges?.has(iso) ?? false;\n\n        if (!explicitlyChanged && !isNewIso && !pointerChanged) {\n          continue;\n        }\n\n        if (isNewIso) {\n          newIsos.add(iso);\n        }\n\n        const ensured = sanitizeDayRecord(result, iso);\n        if (!ensured) continue;\n        if (!mutated) {\n          mutated = true;\n          result = { ...result };\n        }\n        result[iso] = ensured;\n      }\n\n      if (!mutated && Object.is(prev, result) && removedIsos.size === 0) {\n        if (impactedIsos.size === 0) {\n          return;\n        }\n      }\n\n      const nextUpdates: Array<[ISODate, Record<string, DayTask>]> = [];\n      for (const iso of impactedIsos) {\n        if (!Object.prototype.hasOwnProperty.call(result, iso)) {\n          continue;\n        }\n        const record = result[iso];\n        if (!record) continue;\n        const nextTasks = record.tasksById ?? {};\n        if (newIsos.has(iso) || currentTasksById[iso] !== nextTasks) {\n          nextUpdates.push([iso, nextTasks]);\n        }\n      }\n\n      const nextRemovals =\n        removedIsos.size > 0 ? Array.from(removedIsos) : undefined;\n\n      if (Object.is(prev, result) && nextUpdates.length === 0 && !nextRemovals) {\n        return;\n      }\n\n      if (!Object.is(prev, result)) {\n        rawDaysRef.current = result;\n        setRawDays(result);\n      }\n\n      if (nextUpdates.length === 0 && !nextRemovals) {\n        return;\n      }\n\n      setTasksById((prevMap) => {\n        let nextMap = prevMap;\n        let mutatedMap = false;\n\n        if (nextRemovals) {\n          for (const iso of nextRemovals) {\n            if (!Object.prototype.hasOwnProperty.call(nextMap, iso)) {\n              continue;\n            }\n            if (!mutatedMap) {\n              mutatedMap = true;\n              nextMap = { ...nextMap };\n            }\n            delete nextMap[iso];\n          }\n        }\n\n        if (nextUpdates.length) {\n          for (const [iso, map] of nextUpdates) {\n            if (nextMap[iso] === map) continue;\n            if (!mutatedMap) {\n              mutatedMap = true;\n              nextMap = { ...nextMap };\n            }\n            nextMap[iso] = map;\n          }\n        }\n\n        if (mutatedMap) {\n          tasksByIdRef.current = nextMap;\n          return nextMap;\n        }\n\n        return prevMap;\n      });\n    },\n    [setRawDays, setTasksById],\n  );\n\n  const daysValue = React.useMemo(\n    () => ({ days, setDays, tasksById }),\n    [days, setDays, tasksById],\n  );\n  const focusValue = React.useMemo(\n    () => ({ focus, setFocus, today }),\n    [focus, setFocus, today],\n  );\n  const setSelected = React.useCallback<\n    React.Dispatch<React.SetStateAction<SelectionMap>>\n  >(\n    (update) => {\n      setSelectedState((prev) => {\n        const next =\n          typeof update === \"function\"\n            ? (\n                update as (current: SelectionMap) => SelectionMap\n              )(prev)\n            : update;\n\n        if (Object.is(prev, next)) {\n          return prev;\n        }\n        return next;\n      });\n    },\n    [setSelectedState],\n  );\n  const selectionValue = React.useMemo(\n    () => ({ selected, setSelected }),\n    [selected, setSelected],\n  );\n\n  const iso = focus === FOCUS_PLACEHOLDER ? today : focus;\n  const normalizedIso =\n    iso === FOCUS_PLACEHOLDER ? HYDRATION_TODAY : iso;\n  const isToday = React.useCallback(\n    (candidate: ISODate) =>\n      today !== FOCUS_PLACEHOLDER && candidate === today,\n    [today],\n  );\n  const week = React.useMemo(() => {\n    const { start, end } = weekRangeFromISO(normalizedIso);\n    const weekDays: ISODate[] = [];\n    for (let i = 0; i < 7; i += 1) {\n      weekDays.push(toISODate(addDays(start, i)));\n    }\n    return { start, end, days: weekDays, isToday } as const;\n  }, [normalizedIso, isToday]);\n\n  const getDayFocus = React.useCallback(\n    (targetIso: ISODate) => {\n      const record = days[targetIso] ?? ensureDay(days, targetIso);\n      return record.focus ?? \"\";\n    },\n    [days],\n  );\n\n  const updateDayFocus = React.useCallback(\n    (targetIso: ISODate, value: string) => {\n      setDays((prev) => {\n        const base = ensureDay(prev, targetIso);\n        if ((base.focus ?? \"\") === value) {\n          return prev;\n        }\n        const next = applyFocusToDay(base, value);\n        return { ...prev, [targetIso]: next };\n      });\n    },\n    [setDays],\n  );\n\n  const getNote = React.useCallback(\n    (targetIso: ISODate) => {\n      const record = days[targetIso] ?? ensureDay(days, targetIso);\n      return record.notes ?? \"\";\n    },\n    [days],\n  );\n\n  const updateNote = React.useCallback(\n    (targetIso: ISODate, value: string) => {\n      setDays((prev) => {\n        const base = ensureDay(prev, targetIso);\n        if ((base.notes ?? \"\") === value) {\n          return prev;\n        }\n        const next = applyNotesToDay(base, value);\n        return { ...prev, [targetIso]: next };\n      });\n    },\n    [setDays],\n  );\n\n  const goalsValue = React.useMemo(\n    () => ({\n      goals: goalList,\n      err: goalErr,\n      setErr: setGoalErr,\n      lastDeleted: lastDeletedGoal,\n      addGoal,\n      toggleDone: toggleGoalDone,\n      removeGoal,\n      updateGoal,\n      undoRemove: undoRemoveGoal,\n      clearGoals,\n    }),\n    [\n      goalList,\n      goalErr,\n      setGoalErr,\n      lastDeletedGoal,\n      addGoal,\n      toggleGoalDone,\n      removeGoal,\n      updateGoal,\n      undoRemoveGoal,\n      clearGoals,\n    ],\n  );\n\n  const plannerValue = React.useMemo(\n    () => ({\n      iso,\n      today,\n      hydrated,\n      setIso: setFocus,\n      viewMode,\n      setViewMode,\n      week,\n      goals: goalsValue,\n      reminders,\n      getFocus: getDayFocus,\n      updateFocus: updateDayFocus,\n      getNote,\n      updateNote,\n    }),\n    [\n      iso,\n      today,\n      hydrated,\n      setFocus,\n      viewMode,\n      setViewMode,\n      week,\n      goalsValue,\n      reminders,\n      getDayFocus,\n      updateDayFocus,\n      getNote,\n      updateNote,\n    ],\n  );\n\n  return React.createElement(\n    DaysContext.Provider,\n    { value: daysValue },\n    React.createElement(\n      FocusContext.Provider,\n      { value: focusValue },\n      React.createElement(\n        SelectionContext.Provider,\n        { value: selectionValue },\n        React.createElement(\n          PlannerRemindersContext.Provider,\n          { value: reminders },\n          React.createElement(\n            PlannerStateContext.Provider,\n            { value: plannerValue },\n            children as React.ReactNode,\n          ),\n        ),\n      ),\n    ),\n  );\n}\n\nexport function PlannerProvider({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  const reminders = React.useContext(RemindersContext);\n  if (reminders) {\n    return <PlannerProviderInner>{children}</PlannerProviderInner>;\n  }\n  return (\n    <RemindersProvider>\n      <PlannerProviderInner>{children}</PlannerProviderInner>\n    </RemindersProvider>\n  );\n}\n\nexport function useDays(): DaysState {\n  const ctx = React.useContext(DaysContext);\n  if (!ctx)\n    throw new Error(\n      \"PlannerProvider missing. Wrap your planner page with <PlannerProvider>.\",\n    );\n  return ctx;\n}\n\nexport function useFocus(): FocusState {\n  const ctx = React.useContext(FocusContext);\n  if (!ctx)\n    throw new Error(\n      \"PlannerProvider missing. Wrap your planner page with <PlannerProvider>.\",\n    );\n  return ctx;\n}\n\nexport function useSelection(): SelectionState {\n  const ctx = React.useContext(SelectionContext);\n  if (!ctx)\n    throw new Error(\n      \"PlannerProvider missing. Wrap your planner page with <PlannerProvider>.\",\n    );\n  return ctx;\n}\n\nexport function usePlanner(): PlannerState {\n  const ctx = React.useContext(PlannerStateContext);\n  if (!ctx)\n    throw new Error(\n      \"PlannerProvider missing. Wrap your planner page with <PlannerProvider>.\",\n    );\n  return ctx;\n}\n\nexport function usePlannerReminders(): RemindersContextValue {\n  const ctx = React.useContext(PlannerRemindersContext);\n  if (!ctx)\n    throw new Error(\n      \"PlannerProvider missing. Wrap your planner page with <PlannerProvider>.\",\n    );\n  return ctx;\n}\n","// Auto-generated by scripts/generate-feature-index.ts\n// Do not edit directly.\nexport { createDayTextFieldHook } from \"./createDayTextFieldHook\";\nexport { DayCard } from \"./DayCard\";\nexport { DayCardHeader } from \"./DayCardHeader\";\nexport { addProject, addTask, addTaskImage, removeProject, removeTask, removeTaskImage, renameProject, renameTask, toggleProject, toggleTask, updateTaskReminder } from \"./dayCrud\";\nexport { DayRow } from \"./DayRow\";\nexport { EmptyRow } from \"./EmptyRow\";\nexport { FocusPanel } from \"./FocusPanel\";\nexport { PlannerProvider, useDays, useFocus, usePlanner, usePlannerReminders, useSelection } from \"./plannerContext\";\nexport type { PlannerViewMode } from \"./plannerContext\";\nexport { makeCrud, setFocus, setNotes } from \"./plannerCrud\";\nexport type { UpsertDay } from \"./plannerCrud\";\nexport { PlannerFab } from \"./PlannerFab\";\nexport { PlannerIslandBoundary } from \"./PlannerIslandBoundary\";\nexport { PlannerListPanel } from \"./PlannerListPanel\";\nexport { PlannerPage } from \"./PlannerPage\";\nexport { buildTaskLookups, computeDayCounts, decodePlannerDays, decodePlannerFocus, DEFAULT_MAX_DAY_AGE_DAYS, ensureDay, FOCUS_PLACEHOLDER, HYDRATION_TODAY, pruneOldDays, sanitizeDayRecord, sanitizeTaskReminder, taskRemindersEqual, todayISO } from \"./plannerSerialization\";\nexport type { PruneOldDaysOptions, PruneOldDaysReport } from \"./plannerSerialization\";\nexport type { DayRecord, DayTask, ISODate, Project, Selection, TaskReminder } from \"./plannerTypes\";\nexport { ProjectList } from \"./ProjectList\";\nexport { scheduleSavingReset } from \"./scheduleSavingReset\";\nexport { ScrollTopFloatingButton } from \"./ScrollTopFloatingButton\";\nexport { TaskList } from \"./TaskList\";\nexport { TaskReminderSettings } from \"./TaskReminderSettings\";\nexport { TaskRow } from \"./TaskRow\";\nexport { TodayHero } from \"./TodayHero\";\nexport { TodayHeroHeader } from \"./TodayHeroHeader\";\nexport { TodayHeroProjects } from \"./TodayHeroProjects\";\nexport type { TodayHeroProjectsProps } from \"./TodayHeroProjects\";\nexport { TodayHeroTasks } from \"./TodayHeroTasks\";\nexport type { TodayHeroTasksProps } from \"./TodayHeroTasks\";\nexport { useDay } from \"./useDay\";\nexport { useDayFocus } from \"./useDayFocus\";\nexport { useDayNotes } from \"./useDayNotes\";\nexport { useFocusDate, useWeek } from \"./useFocusDate\";\nexport { usePlannerActions, usePlannerStore } from \"./usePlannerStore\";\nexport { useSelectedProject, useSelectedTask, useSelectionState } from \"./useSelection\";\nexport { useTodayHeroProjects } from \"./useTodayHeroProjects\";\nexport { useTodayHeroTasks } from \"./useTodayHeroTasks\";\nexport { useWeekData } from \"./useWeekData\";\nexport { AgendaView } from \"./views/AgendaView\";\nexport { DayView } from \"./views/DayView\";\nexport { MonthView } from \"./views/MonthView\";\nexport { WeekView } from \"./views/WeekView\";\nexport { WeekNotes } from \"./WeekNotes\";\nexport { WeekPicker } from \"./WeekPicker\";\nexport { WeekPickerShell } from \"./WeekPickerShell\";\nexport { WeekSummary } from \"./WeekSummary\";\n","\"use client\";\n\nimport * as React from \"react\";\nimport { PageShell } from \"@/components/ui/layout/PageShell\";\nimport { cn } from \"@/lib/utils\";\nimport { addDays, formatWeekDay, toISODate } from \"@/lib/date\";\nimport { useWeek, useFocusDate } from \"../useFocusDate\";\nimport { usePlannerStore } from \"../usePlannerStore\";\nimport { ensureDay } from \"../plannerSerialization\";\nimport { PlannerIslandBoundary } from \"../PlannerIslandBoundary\";\n\nexport function AgendaView() {\n  const { iso } = useFocusDate();\n  const { start, isToday } = useWeek(iso);\n  const { days: map } = usePlannerStore();\n\n  const entries = React.useMemo(() => {\n    const list: {\n      iso: string;\n      label: string;\n      done: number;\n      total: number;\n      projects: number;\n      tasks: { id: string; title: string; done: boolean }[];\n      isToday: boolean;\n    }[] = [];\n    for (let index = 0; index < 14; index += 1) {\n      const dateIso = toISODate(addDays(start, index));\n      const record = ensureDay(map, dateIso);\n      const pending = record.tasks.filter((task) => !task.done);\n      const shownTasks = pending.length > 0 ? pending : record.tasks;\n      list.push({\n        iso: dateIso,\n        label: formatWeekDay(dateIso),\n        done: record.doneCount,\n        total: record.totalCount,\n        projects: record.projects.length,\n        tasks: shownTasks.map((task) => ({\n          id: task.id,\n          title: task.title,\n          done: task.done,\n        })),\n        isToday: isToday(dateIso),\n      });\n    }\n    return list;\n  }, [isToday, map, start]);\n\n  const headerId = React.useId();\n\n  return (\n    <PageShell\n      as=\"section\"\n      grid\n      className=\"py-[var(--space-6)]\"\n      contentClassName=\"gap-y-[var(--space-6)]\"\n      aria-labelledby={headerId}\n    >\n      <header className=\"col-span-full flex flex-col gap-[var(--space-3)]\">\n        <h2 id={headerId} className=\"text-title font-semibold tracking-tight\">\n          Agenda view\n        </h2>\n        <p className=\"text-body text-muted-foreground max-w-prose\">\n          Scan the next two weeks. Upcoming tasks show first; finished days still\n          list their history so you can revisit context without leaving the\n          agenda.\n        </p>\n      </header>\n\n      <PlannerIslandBoundary\n        name=\"planner:agenda-view:list\"\n        title=\"Agenda unavailable\"\n        description=\"We couldn't load the upcoming agenda. Retry to rebuild the list.\"\n        retryLabel=\"Retry agenda\"\n        variant=\"plain\"\n        fallbackClassName=\"col-span-full space-y-[var(--space-4)]\"\n      >\n        <ol className=\"col-span-full space-y-[var(--space-4)]\">\n          {entries.map((entry) => (\n            <li key={entry.iso}>\n              <article\n                aria-labelledby={`${entry.iso}-heading`}\n                className={cn(\n                  \"rounded-card border border-border/40 bg-card/80 p-[var(--space-4)] shadow-sm\",\n                  \"flex flex-col gap-[var(--space-3)]\",\n                  entry.isToday && \"ring-1 ring-ring/60\",\n                )}\n              >\n                <header className=\"flex flex-wrap items-center gap-[var(--space-3)]\">\n                  <h3\n                    id={`${entry.iso}-heading`}\n                    className=\"text-ui font-semibold tracking-wide\"\n                  >\n                    {entry.label}\n                  </h3>\n                  <span className=\"badge badge--sm\" aria-live=\"polite\">\n                    <span className=\"tabular-nums\">{entry.done}</span>\n                    <span aria-hidden className=\"px-[var(--space-1)] opacity-60\">\n                      /\n                    </span>\n                    <span className=\"tabular-nums\">{entry.total}</span>\n                  </span>\n                  <span className=\"text-label text-muted-foreground\">\n                    {entry.projects} projects\n                  </span>\n                </header>\n\n                {entry.tasks.length ? (\n                  <ul className=\"space-y-[var(--space-2)]\">\n                    {entry.tasks.map((task) => (\n                      <li\n                        key={task.id}\n                        className={cn(\n                          \"rounded-[var(--radius-md)] border border-border/30 px-[var(--space-3)] py-[var(--space-2)]\",\n                          \"bg-card/90 text-body flex items-center gap-[var(--space-3)]\",\n                          task.done && \"opacity-70 line-through\",\n                        )}\n                      >\n                        <span\n                          className={cn(\n                            \"inline-flex h-[var(--space-3)] w-[var(--space-3)] items-center justify-center rounded-full border\",\n                            task.done\n                              ? \"border-success/60 text-success\"\n                              : \"border-muted-foreground/40 text-muted-foreground\",\n                          )}\n                          aria-hidden\n                        >\n                          {task.done ? \"\" : \"\"}\n                        </span>\n                        <span className=\"flex-1 truncate\" title={task.title}>\n                          {task.title}\n                        </span>\n                      </li>\n                    ))}\n                  </ul>\n                ) : (\n                  <p className=\"text-label text-muted-foreground\">\n                    No tasks scheduled.\n                  </p>\n                )}\n              </article>\n            </li>\n          ))}\n        </ol>\n      </PlannerIslandBoundary>\n    </PageShell>\n  );\n}\n","\"use client\";\n\n/**\n * TodayHero  day-scoped. Single project selection shared via useSelectedProject/useSelectedTask.\n * - No default selection. Select via UI or when adding a project/task.\n * - Animated progress bar for the selected project's tasks.\n */\n\nimport { useEffect, useMemo } from \"react\";\n\nimport { GlitchProgress, TOKEN_WIDTH_CLASS } from \"@/components/ui\";\nimport { cn } from \"@/lib/utils\";\n\nimport type { ISODate } from \"./plannerTypes\";\nimport { TodayHeroHeader } from \"./TodayHeroHeader\";\nimport { TodayHeroProjects } from \"./TodayHeroProjects\";\nimport { TodayHeroTasks } from \"./TodayHeroTasks\";\nimport { useDay } from \"./useDay\";\nimport { useFocusDate } from \"./useFocusDate\";\nimport { useSelectedProject, useSelectedTask } from \"./useSelection\";\nimport { useTodayHeroProjects } from \"./useTodayHeroProjects\";\nimport { useTodayHeroTasks } from \"./useTodayHeroTasks\";\n\ntype Props = { iso?: ISODate };\n\nexport function TodayHero({ iso }: Props) {\n  const { iso: isoActive, setIso, today } = useFocusDate();\n  const viewIso = iso ?? isoActive;\n  const isToday = viewIso === today;\n\n  useEffect(() => {\n    if (iso && iso !== isoActive) setIso(iso);\n  }, [iso, isoActive, setIso]);\n\n  const {\n    projects,\n    tasks,\n    renameTask,\n    toggleTask,\n    deleteTask,\n    renameProject,\n    deleteProject,\n    toggleProject,\n  } = useDay(viewIso);\n\n  const [selProjectId, setSelProjectId] = useSelectedProject(viewIso);\n  const [, setSelTaskId] = useSelectedTask(viewIso);\n\n  const selectedProjectName = useMemo(() => {\n    const project = projects.find((p) => p.id === selProjectId);\n    return project?.name ?? \"\";\n  }, [projects, selProjectId]);\n\n  const scopedTasks = useMemo(\n    () => (selProjectId ? tasks.filter((t) => t.projectId === selProjectId) : []),\n    [tasks, selProjectId],\n  );\n\n  const { done, total } = useMemo<{ done: number; total: number }>(\n    () =>\n      scopedTasks.reduce<{ done: number; total: number }>(\n        (acc, task) => {\n          acc.total += 1;\n          if (task.done) acc.done += 1;\n          return acc;\n        },\n        { done: 0, total: 0 },\n      ),\n    [scopedTasks],\n  );\n\n  const heroProgressLabel = selectedProjectName\n    ? `Tasks completed for ${selectedProjectName}`\n    : \"Tasks completed\";\n\n  const projectState = useTodayHeroProjects({\n    iso: viewIso,\n    projects,\n    selectedProjectId: selProjectId,\n    setSelectedProjectId: setSelProjectId,\n    renameProject,\n    deleteProject,\n    toggleProject,\n  });\n\n  const taskState = useTodayHeroTasks({\n    iso: viewIso,\n    scopedTasks,\n    projectId: selProjectId,\n    projectName: selectedProjectName,\n    renameTask,\n    deleteTask,\n    toggleTask,\n    setSelectedTaskId: setSelTaskId,\n  });\n\n  return (\n    <section className=\"bg-hero-soft rounded-card r-card-lg card-pad-lg anim-in\">\n      <TodayHeroHeader viewIso={viewIso} isToday={isToday} onChange={setIso} />\n\n      <GlitchProgress\n        current={done}\n        total={total}\n        showPercentage\n        className=\"mb-[var(--space-4)] flex items-center gap-[var(--space-3)]\"\n        trackClassName=\"w-full\"\n        percentageClassName={cn(\"text-right\", TOKEN_WIDTH_CLASS)}\n        aria-label={heroProgressLabel}\n      />\n\n      <TodayHeroProjects\n        projects={projects}\n        selectedProjectId={selProjectId}\n        projectsListId={projectState.projectsListId}\n        projectName={projectState.projectName}\n        editingProjectId={projectState.editingProjectId}\n        editingProjectName={projectState.editingProjectName}\n        showAllProjects={projectState.showAllProjects}\n        visibleProjects={projectState.visibleProjects}\n        hiddenProjectsCount={projectState.hiddenProjectsCount}\n        shouldShowProjectToggle={projectState.shouldShowProjectToggle}\n        onProjectNameChange={projectState.handleProjectNameChange}\n        onProjectFormSubmit={projectState.handleProjectFormSubmit}\n        onProjectSelect={projectState.handleProjectSelect}\n        onProjectToggle={projectState.handleProjectToggle}\n        onProjectDelete={projectState.handleProjectDelete}\n        onProjectEditOpen={projectState.openProjectEditor}\n        onProjectRenameChange={projectState.handleProjectRenameChange}\n        onProjectRenameCommit={projectState.commitProjectRename}\n        onProjectRenameCancel={projectState.cancelProjectRename}\n        onToggleShowAllProjects={projectState.toggleShowAllProjects}\n      />\n\n      <TodayHeroTasks\n        projectId={selProjectId}\n        projectName={selectedProjectName}\n        tasksListId={taskState.tasksListId}\n        taskInputName={taskState.taskInputName}\n        visibleTasks={taskState.visibleTasks}\n        totalTaskCount={taskState.totalTaskCount}\n        showAllTasks={taskState.showAllTasks}\n        shouldShowTaskToggle={taskState.shouldShowTaskToggle}\n        editingTaskId={taskState.editingTaskId}\n        editingTaskText={taskState.editingTaskText}\n        taskAnnouncementText={taskState.taskAnnouncementText}\n        onTaskFormSubmit={taskState.handleTaskFormSubmit}\n        onTaskSelect={taskState.handleTaskSelect}\n        onTaskToggle={taskState.handleTaskToggle}\n        onTaskDelete={taskState.handleTaskDelete}\n        onTaskEditOpen={taskState.openTaskEditor}\n        onTaskRenameChange={taskState.handleTaskRenameChange}\n        onTaskRenameCommit={taskState.commitTaskRename}\n        onTaskRenameCancel={taskState.cancelTaskRename}\n        onToggleShowAllTasks={taskState.toggleShowAllTasks}\n      />\n    </section>\n  );\n}\n","\"use client\";\n\nimport * as React from \"react\";\nimport { PageShell } from \"@/components/ui/layout/PageShell\";\nimport { WeekSummary } from \"../WeekSummary\";\nimport { WeekNotes } from \"../WeekNotes\";\nimport { DayCard } from \"../DayCard\";\nimport { useWeek, useFocusDate } from \"../useFocusDate\";\nimport { PlannerIslandBoundary } from \"../PlannerIslandBoundary\";\n\nexport function WeekView() {\n  const { iso } = useFocusDate();\n  const { days, isToday } = useWeek(iso);\n\n  const heroId = React.useId();\n\n  return (\n    <PageShell\n      as=\"div\"\n      grid\n      className=\"py-[var(--space-6)]\"\n      contentClassName=\"gap-y-[var(--space-6)]\"\n      aria-labelledby={heroId}\n    >\n      <header className=\"col-span-full flex flex-col gap-[var(--space-3)]\">\n        <h2 id={heroId} className=\"text-title font-semibold tracking-tight\">\n          Week overview\n        </h2>\n        <p className=\"text-body text-muted-foreground max-w-prose\">\n          Review the current week at a glance. Progress cards stay interactive so\n          updates here reflect instantly across other views.\n        </p>\n      </header>\n\n      <div className=\"col-span-full grid gap-[var(--space-4)] lg:grid-cols-12\">\n        <div className=\"lg:col-span-8 space-y-[var(--space-4)]\">\n          <PlannerIslandBoundary\n            name=\"planner:week-view:summary\"\n            title=\"Week summary unavailable\"\n            description=\"We hit an error loading the weekly summary. Retry to bring it back.\"\n            retryLabel=\"Retry summary\"\n          >\n            <WeekSummary iso={iso} />\n          </PlannerIslandBoundary>\n        </div>\n        <aside\n          aria-label=\"Week notes\"\n          className=\"lg:col-span-4 space-y-[var(--space-4)]\"\n        >\n          <PlannerIslandBoundary\n            name=\"planner:week-view:notes\"\n            title=\"Notes unavailable\"\n            description=\"We couldn't load your notes for the selected week. Retry to open them again.\"\n            retryLabel=\"Retry notes\"\n          >\n            <WeekNotes iso={iso} />\n          </PlannerIslandBoundary>\n        </aside>\n      </div>\n\n      <PlannerIslandBoundary\n        name=\"planner:week-view:cards\"\n        title=\"Week schedule unavailable\"\n        description=\"We weren't able to render the day cards. Retry to reload the schedule.\"\n        retryLabel=\"Retry day cards\"\n        variant=\"plain\"\n        fallbackClassName=\"col-span-full grid gap-[var(--space-4)] md:grid-cols-2\"\n      >\n        <div className=\"col-span-full grid gap-[var(--space-4)] md:grid-cols-2\">\n          {days.map((dayIso) => (\n            <DayCard key={dayIso} iso={dayIso} isToday={isToday(dayIso)} />\n          ))}\n        </div>\n      </PlannerIslandBoundary>\n    </PageShell>\n  );\n}\n","\"use client\";\n\nimport * as React from \"react\";\n\ntype FocusableElement = { focus: (options?: FocusOptions) => void };\n\ntype UseAutoFocusArgs<T extends FocusableElement> = {\n  ref: React.MutableRefObject<T | null> | React.RefObject<T | null>;\n  when: boolean;\n};\n\nexport default function useAutoFocus<T extends FocusableElement>({\n  ref,\n  when,\n}: UseAutoFocusArgs<T>): void {\n  const prev = React.useRef(false);\n\n  React.useEffect(() => {\n    if (when && !prev.current) {\n      ref.current?.focus();\n    }\n\n    prev.current = when;\n  }, [when, ref]);\n}\n","\"use client\";\n\nimport * as React from \"react\";\nimport { cn } from \"@/lib/utils\";\n\ntype WeekPickerShellProps = React.HTMLAttributes<HTMLDivElement>;\n\ninterface WeekPickerShellSlotProps {\n  readonly slotId: string;\n  readonly children: React.ReactNode;\n}\n\nconst WeekPickerShellTotals = ({ children }: WeekPickerShellSlotProps) => (\n  <>{children}</>\n);\nWeekPickerShellTotals.displayName = \"WeekPickerShellTotals\";\n\nconst WeekPickerShellChips = ({ children }: WeekPickerShellSlotProps) => (\n  <>{children}</>\n);\nWeekPickerShellChips.displayName = \"WeekPickerShellChips\";\n\nconst WeekPickerShellControls = ({ children }: WeekPickerShellSlotProps) => (\n  <>{children}</>\n);\nWeekPickerShellControls.displayName = \"WeekPickerShellControls\";\n\ntype WeekPickerShellComponent = React.ForwardRefExoticComponent<\n  WeekPickerShellProps & React.RefAttributes<HTMLDivElement>\n> & {\n  readonly Totals: typeof WeekPickerShellTotals;\n  readonly Chips: typeof WeekPickerShellChips;\n  readonly Controls: typeof WeekPickerShellControls;\n};\n\nconst WeekPickerShellBase = React.forwardRef<HTMLDivElement, WeekPickerShellProps>(\n  function WeekPickerShell({ children, className, ...props }, ref) {\n    const totals: React.ReactElement<WeekPickerShellSlotProps>[] = [];\n    const chips: React.ReactElement<WeekPickerShellSlotProps>[] = [];\n    const controls: React.ReactElement<WeekPickerShellSlotProps>[] = [];\n    const remainder: React.ReactNode[] = [];\n\n    React.Children.forEach(children, (child) => {\n      if (!React.isValidElement(child)) {\n        if (child != null) {\n          remainder.push(child);\n        }\n        return;\n      }\n\n      if (child.type === WeekPickerShellTotals) {\n        totals.push(child as React.ReactElement<WeekPickerShellSlotProps>);\n        return;\n      }\n\n      if (child.type === WeekPickerShellChips) {\n        chips.push(child as React.ReactElement<WeekPickerShellSlotProps>);\n        return;\n      }\n\n      if (child.type === WeekPickerShellControls) {\n        controls.push(child as React.ReactElement<WeekPickerShellSlotProps>);\n        return;\n      }\n\n      remainder.push(child);\n    });\n\n    const hasTopRow = totals.length > 0 || controls.length > 0;\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\"week-picker-shell chip-shell\", className)}\n        {...props}\n      >\n        {hasTopRow ? (\n          <div className=\"week-picker-shell__top flex w-full flex-wrap items-center chip-gap-x chip-gap-y-tight\">\n            {controls.length > 0 ? (\n              <div className=\"week-picker-shell__controls flex flex-wrap items-center chip-gap-x-tight chip-gap-y-tight\">\n                {controls.map((slot) => {\n                  const key = slot.key ?? slot.props.slotId;\n                  return (\n                    <React.Fragment key={key}>{slot.props.children}</React.Fragment>\n                  );\n                })}\n              </div>\n            ) : null}\n            {totals.length > 0 ? (\n              <div className=\"week-picker-shell__totals ml-auto flex flex-wrap items-center justify-end chip-gap-x chip-gap-y-tight\">\n                {totals.map((slot) => {\n                  const key = slot.key ?? slot.props.slotId;\n                  return (\n                    <React.Fragment key={key}>{slot.props.children}</React.Fragment>\n                  );\n                })}\n              </div>\n            ) : null}\n          </div>\n        ) : null}\n        {chips.map((slot) => {\n          const key = slot.key ?? slot.props.slotId;\n          return <React.Fragment key={key}>{slot.props.children}</React.Fragment>;\n        })}\n        {remainder}\n      </div>\n    );\n  },\n);\n\nWeekPickerShellBase.displayName = \"WeekPickerShell\";\n\nconst WeekPickerShell = Object.assign(WeekPickerShellBase, {\n  Totals: WeekPickerShellTotals,\n  Chips: WeekPickerShellChips,\n  Controls: WeekPickerShellControls,\n}) as WeekPickerShellComponent;\nexport { WeekPickerShell };\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"stage\":\"PortraitFrame_stage__3_a7I\",\"innerTransparent\":\"PortraitFrame_innerTransparent__MYnxm\",\"stageTransparent\":\"PortraitFrame_stageTransparent__keBOl\",\"rimLighting\":\"PortraitFrame_rimLighting__hywbJ\",\"character\":\"PortraitFrame_character__VWyGN\",\"characterBody\":\"PortraitFrame_characterBody__48J_q\",\"characterHead\":\"PortraitFrame_characterHead__6Lbwb\",\"characterCollar\":\"PortraitFrame_characterCollar__QZCLl\",\"layerFront\":\"PortraitFrame_layerFront__FeXt_\",\"layerRear\":\"PortraitFrame_layerRear__OZ8zb\",\"layerDimmed\":\"PortraitFrame_layerDimmed__t7fzP\",\"angel\":\"PortraitFrame_angel__9p4ib\",\"angelWings\":\"PortraitFrame_angelWings__Hpgwr\",\"demon\":\"PortraitFrame_demon__y_lmI\",\"demonHorns\":\"PortraitFrame_demonHorns__JshID\",\"poseDuoAngel\":\"PortraitFrame_poseDuoAngel__pnZXf\",\"poseDuoDemon\":\"PortraitFrame_poseDuoDemon__aNg3w\",\"poseAngelLeadingAngel\":\"PortraitFrame_poseAngelLeadingAngel__ooNwP\",\"poseAngelLeadingDemon\":\"PortraitFrame_poseAngelLeadingDemon__YDuZL\",\"poseDemonLeadingAngel\":\"PortraitFrame_poseDemonLeadingAngel__2mTvl\",\"poseDemonLeadingDemon\":\"PortraitFrame_poseDemonLeadingDemon__mPvyN\",\"poseBackToBackAngel\":\"PortraitFrame_poseBackToBackAngel__JHU_y\",\"poseBackToBackDemon\":\"PortraitFrame_poseBackToBackDemon__xUwrx\",\"stageBackToBack\":\"PortraitFrame_stageBackToBack__XZgxv\"};","// extracted by mini-css-extract-plugin","// src/components/planner/useDayNotes.ts\n\"use client\";\n\nimport { createDayTextFieldHook } from \"./createDayTextFieldHook\";\nimport { scheduleSavingReset } from \"./scheduleSavingReset\";\nimport { setNotes as applyNotes } from \"./plannerCrud\";\n\nexport const useDayNotes = createDayTextFieldHook({\n  selectValue: (day) => day.notes,\n  applyValue: applyNotes,\n  scheduleSavingReset,\n});\n","export const colorTokens = [\n  \"bg-border\",\n  \"bg-border-subtle\",\n  \"bg-input\",\n  \"bg-ring\",\n  \"bg-background\",\n  \"bg-foreground\",\n  \"bg-card\",\n  \"bg-surface\",\n  \"bg-surface-muted\",\n  \"bg-surface-hover\",\n  \"bg-surface-foreground\",\n  \"bg-surface-2\",\n  \"bg-surface-2-foreground\",\n  \"bg-panel\",\n  \"bg-card-hairline\",\n  \"bg-card-hairline-40\",\n  \"bg-card-hairline-45\",\n  \"bg-card-hairline-55\",\n  \"bg-card-hairline-60\",\n  \"bg-card-hairline-65\",\n  \"bg-card-hairline-70\",\n  \"bg-card-hairline-75\",\n  \"bg-card-hairline-90\",\n  \"bg-primary\",\n  \"bg-primary-foreground\",\n  \"bg-primary-soft\",\n  \"bg-accent\",\n  \"bg-accent-foreground\",\n  \"bg-accent-soft\",\n  \"bg-accent-overlay\",\n  \"bg-on-accent\",\n  \"bg-accent-3\",\n  \"bg-accent-2\",\n  \"bg-accent-2-foreground\",\n  \"bg-glow\",\n  \"bg-ring-muted\",\n  \"bg-danger\",\n  \"bg-danger-foreground\",\n  \"bg-warning\",\n  \"bg-warning-foreground\",\n  \"bg-warning-soft\",\n  \"bg-warning-soft-strong\",\n  \"bg-success\",\n  \"bg-success-foreground\",\n  \"bg-success-soft\",\n  \"bg-success-glow\",\n  \"bg-tone-top\",\n  \"bg-tone-jg\",\n  \"bg-tone-mid\",\n  \"bg-tone-bot\",\n  \"bg-tone-sup\",\n  \"bg-aurora-g\",\n  \"bg-aurora-g-light\",\n  \"bg-aurora-p\",\n  \"bg-aurora-p-light\",\n  \"bg-muted\",\n  \"bg-muted-foreground\",\n  \"bg-lav-deep\",\n  \"bg-surface-vhs\",\n  \"bg-surface-streak\",\n  \"bg-card-foreground\",\n  \"bg-interaction-primary-hover\",\n  \"bg-interaction-primary-active\",\n  \"bg-interaction-focus-hover\",\n  \"bg-interaction-focus-active\",\n  \"bg-interaction-focus-surfaceHover\",\n  \"bg-interaction-focus-surfaceActive\",\n  \"bg-interaction-focus-tintHover\",\n  \"bg-interaction-focus-tintActive\",\n  \"bg-interaction-accent-hover\",\n  \"bg-interaction-accent-active\",\n  \"bg-interaction-accent-surfaceHover\",\n  \"bg-interaction-accent-surfaceActive\",\n  \"bg-interaction-accent-tintHover\",\n  \"bg-interaction-accent-tintActive\",\n  \"bg-interaction-info-hover\",\n  \"bg-interaction-info-active\",\n  \"bg-interaction-info-surfaceHover\",\n  \"bg-interaction-info-surfaceActive\",\n  \"bg-interaction-info-tintHover\",\n  \"bg-interaction-info-tintActive\",\n  \"bg-interaction-danger-hover\",\n  \"bg-interaction-danger-active\",\n  \"bg-interaction-danger-surfaceHover\",\n  \"bg-interaction-danger-surfaceActive\",\n  \"bg-interaction-danger-tintHover\",\n  \"bg-interaction-danger-tintActive\",\n  \"bg-interaction-foreground-tintHover\",\n  \"bg-interaction-foreground-tintActive\",\n  \"bg-ring-contrast\",\n];\n\nexport const depthTokenNames = [\n  \"neo-depth-sm\",\n  \"neo-depth-md\",\n  \"neo-depth-lg\",\n  \"neo-surface\",\n  \"neo-surface-alt\",\n  \"neo-highlight\",\n  \"depth-shadow-outer\",\n  \"depth-shadow-outer-strong\",\n  \"depth-shadow-soft\",\n  \"depth-shadow-inner\",\n  \"shadow-outer-sm\",\n  \"shadow-outer-md\",\n  \"shadow-outer-lg\",\n  \"shadow-outer-xl\",\n  \"shadow-inner-sm\",\n  \"shadow-inner-md\",\n  \"shadow-inner-lg\",\n  \"depth-glow-highlight-soft\",\n  \"depth-glow-highlight-medium\",\n  \"depth-glow-highlight-strong\",\n  \"depth-glow-shadow-soft\",\n  \"depth-glow-shadow-medium\",\n  \"depth-glow-shadow-strong\",\n  \"depth-focus-ring-rest\",\n  \"depth-focus-ring-active\",\n  \"glow-ring-sm\",\n  \"glow-ring-md\",\n  \"glow-ring\",\n  \"card-elev-1\",\n  \"card-elev-2\",\n  \"card-elev-3\",\n] as const;\n\nexport const surfaceTokenNames = [\n  \"danger-surface-foreground\",\n  \"surface-overlay-soft\",\n  \"surface-overlay-strong\",\n  \"glitch-card-surface-top\",\n  \"glitch-card-surface-bottom\",\n  \"surface-card-soft\",\n  \"surface-card-strong\",\n  \"surface-card-strong-hover\",\n  \"surface-card-strong-active\",\n  \"surface-card-strong-today\",\n  \"surface-card-strong-empty\",\n  \"surface-rail-accent\",\n] as const;\n\nexport const gradientTokenNames = [\n  \"edge-iris\",\n  \"seg-active-grad\",\n  \"review-result-win-gradient\",\n  \"review-result-loss-gradient\",\n  \"gradient-blob-primary\",\n  \"gradient-drip-overlay\",\n  \"gradient-drip-overlay-compact\",\n  \"gradient-glitch-primary\",\n  \"gradient-glitch-overlay\",\n  \"gradient-glitch-rail\",\n  \"gradient-hero-slot-highlight\",\n  \"gradient-hero-slot-shadow\",\n  \"gradient-hero-topline\",\n  \"gradient-hero-action-halo\",\n  \"gradient-panel-tilt-strong\",\n  \"gradient-panel-tilt-bright\",\n  \"gradient-panel-tilt-muted\",\n] as const;\n\nexport const motionTokenNames = [\n  \"glow-pulse\",\n  \"glitch-rgb-shift\",\n  \"glitch-scanline\",\n] as const;\n\nexport const spacingTokens = [4, 8, 12, 16, 24, 32, 48, 64];\n\nconst ringEntries = [\n  [\"xs\", { diameter: spacingTokens[4], stroke: spacingTokens[0] }],\n  [\"s\", { diameter: spacingTokens[5], stroke: spacingTokens[0] }],\n  [\"m\", { diameter: spacingTokens[7], stroke: spacingTokens[0] }],\n  [\"l\", { diameter: spacingTokens[7] * 3.5, stroke: spacingTokens[0] }],\n] as const;\n\ntype RingEntry = (typeof ringEntries)[number];\nexport type RingSize = RingEntry[0];\n\nconst ringTokenMap: Record<\n  RingSize,\n  { diameter: `--ring-diameter-${RingSize}`; stroke: `--ring-stroke-${RingSize}` }\n> = ringEntries.reduce(\n  (acc, [token]) => {\n    acc[token] = {\n      diameter: `--ring-diameter-${token}` as const,\n      stroke: `--ring-stroke-${token}` as const,\n    };\n    return acc;\n  },\n  {} as Record<\n    RingSize,\n    { diameter: `--ring-diameter-${RingSize}`; stroke: `--ring-stroke-${RingSize}` }\n  >,\n);\n\nconst ringFallbacks: Record<\n  RingSize,\n  { diameter: number; stroke: number; inset: number }\n> = ringEntries.reduce(\n  (acc, [token, { diameter, stroke }]) => {\n    acc[token] = {\n      diameter,\n      stroke,\n      inset: spacingTokens[2] / 2,\n    };\n    return acc;\n  },\n  {} as Record<RingSize, { diameter: number; stroke: number; inset: number }>,\n);\n\nexport interface RingMetrics {\n  diameter: number;\n  stroke: number;\n  inset: number;\n}\n\nexport const getRingMetrics = (\n  size: RingSize,\n  overrides?: Partial<RingMetrics>,\n): RingMetrics => {\n  const tokens = ringTokenMap[size];\n  const fallback = ringFallbacks[size];\n  const diameterFallback = overrides?.diameter ?? fallback.diameter;\n  const strokeFallback = overrides?.stroke ?? fallback.stroke;\n  const insetFallback = overrides?.inset ?? fallback.inset;\n  const diameter = readNumberToken(tokens.diameter, diameterFallback);\n  const stroke = readNumberToken(tokens.stroke, strokeFallback);\n  const inset = readNumberToken(\n    `--ring-inset-${size}`,\n    readNumberToken(\"--ring-inset\", insetFallback),\n  );\n\n  return {\n    diameter,\n    stroke,\n    inset,\n  };\n};\n\nconst radiusEntries = [\n  [\"sm\", 6],\n  [\"md\", 8],\n  [\"lg\", 12],\n  [\"xl\", 16],\n  [\"2xl\", 24],\n  [\"full\", 9999],\n] as const;\n\ntype RadiusKey = (typeof radiusEntries)[number][0];\ntype RadiusVar = `--radius-${RadiusKey}`;\n\nexport const radiusScale: Record<RadiusKey, number> = radiusEntries.reduce(\n  (acc, [token, value]) => {\n    acc[token] = value;\n    return acc;\n  },\n  {} as Record<RadiusKey, number>,\n);\n\nexport const radiusTokens = radiusEntries.map(\n  ([token]) => `--radius-${token}` as RadiusVar,\n);\n\nconst extractBalancedSubstring = (\n  input: string,\n  startIndex: number,\n): { body: string; endIndex: number } | null => {\n  if (input[startIndex] !== \"(\") {\n    return null;\n  }\n\n  let depth = 0;\n\n  for (let index = startIndex; index < input.length; index += 1) {\n    const char = input[index];\n\n    if (char === \"(\") {\n      depth += 1;\n      continue;\n    }\n\n    if (char === \")\") {\n      depth -= 1;\n\n      if (depth === 0) {\n        return {\n          body: input.slice(startIndex + 1, index),\n          endIndex: index + 1,\n        };\n      }\n    }\n  }\n\n  return null;\n};\n\nconst parseVarFunction = (\n  raw: string,\n): { name: string; fallback?: string } | null => {\n  const trimmed = raw.trim();\n  const lower = trimmed.toLowerCase();\n\n  if (!lower.startsWith(\"var(\") || !trimmed.endsWith(\")\")) {\n    return null;\n  }\n\n  const openIndex = lower.indexOf(\"(\");\n  const extracted = extractBalancedSubstring(trimmed, openIndex);\n\n  if (!extracted) {\n    return null;\n  }\n\n  const inner = extracted.body;\n  let depth = 0;\n  let name = \"\";\n  let fallback = \"\";\n  let hasFallback = false;\n\n  for (let index = 0; index < inner.length; index += 1) {\n    const char = inner[index];\n\n    if (char === \"(\") {\n      depth += 1;\n    } else if (char === \")\") {\n      depth -= 1;\n    } else if (char === \",\" && depth === 0 && !hasFallback) {\n      hasFallback = true;\n      continue;\n    }\n\n    if (!hasFallback) {\n      name += char;\n    } else {\n      fallback += char;\n    }\n  }\n\n  const variable = name.trim();\n\n  if (!variable.startsWith(\"--\")) {\n    return null;\n  }\n\n  return {\n    name: variable,\n    fallback: hasFallback ? fallback.trim() || undefined : undefined,\n  };\n};\n\nconst resolveCssNumber = (\n  raw: string,\n  computedStyle: CSSStyleDeclaration,\n  seen: Set<string>,\n): number | null => {\n  const trimmed = raw.trim();\n\n  if (!trimmed) {\n    return null;\n  }\n\n  const numeric = Number.parseFloat(trimmed);\n\n  if (Number.isFinite(numeric)) {\n    return numeric;\n  }\n\n  const lower = trimmed.toLowerCase();\n\n  if (lower.startsWith(\"var(\")) {\n    const parsed = parseVarFunction(trimmed);\n\n    if (!parsed) {\n      return null;\n    }\n\n    const { name, fallback } = parsed;\n\n    if (seen.has(name)) {\n      return null;\n    }\n\n    const nextSeen = new Set(seen);\n    nextSeen.add(name);\n\n    const referenced = computedStyle.getPropertyValue(name).trim();\n\n    if (referenced) {\n      const resolved = resolveCssNumber(referenced, computedStyle, nextSeen);\n\n      if (resolved !== null) {\n        return resolved;\n      }\n    }\n\n    if (fallback) {\n      return resolveCssNumber(fallback, computedStyle, nextSeen);\n    }\n\n    return null;\n  }\n\n  if (lower.startsWith(\"calc(\") && trimmed.endsWith(\")\")) {\n    const openIndex = lower.indexOf(\"(\");\n    const extracted = extractBalancedSubstring(trimmed, openIndex);\n\n    if (!extracted) {\n      return null;\n    }\n\n    let index = 0;\n    const { body } = extracted;\n    let sanitized = \"\";\n    const lowerBody = body.toLowerCase();\n\n    while (index < body.length) {\n      if (lowerBody.startsWith(\"var(\", index)) {\n        const varOpen = body.indexOf(\"(\", index + 3);\n\n        if (varOpen === -1) {\n          return null;\n        }\n\n        const extractedVar = extractBalancedSubstring(body, varOpen);\n\n        if (!extractedVar) {\n          return null;\n        }\n\n        const rawVar = `var(${extractedVar.body})`;\n        const resolvedVar = resolveCssNumber(rawVar, computedStyle, new Set(seen));\n        sanitized += resolvedVar !== null ? String(resolvedVar) : \"0\";\n        index = extractedVar.endIndex;\n        continue;\n      }\n\n      if (lowerBody.startsWith(\"calc(\", index)) {\n        const calcOpen = body.indexOf(\"(\", index + 4);\n\n        if (calcOpen === -1) {\n          return null;\n        }\n\n        const extractedCalc = extractBalancedSubstring(body, calcOpen);\n\n        if (!extractedCalc) {\n          return null;\n        }\n\n        const nestedValue = resolveCssNumber(\n          `calc(${extractedCalc.body})`,\n          computedStyle,\n          new Set(seen),\n        );\n\n        sanitized += nestedValue !== null ? String(nestedValue) : \"0\";\n        index = extractedCalc.endIndex;\n        continue;\n      }\n\n      sanitized += body[index];\n      index += 1;\n    }\n\n    const withoutUnits = sanitized.replace(\n      /(-?\\d*\\.?\\d+(?:e[+-]?\\d+)?)\\s*[a-z%]+/gi,\n      \"$1\",\n    );\n    const cleaned = withoutUnits.replace(/[^0-9+\\-*/().\\s]/g, \"\");\n\n    if (!cleaned.trim()) {\n      return null;\n    }\n\n    try {\n      const result = Function(\"return (\" + cleaned + \");\")();\n      return typeof result === \"number\" && Number.isFinite(result) ? result : null;\n    } catch {\n      return null;\n    }\n  }\n\n  return null;\n};\n\nexport const readNumberToken = (token: string, fallback: number): number => {\n  if (typeof document === \"undefined\") {\n    return fallback;\n  }\n\n  const root = document.documentElement;\n  const computedStyle = getComputedStyle(root);\n  const raw = computedStyle.getPropertyValue(token).trim();\n\n  if (!raw) {\n    return fallback;\n  }\n\n  const resolved = resolveCssNumber(raw, computedStyle, new Set([token]));\n\n  if (resolved !== null) {\n    return resolved;\n  }\n\n  return fallback;\n};\n","\"use client\";\n\nimport * as React from \"react\";\nimport {\n  ensureDay,\n  computeDayCounts,\n  buildTaskLookups,\n  FOCUS_PLACEHOLDER,\n} from \"./plannerSerialization\";\nimport { useDays, useFocus } from \"./plannerContext\";\nimport type {\n  DayRecord,\n  DayTask,\n  ISODate,\n  Project,\n} from \"./plannerTypes\";\nimport { makeCrud } from \"./plannerCrud\";\nimport { readLocal, removeLocal } from \"@/lib/db\";\n\nexport type { ISODate, DayRecord, Project, DayTask, TaskReminder } from \"./plannerTypes\";\n\ntype LegacySnapshot = {\n  projects: Project[] | null;\n  tasks: DayTask[] | null;\n};\n\nconst LEGACY_PROJECTS_KEY = \"planner:projects\";\nconst LEGACY_TASKS_KEY = \"planner:tasks\";\n\nfunction migrateLegacy(\n  days: Record<ISODate, DayRecord>,\n  iso: ISODate,\n  legacy?: LegacySnapshot,\n): Record<ISODate, DayRecord> {\n  if (typeof window === \"undefined\") return days;\n  const projects =\n    legacy?.projects ?? readLocal<Project[]>(LEGACY_PROJECTS_KEY);\n  const tasks = legacy?.tasks ?? readLocal<DayTask[]>(LEGACY_TASKS_KEY);\n  if (!projects && !tasks) {\n    return days;\n  }\n  const next = { ...days } as Record<ISODate, DayRecord>;\n  const ensured = ensureDay(next, iso);\n  let updated = ensured;\n  if (projects) {\n    updated = { ...updated, projects };\n  }\n  if (tasks) {\n    updated = { ...updated, tasks, ...buildTaskLookups(tasks) };\n  }\n  const { doneCount, totalCount } = computeDayCounts(\n    updated.projects,\n    updated.tasks,\n  );\n  next[iso] = { ...updated, doneCount, totalCount };\n  removeLocal(LEGACY_PROJECTS_KEY);\n  removeLocal(LEGACY_TASKS_KEY);\n  return next;\n}\n\n/**\n * Provides persistent planner state and CRUD helpers for the focused day.\n * @returns Planner state object with CRUD operations.\n */\nexport function usePlannerStore() {\n  const { days, setDays } = useDays();\n  const { focus, setFocus, today } = useFocus();\n  const activeFocus = focus === FOCUS_PLACEHOLDER ? today : focus;\n  const legacyMigratedRef = React.useRef(false);\n\n  const applyDaysUpdate = React.useCallback(\n    (\n      updater: (prev: Record<ISODate, DayRecord>) => Record<ISODate, DayRecord>,\n      changed?: ISODate | Iterable<ISODate>,\n    ) => {\n      if (changed === undefined) {\n        setDays(updater);\n        return;\n      }\n\n      const list =\n        typeof changed === \"string\"\n          ? [changed]\n          : Array.from(changed);\n\n      setDays((prev) => {\n        const next = updater(prev);\n        return [next, list] as const;\n      });\n    },\n    [setDays],\n  );\n\n  React.useEffect(() => {\n    if (legacyMigratedRef.current) return;\n    if (!activeFocus) return;\n\n    const projects = readLocal<Project[]>(LEGACY_PROJECTS_KEY);\n    const tasks = readLocal<DayTask[]>(LEGACY_TASKS_KEY);\n\n    if (!projects && !tasks) {\n      legacyMigratedRef.current = true;\n      return;\n    }\n\n    applyDaysUpdate(\n      (prev) => migrateLegacy(prev, activeFocus, { projects, tasks }),\n      activeFocus,\n    );\n    legacyMigratedRef.current = true;\n  }, [activeFocus, applyDaysUpdate]);\n\n  const upsertDay = React.useCallback(\n    (date: ISODate, fn: (d: DayRecord) => DayRecord) => {\n      if (date === FOCUS_PLACEHOLDER) {\n        return;\n      }\n      applyDaysUpdate(\n        (prev) => {\n          const base = ensureDay(prev, date);\n          const next = fn(base);\n          return { ...prev, [date]: next };\n        },\n        date,\n      );\n    },\n    [applyDaysUpdate],\n  );\n\n  const getDay = React.useCallback(\n    (date: ISODate): DayRecord => ensureDay(days, date),\n    [days],\n  );\n\n  const setDay = React.useCallback(\n    (date: ISODate, next: DayRecord) => {\n      if (date === FOCUS_PLACEHOLDER) {\n        return;\n      }\n      applyDaysUpdate((prev) => ({ ...prev, [date]: next }), date);\n    },\n    [applyDaysUpdate],\n  );\n\n  const crud = React.useMemo(\n    () => makeCrud(activeFocus, upsertDay),\n    [activeFocus, upsertDay],\n  );\n  const { setFocus: setDayFocus, ...restCrud } = crud;\n\n  return {\n    days,\n    focus: activeFocus,\n    setFocus,\n    day: getDay(activeFocus),\n    getDay,\n    setDay,\n    upsertDay,\n    setDayFocus,\n    ...restCrud,\n  } as const;\n}\n\ntype ProjectSelector = (projectId: string) => void;\ntype TaskSelector = (taskId: string) => void;\n\ntype CreateProjectArgs = {\n  iso: ISODate;\n  name: string;\n  select?: ProjectSelector;\n};\n\ntype CreateTaskArgs = {\n  iso: ISODate;\n  projectId?: string;\n  title: string;\n  select?: TaskSelector;\n};\n\n/**\n * Shared helpers that wrap planner CRUD to standardise creation flows.\n */\nexport function usePlannerActions() {\n  const { upsertDay } = usePlannerStore();\n\n  const createProject = React.useCallback(\n    ({ iso, name, select }: CreateProjectArgs) => {\n      if (!iso) return;\n      const trimmed = name.trim();\n      if (!trimmed) return;\n      const id = makeCrud(iso, upsertDay).addProject(trimmed);\n      if (!id) return;\n      select?.(id);\n      return id;\n    },\n    [upsertDay],\n  );\n\n  const createTask = React.useCallback(\n    ({ iso, projectId, title, select }: CreateTaskArgs) => {\n      if (!iso || !projectId) return;\n      const trimmed = title.trim();\n      if (!trimmed) return;\n      const id = makeCrud(iso, upsertDay).addTask(trimmed, projectId);\n      if (!id) return;\n      select?.(id);\n      return id;\n    },\n    [upsertDay],\n  );\n\n  return React.useMemo(\n    () => ({\n      createProject,\n      createTask,\n    }),\n    [createProject, createTask],\n  );\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"heroPanel\":\"PlannerPage_heroPanel__35OO2\",\"heroContent\":\"PlannerPage_heroContent__Tprao\",\"heroText\":\"PlannerPage_heroText__2WGLB\",\"heroPortrait\":\"PlannerPage_heroPortrait__2ypC0\",\"heroEyebrow\":\"PlannerPage_heroEyebrow__UPjsY\",\"heroHeading\":\"PlannerPage_heroHeading__3EjiV\",\"heroSubtitle\":\"PlannerPage_heroSubtitle__CPmqH\",\"heroActions\":\"PlannerPage_heroActions__vlEzm\",\"heroDial\":\"PlannerPage_heroDial__EkP8H\",\"heroRing\":\"PlannerPage_heroRing__0OBXl\",\"heroRingReduced\":\"PlannerPage_heroRingReduced__SxmNN\",\"heroRingValue\":\"PlannerPage_heroRingValue__4zikp\",\"heroRingCaption\":\"PlannerPage_heroRingCaption__AJANE\",\"heroSliderLabel\":\"PlannerPage_heroSliderLabel__2_QAL\",\"heroSlider\":\"PlannerPage_heroSlider__AwdkA\",\"heroFeedback\":\"PlannerPage_heroFeedback__vGMYt\"};","// extracted by mini-css-extract-plugin","\"use client\";\n\nimport * as React from \"react\";\nimport { NeoCard } from \"@/components/ui/primitives/NeoCard\";\nimport { Label } from \"@/components/ui/Label\";\nimport { Input } from \"@/components/ui/primitives/Input\";\nimport { Select } from \"@/components/ui/Select\";\nimport { Toggle } from \"@/components/ui/toggles/Toggle\";\nimport { AnimatedSelect } from \"@/components/ui\";\nimport { usePersistentState } from \"@/lib/db\";\nimport { usePlannerReminders } from \"./plannerContext\";\nimport type { DayTask, TaskReminder } from \"./plannerTypes\";\n\nconst LEAD_OPTIONS: Array<{ value: string; label: string }> = [\n  { value: \"0\", label: \"At start\" },\n  { value: \"5\", label: \"5 minutes before\" },\n  { value: \"10\", label: \"10 minutes before\" },\n  { value: \"15\", label: \"15 minutes before\" },\n  { value: \"30\", label: \"30 minutes before\" },\n  { value: \"60\", label: \"1 hour before\" },\n];\n\nconst VALID_LEAD_MINUTES = new Set(\n  LEAD_OPTIONS.map((option) => Number.parseInt(option.value, 10)),\n);\n\nconst DEFAULT_TIME = \"09:00\";\n\ntype TaskReminderSettingsProps = {\n  task?: DayTask;\n  onChange: (partial: Partial<TaskReminder> | null) => void;\n};\n\nexport function TaskReminderSettings({\n  task,\n  onChange,\n}: TaskReminderSettingsProps) {\n  const { filtered, items } = usePlannerReminders();\n  const [defaultReminderId, setDefaultReminderId] =\n    usePersistentState<string | null>(\"planner:reminder-default-id.v1\", null);\n  const [defaultTime, setDefaultTime] = usePersistentState<string>(\n    \"planner:reminder-default-time.v1\",\n    DEFAULT_TIME,\n  );\n  const [defaultLeadMinutes, setDefaultLeadMinutes] = usePersistentState<number>(\n    \"planner:reminder-default-lead.v1\",\n    0,\n  );\n\n  const availableReminders = React.useMemo(() => {\n    const source = filtered.length > 0 ? filtered : items;\n    return source\n      .slice()\n      .sort((a, b) => {\n        if (!!b.pinned === !!a.pinned) return a.title.localeCompare(b.title);\n        return Number(b.pinned) - Number(a.pinned);\n      })\n      .map((reminder) => ({\n        value: reminder.id,\n        label: reminder.title,\n      }));\n  }, [filtered, items]);\n\n  const taskId = task?.id;\n  const activeReminder = task?.reminder;\n  const isEnabled = Boolean(activeReminder?.enabled);\n  const advancedDisclosureButtonId = React.useId();\n  const advancedDisclosurePanelId = React.useId();\n  const previousAdvancedState = React.useRef<boolean>(true);\n  const previousIsEnabled = React.useRef<boolean>(isEnabled);\n  const suppressNextCloseSync = React.useRef<boolean>(false);\n  const previousTaskId = React.useRef<DayTask[\"id\"] | undefined>(taskId);\n  const [areAdvancedOptionsOpen, setAreAdvancedOptionsOpen] = React.useState<boolean>(\n    isEnabled,\n  );\n  const reminderId =\n    activeReminder?.reminderId ??\n    defaultReminderId ??\n    availableReminders[0]?.value ??\n    \"\";\n  const reminderTime = activeReminder?.time ?? defaultTime ?? DEFAULT_TIME;\n  const leadMinutesRaw =\n    activeReminder?.leadMinutes ?? defaultLeadMinutes ?? 0;\n  const leadMinutes = React.useMemo(() => {\n    if (VALID_LEAD_MINUTES.has(leadMinutesRaw)) {\n      return leadMinutesRaw;\n    }\n    return 0;\n  }, [leadMinutesRaw]);\n\n  const selectedTaskLabel = React.useMemo(() => {\n    if (!task) return \"No task selected\";\n    const trimmed = task.title.trim();\n    return trimmed ? `Reminder for ${trimmed}` : \"Reminder for untitled task\";\n  }, [task]);\n\n  React.useEffect(() => {\n    if (previousTaskId.current === taskId) return;\n    previousTaskId.current = taskId;\n    previousAdvancedState.current = true;\n    setAreAdvancedOptionsOpen(isEnabled);\n    previousIsEnabled.current = isEnabled;\n  }, [isEnabled, taskId]);\n\n  React.useEffect(() => {\n    if (!isEnabled) {\n      if (suppressNextCloseSync.current) {\n        suppressNextCloseSync.current = false;\n        previousIsEnabled.current = isEnabled;\n        return;\n      }\n\n      if (previousIsEnabled.current) {\n        setAreAdvancedOptionsOpen((previous) => {\n          previousAdvancedState.current = previous;\n          return false;\n        });\n      } else {\n        setAreAdvancedOptionsOpen(false);\n      }\n      previousIsEnabled.current = isEnabled;\n      return;\n    }\n\n    const nextOpen = previousAdvancedState.current ?? true;\n    previousAdvancedState.current = nextOpen;\n    setAreAdvancedOptionsOpen(nextOpen);\n    previousIsEnabled.current = isEnabled;\n  }, [isEnabled]);\n\n  React.useEffect(() => {\n    if (!task || !isEnabled) return;\n    if (availableReminders.length === 0) return;\n    if (\n      reminderId &&\n      availableReminders.some((reminder) => reminder.value === reminderId)\n    ) {\n      return;\n    }\n\n    const fallback = availableReminders[0]?.value;\n    if (!fallback) return;\n\n    onChange({ reminderId: fallback });\n    setDefaultReminderId(fallback);\n  }, [\n    availableReminders,\n    isEnabled,\n    onChange,\n    reminderId,\n    setDefaultReminderId,\n    task,\n  ]);\n\n  React.useEffect(() => {\n    if (!task || !isEnabled) return;\n    if (VALID_LEAD_MINUTES.has(leadMinutesRaw)) return;\n\n    const fallbackLead = 0;\n    onChange({ leadMinutes: fallbackLead });\n    setDefaultLeadMinutes(fallbackLead);\n  }, [isEnabled, leadMinutesRaw, onChange, setDefaultLeadMinutes, task]);\n\n  const handleToggle = React.useCallback(\n    (side: \"Left\" | \"Right\") => {\n      if (!task) return;\n      const enable = side === \"Right\";\n      const fallbackId =\n        activeReminder?.reminderId ??\n        reminderId ??\n        availableReminders[0]?.value ??\n        \"\";\n      const fallbackTime =\n        activeReminder?.time ?? reminderTime ?? DEFAULT_TIME;\n      const fallbackLead =\n        activeReminder?.leadMinutes ?? leadMinutes ?? 0;\n\n      if (!enable) {\n        previousAdvancedState.current = areAdvancedOptionsOpen;\n        suppressNextCloseSync.current = true;\n        setAreAdvancedOptionsOpen(false);\n        onChange({\n          enabled: false,\n          ...(fallbackId ? { reminderId: fallbackId } : {}),\n          ...(fallbackTime ? { time: fallbackTime } : {}),\n          leadMinutes: fallbackLead,\n        });\n        return;\n      }\n\n      const nextOpen = previousAdvancedState.current ?? true;\n      previousAdvancedState.current = nextOpen;\n      setAreAdvancedOptionsOpen(nextOpen);\n      onChange({\n        enabled: true,\n        ...(fallbackId ? { reminderId: fallbackId } : {}),\n        ...(fallbackTime ? { time: fallbackTime } : {}),\n        leadMinutes: fallbackLead,\n      });\n      if (fallbackId) setDefaultReminderId(fallbackId);\n      if (fallbackTime) setDefaultTime(fallbackTime);\n      setDefaultLeadMinutes(fallbackLead);\n    },\n    [\n      task,\n      activeReminder?.reminderId,\n      activeReminder?.time,\n      activeReminder?.leadMinutes,\n      reminderId,\n      reminderTime,\n      leadMinutes,\n      availableReminders,\n      onChange,\n      setDefaultReminderId,\n      setDefaultTime,\n      setDefaultLeadMinutes,\n      areAdvancedOptionsOpen,\n    ],\n  );\n\n  const handleAdvancedDisclosureToggle = React.useCallback(() => {\n    if (!isEnabled) return;\n    setAreAdvancedOptionsOpen((previous) => {\n      const next = !previous;\n      previousAdvancedState.current = next;\n      return next;\n    });\n  }, [isEnabled]);\n\n  const handleReminderSelect = React.useCallback(\n    (value: string) => {\n      if (!task) return;\n      onChange({ reminderId: value || undefined });\n      if (value) setDefaultReminderId(value);\n    },\n    [onChange, setDefaultReminderId, task],\n  );\n\n  const handleTimeChange = React.useCallback(\n    (value: string) => {\n      if (!task) return;\n      onChange({ time: value || undefined });\n      if (value) setDefaultTime(value);\n    },\n    [onChange, setDefaultTime, task],\n  );\n\n  const handleLeadChange = React.useCallback(\n    (value: string) => {\n      if (!task) return;\n      const minutes = Number.parseInt(value, 10);\n      const normalized =\n        Number.isFinite(minutes) && VALID_LEAD_MINUTES.has(minutes)\n          ? minutes\n          : 0;\n      onChange({ leadMinutes: normalized });\n      setDefaultLeadMinutes(normalized);\n    },\n    [onChange, setDefaultLeadMinutes, task],\n  );\n\n  const noReminders = availableReminders.length === 0;\n\n  return (\n    <NeoCard className=\"col-span-full card-pad space-y-[var(--space-4)]\">\n      <header className=\"flex flex-col gap-[var(--space-1)]\">\n        <h3 className=\"text-title-sm font-semibold\">Task reminders</h3>\n        <p className=\"text-ui text-muted-foreground\">{selectedTaskLabel}</p>\n      </header>\n\n      {!task ? (\n        <p className=\"text-ui text-muted-foreground\">\n          Select a task to attach a reminder.\n        </p>\n      ) : noReminders ? (\n        <p className=\"text-ui text-muted-foreground\">\n          Add reminders in Goals  Reminders to make them available here.\n        </p>\n      ) : (\n        <div className=\"grid gap-[var(--space-4)] md:grid-cols-2\">\n          <div className=\"flex flex-col gap-[var(--space-2)]\">\n            <span className=\"text-ui font-medium\">\n              Reminder state\n            </span>\n            <Toggle\n              leftLabel=\"Off\"\n              rightLabel=\"On\"\n              value={isEnabled ? \"Right\" : \"Left\"}\n              onChange={handleToggle}\n              disabled={!task}\n              className=\"w-full\"\n            />\n            <p className=\"text-caption text-muted-foreground\">\n              Enable reminders to adjust templates, send time, and lead time.\n            </p>\n          </div>\n\n          <div className=\"flex flex-col gap-[var(--space-2)]\">\n            <button\n              type=\"button\"\n              id={advancedDisclosureButtonId}\n              className=\"inline-flex w-full items-center justify-between rounded-[var(--control-radius)] border border-border bg-card px-[var(--space-3)] py-[var(--space-2)] text-left text-ui font-medium transition hover:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-60\"\n              aria-controls={advancedDisclosurePanelId}\n              aria-expanded={isEnabled && areAdvancedOptionsOpen}\n              aria-disabled={!isEnabled}\n              onClick={handleAdvancedDisclosureToggle}\n              disabled={!isEnabled}\n            >\n              <span>Reminder options</span>\n              <span className=\"text-caption text-muted-foreground\">\n                {areAdvancedOptionsOpen ? \"Hide\" : \"Show\"}\n              </span>\n            </button>\n\n            <div\n              id={advancedDisclosurePanelId}\n              role=\"region\"\n              aria-labelledby={advancedDisclosureButtonId}\n              hidden={!isEnabled || !areAdvancedOptionsOpen}\n              className=\"grid gap-[var(--space-3)] md:grid-cols-2\"\n            >\n              <div className=\"flex flex-col gap-[var(--space-2)]\">\n                <Label htmlFor={`reminder-select-${task.id}`}>Reminder</Label>\n                <AnimatedSelect\n                  id={`reminder-select-${task.id}`}\n                  items={availableReminders}\n                  value={reminderId}\n                  onChange={handleReminderSelect}\n                  placeholder=\"Choose reminder\"\n                  ariaLabel=\"Select reminder template\"\n                  disabled={!isEnabled}\n                  size=\"md\"\n                />\n              </div>\n\n              <div className=\"flex flex-col gap-[var(--space-2)]\">\n                <Label htmlFor={`reminder-time-${task.id}`}>Time</Label>\n                <Input\n                  id={`reminder-time-${task.id}`}\n                  type=\"time\"\n                  step={60}\n                  value={reminderTime}\n                  onChange={(event) => handleTimeChange(event.target.value)}\n                  disabled={!isEnabled}\n                />\n              </div>\n\n              <div className=\"flex flex-col gap-[var(--space-2)]\">\n                <Label htmlFor={`reminder-lead-${task.id}`}>Lead time</Label>\n                <Select\n                  variant=\"native\"\n                  id={`reminder-lead-${task.id}`}\n                  items={LEAD_OPTIONS}\n                  value={String(leadMinutes)}\n                  onChange={handleLeadChange}\n                  disabled={!isEnabled}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </NeoCard>\n  );\n}\n","\"use client\";\n\nimport * as React from \"react\";\nimport { addDays, toISODate, weekRangeFromISO } from \"@/lib/date\";\nimport { usePlanner } from \"./plannerContext\";\nimport type { ISODate } from \"./plannerTypes\";\n\n/**\n * Exposes the currently focused ISO date and helper to update it.\n * @returns Current focus ISO date, setter, today's ISO string, and hydration flag.\n */\nexport function useFocusDate() {\n  const { iso, setIso, today, hydrated } = usePlanner();\n  return { iso, setIso, today, hydrated } as const;\n}\n\n/**\n * Derives week information for a given ISO date.\n * @param iso - ISO date to compute the week range for.\n * @returns Week start/end dates, list of day ISO strings, and today checker.\n */\nexport function useWeek(iso?: ISODate) {\n  const { week, iso: currentIso, today } = usePlanner();\n  return React.useMemo(() => {\n    const targetIso = iso ?? currentIso;\n    if (targetIso === currentIso) {\n      return week;\n    }\n    const { start, end } = weekRangeFromISO(targetIso);\n    const days: ISODate[] = [];\n    for (let i = 0; i < 7; i += 1) {\n      days.push(toISODate(addDays(start, i)));\n    }\n    const isToday = (d: ISODate) => d === today;\n    return { start, end, days, isToday } as const;\n  }, [iso, currentIso, today, week]);\n}\n","// src/components/planner/WeekNotes.tsx\n\"use client\";\nimport \"./style.css\";\n\n/**\n * WeekNotes  day-scoped notes editor for the focused ISO date.\n * Historical name kept for compatibility, but UI copy reflects daily scope.\n */\n\nimport * as React from \"react\";\nimport { SectionCard } from \"@/components/ui/layout/SectionCard\";\nimport { Textarea } from \"@/components/ui/primitives/Textarea\";\nimport { useDayNotes } from \"./useDayNotes\";\nimport type { ISODate } from \"./plannerTypes\";\n\ntype Props = { iso: ISODate };\n\nexport function WeekNotes({ iso }: Props) {\n  const { value, setValue, saving, isDirty, lastSavedRef, commit } =\n    useDayNotes(iso);\n  const headerId = React.useMemo(() => `notes-${iso}-header`, [iso]);\n\n  return (\n    <SectionCard className=\"card-neo-soft\">\n      <SectionCard.Header\n        id={headerId}\n        title=\"Day notes\"\n        titleAs=\"h6\"\n        titleClassName=\"text-title font-semibold tracking-tight\"\n      />\n      <SectionCard.Body>\n        <Textarea\n          placeholder=\"Jot down anything related to this day\"\n          value={value}\n          onChange={(e) => setValue(e.target.value)}\n          name={`notes-${iso}`}\n          aria-labelledby={headerId}\n          aria-label=\"Day notes\"\n          resize=\"resize-y\"\n          textareaClassName=\"min-h-[calc(var(--space-8)*3_-_var(--space-3))] leading-relaxed\"\n          onBlur={commit}\n        />\n        <div className=\"mt-[var(--space-2)] text-label text-muted-foreground\" aria-live=\"polite\">\n          {saving\n            ? \"Saving\"\n            : isDirty\n              ? \"Unsaved changes\"\n              : lastSavedRef.current\n                ? \"All changes saved\"\n                : \"No notes yet\"}\n        </div>\n      </SectionCard.Body>\n    </SectionCard>\n  );\n}\n","\"use client\";\n\nimport { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport type { FormEvent } from \"react\";\n\nimport type { DayTask, ISODate } from \"./plannerTypes\";\nimport { usePlannerActions } from \"./usePlannerStore\";\n\ntype TodayHeroTaskAnnouncement = {\n  text: string;\n  toggleMarker: boolean;\n};\n\ntype UseTodayHeroTasksParams = {\n  iso: ISODate;\n  scopedTasks: DayTask[];\n  projectId: string;\n  projectName: string;\n  renameTask: (taskId: string, title: string) => void;\n  deleteTask: (taskId: string) => void;\n  toggleTask: (taskId: string) => void;\n  setSelectedTaskId: (taskId: string) => void;\n};\n\ntype UseTodayHeroTasksResult = {\n  tasksListId: string;\n  taskInputName: string;\n  visibleTasks: DayTask[];\n  totalTaskCount: number;\n  showAllTasks: boolean;\n  shouldShowTaskToggle: boolean;\n  editingTaskId: string | null;\n  editingTaskText: string;\n  taskAnnouncementText: string;\n  handleTaskFormSubmit: (event: FormEvent<HTMLFormElement>) => void;\n  handleTaskSelect: (taskId: string) => void;\n  handleTaskToggle: (taskId: string) => void;\n  handleTaskDelete: (taskId: string) => void;\n  openTaskEditor: (taskId: string, title: string, options?: { select?: boolean }) => void;\n  handleTaskRenameChange: (value: string) => void;\n  commitTaskRename: (taskId: string, fallbackTitle: string) => void;\n  cancelTaskRename: () => void;\n  toggleShowAllTasks: () => void;\n};\n\nconst TASK_PREVIEW_LIMIT = 12;\n\nexport function useTodayHeroTasks({\n  iso,\n  scopedTasks,\n  projectId,\n  projectName,\n  renameTask,\n  deleteTask,\n  toggleTask,\n  setSelectedTaskId,\n}: UseTodayHeroTasksParams): UseTodayHeroTasksResult {\n  const [showAllTasksState, setShowAllTasksState] = useState(false);\n  const [editingTaskId, setEditingTaskId] = useState<string | null>(null);\n  const [editingTaskText, setEditingTaskText] = useState(\"\");\n  const [taskAnnouncement, setTaskAnnouncement] = useState<TodayHeroTaskAnnouncement>({\n    text: \"\",\n    toggleMarker: false,\n  });\n  const { createTask } = usePlannerActions();\n\n  const prevProjectIdRef = useRef<string | null>(null);\n  const prevTasksRef = useRef<Map<string, { title: string; done: boolean }>>(\n    new Map(),\n  );\n\n  const tasksListId = useMemo(\n    () => `today-hero-task-list-${projectId || \"none\"}`,\n    [projectId],\n  );\n\n  const taskInputName = useMemo(\n    () => `new-task-${projectId || \"none\"}`,\n    [projectId],\n  );\n\n  const totalTaskCount = scopedTasks.length;\n\n  const showAllTasks = showAllTasksState && totalTaskCount > TASK_PREVIEW_LIMIT;\n\n  const visibleTasks = useMemo(\n    () =>\n      showAllTasks\n        ? scopedTasks\n        : scopedTasks.slice(0, TASK_PREVIEW_LIMIT),\n    [scopedTasks, showAllTasks],\n  );\n\n  const shouldShowTaskToggle = totalTaskCount > TASK_PREVIEW_LIMIT;\n\n  const handleTaskFormSubmit = useCallback(\n    (event: FormEvent<HTMLFormElement>) => {\n      if (!projectId) {\n        event.preventDefault();\n        return;\n      }\n\n      event.preventDefault();\n\n      const input = event.currentTarget.elements.namedItem(\n        taskInputName,\n      ) as HTMLInputElement | null;\n\n      const rawValue = input?.value ?? \"\";\n      const trimmedValue = rawValue.trim();\n\n      if (!trimmedValue) {\n        if (input) input.value = \"\";\n        return;\n      }\n\n      const id = createTask({\n        iso,\n        projectId,\n        title: trimmedValue,\n        select: setSelectedTaskId,\n      });\n\n      if (id && input) {\n        input.value = \"\";\n      }\n    },\n    [createTask, iso, projectId, setSelectedTaskId, taskInputName],\n  );\n\n  const handleTaskSelect = useCallback(\n    (taskId: string) => {\n      setSelectedTaskId(taskId);\n    },\n    [setSelectedTaskId],\n  );\n\n  const handleTaskToggle = useCallback(\n    (taskId: string) => {\n      toggleTask(taskId);\n      setSelectedTaskId(taskId);\n    },\n    [setSelectedTaskId, toggleTask],\n  );\n\n  const handleTaskDelete = useCallback(\n    (taskId: string) => {\n      deleteTask(taskId);\n      setSelectedTaskId(\"\");\n      if (editingTaskId === taskId) {\n        setEditingTaskId(null);\n        setEditingTaskText(\"\");\n      }\n    },\n    [deleteTask, editingTaskId, setSelectedTaskId],\n  );\n\n  const openTaskEditor = useCallback(\n    (taskId: string, title: string, options?: { select?: boolean }) => {\n      setEditingTaskText(title);\n      setEditingTaskId(taskId);\n      if (options?.select) setSelectedTaskId(taskId);\n    },\n    [setSelectedTaskId],\n  );\n\n  const handleTaskRenameChange = useCallback((value: string) => {\n    setEditingTaskText(value);\n  }, []);\n\n  const commitTaskRename = useCallback(\n    (taskId: string, fallbackTitle: string) => {\n      const nextTitle = editingTaskText.trim() || fallbackTitle;\n      renameTask(taskId, nextTitle);\n      setEditingTaskId(null);\n    },\n    [editingTaskText, renameTask],\n  );\n\n  const cancelTaskRename = useCallback(() => {\n    setEditingTaskId(null);\n  }, []);\n\n  const toggleShowAllTasks = useCallback(() => {\n    if (!shouldShowTaskToggle) {\n      setShowAllTasksState(false);\n      return;\n    }\n    setShowAllTasksState((prev) => !prev);\n  }, [shouldShowTaskToggle]);\n\n  useEffect(() => {\n    setShowAllTasksState(false);\n  }, [projectId]);\n\n  useEffect(() => {\n    if (showAllTasksState && totalTaskCount <= TASK_PREVIEW_LIMIT) {\n      setShowAllTasksState(false);\n    }\n  }, [showAllTasksState, totalTaskCount]);\n\n  useEffect(() => {\n    if (editingTaskId && !scopedTasks.some((task) => task.id === editingTaskId)) {\n      setEditingTaskId(null);\n      setEditingTaskText(\"\");\n    }\n  }, [editingTaskId, scopedTasks]);\n\n  useEffect(() => {\n    if (!projectId) {\n      prevProjectIdRef.current = null;\n      prevTasksRef.current = new Map();\n      setTaskAnnouncement((prev) =>\n        prev.text ? { text: \"\", toggleMarker: prev.toggleMarker } : prev,\n      );\n      return;\n    }\n\n    const currentTasksMap = new Map<string, { title: string; done: boolean }>(\n      scopedTasks.map((task) => [task.id, { title: task.title, done: task.done }]),\n    );\n\n    if (prevProjectIdRef.current !== projectId) {\n      prevProjectIdRef.current = projectId;\n      prevTasksRef.current = currentTasksMap;\n      setTaskAnnouncement((prev) =>\n        prev.text ? { text: \"\", toggleMarker: prev.toggleMarker } : prev,\n      );\n      return;\n    }\n\n    const prevTasksMap = prevTasksRef.current;\n    let message: string | null = null;\n    const projectSuffix = projectName ? ` in project \"${projectName}\"` : \"\";\n\n    for (const [id, task] of currentTasksMap) {\n      if (!prevTasksMap.has(id)) {\n        message = `Task \"${task.title}\" added${projectSuffix}.`;\n        break;\n      }\n    }\n\n    if (!message) {\n      for (const [id, prevTask] of prevTasksMap) {\n        if (!currentTasksMap.has(id)) {\n          message = `Task \"${prevTask.title}\" removed${projectSuffix}.`;\n          break;\n        }\n      }\n    }\n\n    if (!message) {\n      for (const [id, task] of currentTasksMap) {\n        const prevTask = prevTasksMap.get(id);\n        if (!prevTask) continue;\n\n        if (prevTask.title !== task.title) {\n          message = `Task \"${prevTask.title}\" renamed to \"${task.title}\"${projectSuffix}.`;\n          break;\n        }\n\n        if (prevTask.done !== task.done) {\n          message = task.done\n            ? `Task \"${task.title}\" marked complete${projectSuffix}.`\n            : `Task \"${task.title}\" marked incomplete${projectSuffix}.`;\n          break;\n        }\n      }\n    }\n\n    if (message) {\n      setTaskAnnouncement((prev) => ({\n        text: `${message}${prev.toggleMarker ? \"\" : \"\\u200B\"}`,\n        toggleMarker: !prev.toggleMarker,\n      }));\n    }\n\n    prevTasksRef.current = currentTasksMap;\n  }, [projectId, projectName, scopedTasks]);\n\n  return {\n    tasksListId,\n    taskInputName,\n    visibleTasks,\n    totalTaskCount,\n    showAllTasks,\n    shouldShowTaskToggle,\n    editingTaskId,\n    editingTaskText,\n    taskAnnouncementText: taskAnnouncement.text,\n    handleTaskFormSubmit,\n    handleTaskSelect,\n    handleTaskToggle,\n    handleTaskDelete,\n    openTaskEditor,\n    handleTaskRenameChange,\n    commitTaskRename,\n    cancelTaskRename,\n    toggleShowAllTasks,\n  };\n}\n\n","// src/components/planner/scheduleSavingReset.ts\n\nexport function scheduleSavingReset(callback: VoidFunction): void {\n  if (typeof queueMicrotask === \"function\") {\n    queueMicrotask(callback);\n    return;\n  }\n\n  setTimeout(callback, 0);\n}\n","\"use client\";\n\nimport { Pencil, Trash2 } from \"lucide-react\";\nimport type { FormEvent, KeyboardEvent, MouseEvent } from \"react\";\n\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"@/components/ui/primitives/Button\";\nimport { IconButton } from \"@/components/ui/primitives/IconButton\";\nimport { Input } from \"@/components/ui/primitives/Input\";\nimport { CheckCircle } from \"@/components/ui/toggles/CheckCircle\";\nimport type { DayTask } from \"./plannerTypes\";\n\nconst TASK_OPTION_GUARD_SELECTOR = \"[data-task-option-guard='true']\";\n\nexport type TodayHeroTasksProps = {\n  projectId: string;\n  projectName: string;\n  tasksListId: string;\n  taskInputName: string;\n  visibleTasks: DayTask[];\n  totalTaskCount: number;\n  showAllTasks: boolean;\n  shouldShowTaskToggle: boolean;\n  editingTaskId: string | null;\n  editingTaskText: string;\n  taskAnnouncementText: string;\n  onTaskFormSubmit: (event: FormEvent<HTMLFormElement>) => void;\n  onTaskSelect: (taskId: string) => void;\n  onTaskToggle: (taskId: string) => void;\n  onTaskDelete: (taskId: string) => void;\n  onTaskEditOpen: (taskId: string, title: string, options?: { select?: boolean }) => void;\n  onTaskRenameChange: (value: string) => void;\n  onTaskRenameCommit: (taskId: string, fallbackTitle: string) => void;\n  onTaskRenameCancel: () => void;\n  onToggleShowAllTasks: () => void;\n};\n\nexport function TodayHeroTasks({\n  projectId,\n  projectName,\n  tasksListId,\n  taskInputName,\n  visibleTasks,\n  totalTaskCount,\n  showAllTasks,\n  shouldShowTaskToggle,\n  editingTaskId,\n  editingTaskText,\n  taskAnnouncementText,\n  onTaskFormSubmit,\n  onTaskSelect,\n  onTaskToggle,\n  onTaskDelete,\n  onTaskEditOpen,\n  onTaskRenameChange,\n  onTaskRenameCommit,\n  onTaskRenameCancel,\n  onToggleShowAllTasks,\n}: TodayHeroTasksProps) {\n  if (!projectId) {\n    return (\n      <div className=\"mt-[var(--space-4)] text-ui font-medium text-muted-foreground\">\n        Select a project to add and view tasks.\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"mt-[var(--space-4)] space-y-[var(--space-4)]\">\n      <form onSubmit={onTaskFormSubmit}>\n        <Input\n          name={taskInputName}\n          placeholder={`> task for \"${projectName || \"Project\"}\"`}\n          aria-label=\"New task\"\n          className=\"w-full\"\n        />\n      </form>\n\n      <div aria-live=\"polite\" className=\"sr-only\">\n        {taskAnnouncementText}\n      </div>\n\n      {totalTaskCount === 0 ? (\n        <div className=\"tasks-placeholder\">No tasks yet.</div>\n      ) : (\n        <div className=\"space-y-[var(--space-2)]\">\n          <ul\n            id={tasksListId}\n            className=\"space-y-[var(--space-2)]\"\n            role=\"list\"\n            aria-label=\"Tasks\"\n          >\n            {visibleTasks.map((task) => {\n              const isEditing = editingTaskId === task.id;\n              return (\n                <li key={task.id} className=\"group relative\" role=\"listitem\">\n                  <button\n                    type=\"button\"\n                    aria-label={`Select task ${task.title}`}\n                    onClick={(event: MouseEvent<HTMLButtonElement>) => {\n                      if (event.defaultPrevented) return;\n                      if (\n                        event.target instanceof Element &&\n                        event.target.closest(TASK_OPTION_GUARD_SELECTOR)\n                      ) {\n                        return;\n                      }\n                      if (event.target !== event.currentTarget) return;\n                      onTaskSelect(task.id);\n                    }}\n                    onKeyDown={(event: KeyboardEvent<HTMLButtonElement>) => {\n                      if (event.defaultPrevented) return;\n                      if (event.currentTarget !== event.target) {\n                        return;\n                      }\n                      if (\n                        event.key === \"Enter\" ||\n                        event.key === \" \" ||\n                        event.key === \"Spacebar\"\n                      ) {\n                        event.preventDefault();\n                        onTaskSelect(task.id);\n                      }\n                    }}\n                    className={cn(\n                      \"task-tile absolute inset-0 w-full rounded-card r-card-lg border transition-colors\",\n                      \"border-border bg-card/55 hover:bg-card/70 focus-visible:bg-card/70 active:bg-card/80\",\n                      \"group-hover:bg-card/70 group-active:bg-card/80 group-focus-within:bg-card/70\",\n                      \"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-0\",\n                      \"group-focus-within:ring-2 group-focus-within:ring-ring group-focus-within:ring-offset-0\",\n                    )}\n                  >\n                    <span className=\"sr-only\">{`Select task ${task.title}`}</span>\n                  </button>\n\n                  <div\n                    className={cn(\n                      \"pointer-events-none relative z-[1] flex w-full items-center justify-between\",\n                      \"rounded-card r-card-lg px-[var(--space-3)] py-[var(--space-2)]\",\n                    )}\n                  >\n                    <div className=\"pointer-events-none flex items-center gap-[var(--space-3)]\">\n                      <div\n                        className=\"pointer-events-auto\"\n                        data-task-option-guard=\"true\"\n                        onPointerDown={(event) => event.stopPropagation()}\n                      >\n                        <CheckCircle\n                          checked={task.done}\n                          onChange={() => {\n                            onTaskToggle(task.id);\n                          }}\n                          size=\"sm\"\n                        />\n                      </div>\n                      {isEditing ? (\n                        <Input\n                          name={`rename-task-${task.id}`}\n                          autoFocus\n                          value={editingTaskText}\n                          onChange={(event) => onTaskRenameChange(event.target.value)}\n                          onKeyDown={(event) => {\n                            if (event.key === \"Enter\") {\n                              onTaskRenameCommit(task.id, task.title);\n                            }\n                            if (event.key === \"Escape\") onTaskRenameCancel();\n                          }}\n                          onBlur={() => {\n                            onTaskRenameCommit(task.id, task.title);\n                          }}\n                          onPointerDown={(event) => event.stopPropagation()}\n                          className=\"pointer-events-auto\"\n                          aria-label={`Rename task ${task.title}`}\n                          data-task-option-guard=\"true\"\n                        />\n                      ) : (\n                        <button\n                          type=\"button\"\n                          className={cn(\n                            \"task-tile__text pointer-events-auto\",\n                            task.done && \"line-through-soft\",\n                          )}\n                          onClick={(event) => {\n                            event.stopPropagation();\n                            onTaskEditOpen(task.id, task.title);\n                          }}\n                          onKeyDown={(event) => {\n                            if (event.key === \"Enter\" || event.key === \" \") {\n                              event.preventDefault();\n                              event.stopPropagation();\n                              onTaskEditOpen(task.id, task.title);\n                            }\n                          }}\n                          onPointerDown={(event) => event.stopPropagation()}\n                          aria-label={`Edit task ${task.title}`}\n                          title=\"Edit task\"\n                        >\n                          {task.title}\n                        </button>\n                      )}\n                    </div>\n\n                    <div\n                      className={cn(\n                        \"flex items-center gap-[var(--space-2)]\",\n                        isEditing\n                          ? \"opacity-0 pointer-events-none\"\n                          : \"opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto group-focus-within:opacity-100 group-focus-within:pointer-events-auto\",\n                      )}\n                    >\n                      <IconButton\n                        aria-label={`Edit task ${task.title}`}\n                        title=\"Edit\"\n                        onClick={(event) => {\n                          event.stopPropagation();\n                          onTaskEditOpen(task.id, task.title, { select: true });\n                        }}\n                        onPointerDown={(event) => event.stopPropagation()}\n                        size=\"sm\"\n                        variant=\"quiet\"\n                        iconSize=\"xs\"\n                      >\n                        <Pencil />\n                      </IconButton>\n                      <IconButton\n                        aria-label=\"Remove task\"\n                        title=\"Remove\"\n                        onClick={(event) => {\n                          event.stopPropagation();\n                          onTaskDelete(task.id);\n                        }}\n                        onPointerDown={(event) => event.stopPropagation()}\n                        size=\"sm\"\n                        variant=\"quiet\"\n                        iconSize=\"xs\"\n                      >\n                        <Trash2 />\n                      </IconButton>\n                    </div>\n                  </div>\n                </li>\n              );\n            })}\n          </ul>\n          {shouldShowTaskToggle && (\n            <div className=\"flex justify-end\">\n              <Button\n                size=\"sm\"\n                variant=\"quiet\"\n                onClick={onToggleShowAllTasks}\n                aria-expanded={showAllTasks}\n                aria-controls={tasksListId}\n              >\n                {showAllTasks ? \"Show less\" : \"Show more\"}\n              </Button>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n","import * as React from \"react\";\nimport { getRingMetrics, type RingSize } from \"@/lib/tokens\";\nimport RingNoiseDefs from \"./RingNoiseDefs\";\n\ninterface ProgressRingIconProps {\n  pct: number; // 0..100\n  size?: number | RingSize;\n}\n\nconst DEFAULT_RING_SIZE: RingSize = \"m\";\n\nexport default function ProgressRingIcon({\n  pct,\n  size,\n}: ProgressRingIconProps) {\n  const uniqueId = React.useId();\n  const noiseFilterId = React.useMemo(\n    () => `ring-noise-${uniqueId}`,\n    [uniqueId],\n  );\n  const ringSize = typeof size === \"string\" ? size : DEFAULT_RING_SIZE;\n  const metrics = React.useMemo(() => getRingMetrics(ringSize), [ringSize]);\n  const resolvedSize = typeof size === \"number\" ? size : metrics.diameter;\n  const strokeWidth = metrics.stroke;\n  const trackInset = metrics.inset;\n  const radius = Math.max(resolvedSize / 2 - trackInset, 0);\n  const circumference = 2 * Math.PI * radius;\n  const offset = circumference - (pct / 100) * circumference;\n  return (\n    <svg\n      className=\"h-full w-full rotate-[-90deg]\"\n      viewBox={`0 0 ${resolvedSize} ${resolvedSize}`}\n      aria-hidden=\"true\"\n      focusable=\"false\"\n    >\n      <defs>\n        <RingNoiseDefs id={noiseFilterId} />\n      </defs>\n      <circle\n        cx={resolvedSize / 2}\n        cy={resolvedSize / 2}\n        r={radius}\n        stroke=\"currentColor\"\n        strokeWidth={strokeWidth}\n        className=\"text-foreground/20\"\n        fill=\"none\"\n      />\n      <circle\n        cx={resolvedSize / 2}\n        cy={resolvedSize / 2}\n        r={radius}\n        stroke=\"currentColor\"\n        strokeWidth={strokeWidth}\n        strokeLinecap=\"round\"\n        strokeDasharray={circumference}\n        strokeDashoffset={offset}\n        className=\"text-accent shadow-ring motion-safe:animate-pulse [--ring:var(--accent)]\"\n        filter={`url(#${noiseFilterId})`}\n        fill=\"none\"\n      />\n    </svg>\n  );\n}\n","\"use client\";\n\nimport * as React from \"react\";\nimport { formatIsoLabel } from \"@/lib/date\";\nimport { GlitchProgress } from \"@/components/ui/primitives/GlitchProgress\";\nimport type { ISODate } from \"./plannerTypes\";\n\ntype Props = {\n  iso: ISODate;\n  projectCount: number;\n  doneCount: number;\n  totalCount: number;\n};\n\nexport function DayCardHeader({\n  iso,\n  projectCount,\n  doneCount,\n  totalCount,\n}: Props) {\n  const formattedIsoLabel = React.useMemo(() => formatIsoLabel(iso), [iso]);\n  const headerText = React.useMemo(\n    () => `// ${formattedIsoLabel}`,\n    [formattedIsoLabel],\n  );\n  const pctNum =\n    totalCount === 0 ? 0 : Math.round((doneCount / totalCount) * 100);\n\n  return (\n    <div className=\"col-span-1 lg:col-span-3 flex items-center gap-[var(--space-3)] min-w-0\">\n      <span\n        className=\"glitch glitch-label text-ui font-semibold tracking-wide shrink-0\"\n        data-text={headerText}\n      >\n        {headerText}\n      </span>\n\n      <div className=\"flex-1 min-w-0\">\n        <GlitchProgress\n          current={doneCount}\n          total={totalCount}\n          aria-label={`Completed items for ${formattedIsoLabel}`}\n        />\n      </div>\n\n      <div className=\"shrink-0 flex items-baseline gap-[var(--space-3)] text-label text-muted-foreground\">\n        <span className=\"tabular-nums font-medium text-foreground\">\n          {pctNum}%\n        </span>\n        <span className=\"hidden sm:inline\"></span>\n        <span className=\"whitespace-nowrap\">\n          <span className=\"tabular-nums\">{projectCount}</span> projects\n        </span>\n        <span className=\"hidden sm:inline\"></span>\n        <span className=\"whitespace-nowrap\">\n          <span className=\"tabular-nums\">{doneCount}</span> /{\" \"}\n          <span className=\"tabular-nums\">{totalCount}</span> items\n        </span>\n      </div>\n    </div>\n  );\n}\n","import * as React from \"react\";\nimport { AvatarFrame } from \"@/components/ui/primitives/AvatarFrame\";\nimport { cn } from \"@/lib/utils\";\nimport styles from \"./PortraitFrame.module.css\";\n\nexport type PoseVariant =\n  | \"duo\"\n  | \"angel-leading\"\n  | \"demon-leading\"\n  | \"back-to-back\";\n\nexport interface PortraitFrameProps {\n  pose?: PoseVariant;\n  /**\n   * When true, the inner surface keeps the rim treatment but exposes a transparent backdrop.\n   */\n  transparentBackground?: boolean;\n  className?: string;\n}\n\ntype CharacterConfig = {\n  className: string;\n  description: string;\n};\n\ntype PoseConfig = {\n  label: string;\n  stageClassName?: string;\n  angel: CharacterConfig;\n  demon: CharacterConfig;\n};\n\nconst poseConfigs: Record<PoseVariant, PoseConfig> = {\n  duo: {\n    label: \"Angel and demon busts sharing a circular portrait frame\",\n    angel: {\n      className: cn(styles.poseDuoAngel, styles.layerFront),\n      description:\n        \"Luminous angel bust facing forward with wings framing the left edge of the frame.\",\n    },\n    demon: {\n      className: cn(styles.poseDuoDemon, styles.layerRear),\n      description:\n        \"Violet demon bust leaning inward with curved horns catching the rim lighting on the right.\",\n    },\n  },\n  \"angel-leading\": {\n    label: \"Angel steps forward while the demon softens into the rim light\",\n    angel: {\n      className: cn(styles.poseAngelLeadingAngel, styles.layerFront),\n      description:\n        \"Angel bust leading the frame with wings swept wide and haloed highlights toward the viewer.\",\n    },\n    demon: {\n      className: cn(styles.poseAngelLeadingDemon, styles.layerRear, styles.layerDimmed),\n      description:\n        \"Demon bust recessed behind the angel, horns still outlined by the accent glow.\",\n    },\n  },\n  \"demon-leading\": {\n    label: \"Demon steps into focus while the angel supports from behind\",\n    angel: {\n      className: cn(styles.poseDemonLeadingAngel, styles.layerRear, styles.layerDimmed),\n      description:\n        \"Angel bust easing back with wings diffused while keeping the left rim illuminated.\",\n    },\n    demon: {\n      className: cn(styles.poseDemonLeadingDemon, styles.layerFront),\n      description:\n        \"Demon bust leading the pose with forward-set horns and a saturated rim highlight.\",\n    },\n  },\n  \"back-to-back\": {\n    label: \"Angel and demon posed back to back with crossed silhouettes\",\n    stageClassName: styles.stageBackToBack,\n    angel: {\n      className: cn(styles.poseBackToBackAngel, styles.layerFront),\n      description:\n        \"Angel bust glancing over the shoulder with wings fanning outward across the left rim.\",\n    },\n    demon: {\n      className: cn(styles.poseBackToBackDemon, styles.layerFront),\n      description:\n        \"Demon bust rotated outward with horns arcing above the right edge of the frame.\",\n    },\n  },\n};\n\nexport function PortraitFrame({\n  pose = \"duo\",\n  transparentBackground = false,\n  className,\n}: PortraitFrameProps) {\n  const config = poseConfigs[pose];\n  const figureId = React.useId();\n  const angelId = React.useId();\n  const demonId = React.useId();\n\n  return (\n    <AvatarFrame\n      as=\"figure\"\n      frame\n      size=\"lg\"\n      role=\"img\"\n      aria-labelledby={`${figureId} ${angelId} ${demonId}`}\n      className={className}\n      innerClassName={cn(\n        \"flex h-full w-full items-center justify-center\",\n        transparentBackground && styles.innerTransparent,\n      )}\n      before={\n        <>\n          <span id={figureId} className=\"sr-only\">\n            {config.label}\n          </span>\n          <span id={angelId} className=\"sr-only\">\n            {config.angel.description}\n          </span>\n          <span id={demonId} className=\"sr-only\">\n            {config.demon.description}\n          </span>\n        </>\n      }\n    >\n      <span aria-hidden className={styles.rimLighting} />\n      <div\n        aria-hidden\n        className={cn(\n          styles.stage,\n          config.stageClassName,\n          transparentBackground && styles.stageTransparent,\n        )}\n      >\n        <div className={cn(styles.character, styles.angel, config.angel.className)}>\n          <span aria-hidden className={styles.angelWings} />\n          <span aria-hidden className={styles.characterBody} />\n          <span aria-hidden className={styles.characterCollar} />\n          <span aria-hidden className={styles.characterHead} />\n        </div>\n        <div className={cn(styles.character, styles.demon, config.demon.className)}>\n          <span aria-hidden className={styles.demonHorns} />\n          <span aria-hidden className={styles.characterBody} />\n          <span aria-hidden className={styles.characterCollar} />\n          <span aria-hidden className={styles.characterHead} />\n        </div>\n      </div>\n    </AvatarFrame>\n  );\n}\n","\"use client\";\n\nimport * as React from \"react\";\nimport { IconButton } from \"@/components/ui/primitives/IconButton\";\nimport { ArrowUp } from \"lucide-react\";\nimport { usePrefersReducedMotion } from \"@/lib/useReducedMotion\";\n\ntype ScrollTopFloatingButtonProps = {\n  watchRef: React.RefObject<HTMLElement | null>;\n  forceVisible?: boolean;\n};\n\nexport function ScrollTopFloatingButton({\n  watchRef,\n  forceVisible = false,\n}: ScrollTopFloatingButtonProps) {\n  const [visible, setVisible] = React.useState(false);\n  const reduceMotion = usePrefersReducedMotion();\n\n  const [target, setTarget] = React.useState<HTMLElement | null>(\n    () => watchRef.current,\n  );\n\n  const watchedElement = watchRef.current;\n\n  const supportsIntersectionObserver =\n    typeof window !== \"undefined\" && \"IntersectionObserver\" in window;\n\n  React.useEffect(() => {\n    if (watchedElement !== target) {\n      setTarget(watchedElement ?? null);\n    }\n  }, [watchedElement, target]);\n\n  React.useEffect(() => {\n    if (!supportsIntersectionObserver) {\n      setVisible(true);\n      return undefined;\n    }\n\n    if (!target) {\n      return undefined;\n    }\n\n    const obs = new IntersectionObserver((entries) => {\n      entries.forEach((e) => setVisible(!e.isIntersecting));\n    });\n\n    obs.observe(target);\n\n    return () => {\n      obs.unobserve(target);\n      obs.disconnect();\n    };\n  }, [supportsIntersectionObserver, target]);\n\n  const scrollTop = () => {\n    if (typeof window !== \"undefined\") {\n      const behavior: ScrollBehavior = reduceMotion ? \"auto\" : \"smooth\";\n      window.scrollTo({ top: 0, behavior });\n    }\n  };\n\n  if (!visible && !forceVisible) return null;\n\n  return (\n    <IconButton\n      aria-label=\"Scroll to top\"\n      onClick={scrollTop}\n      className=\"fixed bottom-[var(--space-8)] right-[max(var(--space-2),calc((var(--viewport-width) - var(--shell-max, var(--shell-width))) / 2 + var(--space-2)))] z-50\"\n    >\n      <ArrowUp />\n    </IconButton>\n  );\n}\n","\"use client\";\n\nimport { Pencil, Trash2 } from \"lucide-react\";\nimport type { FormEvent } from \"react\";\n\nimport { cn } from \"@/lib/utils\";\nimport { Label } from \"@/components/ui/Label\";\nimport { Button } from \"@/components/ui/primitives/Button\";\nimport { IconButton } from \"@/components/ui/primitives/IconButton\";\nimport { Input } from \"@/components/ui/primitives/Input\";\nimport { CheckCircle } from \"@/components/ui/toggles/CheckCircle\";\nimport type { Project } from \"./plannerTypes\";\n\nconst PROJECT_OPTION_GUARD_SELECTOR = \"[data-project-option-guard='true']\";\n\nexport type TodayHeroProjectsProps = {\n  projects: Project[];\n  selectedProjectId: string;\n  projectsListId: string;\n  projectName: string;\n  editingProjectId: string | null;\n  editingProjectName: string;\n  showAllProjects: boolean;\n  visibleProjects: Project[];\n  hiddenProjectsCount: number;\n  shouldShowProjectToggle: boolean;\n  onProjectNameChange: (value: string) => void;\n  onProjectFormSubmit: (event: FormEvent<HTMLFormElement>) => void;\n  onProjectSelect: (projectId: string) => void;\n  onProjectToggle: (projectId: string) => void;\n  onProjectDelete: (projectId: string) => void;\n  onProjectEditOpen: (projectId: string, name: string) => void;\n  onProjectRenameChange: (value: string) => void;\n  onProjectRenameCommit: (projectId: string, fallbackName: string) => void;\n  onProjectRenameCancel: () => void;\n  onToggleShowAllProjects: () => void;\n};\n\nexport function TodayHeroProjects({\n  projects,\n  selectedProjectId,\n  projectsListId,\n  projectName,\n  editingProjectId,\n  editingProjectName,\n  showAllProjects,\n  visibleProjects,\n  hiddenProjectsCount,\n  shouldShowProjectToggle,\n  onProjectNameChange,\n  onProjectFormSubmit,\n  onProjectSelect,\n  onProjectToggle,\n  onProjectDelete,\n  onProjectEditOpen,\n  onProjectRenameChange,\n  onProjectRenameCommit,\n  onProjectRenameCancel,\n  onToggleShowAllProjects,\n}: TodayHeroProjectsProps) {\n  const newProjectInputId = `${projectsListId}-new-project`;\n  const newProjectHelpId = `${projectsListId}-new-project-help`;\n  const activeProjectOptionId = visibleProjects.some(\n    (project) => project.id === selectedProjectId,\n  )\n    ? `${projectsListId}-option-${selectedProjectId}`\n    : undefined;\n\n  return (\n    <div className=\"mt-[var(--space-4)] space-y-[var(--space-4)]\">\n      <form onSubmit={onProjectFormSubmit} className=\"grid gap-[var(--space-2)]\">\n        <Label htmlFor={newProjectInputId} className=\"mb-0\">\n          New project\n        </Label>\n        <div className=\"flex flex-col gap-[var(--space-2)] sm:flex-row sm:items-center sm:gap-[var(--space-3)]\">\n          <Input\n            id={newProjectInputId}\n            name=\"new-project\"\n            placeholder=\"> new project\"\n            value={projectName}\n            onChange={(event) => onProjectNameChange(event.target.value)}\n            className=\"w-full sm:flex-1\"\n            aria-describedby={newProjectHelpId}\n          />\n          <Button\n            type=\"submit\"\n            size=\"sm\"\n            variant=\"default\"\n            className=\"w-full sm:w-auto sm:shrink-0\"\n            disabled={projectName.trim().length === 0}\n          >\n            Add\n          </Button>\n        </div>\n        <div\n          id={newProjectHelpId}\n          className=\"text-label font-medium text-foreground\"\n        >\n          Press Enter or Add to glitch this project into today.\n        </div>\n      </form>\n\n      {projects.length > 0 && (\n        <>\n          <ul\n            id={projectsListId}\n            className=\"space-y-[var(--space-2)]\"\n            role=\"listbox\"\n            aria-label=\"Projects\"\n            aria-activedescendant={activeProjectOptionId}\n          >\n            {visibleProjects.map((project) => {\n              const isEditing = editingProjectId === project.id;\n              const isSelected = selectedProjectId === project.id;\n              const optionId = `${projectsListId}-option-${project.id}`;\n              return (\n                <li key={project.id} role=\"presentation\">\n                  <div\n                    className={cn(\n                      \"group flex select-none items-center justify-between rounded-card r-card-lg border px-[var(--space-3)] py-[var(--space-2)] text-ui font-medium transition\",\n                      \"border-border bg-card/55 hover:bg-card/70 focus-visible:bg-card/70 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring\",\n                      isSelected && \"ring-1 ring-ring\",\n                    )}\n                    tabIndex={0}\n                    role=\"option\"\n                    id={optionId}\n                    aria-selected={isSelected}\n                    aria-disabled={isEditing}\n                    onClick={(event) => {\n                      if (\n                        event.target instanceof Element &&\n                        event.target.closest(PROJECT_OPTION_GUARD_SELECTOR)\n                      ) {\n                        return;\n                      }\n                      if (!isEditing) onProjectSelect(project.id);\n                    }}\n                    onKeyDown={(event) => {\n                      if (event.target !== event.currentTarget) return;\n                      if (isEditing) return;\n                      if ([\"Enter\", \" \", \"Space\", \"Spacebar\"].includes(event.key)) {\n                        event.preventDefault();\n                        onProjectSelect(project.id);\n                      }\n                    }}\n                    title={\n                      isEditing\n                        ? \"Editing\"\n                        : isSelected\n                          ? \"Selected\"\n                          : \"Click to select\"\n                    }\n                  >\n                    {isEditing ? (\n                      <Input\n                        name={`rename-project-${project.id}`}\n                        autoFocus\n                        value={editingProjectName}\n                        onChange={(event) => onProjectRenameChange(event.target.value)}\n                        onKeyDown={(event) => {\n                          if (event.key === \"Enter\") {\n                            onProjectRenameCommit(project.id, project.name);\n                          }\n                          if (event.key === \"Escape\") onProjectRenameCancel();\n                        }}\n                        onBlur={() => {\n                          onProjectRenameCommit(project.id, project.name);\n                        }}\n                        aria-label={`Rename project ${project.name}`}\n                        data-project-option-guard=\"true\"\n                      />\n                    ) : (\n                        <div className=\"flex min-w-0 items-center gap-[var(--space-3)]\">\n                          <span\n                            className=\"shrink-0\"\n                            data-project-option-guard=\"true\"\n                          >\n                          <CheckCircle\n                            size=\"sm\"\n                            checked={project.done}\n                            onChange={() => onProjectToggle(project.id)}\n                            aria-label={`Toggle completion for ${project.name}`}\n                          />\n                        </span>\n                        <span\n                          className={cn(\n                            \"truncate\",\n                            project.done && \"line-through-soft text-muted-foreground\",\n                          )}\n                        >\n                          {project.name}\n                        </span>\n                      </div>\n                    )}\n\n                    <div className=\"flex items-center gap-[var(--space-2)]\">\n                      <IconButton\n                        aria-label={`Edit project ${project.name}`}\n                        title=\"Edit\"\n                        onClick={(event) => {\n                          event.stopPropagation();\n                          onProjectEditOpen(project.id, project.name);\n                        }}\n                        size=\"sm\"\n                        variant=\"quiet\"\n                        iconSize=\"xs\"\n                      >\n                        <Pencil />\n                      </IconButton>\n                      <IconButton\n                        aria-label={`Remove project ${project.name}`}\n                        title=\"Remove\"\n                        onClick={(event) => {\n                          event.stopPropagation();\n                          onProjectDelete(project.id);\n                        }}\n                        size=\"sm\"\n                        variant=\"quiet\"\n                        iconSize=\"xs\"\n                      >\n                        <Trash2 />\n                      </IconButton>\n                    </div>\n                  </div>\n                </li>\n              );\n            })}\n            {hiddenProjectsCount > 0 && (\n              <li className=\"pr-[var(--space-1)] text-right text-label font-medium tracking-[0.02em] opacity-70\">\n                + {hiddenProjectsCount} more\n              </li>\n            )}\n          </ul>\n          {shouldShowProjectToggle && (\n            <div className=\"flex justify-end\">\n              <Button\n                size=\"sm\"\n                variant=\"quiet\"\n                onClick={onToggleShowAllProjects}\n                aria-expanded={showAllProjects}\n                aria-controls={projectsListId}\n              >\n                {showAllProjects ? \"Show less\" : \"Show more\"}\n              </Button>\n            </div>\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n","// src/components/error/ClientErrorBoundary.tsx\n\"use client\";\n\nimport * as React from \"react\";\n\nimport { reportBoundaryError } from \"@/lib/observability/boundary-error-reporter\";\n\ntype BoundaryError = Error & { digest?: string };\n\ntype ClientErrorBoundaryProps = {\n  readonly name: string;\n  readonly children: React.ReactNode;\n  readonly renderFallback?: (context: {\n    error: BoundaryError;\n    reset: () => void;\n  }) => React.ReactNode;\n};\n\ntype ClientErrorBoundaryState = {\n  error: BoundaryError | null;\n  resetKey: number;\n};\n\nexport class ClientErrorBoundary extends React.Component<\n  ClientErrorBoundaryProps,\n  ClientErrorBoundaryState\n> {\n  state: ClientErrorBoundaryState = {\n    error: null,\n    resetKey: 0,\n  };\n\n  static getDerivedStateFromError(\n    error: BoundaryError,\n  ): Partial<ClientErrorBoundaryState> {\n    return { error };\n  }\n\n  override componentDidCatch(error: BoundaryError, info: React.ErrorInfo) {\n    const { name } = this.props;\n\n    reportBoundaryError({\n      boundary: name,\n      error,\n      info: {\n        componentStack: info.componentStack,\n      },\n    });\n  }\n\n  private readonly handleReset = () => {\n    this.setState((previous) => ({\n      error: null,\n      resetKey: previous.resetKey + 1,\n    }));\n  };\n\n  override render() {\n    const { children, renderFallback } = this.props;\n    const { error, resetKey } = this.state;\n\n    if (error) {\n      if (renderFallback) {\n        return renderFallback({ error, reset: this.handleReset });\n      }\n\n      return null;\n    }\n\n    return React.createElement(React.Fragment, { key: resetKey }, children);\n  }\n}\n\n","\"use client\";\n\nimport { useMemo, useRef, useCallback } from \"react\";\nimport type { ChangeEvent } from \"react\";\nimport { Calendar } from \"lucide-react\";\n\nimport { toISODate } from \"@/lib/date\";\nimport { IconButton } from \"@/components/ui/primitives/IconButton\";\nimport type { ISODate } from \"./plannerTypes\";\n\nconst HEADER_TITLE = \"Today\";\n\ntype DateInputWithPicker = HTMLInputElement & { showPicker?: () => void };\n\ntype TodayHeroHeaderProps = {\n  viewIso: ISODate;\n  isToday: boolean;\n  onChange: (nextIso: ISODate) => void;\n};\n\nexport function TodayHeroHeader({\n  viewIso,\n  isToday,\n  onChange,\n}: TodayHeroHeaderProps) {\n  const fallbackIso = useMemo(() => toISODate(), []);\n  const dateRef = useRef<HTMLInputElement>(null);\n\n  const openPicker = useCallback(() => {\n    const el = dateRef.current as DateInputWithPicker | null;\n    if (el?.showPicker) {\n      el.showPicker();\n      return;\n    }\n    dateRef.current?.focus();\n  }, []);\n\n  const handleChange = useCallback(\n    (event: ChangeEvent<HTMLInputElement>) => {\n      onChange(event.target.value as ISODate);\n    },\n    [onChange],\n  );\n\n  const title = isToday ? HEADER_TITLE : viewIso;\n  const inputValue = viewIso || fallbackIso;\n\n  return (\n    <div className=\"mb-[var(--space-4)] flex flex-col gap-[var(--space-2)] md:flex-row md:items-center md:justify-between\">\n      <div className=\"flex items-center gap-[var(--space-3)]\">\n        <h2 className=\"glitch text-title font-semibold tracking-[-0.01em]\" data-text={title}>\n          {title}\n        </h2>\n      </div>\n\n      <div className=\"flex items-center gap-[var(--space-2)]\">\n        <input\n          ref={dateRef}\n          type=\"date\"\n          value={inputValue}\n          onChange={handleChange}\n          aria-label=\"Change focused date\"\n          className=\"sr-only\"\n        />\n        <IconButton\n          aria-label=\"Open calendar\"\n          title={viewIso}\n          onClick={openPicker}\n          size=\"md\"\n          variant=\"quiet\"\n          iconSize=\"md\"\n        >\n          <Calendar />\n        </IconButton>\n      </div>\n    </div>\n  );\n}\n","\"use client\";\n\n/**\n * WeekPicker  Lavender-Glitch compliant, hydration-safe\n * - Single-click chip: set focus date (TodayHero updates)\n * - Double-click chip: smooth-scroll to that day card\n * - Selected chip shows armed state (dashed, tinted border)\n * - Jump to top button appears after a double-click jump; disappears when back at top\n */\n\nimport * as React from \"react\";\nimport { Hero } from \"@/components/ui/layout/Hero\";\nimport { Button } from \"@/components/ui/primitives/Button\";\nimport { useFocusDate, useWeek } from \"./useFocusDate\";\nimport type { ISODate } from \"./plannerTypes\";\nimport { useWeekData } from \"./useWeekData\";\nimport { usePrefersReducedMotion } from \"@/lib/useReducedMotion\";\nimport { ArrowUpToLine, ChevronLeft, ChevronRight } from \"lucide-react\";\nimport { addDays, fromISODate, toISODate } from \"@/lib/date\";\nimport { cn } from \"@/lib/utils\";\nimport { WeekPickerShell } from \"./WeekPickerShell\";\n\n/*  date helpers  */\n\nconst dmy = new Intl.DateTimeFormat(undefined, {\n  day: \"2-digit\",\n  month: \"short\",\n});\n\nconst chipDisplayFormatter = new Intl.DateTimeFormat(undefined, {\n  weekday: \"short\",\n  month: \"short\",\n  day: \"2-digit\",\n});\n\nconst chipAccessibleFormatter = new Intl.DateTimeFormat(undefined, {\n  weekday: \"long\",\n  month: \"long\",\n  day: \"numeric\",\n});\n\nconst formatChipDisplayLabel = (value: ISODate): string => {\n  const dt = fromISODate(value);\n  if (!dt) return value;\n  return chipDisplayFormatter.format(dt);\n};\n\nconst formatChipAccessibleLabel = (value: ISODate): string => {\n  const dt = fromISODate(value);\n  if (!dt) return value;\n  return chipAccessibleFormatter.format(dt);\n};\n\n/*  presentational chip (no hooks)  */\n\ntype DayChipNavDirection = \"prev\" | \"next\" | \"first\" | \"last\";\n\ntype DayChipProps = {\n  iso: ISODate;\n  selected: boolean;\n  today: boolean;\n  done: number;\n  total: number;\n  onClick: (iso: ISODate) => void;\n  onDoubleClick: (iso: ISODate) => void;\n  onNavigate: (direction: DayChipNavDirection) => void;\n  onFocus: () => void;\n  tabIndex: number;\n};\n\nconst CHIP_SURFACE_CARD = \"[--chip-surface-rest:hsl(var(--card))]\";\nconst CHIP_SURFACE_SUCCESS = \"[--chip-surface-rest:hsl(var(--success) / 0.2)]\";\nconst CHIP_SURFACE_ACCENT_MED = \"[--chip-surface-rest:hsl(var(--accent-3) / 0.2)]\";\nconst CHIP_SURFACE_ACCENT_LIGHT = \"[--chip-surface-rest:hsl(var(--accent-3) / 0.3)]\";\n\nconst DayChip = React.forwardRef<HTMLButtonElement, DayChipProps>(function DayChip(\n  {\n    iso,\n    selected,\n    today,\n    done,\n    total,\n    onClick,\n    onDoubleClick,\n    onNavigate,\n    onFocus,\n    tabIndex,\n  },\n  ref,\n) {\n  const displayLabel = React.useMemo(() => formatChipDisplayLabel(iso), [iso]);\n  const accessibleLabel = React.useMemo(\n    () => formatChipAccessibleLabel(iso),\n    [iso],\n  );\n  const completionRatio = React.useMemo(() => {\n    if (total <= 0) {\n      return 0;\n    }\n    const ratio = done / total;\n    if (!Number.isFinite(ratio)) {\n      return 0;\n    }\n    if (ratio <= 0) {\n      return 0;\n    }\n    if (ratio >= 1) {\n      return 1;\n    }\n    return ratio;\n  }, [done, total]);\n  const { surface: completionSurfaceClass, text: completionTextClass } = React.useMemo(() => {\n    if (total === 0) {\n      return { surface: CHIP_SURFACE_CARD, text: \"text-muted-foreground\" };\n    }\n    if (completionRatio >= 2 / 3) {\n      return { surface: CHIP_SURFACE_SUCCESS, text: \"text-foreground\" };\n    }\n    if (completionRatio >= 1 / 3) {\n      return { surface: CHIP_SURFACE_ACCENT_MED, text: \"text-foreground\" };\n    }\n    return { surface: CHIP_SURFACE_ACCENT_LIGHT, text: \"text-foreground\" };\n  }, [completionRatio, total]);\n  const instructionsId = React.useId();\n  const countsId = React.useId();\n  const instructionsText = selected\n    ? \"Press Enter again or double-click to jump.\"\n    : \"Press Enter to select.\";\n  const describedBy = `${countsId} ${instructionsId}`;\n\n  const handleKeyDown = (event: React.KeyboardEvent<HTMLButtonElement>) => {\n    if (event.key === \"Enter\" && selected) {\n      event.preventDefault();\n      event.stopPropagation();\n      onDoubleClick(iso);\n      return;\n    }\n\n    if (event.key === \"ArrowLeft\") {\n      event.preventDefault();\n      onNavigate(\"prev\");\n      return;\n    }\n\n    if (event.key === \"ArrowRight\") {\n      event.preventDefault();\n      onNavigate(\"next\");\n      return;\n    }\n\n    if (event.key === \"Home\") {\n      event.preventDefault();\n      onNavigate(\"first\");\n      return;\n    }\n\n    if (event.key === \"End\") {\n      event.preventDefault();\n      onNavigate(\"last\");\n    }\n  };\n\n  return (\n    <button\n      type=\"button\"\n      role=\"option\"\n      ref={ref}\n      onClick={() => onClick(iso)}\n      onDoubleClick={() => onDoubleClick(iso)}\n      onKeyDown={handleKeyDown}\n      onFocus={onFocus}\n      tabIndex={tabIndex}\n      aria-selected={selected}\n      aria-label={`Select ${accessibleLabel}`}\n      aria-describedby={describedBy}\n      title={\n        selected\n          ? \"Press Enter again or double-click to jump\"\n          : \"Click or press Enter to focus\"\n      }\n      className={cn(\n        \"chip chip-token relative flex-none w-[--chip-width] rounded-card r-card-lg border text-left transition snap-start chip-surface chip-border chip-ring\",\n        \"focus-visible:outline-none focus-visible:ring focus-visible:ring-offset-0 focus-visible:[--tw-ring-width:var(--ring-size-2)] focus-visible:[--tw-ring-color:var(--ring-accent)]\",\n        \"data-[focus-visible]:outline-none data-[focus-visible]:ring data-[focus-visible]:ring-offset-0 data-[focus-visible]:[--tw-ring-width:var(--ring-size-2)] data-[focus-visible]:[--tw-ring-color:var(--ring-accent)]\",\n        completionSurfaceClass,\n        today && \"chip--today\",\n        selected ? \"chip--active border-dashed\" : undefined,\n      )}\n      data-today={today || undefined}\n      data-active={selected || undefined}\n    >\n      <div\n        className={cn(\n          \"chip__date\",\n          completionTextClass,\n          today && completionSurfaceClass === CHIP_SURFACE_CARD\n            ? \"text-accent-3\"\n            : undefined,\n        )}\n        data-text={displayLabel}\n      >\n        <span aria-hidden=\"true\">{displayLabel}</span>\n        <span className=\"sr-only\" data-chip-label=\"full\">\n          {accessibleLabel}\n        </span>\n      </div>\n      <div id={countsId} className=\"chip__counts text-foreground\">\n        <span className=\"tabular-nums\">{done}</span>\n        <span className=\"text-foreground/70\"> / {total}</span>\n      </div>\n      <span\n        id={instructionsId}\n        className=\"sr-only\"\n        aria-live=\"polite\"\n        aria-atomic=\"true\"\n      >\n        {instructionsText}\n      </span>\n      {/* decorative layers */}\n      <span aria-hidden className=\"chip__scan\" />\n      <span aria-hidden className=\"chip__edge\" />\n    </button>\n  );\n});\n\n/*  main  */\n\nexport function WeekPicker() {\n  const { iso, setIso, today } = useFocusDate();\n  const { start, end, days } = useWeek(iso);\n  const heading = `${dmy.format(start)}  ${dmy.format(end)}`;\n  const { per, weekDone, weekTotal } = useWeekData(days);\n  const reduceMotion = usePrefersReducedMotion();\n  const accessibleRange = `${chipAccessibleFormatter.format(start)} to ${chipAccessibleFormatter.format(end)}`;\n\n  const chipRefs = React.useRef<(HTMLButtonElement | null)[]>([]);\n  const findSelectedIndex = React.useCallback(() => {\n    const selectedIndex = days.indexOf(iso);\n    if (selectedIndex !== -1) {\n      return selectedIndex;\n    }\n    return days.length > 0 ? 0 : -1;\n  }, [days, iso]);\n\n  const [focusIndex, setFocusIndex] = React.useState(() => {\n    const initialIndex = findSelectedIndex();\n    return initialIndex === -1 ? 0 : initialIndex;\n  });\n\n  React.useEffect(() => {\n    const selectedIndex = findSelectedIndex();\n    if (selectedIndex === -1) return;\n    setFocusIndex((prev) => (prev === selectedIndex ? prev : selectedIndex));\n  }, [findSelectedIndex]);\n\n  React.useEffect(() => {\n    chipRefs.current.length = days.length;\n  }, [days.length]);\n\n  const focusChip = React.useCallback(\n    (index: number) => {\n      if (index < 0 || index >= days.length) return;\n      const nextIso = days[index];\n      if (!nextIso) return;\n      if (nextIso !== iso) {\n        setIso(nextIso);\n      }\n      setFocusIndex(index);\n      if (typeof window !== \"undefined\") {\n        window.requestAnimationFrame(() => {\n          chipRefs.current[index]?.focus({ preventScroll: true });\n        });\n      } else {\n        chipRefs.current[index]?.focus({ preventScroll: true });\n      }\n    },\n    [days, iso, setIso],\n  );\n\n  const handleNavigate = React.useCallback(\n    (currentIndex: number, direction: DayChipNavDirection) => {\n      if (days.length === 0) return;\n\n      let nextIndex = currentIndex;\n      switch (direction) {\n        case \"prev\":\n          nextIndex = Math.max(0, currentIndex - 1);\n          break;\n        case \"next\":\n          nextIndex = Math.min(days.length - 1, currentIndex + 1);\n          break;\n        case \"first\":\n          nextIndex = 0;\n          break;\n        case \"last\":\n          nextIndex = days.length - 1;\n          break;\n      }\n\n      if (nextIndex === currentIndex) return;\n\n      focusChip(nextIndex);\n    },\n    [days, focusChip],\n  );\n\n  // Show \"Jump to top\" button after a double-click jump; hide when back at top\n  const [showTop, setShowTop] = React.useState(false);\n  React.useEffect(() => {\n    if (typeof window === \"undefined\") return undefined;\n\n    let frameId: number | null = null;\n\n    const onScroll = () => {\n      if (frameId !== null) return;\n      frameId = window.requestAnimationFrame(() => {\n        frameId = null;\n        const atTop = window.scrollY <= 4;\n        setShowTop((prev) => (atTop ? false : prev));\n      });\n    };\n\n    window.addEventListener(\"scroll\", onScroll, { passive: true });\n\n    return () => {\n      window.removeEventListener(\"scroll\", onScroll);\n      if (frameId !== null) {\n        window.cancelAnimationFrame(frameId);\n      }\n    };\n  }, []);\n\n  // Select (single-click) vs jump (double-click)\n  const selectOnly = React.useCallback(\n    (d: ISODate) => {\n      if (d === iso) return;\n      setIso(d);\n    },\n    [iso, setIso],\n  );\n  const jumpToDay = React.useCallback(\n    (d: ISODate) => {\n      setIso(d);\n      if (typeof document === \"undefined\") return;\n      const el = document.getElementById(`day-${d}`);\n      if (!(el instanceof HTMLElement)) return;\n\n      const behavior: ScrollBehavior = reduceMotion ? \"auto\" : \"smooth\";\n      el.scrollIntoView({\n        behavior,\n        block: \"start\",\n        inline: \"nearest\",\n      });\n      el.focus({ preventScroll: true });\n      if (typeof window !== \"undefined\") {\n        setShowTop(true);\n      }\n    },\n    [reduceMotion, setIso],\n  );\n\n  const jumpToTop = React.useCallback(() => {\n    if (typeof window === \"undefined\") return;\n\n    const behavior: ScrollBehavior = reduceMotion ? \"auto\" : \"smooth\";\n    window.scrollTo({ top: 0, behavior });\n    if (typeof document === \"undefined\") return;\n    const focusTarget =\n      document.getElementById(\"planner-header\") ??\n      document.getElementById(\"main-content\");\n    if (focusTarget instanceof HTMLElement) {\n      window.requestAnimationFrame(() => {\n        focusTarget.focus({ preventScroll: true });\n      });\n    }\n    // The scroll listener will auto-hide the button when we reach the top\n  }, [reduceMotion]);\n\n  const prevWeek = React.useCallback(() => {\n    setIso(toISODate(addDays(start, -7)));\n  }, [setIso, start]);\n\n  const nextWeek = React.useCallback(() => {\n    setIso(toISODate(addDays(start, 7)));\n  }, [setIso, start]);\n\n  const jumpToday = React.useCallback(() => {\n    setIso(today);\n  }, [setIso, today]);\n\n  const isTodayFocused = iso === today;\n\n  /* Top button goes in Hero actions when applicable */\n  const topAction = showTop ? (\n    <Button\n      variant=\"default\"\n      size=\"sm\"\n      aria-label=\"Jump to top\"\n      onClick={jumpToTop}\n      title=\"Jump to top\"\n      className=\"px-[var(--space-4)]\"\n    >\n      <ArrowUpToLine />\n      <span>Top</span>\n    </Button>\n  ) : undefined;\n\n  return (\n    <Hero\n      heading={heading}\n      subtitle={accessibleRange}\n      actions={topAction}\n      rail\n      sticky\n      dividerTint=\"primary\"\n    >\n      <WeekPickerShell>\n        <WeekPickerShell.Controls slotId=\"week-controls\">\n          <div\n            role=\"group\"\n            aria-label=\"Week navigation\"\n            className=\"flex flex-wrap items-center chip-gap-x-tight chip-gap-y-tight\"\n          >\n            <Button\n              variant=\"quiet\"\n              size=\"sm\"\n              aria-label=\"Go to previous week\"\n              onClick={prevWeek}\n            >\n              <ChevronLeft />\n              <span>Prev</span>\n            </Button>\n            <Button\n              size=\"sm\"\n              aria-label=\"Jump to today\"\n              onClick={jumpToday}\n              disabled={isTodayFocused}\n            >\n              Today\n            </Button>\n            <Button\n              variant=\"quiet\"\n              size=\"sm\"\n              aria-label=\"Go to next week\"\n              onClick={nextWeek}\n            >\n              <span>Next</span>\n              <ChevronRight />\n            </Button>\n          </div>\n        </WeekPickerShell.Controls>\n        <WeekPickerShell.Totals slotId=\"week-range\">\n          <span className=\"sr-only\" aria-live=\"polite\">\n            Week range {accessibleRange}\n          </span>\n          <span className=\"inline-flex items-baseline chip-gap-x-tight text-ui text-muted-foreground\">\n            <span>Total tasks:</span>\n            <span className=\"font-medium tabular-nums text-foreground\">\n              {weekDone} / {weekTotal}\n            </span>\n          </span>\n        </WeekPickerShell.Totals>\n        <WeekPickerShell.Chips slotId=\"week-days\">\n          <div\n            role=\"listbox\"\n            aria-label={`Select a focus day between ${accessibleRange}`}\n            className=\"flex flex-nowrap chip-gap-x overflow-x-auto snap-x snap-mandatory lg:flex-wrap lg:chip-gap-y lg:overflow-visible lg:[scroll-snap-type:none]\"\n          >\n            {days.map((d, i) => (\n              <DayChip\n                key={d}\n                iso={d}\n                selected={d === iso}\n                today={d === today}\n                done={per[i]?.done ?? 0}\n                total={per[i]?.total ?? 0}\n                onClick={selectOnly}\n                onDoubleClick={jumpToDay}\n                onNavigate={(direction) => handleNavigate(i, direction)}\n                onFocus={() => setFocusIndex(i)}\n                tabIndex={focusIndex === i ? 0 : -1}\n                ref={(el) => {\n                  chipRefs.current[i] = el;\n                }}\n              />\n            ))}\n          </div>\n        </WeekPickerShell.Chips>\n      </WeekPickerShell>\n    </Hero>\n  );\n}\n","\"use client\";\n\nimport * as React from \"react\";\nimport { cn } from \"@/lib/utils\";\n\nimport \"./PlannerListPanel.css\";\n\ntype PlannerViewportSizeToken = \"minHTasks\" | \"maxHTasks\" | \"maxHProjects\";\n\nconst VIEWPORT_SIZE_CLASS_NAMES: Record<PlannerViewportSizeToken, string> = {\n  minHTasks: \"planner-viewport--minHTasks\",\n  maxHTasks: \"planner-viewport--maxHTasks\",\n  maxHProjects: \"planner-viewport--maxHProjects\",\n};\n\ntype PlannerListPanelProps = {\n  renderComposer?: () => React.ReactNode;\n  renderEmpty: () => React.ReactNode;\n  renderList: () => React.ReactNode;\n  isEmpty: boolean;\n  className?: string;\n  viewportClassName?: string;\n  viewportInsetClassName?: string;\n  /**\n   * Applies predefined viewport sizing tokens. Tokens map to utilities defined\n   * in PlannerListPanel.css: `minHTasks` enforces the task list minimum height,\n   * `maxHTasks` caps the task viewport, and `maxHProjects` aligns the project\n   * list with its design-system max height.\n   */\n  viewportSize?:\n    | PlannerViewportSizeToken\n    | PlannerViewportSizeToken[];\n  viewportProps?: Omit<React.HTMLAttributes<HTMLDivElement>, \"style\">;\n};\n\nexport function PlannerListPanel({\n  renderComposer,\n  renderEmpty,\n  renderList,\n  isEmpty,\n  className,\n  viewportClassName,\n  viewportInsetClassName = \"card-pad\",\n  viewportSize,\n  viewportProps,\n}: PlannerListPanelProps) {\n  const { className: viewportPropsClassName, ...restViewportProps } = viewportProps ?? {};\n\n  const viewportSizeTokens = Array.isArray(viewportSize)\n    ? viewportSize\n    : viewportSize\n      ? [viewportSize]\n      : [];\n\n  const viewportSizeClasses = viewportSizeTokens.map(\n    (token) => VIEWPORT_SIZE_CLASS_NAMES[token],\n  );\n\n  const composer = renderComposer?.();\n  const content = isEmpty ? renderEmpty() : renderList();\n\n  return (\n    <div\n      className={cn(\n        \"flex min-w-0 flex-col gap-[var(--space-3)]\",\n        className,\n      )}\n    >\n      {composer}\n      <div\n        {...restViewportProps}\n        className={cn(\n          \"planner-viewport w-full overflow-y-auto\",\n          viewportInsetClassName,\n          viewportPropsClassName,\n          viewportClassName,\n          viewportSizeClasses,\n        )}\n      >\n        {content}\n      </div>\n    </div>\n  );\n}\n","/**\n * Do not edit directly, this file was auto-generated.\n */\n\nexport default {\n  highlight: \"0 0% 100%\",\n  lavDeep: \"318 82% 60%\",\n  teamBlue: \"200 100% 60%\",\n  teamRed: \"0 85% 60%\",\n  btnBg: \"transparent\",\n  btnFg: \"hsl(var(--foreground))\",\n  hover: \"hsl(var(--foreground) / 0.08)\",\n  active: \"hsl(var(--foreground) / 0.12)\",\n  disabled: \"0.5\",\n  loading: \"0.6\",\n  edgeIris:\n    \"conic-gradient(\\n    from 180deg,\\n    hsl(262 88% 60% / 0),\\n    hsl(262 88% 60% / 0.72),\\n    hsl(var(--accent-3) / 0.72),\\n    hsl(318 82% 60% / 0.7),\\n    hsl(262 88% 60% / 0)\\n  )\",\n  segActiveGrad:\n    \"linear-gradient(\\n    90deg,\\n    hsl(var(--primary-soft) / 0.85),\\n    hsl(var(--accent-soft) / 0.85),\\n    hsl(var(--accent-2) / 0.8)\\n  )\",\n  segActiveBase: \"hsl(var(--card))\",\n  lgViolet: \"var(--ring)\",\n  lgCyan: \"var(--accent-2)\",\n  lgPink: \"var(--lav-deep)\",\n  lgBlack: \"var(--background)\",\n  visuallyHiddenTop: \"-9999px\",\n  bg: \"var(--background)\",\n  text: \"var(--foreground)\",\n  textOnAccent: \"hsl(var(--foreground))\",\n  controlFs: \"var(--font-ui)\",\n  fontSizeMd: \"var(--font-body)\",\n  fontWeightBold: \"800\",\n  fontLabel: \"12px\",\n  fontUi: \"15px\",\n  fontBody: \"19px\",\n  fontTitle: \"24px\",\n  fontTitleLg: \"30px\",\n  controlHXs: \"24px\",\n  controlHSm: \"32px\",\n  controlHMd: \"40px\",\n  controlHLg: \"48px\",\n  controlHXl: \"56px\",\n  controlH: \"var(--control-h-md)\",\n  shellWidth: \"1280px\",\n  shellMax: \"var(--shell-width)\",\n  shadowInsetContrast: \"inset 0 0 0 var(--hairline-w) var(--ring-contrast)\",\n  shadowInsetHairline:\n    \"inset 0 0 0 var(--hairline-w) hsl(var(--card-hairline))\",\n  shadowControlHover:\n    \"0 var(--spacing-1) var(--spacing-2) hsl(var(--shadow-color) / 0.3)\",\n  space1: \"var(--spacing-1)\",\n  space2: \"var(--spacing-2)\",\n  space3: \"var(--spacing-3)\",\n  space4: \"var(--spacing-4)\",\n  space5: \"var(--spacing-5)\",\n  space6: \"var(--spacing-6)\",\n  space7: \"var(--spacing-7)\",\n  space8: \"var(--spacing-8)\",\n  space12: \"calc(var(--space-8) + var(--space-4))\",\n  space16: \"calc(var(--space-8) * 2)\",\n  ringSize1: \"var(--spacing-0-5)\",\n  ringSize2: \"var(--spacing-1)\",\n  iconStroke100: \"var(--spacing-0-5)\",\n  iconStroke150: \"calc(var(--spacing-0-5) * 1.25)\",\n  ringDiameterXs: \"var(--space-5)\",\n  ringDiameterS: \"var(--space-6)\",\n  ringDiameterM: \"var(--space-8)\",\n  ringDiameterL: \"calc(var(--space-8) * 3.5)\",\n  ringStrokeXs: \"var(--ring-size-1)\",\n  ringStrokeS: \"var(--ring-size-1)\",\n  ringStrokeM: \"var(--ring-size-2)\",\n  ringStrokeL: \"var(--ring-size-2)\",\n  ringInset: \"calc(var(--space-3) / 2)\",\n  layoutGutterSm: \"var(--spacing-4)\",\n  layoutGutterMd: \"var(--spacing-5)\",\n  layoutGutterLg: \"var(--spacing-6)\",\n  aaMinContrast: \"4.5\",\n  space9: \"calc(var(--space-8) + var(--space-1))\",\n  space10: \"calc(var(--space-8) + var(--space-2))\",\n  space11: \"calc(var(--space-8) + var(--space-3))\",\n  depthShadowInset: \"var(--shadow-depth-inner)\",\n  layoutQuickActionMin: \"calc(var(--spacing-8) * 3)\",\n  layoutQuickActionTooltipMax: \"calc(var(--spacing-8) * 5)\",\n  spacing0125: \"calc(var(--spacing-1) / 8)\",\n  spacing025: \"calc(var(--spacing-1) / 4)\",\n  spacing05: \"calc(var(--spacing-1) / 2)\",\n  spacing075: \"calc(var(--spacing-1) * 0.75)\",\n  spacing1: \"4px\",\n  spacing2: \"8px\",\n  spacing3: \"12px\",\n  spacing4: \"16px\",\n  spacing5: \"24px\",\n  spacing6: \"32px\",\n  spacing7: \"48px\",\n  spacing8: \"64px\",\n  controlRadius: \"var(--radius-xl)\",\n  pillarWaveStart: \"var(--accent)\",\n  pillarWaveEnd: \"var(--accent-2)\",\n  pillarWaveShadow: \"var(--accent) / 0.35\",\n  pillarTradingStart: \"var(--lav-deep)\",\n  pillarTradingEnd: \"var(--accent)\",\n  pillarTradingShadow: \"var(--lav-deep) / 0.35\",\n  pillarVisionStart: \"var(--success)\",\n  pillarVisionEnd: \"var(--accent-2)\",\n  pillarVisionShadow: \"var(--success) / 0.35\",\n  pillarTempoStart: \"var(--ring)\",\n  pillarTempoEnd: \"var(--accent)\",\n  pillarTempoShadow: \"var(--ring) / 0.35\",\n  pillarPositioningStart: \"var(--accent-2)\",\n  pillarPositioningEnd: \"var(--primary)\",\n  pillarPositioningShadow: \"var(--accent-2) / 0.35\",\n  pillarCommsStart: \"var(--lav-deep)\",\n  pillarCommsEnd: \"var(--primary)\",\n  pillarCommsShadow: \"var(--primary) / 0.35\",\n  cardRadius: \"var(--radius-xl)\",\n  blobRadiusSoft: \"calc(var(--radius-2xl) + var(--spacing-2))\",\n  radiusSm: \"6px\",\n  radiusMd: \"8px\",\n  radiusLg: \"12px\",\n  radiusXl: \"16px\",\n  radius2xl: \"24px\",\n  radiusFull: \"9999px\",\n  background: \"247 34% 6%\",\n  foreground: \"258 26% 97%\",\n  card: \"249 30% 9%\",\n  cardForeground: \"var(--foreground)\",\n  panel: \"var(--card)\",\n  border: \"253 28% 24%\",\n  line: \"var(--border)\",\n  input: \"249 28% 12%\",\n  ring: \"262 88% 66%\",\n  themeRing: \"hsl(var(--ring))\",\n  primary: \"262 88% 60%\",\n  primaryForeground: \"0 0% 100%\",\n  primarySoft: \"262 88% 20%\",\n  accent: \"294 90% 42%\",\n  accent2: \"190 88% 32%\",\n  accent3: \"200 88% 34%\",\n  accentForeground: \"0 0% 100%\",\n  accentContrast: \"294 92% 72%\",\n  accentSoft: \"294 90% 16%\",\n  glow: \"296 96% 56%\",\n  ringMuted: \"248 22% 24%\",\n  danger: \"0 84% 60%\",\n  warning: \"43 96% 56%\",\n  warningSoft: \"var(--warning) / 0.1\",\n  warningSoftStrong: \"var(--warning) / 0.2\",\n  muted: \"248 24% 15%\",\n  mutedForeground: \"248 18% 74%\",\n  fgMuted: \"var(--muted-foreground)\",\n  surface: \"248 26% 11%\",\n  surface2: \"248 26% 16%\",\n  surfaceVhs: \"210 24% 7%\",\n  surfaceStreak: \"240 18% 13%\",\n  shadowColor: \"263 78% 56%\",\n  noirBackground: \"352 68% 4%\",\n  noirForeground: \"0 0% 94%\",\n  noirBorder: \"352 44% 24%\",\n  hardstuckBackground: \"120 58% 3%\",\n  hardstuckForeground: \"120 60% 72%\",\n  hardstuckBorder: \"120 42% 22%\",\n  success: \"160 72% 48%\",\n  successSoft: \"var(--success) / 0.2\",\n  successGlow: \"160 72% 38% / 0.6\",\n  toneTop: \"38 92% 60%\",\n  toneJg: \"152 52% 44%\",\n  toneMid: \"265 72% 62%\",\n  toneBot: \"195 75% 56%\",\n  toneSup: \"320 72% 60%\",\n  auroraG: \"var(--accent-2)\",\n  auroraGLight: \"150 100% 85%\",\n  auroraP: \"var(--accent)\",\n  auroraPLight: \"272 80% 85%\",\n  iconFg: \"250 96% 78%\",\n  accentOverlay: \"hsl(var(--accent))\",\n  ringContrast: \"hsl(var(--ring))\",\n  glowActive: \"hsl(var(--glow))\",\n  neon: \"var(--glow)\",\n  neonSoft: \"hsl(var(--neon))\",\n  focus: \"var(--theme-ring)\",\n  cardHairline: \"hsl(var(--border))\",\n  hairlineW: \"1px\",\n  controlPx: \"var(--spacing-3)\",\n  reviewResultWinGradient:\n    \"linear-gradient(\\n    90deg,\\n    hsl(var(--success) / 0.22),\\n    hsl(var(--accent) / 0.18)\\n  )\",\n  reviewResultLossGradient:\n    \"linear-gradient(\\n    90deg,\\n    hsl(var(--danger) / 0.24),\\n    hsl(var(--primary) / 0.2)\\n  )\",\n  shadow: \"0 10px 30px hsl(250 38% 2% / 0.32)\",\n  shadowDropdown: \"0 12px 40px hsl(var(--shadow-color) / 0.55)\",\n  shadowNeoSm:\n    \"calc(var(--spacing-1)) calc(var(--spacing-1)) calc(var(--spacing-2))\\n      hsl(var(--panel) / 0.72),\\n    calc(var(--spacing-1) * -1) calc(var(--spacing-1) * -1) calc(var(--spacing-2))\\n      hsl(var(--foreground) / 0.06)\",\n  shadowDepthOuter:\n    \"calc(var(--spacing-3)) calc(var(--spacing-3)) var(--spacing-5)\\n      hsl(var(--panel) / 0.72),\\n    calc(var(--spacing-3) * -1) calc(var(--spacing-3) * -1) var(--spacing-5)\\n      hsl(var(--foreground) / 0.06)\",\n  shadowDepthOuterStrong:\n    \"var(--spacing-4) var(--spacing-4) var(--spacing-6) hsl(var(--panel) / 0.72),\\n    calc(var(--spacing-4) * -1) calc(var(--spacing-4) * -1) var(--spacing-6)\\n      hsl(var(--foreground) / 0.08)\",\n  shadowDepthInner:\n    \"inset var(--spacing-1) var(--spacing-1) var(--spacing-3)\\n      hsl(var(--panel) / 0.85),\\n    inset calc(var(--spacing-1) * -1) calc(var(--spacing-1) * -1) var(--spacing-3)\\n      hsl(var(--foreground) / 0.08)\",\n  shadowRing: \"0 0 var(--spacing-3) hsl(var(--ring))\",\n  shadowDepthSoft:\n    \"0 var(--spacing-1) var(--spacing-3) calc(var(--spacing-1) * -1)\\n      hsl(var(--shadow-color))\",\n  shadowGlowSm: \"0 0 var(--spacing-2) var(--glow-active)\",\n  shadowGlowMd: \"0 0 var(--spacing-4) var(--glow-active)\",\n  shadowGlowLg: \"0 0 var(--spacing-5) var(--glow-active)\",\n  shadowGlowXl: \"0 var(--spacing-2) var(--spacing-6) var(--glow-active)\",\n  shadowNavActive:\n    \"0 0 0 var(--hairline-w) hsl(var(--ring) / 0.35),\\n    0 var(--spacing-2) var(--spacing-6) hsl(var(--ring) / 0.2)\",\n  shadowOutlineSubtle: \"0 0 0 var(--hairline-w) hsl(var(--border) / 0.12)\",\n  shadowOutlineFaint: \"0 0 0 var(--hairline-w) hsl(var(--border) / 0.08)\",\n  shadowBadge:\n    \"inset 0 var(--hairline-w) 0 hsl(var(--foreground) / 0.06),\\n    0 0 0 var(--hairline-w) hsl(var(--card-hairline) / 0.35),\\n    0 var(--spacing-3) var(--spacing-4) hsl(var(--shadow-color) / 0.18)\",\n  shadowGlowCurrent: \"0 0 var(--spacing-2) currentColor\",\n  shadowNeonSoft:\n    \"0 0 var(--spacing-2) var(--neon),\\n    0 0 var(--spacing-4) var(--neon-soft)\",\n  shadowNeonStrong:\n    \"0 0 var(--spacing-3) var(--neon),\\n    0 0 var(--spacing-5) var(--neon-soft)\",\n  shadowControl:\n    \"inset 0 var(--spacing-1) var(--spacing-2) 0 color-mix(in oklab, hsl(var(--shadow-color)) 18%, hsl(var(--background)) 82%),\\n    var(--shadow-outline-subtle)\",\n  glowStrong: \"var(--ring) / 0.55\",\n  glowSoft: \"var(--accent) / 0.25\",\n  shadowNeon:\n    \"0 0 var(--space-1) hsl(var(--neon) / 0.55),\\n    0 0 calc(var(--space-3) - var(--space-1) / 2) hsl(var(--neon) / 0.35),\\n    0 0 calc(var(--space-4) + var(--space-1) / 2) hsl(var(--neon) / 0.2)\",\n  btnPrimaryHoverShadow:\n    \"0 calc(var(--space-1) / 2) calc(var(--space-3) / 2)\\n    calc(-1 * var(--space-1) / 4) hsl(var(--accent) / 0.25)\",\n  btnPrimaryActiveShadow:\n    \"inset 0 0 0 calc(var(--space-1) / 4)\\n    hsl(var(--accent) / 0.6)\",\n  heroDividerBlur: \"calc(var(--spacing-1) * 1.5)\",\n  heroIllustrationOpacity: \"0.84\",\n  heroIllustrationBlur: \"calc(var(--space-4) + var(--space-1))\",\n  warningForeground: \"0 0% 100%\",\n  successForeground: \"0 0% 100%\",\n  dangerForeground: \"0 0% 100%\",\n  stateSuccessSurface:\n    \"color-mix(in oklab, hsl(var(--success)) 18%, hsl(var(--surface)))\",\n  stateSuccessBorder:\n    \"color-mix(in oklab, hsl(var(--success)) 65%, hsl(var(--border)))\",\n  stateWarningSurface:\n    \"color-mix(in oklab, hsl(var(--warning)) 20%, hsl(var(--surface)))\",\n  stateWarningBorder:\n    \"color-mix(in oklab, hsl(var(--warning)) 60%, hsl(var(--border)))\",\n  stateDangerSurface:\n    \"color-mix(in oklab, hsl(var(--danger)) 18%, hsl(var(--surface)))\",\n  stateDangerBorder:\n    \"color-mix(in oklab, hsl(var(--danger)) 62%, hsl(var(--border)))\",\n  auroraGLightColor: \"hsl(var(--aurora-g-light))\",\n  auroraPLightColor: \"hsl(var(--aurora-p-light))\",\n  elevation0: \"none\",\n  elevation1: \"var(--shadow-outline-faint)\",\n  elevation2: \"var(--shadow-outline-subtle)\",\n  elevation3: \"var(--shadow-control)\",\n  skeletonBg: \"hsl(var(--muted) / 0.6)\",\n  skeletonFill: \"hsl(var(--foreground) / 0.08)\",\n  gradientNoiseOpacity: \"0.1\",\n  gradientNoiseOverlayOpacity: \"0.06\",\n  shadowInnerSm:\n    \"inset 0 var(--spacing-0-125) var(--spacing-0-5) hsl(var(--shadow-color) / 0.18)\",\n  shadowInnerMd:\n    \"inset 0 var(--spacing-0-25) var(--spacing-1) hsl(var(--shadow-color) / 0.28)\",\n  shadowOuterLg:\n    \"0 var(--spacing-4) var(--spacing-7) hsl(var(--shadow-color) / 0.36)\",\n  glowPrimary: \"hsl(var(--primary) / 0.55)\",\n  blobSurface1: \"hsl(var(--surface))\",\n  blobSurface2: \"hsl(var(--surface-2))\",\n  blobSurface3: \"hsl(var(--card))\",\n  blobSurfaceShadow: \"hsl(var(--shadow-color) / 0.4)\",\n  glitchNoisePrimary: \"hsl(var(--accent) / 0.25)\",\n  glitchNoiseSecondary: \"hsl(var(--ring) / 0.2)\",\n  glitchNoiseContrast: \"hsl(var(--foreground) / 0.12)\",\n  elevationCard: \"var(--shadow-outline-subtle)\",\n  elevationCardPressed: \"var(--shadow-control)\",\n  neoDepthSm: \"var(--spacing-1)\",\n  neoDepthMd: \"var(--spacing-3)\",\n  neoDepthLg: \"var(--spacing-4)\",\n  neoSurface:\n    \"color-mix(in oklab, hsl(var(--card)) 88%, hsl(var(--panel)) 12%)\",\n  neoSurfaceAlt:\n    \"color-mix(in oklab, hsl(var(--panel)) 82%, hsl(var(--card)) 18%)\",\n  neoHighlight: \"color-mix(in oklab, hsl(var(--ring)) 18%, hsl(var(--card)))\",\n  depthShadowOuter: \"var(--shadow-depth-outer)\",\n  depthShadowOuterStrong: \"var(--shadow-depth-outer-strong)\",\n  depthShadowSoft: \"var(--shadow-depth-soft)\",\n  depthShadowInner: \"var(--shadow-depth-inner)\",\n  depthGlowHighlightSoft: \"hsl(var(--highlight) / 0.08)\",\n  depthGlowHighlightMedium: \"hsl(var(--highlight) / 0.35)\",\n  depthGlowHighlightStrong: \"hsl(var(--highlight) / 0.55)\",\n  depthGlowShadowSoft: \"hsl(var(--shadow-color) / 0.14)\",\n  depthGlowShadowMedium: \"hsl(var(--shadow-color) / 0.28)\",\n  depthGlowShadowStrong: \"hsl(var(--shadow-color) / 0.42)\",\n  depthFocusRingRest:\n    \"0 0 0 0 hsl(var(--ring) / 0),\\n    0 0 0 0 hsl(var(--ring) / 0)\",\n  depthFocusRingActive:\n    \"0 0 0 calc(var(--hairline-w) * 1) hsl(var(--ring))\\n    var(--shadow-glow-lg)\",\n  backdropBlob1: \"var(--lg-violet)\",\n  backdropBlob2: \"var(--lg-cyan)\",\n  backdropBlob3: \"var(--lg-pink)\",\n  backdropBlobShadow: \"var(--lg-black)\",\n  backdropGridPrimary: \"var(--accent)\",\n  backdropGridSecondary: \"var(--accent)\",\n  backdropGridOpacity: \"0.1\",\n  backdropDrip1: \"var(--backdrop-blob-1)\",\n  backdropDrip2: \"var(--backdrop-blob-2)\",\n  backdropDrip3: \"var(--backdrop-blob-3)\",\n  backdropDripShadow: \"var(--backdrop-blob-shadow)\",\n  neoGlowStrength: \"0.45\",\n  neonOutlineOpacity: \"0.35\",\n  glitchIntensity: \"1.0\",\n  glitchFringe: \"12deg\",\n  glitchStaticOpacity: \"0.18\",\n  glitchNoiseLevel: \"var(--glitch-static-opacity)\",\n  glitchOverlayButtonOpacity: \"0.42\",\n  glitchOverlayButtonOpacityReduced: \"0.28\",\n  glitchChromaticOffsetStrong: \"calc(var(--spacing-0-25) / 4)\",\n  glitchChromaticOffsetMedium: \"calc(var(--spacing-0-25) * 3 / 20)\",\n  glitchChromaticOffsetLight: \"calc(var(--spacing-0-25) / 10)\",\n  glitchHaloOpacity: \"0.28\",\n  glitchRingColor: \"hsl(var(--ring) / 0.55)\",\n  glitchRingBlur: \"var(--space-2)\",\n  glitchRingShadow: \"0 0 var(--glitch-ring-blur) var(--glitch-ring-color)\",\n  glitchAccentColor: \"hsl(var(--accent) / 0.35)\",\n  glitchAccentBlur: \"var(--spacing-0-5)\",\n  glitchAccentShadow:\n    \"0 0 var(--glitch-accent-blur) var(--glitch-accent-color)\",\n  retroGridStep: \"24px\",\n  retroGridOpacity: \"0.15\",\n  glitchOverlayOpacityCard: \"0.55\",\n  shadowInnerLg:\n    \"inset 0 var(--spacing-0-5) var(--spacing-2) hsl(var(--shadow-color) / 0.36)\",\n  shadowOuterXl:\n    \"0 var(--spacing-5) var(--spacing-8) hsl(var(--shadow-color) / 0.45)\",\n  glowRing:\n    \"0 0 0 calc(var(--spacing-0-5)) hsl(var(--ring) / 0.5), 0 0 var(--spacing-3) hsl(var(--ring) / 0.22)\",\n  glitchNoiseHover: \"calc(var(--glitch-noise-level) * 1.3)\",\n  gridColor: \"var(--accent)\",\n  gridAlpha: \"0.1\",\n  gridSize: \"calc(var(--space-6) - var(--space-1))\",\n  shadowOuterSm:\n    \"0 var(--spacing-2) var(--spacing-4) hsl(var(--shadow-color) / 0.24)\",\n  shadowOuterMd:\n    \"0 var(--spacing-3) var(--spacing-6) hsl(var(--shadow-color) / 0.3)\",\n  cardElev1: \"var(--shadow-outline-faint), var(--shadow-outer-sm)\",\n  cardElev2: \"var(--shadow-outline-subtle), var(--shadow-outer-md)\",\n  cardElev3: \"var(--shadow-outline-subtle), var(--shadow-outer-lg)\",\n  glowRingSm: \"0 0 0 calc(var(--spacing-0-25)) hsl(var(--ring) / 0.45)\",\n  glowRingMd:\n    \"0 0 0 calc(var(--spacing-0-5)) hsl(var(--ring) / 0.5), 0 0 var(--spacing-2) hsl(var(--ring) / 0.2)\",\n  blobSurface:\n    \"color-mix(in oklab, hsl(var(--surface)) 70%, hsl(var(--surface-2)) 30%)\",\n  dripSurface:\n    \"color-mix(in oklab, hsl(var(--accent)) 18%, hsl(var(--background)) 82%)\",\n  gradientBlobPrimary:\n    \"radial-gradient(120% 120% at 50% 10%, hsl(var(--surface) / 0.85), hsl(var(--surface-2) / 0.35), transparent 85%)\",\n  gradientDripOverlay:\n    \"radial-gradient(60% 40% at 10% 0%, hsl(var(--backdrop-drip-1) / 0.2), transparent 60%), radial-gradient(50% 35% at 100% 5%, hsl(var(--backdrop-drip-2) / 0.18), transparent 60%), radial-gradient(55% 35% at 50% 120%, hsl(var(--backdrop-drip-3) / 0.14), transparent 65%), radial-gradient(120% 100% at 50% 100%, hsl(var(--backdrop-drip-shadow) / 0.35), transparent 70%)\",\n  gradientDripOverlayCompact:\n    \"radial-gradient(125% 85% at 18% -20%, hsl(var(--backdrop-drip-1) / 0.28), transparent 65%), radial-gradient(115% 85% at 82% -15%, hsl(var(--backdrop-drip-2) / 0.24), transparent 62%), radial-gradient(120% 95% at 50% 110%, hsl(var(--backdrop-drip-3) / 0.16), transparent 70%)\",\n  gradientGlitchPrimary:\n    \"linear-gradient(135deg, hsl(var(--accent) / 0.35), hsl(var(--accent-2) / 0.3))\",\n  gradientGlitchOverlay:\n    \"linear-gradient(120deg, hsl(var(--accent) / 0.12) 0%, transparent 58%, hsl(var(--ring) / 0.16) 100%), var(--card-overlay-scanlines)\",\n  gradientGlitchRail:\n    \"linear-gradient(180deg, hsl(var(--primary) / 0.6) 0%, hsl(var(--accent) / 0.45) 45%, hsl(var(--ring) / 0.6) 100%)\",\n  gradientHeroSlotHighlight:\n    \"radial-gradient(circle at top left, var(--depth-glow-highlight-medium) 0%, transparent 62%)\",\n  gradientHeroSlotShadow:\n    \"radial-gradient(circle at bottom right, var(--depth-glow-shadow-medium) 0%, transparent 65%)\",\n  gradientHeroTopline:\n    \"linear-gradient(90deg, hsl(var(--accent) / 0.28), transparent 55%, hsl(var(--accent-2) / 0.32))\",\n  gradientHeroActionHalo:\n    \"radial-gradient(120% 95% at 50% 0%, hsl(var(--accent) / 0.24), transparent 65%)\",\n  gradientPanelTiltStrong:\n    \"linear-gradient(140deg, hsl(var(--card) / 0.95), hsl(var(--surface-2) / 0.78))\",\n  gradientPanelTiltBright:\n    \"linear-gradient(140deg, hsl(var(--card) / 0.98), hsl(var(--surface-2) / 0.82))\",\n  gradientPanelTiltMuted:\n    \"linear-gradient(140deg, hsl(var(--card) / 0.94), hsl(var(--surface-2) / 0.72))\",\n  dangerSurfaceForeground: \"var(--danger-foreground)\",\n  surfaceOverlaySoft: \"0.12\",\n  surfaceOverlayStrong: \"0.2\",\n  glitchCardSurfaceTop: \"hsl(var(--card) / 0.78)\",\n  glitchCardSurfaceBottom: \"hsl(var(--panel) / 0.66)\",\n  surfaceCardSoft:\n    \"linear-gradient(180deg, hsl(var(--card) / 0.65), hsl(var(--card) / 0.45))\",\n  surfaceCardStrong:\n    \"linear-gradient(180deg, hsl(var(--card) / 0.85), hsl(var(--card) / 0.65))\",\n  surfaceCardStrongHover:\n    \"linear-gradient(180deg, hsl(var(--card) / 0.95), hsl(var(--card) / 0.75))\",\n  surfaceCardStrongActive:\n    \"linear-gradient(180deg, hsl(var(--card) / 0.8), hsl(var(--card) / 0.6))\",\n  surfaceCardStrongToday:\n    \"linear-gradient(180deg, hsl(var(--card) / 0.9), hsl(var(--card) / 0.7))\",\n  surfaceCardStrongEmpty:\n    \"linear-gradient(180deg, hsl(var(--card) / 0.6), hsl(var(--card) / 0.5))\",\n  surfaceRailAccent:\n    \"linear-gradient(180deg, hsl(var(--accent)), hsl(var(--primary)))\",\n  glitchIntensityDefault: \"1.0\",\n  glitchIntensitySubtle: \"calc(var(--glitch-intensity-default) * 0.68)\",\n  glitchIntensityHeroRail: \"0.74\",\n  glitchIntensityBackdropBlob1: \"0.18\",\n  glitchIntensityBackdropBlob2: \"0.16\",\n  glitchIntensityBackdropBlob3: \"0.12\",\n  glitchIntensityBackdropDrip1: \"0.23\",\n  glitchIntensityBackdropDrip2: \"0.2\",\n  glitchIntensityBackdropDrip3: \"0.16\",\n  glitchIntensityBackdropShadow: \"0.38\",\n  glitchPixel: \"var(--glitch-noise-level)\",\n  statGood: \"var(--success)\",\n  statWarn: \"var(--warning)\",\n  statBad: \"var(--danger)\",\n  easeOut: \"cubic-bezier(0.16, 1, 0.3, 1)\",\n  easeMotionGlitch: \"cubic-bezier(0.2, 0.8, 0.2, 1)\",\n  durQuick: \"140ms\",\n  durChill: \"220ms\",\n  durSlow: \"420ms\",\n  cardOverlayScanlines:\n    \"repeating-linear-gradient(\\n    to bottom,\\n    hsl(var(--foreground) / 0.035) 0,\\n    hsl(var(--foreground) / 0.035) var(--spacing-0-25),\\n    transparent var(--spacing-0-5),\\n    transparent calc(var(--spacing-0-5) + var(--spacing-0-25))\\n  )\",\n  glitchDuration: \"450ms\",\n  glowPulse: \"glow-pulse var(--dur-slow) var(--ease-out) infinite alternate\",\n  glitchRgbShift:\n    \"drop-shadow(calc(var(--glitch-chromatic-offset-light) * -1) 0 0 hsl(var(--accent) / 0.45)) drop-shadow(var(--glitch-chromatic-offset-light) 0 0 hsl(var(--ring) / 0.45))\",\n  glitchScanline:\n    \"glitch-scanline calc(var(--glitch-duration) * 1.2) steps(2, end) infinite\",\n  scanline: \"var(--glitch-scanline)\",\n  motionDurationSm: \"var(--dur-quick)\",\n  motionDurationMd: \"var(--dur-chill)\",\n  motionDurationLg: \"var(--dur-slow)\",\n  motionEaseGlitch: \"var(--ease-motion-glitch)\",\n  headerStack: \"calc(var(--spacing-8) + var(--spacing-4))\",\n};\n","import tokens from \"../../tokens/tokens.js\";\n\nconst FILTER_SLOPE_TOKEN = \"--gradient-noise-opacity\";\nconst FILTER_TABLE_TOKEN = \"--gradient-noise-table\";\nconst FILTER_STD_DEVIATION_TOKEN = \"--gradient-noise-std-deviation\";\n\nconst numberPattern = /-?\\d*\\.?\\d+(?:e[+-]?\\d+)?/gi;\n\nconst parsedGradientNoiseOpacity = Number.parseFloat(\n  tokens.gradientNoiseOpacity,\n);\nconst defaultSlope = Number.isFinite(parsedGradientNoiseOpacity)\n  ? parsedGradientNoiseOpacity\n  : 0.1;\n\nconst defaultTable = Object.freeze([0, 1] as const);\nconst defaultStdDeviation = 0;\n\nconst clampNumber = (value: number, min: number, max: number): number =>\n  Math.min(Math.max(value, min), max);\n\nconst parseNumbers = (value: string): number[] => {\n  if (!value) {\n    return [];\n  }\n\n  const matches = value.match(numberPattern);\n\n  if (!matches) {\n    return [];\n  }\n\n  return matches\n    .map((segment) => Number.parseFloat(segment))\n    .filter((segment): segment is number => Number.isFinite(segment));\n};\n\nconst parseNumber = (value: string): number | null => {\n  const [first] = parseNumbers(value);\n\n  if (typeof first === \"number\") {\n    return first;\n  }\n\n  return null;\n};\n\nexport interface FilterNumericValues {\n  slope: number;\n  table: readonly number[];\n  stdDeviation: number;\n}\n\nconst cloneDefaultTable = (): number[] => [...defaultTable];\n\nconst getComputedValue = (token: string): string => {\n  if (typeof document === \"undefined\") {\n    return \"\";\n  }\n\n  const { documentElement } = document;\n\n  if (!documentElement) {\n    return \"\";\n  }\n\n  return getComputedStyle(documentElement).getPropertyValue(token).trim();\n};\n\nconst numericTable = (raw: string): number[] => {\n  const parsed = parseNumbers(raw).map((entry) =>\n    clampNumber(entry, 0, 1),\n  );\n\n  if (parsed.length === 0) {\n    return cloneDefaultTable();\n  }\n\n  return parsed;\n};\n\nconst numericSlope = (raw: string): number => {\n  const parsed = parseNumber(raw);\n\n  if (parsed === null) {\n    return defaultSlope;\n  }\n\n  return clampNumber(parsed, 0, 1);\n};\n\nconst numericStdDeviation = (raw: string): number => {\n  const parsed = parseNumber(raw);\n\n  if (parsed === null) {\n    return defaultStdDeviation;\n  }\n\n  return clampNumber(parsed, 0, 64);\n};\n\nexport const tokensToFilter = (): FilterNumericValues => {\n  const slope = numericSlope(getComputedValue(FILTER_SLOPE_TOKEN));\n  const table = numericTable(getComputedValue(FILTER_TABLE_TOKEN));\n  const stdDeviation = numericStdDeviation(\n    getComputedValue(FILTER_STD_DEVIATION_TOKEN),\n  );\n\n  return {\n    slope,\n    table,\n    stdDeviation,\n  };\n};\n","\"use client\";\n\nimport * as React from \"react\";\n\nimport tokens from \"../../tokens/tokens.js\";\nimport { svgNumericFilters } from \"@/lib/features\";\nimport { tokensToFilter } from \"@/lib/filter-tokens\";\nimport { useOptionalTheme } from \"@/lib/theme-context\";\n\nconst gradientNoiseOpacityToken = tokens.gradientNoiseOpacity;\nconst gradientNoiseOpacityCssFallback = `var(--gradient-noise-opacity, ${gradientNoiseOpacityToken || \"0.1\"})`;\n\nconst filterValuesAreEqual = (\n  a: ReturnType<typeof tokensToFilter>,\n  b: ReturnType<typeof tokensToFilter>,\n) =>\n  a.slope === b.slope &&\n  a.stdDeviation === b.stdDeviation &&\n  a.table.length === b.table.length &&\n  a.table.every((value, index) => value === b.table[index]);\n\ninterface RingNoiseDefsProps {\n  id: string;\n}\n\nexport default function RingNoiseDefs({ id }: RingNoiseDefsProps) {\n  const themeContext = useOptionalTheme();\n  const themeVariant = themeContext?.[0].variant;\n  const themeBackground = themeContext?.[0].bg;\n  const [filterValues, setFilterValues] = React.useState(tokensToFilter);\n\n  React.useEffect(() => {\n    if (!svgNumericFilters) {\n      return;\n    }\n\n    const next = tokensToFilter();\n\n    setFilterValues((prev) => (filterValuesAreEqual(prev, next) ? prev : next));\n  }, [themeVariant, themeBackground]);\n\n  const slopeValue = svgNumericFilters\n    ? filterValues.slope\n    : gradientNoiseOpacityCssFallback;\n\n  return (\n    <filter\n      id={id}\n      x=\"-15%\"\n      y=\"-15%\"\n      width=\"130%\"\n      height=\"130%\"\n      filterUnits=\"objectBoundingBox\"\n      colorInterpolationFilters=\"sRGB\"\n    >\n      <feTurbulence\n        type=\"fractalNoise\"\n        baseFrequency=\"1.1\"\n        numOctaves=\"3\"\n        seed=\"4\"\n        result=\"noise\"\n      />\n      <feColorMatrix in=\"noise\" type=\"saturate\" values=\"0\" result=\"monoNoise\" />\n      <feComponentTransfer in=\"monoNoise\" result=\"noiseAlpha\">\n        <feFuncA type=\"linear\" slope={slopeValue} />\n      </feComponentTransfer>\n      <feBlend in=\"SourceGraphic\" in2=\"noiseAlpha\" mode=\"soft-light\" />\n    </filter>\n  );\n}\n","\"use client\";\n\nimport * as React from \"react\";\nimport { Label } from \"@/components/ui/Label\";\nimport { Input } from \"@/components/ui/primitives/Input\";\nimport { IconButton } from \"@/components/ui/primitives/IconButton\";\nimport { CheckCircle } from \"@/components/ui/toggles/CheckCircle\";\nimport { Pencil, Trash2 } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { EmptyRow } from \"./EmptyRow\";\nimport { PlannerListPanel } from \"./PlannerListPanel\";\nimport type { Project } from \"./plannerTypes\";\n\nconst PROJECT_ROW_GUARD_SELECTOR = \"[data-project-row-guard='true']\";\n\ntype Props = {\n  projects: Project[];\n  selectedProjectId: string;\n  setSelectedProjectId: (id: string) => void;\n  setSelectedTaskId: (id: string) => void;\n  toggleProject: (id: string) => void;\n  renameProject: (id: string, name: string) => void;\n  deleteProject: (id: string) => void;\n  createProject: (name: string) => string | undefined;\n};\n\nexport function ProjectList({\n  projects,\n  selectedProjectId,\n  setSelectedProjectId,\n  setSelectedTaskId,\n  toggleProject,\n  renameProject,\n  deleteProject,\n  createProject,\n}: Props) {\n  const newProjectInputId = React.useId();\n  const [editingProjectId, setEditingProjectId] = React.useState<string | null>(\n    null,\n  );\n  const [editingProjectName, setEditingProjectName] = React.useState(\"\");\n  const [draftProject, setDraftProject] = React.useState(\"\");\n  const projectRefs = React.useRef<Map<string, HTMLDivElement | null>>(new Map());\n  const projectsScrollable = projects.length > 3;\n  const multiple = projects.length > 1;\n  const projectListEmpty = projects.length === 0;\n\n  const registerProjectRef = React.useCallback(\n    (projectId: string, node: HTMLDivElement | null) => {\n      if (node) {\n        projectRefs.current.set(projectId, node);\n      } else {\n        projectRefs.current.delete(projectId);\n      }\n    },\n    [],\n  );\n\n  const focusProjectRadio = React.useCallback((projectId: string) => {\n    const node = projectRefs.current.get(projectId);\n    node?.focus();\n  }, []);\n\n  const addProjectCommit = React.useCallback(() => {\n    const id = createProject(draftProject);\n    if (id) {\n      setDraftProject(\"\");\n    }\n  }, [createProject, draftProject]);\n\n  const commitRename = React.useCallback(\n    (projectId: string, fallbackName: string) => {\n      const trimmed = editingProjectName.trim();\n      const nextName = trimmed || fallbackName;\n      renameProject(projectId, nextName);\n      setEditingProjectName(nextName);\n      setEditingProjectId(null);\n    },\n    [editingProjectName, renameProject, setEditingProjectId, setEditingProjectName],\n  );\n\n  React.useEffect(() => {\n    if (!editingProjectId) return;\n    const editingProject = projects.find((p) => p.id === editingProjectId);\n    if (!editingProject) return;\n    if (editingProject.disabled || editingProject.loading) {\n      setEditingProjectId(null);\n      setEditingProjectName(editingProject.name);\n    }\n  }, [editingProjectId, projects, setEditingProjectId, setEditingProjectName]);\n\n  const onRowKey = React.useCallback(\n    (idx: number, p: Project) => (e: React.KeyboardEvent) => {\n      if (e.key === \" \" || e.key === \"Enter\") {\n        e.preventDefault();\n        setSelectedProjectId(p.id);\n      }\n      if (multiple && (e.key === \"ArrowDown\" || e.key === \"ArrowRight\")) {\n        e.preventDefault();\n        const next = (idx + 1) % projects.length;\n        const nextId = projects[next].id;\n        setSelectedProjectId(nextId);\n        focusProjectRadio(nextId);\n      }\n      if (multiple && (e.key === \"ArrowUp\" || e.key === \"ArrowLeft\")) {\n        e.preventDefault();\n        const prev = (idx - 1 + projects.length) % projects.length;\n        const prevId = projects[prev].id;\n        setSelectedProjectId(prevId);\n        focusProjectRadio(prevId);\n      }\n    },\n    [focusProjectRadio, multiple, projects, setSelectedProjectId],\n  );\n\n  return (\n    <PlannerListPanel\n      className=\"gap-[var(--space-2)]\"\n      renderComposer={() => (\n        <form\n          className=\"grid gap-[var(--space-2)]\"\n          onSubmit={(e) => {\n            e.preventDefault();\n            addProjectCommit();\n          }}\n        >\n          <Label htmlFor={newProjectInputId} className=\"mb-0\">\n            New project\n          </Label>\n          <Input\n            id={newProjectInputId}\n            className=\"w-full\"\n            placeholder=\"> new project\"\n            value={draftProject}\n            onChange={(e) => setDraftProject(e.target.value)}\n          />\n        </form>\n      )}\n      isEmpty={projectListEmpty}\n      renderEmpty={() => (\n        <ul\n          className=\"w-full space-y-[var(--space-2)]\"\n          aria-label=\"Projects\"\n        >\n          <li className=\"w-full\">\n            <EmptyRow text=\"No projects yet.\" tone=\"muted\" variant=\"rotate\" />\n          </li>\n        </ul>\n      )}\n      renderList={() => (\n        <ul\n          className=\"w-full space-y-[var(--space-2)]\"\n          role=\"radiogroup\"\n          aria-label=\"Projects\"\n        >\n          {projects.map((p, idx) => {\n            const active = p.id === selectedProjectId;\n            const isEditing = editingProjectId === p.id;\n            const isDisabled = Boolean(p.disabled);\n            const isLoading = Boolean(p.loading);\n            const isRowInactive = isDisabled || isLoading;\n            const blockInteraction = isRowInactive || isEditing;\n            const handleRowKey = onRowKey(idx, p);\n            const projectLabel = p.name.trim() || \"Untitled project\";\n            return (\n              <li key={p.id} className=\"w-full\">\n                <div\n                  role=\"radio\"\n                  tabIndex={isRowInactive ? -1 : active ? 0 : -1}\n                  aria-checked={active}\n                  aria-label={projectLabel}\n                  aria-disabled={isRowInactive || undefined}\n                  data-disabled={isDisabled ? \"true\" : undefined}\n                  data-loading={isLoading ? \"true\" : undefined}\n                  ref={(node) => registerProjectRef(p.id, node)}\n                  onKeyDown={blockInteraction ? undefined : handleRowKey}\n                  onClick={(event) => {\n                    if (\n                      event.target instanceof Element &&\n                      event.target.closest(PROJECT_ROW_GUARD_SELECTOR)\n                    ) {\n                      return;\n                    }\n                    if (blockInteraction || active) return;\n                    setSelectedTaskId(\"\");\n                    setSelectedProjectId(p.id);\n                  }}\n                  className={cn(\n                    \"proj-card group relative [overflow:visible] w-full text-left rounded-card r-card-lg border pl-[var(--space-4)] pr-[var(--space-2)] py-[var(--space-2)]\",\n                    \"bg-card/55 hover:bg-card/70 transition\",\n                    \"grid min-h-[var(--space-7)] grid-cols-[auto,1fr,auto] items-center gap-[var(--space-4)]\",\n                    \"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring\",\n                    active && \"proj-card--active ring-1 ring-ring\",\n                  )}\n                >\n                  <span\n                    className=\"shrink-0\"\n                    data-project-row-guard=\"true\"\n                  >\n                    <CheckCircle\n                      checked={!!p.done}\n                      onChange={() => toggleProject(p.id)}\n                      disabled={isRowInactive}\n                      aria-label={`Toggle ${projectLabel} complete`}\n                      size=\"sm\"\n                    />\n                  </span>\n\n                  {isEditing ? (\n                    <Input\n                      name={`rename-project-${p.id}`}\n                      autoFocus\n                      value={editingProjectName}\n                      onChange={(e) => setEditingProjectName(e.target.value)}\n                      onKeyDown={(e) => {\n                        if (e.key === \"Enter\") {\n                          if (isRowInactive) {\n                            setEditingProjectId(null);\n                            setEditingProjectName(p.name);\n                            return;\n                          }\n                          commitRename(p.id, p.name);\n                        }\n                        if (e.key === \"Escape\") {\n                          setEditingProjectId(null);\n                          setEditingProjectName(p.name);\n                        }\n                      }}\n                      onBlur={() => {\n                        if (isRowInactive) {\n                          setEditingProjectId(null);\n                          setEditingProjectName(p.name);\n                          return;\n                        }\n                        commitRename(p.id, p.name);\n                      }}\n                      disabled={isRowInactive}\n                      aria-label={`Rename project ${p.name}`}\n                      data-project-row-guard=\"true\"\n                    />\n                  ) : (\n                    <span className=\"proj-card__title truncate font-medium\">\n                      {p.name || \"Untitled\"}\n                    </span>\n                  )}\n\n                  <div className=\"ml-auto flex items-center gap-[var(--space-2)] opacity-0 transition-opacity group-hover:opacity-100 group-focus-within:opacity-100\">\n                    <IconButton\n                      aria-label=\"Edit project\"\n                      title=\"Edit\"\n                      onClick={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        setEditingProjectId(p.id);\n                        setEditingProjectName(p.name);\n                      }}\n                      size=\"sm\"\n                      iconSize=\"xs\"\n                      variant=\"quiet\"\n                      disabled={isRowInactive}\n                    >\n                      <Pencil />\n                    </IconButton>\n                    <IconButton\n                      aria-label=\"Delete project\"\n                      title=\"Delete\"\n                      onClick={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        const was = selectedProjectId === p.id;\n                        deleteProject(p.id);\n                        if (was) setSelectedProjectId(\"\");\n                      }}\n                      size=\"sm\"\n                      iconSize=\"xs\"\n                      variant=\"quiet\"\n                      disabled={isRowInactive}\n                    >\n                      <Trash2 />\n                    </IconButton>\n                  </div>\n                </div>\n              </li>\n            );\n          })}\n        </ul>\n      )}\n      viewportClassName={cn(\n        projectsScrollable ? undefined : \"overflow-visible\",\n      )}\n      viewportSize={projectsScrollable ? \"maxHProjects\" : undefined}\n    />\n  );\n}\n","export interface LlmAgentMetadata {\n  readonly id: string;\n  readonly label?: string;\n  readonly kind?: string;\n}\n\nexport interface LlmAgentUsage extends LlmAgentMetadata {\n  readonly tokens: number;\n  readonly share: number;\n}\n\nexport interface LlmTokenUsageSummary {\n  readonly totalTokens: number;\n  readonly agents: readonly LlmAgentUsage[];\n}\n\ntype UsageRecord = {\n  metadata: LlmAgentMetadata;\n  tokens: number;\n};\n\nconst usageStore = new Map<string, UsageRecord>();\n\nlet aggregateTokens = 0;\n\nfunction normalizeText(value: string | undefined): string | undefined {\n  if (typeof value !== \"string\") {\n    return undefined;\n  }\n\n  const trimmed = value.trim();\n  return trimmed.length > 0 ? trimmed : undefined;\n}\n\nfunction normalizeMetadata(metadata: LlmAgentMetadata): LlmAgentMetadata {\n  const normalizedId = normalizeText(metadata.id);\n  const normalizedLabel = normalizeText(metadata.label);\n  const normalizedKind = normalizeText(metadata.kind);\n\n  return {\n    id: normalizedId ?? \"\",\n    ...(normalizedLabel !== undefined ? { label: normalizedLabel } : {}),\n    ...(normalizedKind !== undefined ? { kind: normalizedKind } : {}),\n  } satisfies LlmAgentMetadata;\n}\n\nfunction mergeMetadata(\n  existing: LlmAgentMetadata | undefined,\n  incoming: LlmAgentMetadata,\n): LlmAgentMetadata {\n  return {\n    id: incoming.id,\n    ...(existing?.label ? { label: existing.label } : {}),\n    ...(existing?.kind ? { kind: existing.kind } : {}),\n    ...(incoming.label !== undefined ? { label: incoming.label } : {}),\n    ...(incoming.kind !== undefined ? { kind: incoming.kind } : {}),\n  } satisfies LlmAgentMetadata;\n}\n\nfunction normalizeTokenCount(value: number): number | null {\n  if (typeof value !== \"number\" || !Number.isFinite(value)) {\n    return null;\n  }\n\n  if (value < 0) {\n    return null;\n  }\n\n  const rounded = Math.round(value);\n  return rounded > 0 ? rounded : 0;\n}\n\nfunction deleteUsage(id: string, previousTokens: number): void {\n  usageStore.delete(id);\n  aggregateTokens -= previousTokens;\n\n  if (aggregateTokens < 0) {\n    aggregateTokens = 0;\n  }\n}\n\nexport function recordLlmTokenUsage(\n  metadata: LlmAgentMetadata,\n  tokens: number,\n): void {\n  const normalizedMetadata = normalizeMetadata(metadata);\n\n  if (normalizedMetadata.id.length === 0) {\n    return;\n  }\n\n  const normalizedTokens = normalizeTokenCount(tokens);\n\n  if (normalizedTokens === null) {\n    return;\n  }\n\n  const existing = usageStore.get(normalizedMetadata.id);\n  const previousTokens = existing?.tokens ?? 0;\n\n  if (normalizedTokens === 0) {\n    if (existing) {\n      deleteUsage(normalizedMetadata.id, previousTokens);\n    }\n    return;\n  }\n\n  const mergedMetadata = mergeMetadata(existing?.metadata, normalizedMetadata);\n\n  usageStore.set(normalizedMetadata.id, {\n    metadata: mergedMetadata,\n    tokens: normalizedTokens,\n  });\n\n  aggregateTokens += normalizedTokens - previousTokens;\n\n  if (aggregateTokens < 0) {\n    aggregateTokens = 0;\n  }\n}\n\nexport function getLlmTokenUsageSummary(): LlmTokenUsageSummary {\n  const safeTotal = aggregateTokens > 0 ? aggregateTokens : 0;\n\n  const agents = Array.from(usageStore.values())\n    .filter((record) => record.tokens > 0)\n    .map<LlmAgentUsage>((record) => {\n      const share = safeTotal === 0 ? 0 : record.tokens / safeTotal;\n\n      return {\n        ...record.metadata,\n        tokens: record.tokens,\n        share,\n      } satisfies LlmAgentUsage;\n    })\n    .sort((a, b) => {\n      if (b.tokens !== a.tokens) {\n        return b.tokens - a.tokens;\n      }\n\n      return a.id.localeCompare(b.id);\n    });\n\n  return {\n    totalTokens: safeTotal,\n    agents,\n  } satisfies LlmTokenUsageSummary;\n}\n\nexport function resetLlmTokenUsage(): void {\n  usageStore.clear();\n  aggregateTokens = 0;\n}\n","\"use client\";\n\nimport * as React from \"react\";\nimport { layoutGridClassName, PageShell } from \"@/components/ui/layout/PageShell\";\nimport { TodayHero } from \"../TodayHero\";\nimport { WeekNotes } from \"../WeekNotes\";\nimport { DayRow } from \"../DayRow\";\nimport { PlannerFab } from \"../PlannerFab\";\nimport { useFocusDate, useWeek } from \"../useFocusDate\";\nimport type { ISODate } from \"../plannerTypes\";\nimport { PlannerIslandBoundary } from \"../PlannerIslandBoundary\";\n\nconst PLANNER_SCROLL_STORAGE_KEY = \"planner:scroll-position\";\n\nexport function DayView() {\n  const { iso, today } = useFocusDate();\n  const { days } = useWeek(iso);\n\n  React.useEffect(() => {\n    if (typeof window === \"undefined\") return undefined;\n\n    const stored = sessionStorage.getItem(PLANNER_SCROLL_STORAGE_KEY);\n    if (stored) {\n      const parsed = Number.parseInt(stored, 10);\n      if (!Number.isNaN(parsed)) {\n        window.scrollTo({ top: parsed });\n      }\n    }\n\n    let frame = 0;\n    const handleScroll = () => {\n      if (frame) return;\n      frame = window.requestAnimationFrame(() => {\n        frame = 0;\n        sessionStorage.setItem(\n          PLANNER_SCROLL_STORAGE_KEY,\n          Math.round(window.scrollY).toString(),\n        );\n      });\n    };\n\n    const handlePageHide = () => {\n      sessionStorage.setItem(\n        PLANNER_SCROLL_STORAGE_KEY,\n        Math.round(window.scrollY).toString(),\n      );\n    };\n\n    window.addEventListener(\"scroll\", handleScroll, { passive: true });\n    window.addEventListener(\"pagehide\", handlePageHide);\n\n    return () => {\n      window.removeEventListener(\"scroll\", handleScroll);\n      window.removeEventListener(\"pagehide\", handlePageHide);\n      if (frame) {\n        window.cancelAnimationFrame(frame);\n      }\n      sessionStorage.setItem(\n        PLANNER_SCROLL_STORAGE_KEY,\n        Math.round(window.scrollY).toString(),\n      );\n    };\n  }, []);\n\n  const dayItems = React.useMemo<Array<{ iso: ISODate; isToday: boolean }>>(\n    () => days.map((d) => ({ iso: d, isToday: d === today })),\n    [days, today],\n  );\n\n  const heroRef = React.useRef<HTMLDivElement>(null);\n\n  return (\n    <>\n      <PageShell\n        as=\"div\"\n        grid\n        className=\"py-[var(--space-6)]\"\n        contentClassName=\"gap-y-[var(--space-6)]\"\n      >\n        <div\n          role=\"group\"\n          aria-label=\"Today and weekly panels\"\n          className={`${layoutGridClassName} col-span-full lg:grid-cols-12`}\n        >\n          <div className=\"col-span-full lg:col-span-8\" ref={heroRef}>\n            <PlannerIslandBoundary\n              name=\"planner:day-view:today-hero\"\n              title=\"Today's planner unavailable\"\n              description=\"We hit an error loading today's focus view. Retry to restore the hero section.\"\n              retryLabel=\"Retry focus view\"\n            >\n              <TodayHero iso={iso} />\n            </PlannerIslandBoundary>\n          </div>\n\n          <aside\n            aria-label=\"Day notes\"\n            className=\"col-span-full space-y-[var(--space-6)] lg:col-span-4 lg:sticky lg:top-[var(--header-stack)]\"\n          >\n            <PlannerIslandBoundary\n              name=\"planner:day-view:notes\"\n              title=\"Notes unavailable\"\n              description=\"We ran into an error loading your notes for this day. Retry to reopen the editor.\"\n              retryLabel=\"Retry notes\"\n            >\n              <WeekNotes iso={iso} />\n            </PlannerIslandBoundary>\n          </aside>\n        </div>\n\n        <PlannerIslandBoundary\n          name=\"planner:day-view:list\"\n          title=\"Day list unavailable\"\n          description=\"We couldn't render the week overview. Retry to reload the day rows.\"\n          retryLabel=\"Retry day list\"\n          variant=\"plain\"\n          fallbackClassName=\"col-span-full flex flex-col gap-[var(--space-4)]\"\n        >\n          <ul\n            aria-label=\"Week days (Monday to Sunday)\"\n            className=\"col-span-full flex flex-col gap-[var(--space-4)]\"\n          >\n            {dayItems.map((item) => (\n              <DayRow key={item.iso} iso={item.iso} isToday={item.isToday} />\n            ))}\n          </ul>\n        </PlannerIslandBoundary>\n      </PageShell>\n      <PlannerFab />\n    </>\n  );\n}\n","import * as React from \"react\";\nimport { cn } from \"@/lib/utils\";\n\nconst DEFAULT_DESCRIPTOR = {\n  id: \"static\",\n  text: \"Nothing queued yet.\",\n} as const;\n\nconst ROTATING_DESCRIPTORS = [\n  { id: \"echo\", text: \"Awaiting planner echo\" },\n  { id: \"buffer\", text: \"Buffering next step\" },\n  { id: \"ghost\", text: \"Ghost row awaiting sync\" },\n] as const;\n\ntype EmptyRowTone = \"default\" | \"muted\";\ntype EmptyRowVariant = \"default\" | \"rotate\";\n\ntype EmptyRowProps = {\n  text?: string;\n  tone?: EmptyRowTone;\n  variant?: EmptyRowVariant;\n};\n\nexport function EmptyRow({\n  text,\n  tone = \"default\",\n  variant = \"default\",\n}: EmptyRowProps) {\n  const componentId = React.useId();\n\n  const descriptor = React.useMemo(() => {\n    if (text) {\n      return { id: \"custom\", text } as const;\n    }\n\n    if (variant === \"rotate\") {\n      const seed = Array.from(componentId).reduce(\n        (total, char) => total + char.charCodeAt(0),\n        0,\n      );\n      const rotating = ROTATING_DESCRIPTORS[seed % ROTATING_DESCRIPTORS.length];\n      return rotating;\n    }\n\n    return DEFAULT_DESCRIPTOR;\n  }, [componentId, text, variant]);\n\n  const secondaryText = React.useMemo(() => {\n    if (variant !== \"rotate\") return undefined;\n    const seed = Array.from(componentId).reduce(\n      (total, char) => total + char.charCodeAt(0) * 7,\n      0,\n    );\n    return ROTATING_DESCRIPTORS[(seed + 1) % ROTATING_DESCRIPTORS.length];\n  }, [componentId, variant]);\n\n  const isRotating = variant === \"rotate\";\n  const toneClassName = tone === \"muted\" ? \"text-muted-foreground\" : undefined;\n  const primaryClassName = cn(\n    \"font-medium\",\n    tone === \"muted\" ? \"text-muted-foreground\" : \"text-foreground\",\n  );\n\n  return (\n    <div\n      className={cn(\"tasks-placeholder text-label\", toneClassName)}\n      data-placeholder-tone={tone}\n      data-placeholder-variant={variant}\n      data-placeholder-layer={descriptor.id}\n      data-placeholder-size={isRotating ? \"compact\" : undefined}\n    >\n      <span className={primaryClassName} data-placeholder-primary>\n        {descriptor.text}\n      </span>\n      {isRotating && secondaryText ? (\n        <span\n          aria-hidden=\"true\"\n          className=\"text-ui text-muted-foreground\"\n          data-placeholder-descriptor\n          data-placeholder-layer-secondary={secondaryText.id}\n        >\n          {secondaryText.text}\n        </span>\n      ) : null}\n    </div>\n  );\n}\n","// src/components/planner/useDayFocus.ts\n\"use client\";\n\nimport { createDayTextFieldHook } from \"./createDayTextFieldHook\";\nimport { scheduleSavingReset } from \"./scheduleSavingReset\";\nimport { setFocus as applyFocus } from \"./plannerCrud\";\n\nexport const useDayFocus = createDayTextFieldHook({\n  selectValue: (day) => day.focus,\n  applyValue: applyFocus,\n  scheduleSavingReset,\n});\n","// src/components/planner/createDayTextFieldHook.ts\n\"use client\";\n\nimport * as React from \"react\";\n\nimport type { DayRecord, ISODate } from \"./plannerTypes\";\nimport { scheduleSavingReset as defaultScheduleSavingReset } from \"./scheduleSavingReset\";\nimport { usePlannerStore } from \"./usePlannerStore\";\n\ntype DayTextSelector = (day: DayRecord) => string | undefined;\ntype DayTextMutator = (day: DayRecord, value: string) => DayRecord;\n\ntype UseDayTextField = (iso: ISODate) => {\n  value: string;\n  setValue: React.Dispatch<React.SetStateAction<string>>;\n  saving: boolean;\n  isDirty: boolean;\n  lastSavedRef: React.MutableRefObject<string>;\n  commit: VoidFunction;\n};\n\nexport function createDayTextFieldHook({\n  selectValue,\n  applyValue,\n  scheduleSavingReset = defaultScheduleSavingReset,\n}: {\n  selectValue: DayTextSelector;\n  applyValue: DayTextMutator;\n  scheduleSavingReset?: typeof defaultScheduleSavingReset;\n}): UseDayTextField {\n  return function useDayTextField(iso: ISODate) {\n    const { getDay, upsertDay } = usePlannerStore();\n    const day = getDay(iso);\n    const persistedValue = selectValue(day) ?? \"\";\n\n    const applyForIso = React.useCallback(\n      (value: string) => {\n        upsertDay(iso, (d) => applyValue(d, value));\n      },\n      [iso, upsertDay],\n    );\n\n    const [value, setValue] = React.useState<string>(() => persistedValue);\n    const [saving, setSaving] = React.useState(false);\n    const mountedRef = React.useRef(true);\n    const scheduleSavingResetRef = React.useRef(scheduleSavingReset);\n    scheduleSavingResetRef.current = scheduleSavingReset;\n    const lastSavedRef = React.useRef(persistedValue.trim());\n\n    const trimmed = React.useMemo(() => value.trim(), [value]);\n    const isDirty = trimmed !== lastSavedRef.current;\n\n    const commit = React.useCallback(() => {\n      if (!isDirty) return;\n      setSaving(true);\n      try {\n        applyForIso(trimmed);\n        lastSavedRef.current = trimmed;\n      } finally {\n        scheduleSavingResetRef.current(() => {\n          if (mountedRef.current) {\n            setSaving(false);\n          }\n        });\n      }\n    }, [applyForIso, isDirty, trimmed]);\n\n    React.useEffect(() => {\n      setValue(persistedValue);\n      lastSavedRef.current = persistedValue.trim();\n    }, [iso, persistedValue]);\n\n    React.useEffect(() => {\n      return () => {\n        mountedRef.current = false;\n      };\n    }, []);\n\n    return { value, setValue, saving, isDirty, lastSavedRef, commit } as const;\n  };\n}\n","import { isPillar, type Goal, type Pillar } from \"@/lib/types\";\n\nexport const ACTIVE_CAP = 3;\n\nexport type AddGoalInput = {\n  title: string;\n  metric: string;\n  notes: string;\n  pillar: Pillar | \"\";\n};\n\nfunction isRecord(value: unknown): value is Record<string, unknown> {\n  return typeof value === \"object\" && value !== null && !Array.isArray(value);\n}\n\nfunction decodeGoal(value: unknown): Goal | null {\n  if (!isRecord(value)) return null;\n  const id = value[\"id\"];\n  const title = value[\"title\"];\n  const done = value[\"done\"];\n  const createdAt = value[\"createdAt\"];\n  if (typeof id !== \"string\") return null;\n  if (typeof title !== \"string\") return null;\n  if (typeof done !== \"boolean\") return null;\n  if (typeof createdAt !== \"number\" || !Number.isFinite(createdAt)) return null;\n  const goal: Goal = { id, title, done, createdAt };\n  const pillar = value[\"pillar\"];\n  if (isPillar(pillar)) {\n    goal.pillar = pillar;\n  }\n  const metric = value[\"metric\"];\n  if (typeof metric === \"string\") {\n    goal.metric = metric;\n  }\n  const notes = value[\"notes\"];\n  if (typeof notes === \"string\") {\n    goal.notes = notes;\n  }\n  return goal;\n}\n\nexport function decodeGoals(value: unknown): Goal[] | null {\n  if (!Array.isArray(value)) return null;\n  const result: Goal[] = [];\n  for (const entry of value) {\n    const goal = decodeGoal(entry);\n    if (goal) result.push(goal);\n  }\n  return result;\n}\n\n","\"use client\";\n\nimport { useCallback, useEffect, useMemo, useState } from \"react\";\nimport type { FormEvent } from \"react\";\n\nimport type { ISODate, Project } from \"./plannerTypes\";\nimport { usePlannerActions } from \"./usePlannerStore\";\n\nconst PROJECT_PREVIEW_LIMIT = 12;\n\ntype UseTodayHeroProjectsParams = {\n  iso: ISODate;\n  projects: Project[];\n  selectedProjectId: string;\n  setSelectedProjectId: (projectId: string) => void;\n  renameProject: (id: string, name: string) => void;\n  deleteProject: (id: string) => void;\n  toggleProject: (id: string) => void;\n};\n\ntype UseTodayHeroProjectsResult = {\n  projectsListId: string;\n  projectName: string;\n  editingProjectId: string | null;\n  editingProjectName: string;\n  showAllProjects: boolean;\n  visibleProjects: Project[];\n  hiddenProjectsCount: number;\n  shouldShowProjectToggle: boolean;\n  handleProjectNameChange: (value: string) => void;\n  handleProjectFormSubmit: (event: FormEvent<HTMLFormElement>) => void;\n  handleProjectSelect: (projectId: string) => void;\n  handleProjectToggle: (projectId: string) => void;\n  handleProjectDelete: (projectId: string) => void;\n  openProjectEditor: (projectId: string, name: string) => void;\n  handleProjectRenameChange: (value: string) => void;\n  commitProjectRename: (projectId: string, fallbackName: string) => void;\n  cancelProjectRename: () => void;\n  toggleShowAllProjects: () => void;\n};\n\nexport function useTodayHeroProjects({\n  iso,\n  projects,\n  selectedProjectId,\n  setSelectedProjectId,\n  renameProject,\n  deleteProject,\n  toggleProject,\n}: UseTodayHeroProjectsParams): UseTodayHeroProjectsResult {\n  const [projectName, setProjectName] = useState(\"\");\n  const [editingProjectId, setEditingProjectId] = useState<string | null>(null);\n  const [editingProjectName, setEditingProjectName] = useState(\"\");\n  const [showAllProjects, setShowAllProjects] = useState(false);\n\n  const { createProject } = usePlannerActions();\n\n  const projectsListId = \"today-hero-project-list\";\n\n  const visibleProjects = useMemo(\n    () =>\n      showAllProjects\n        ? projects\n        : projects.slice(0, PROJECT_PREVIEW_LIMIT),\n    [projects, showAllProjects],\n  );\n\n  const hiddenProjectsCount = useMemo(\n    () => Math.max(projects.length - visibleProjects.length, 0),\n    [projects.length, visibleProjects.length],\n  );\n\n  const shouldShowProjectToggle = projects.length > PROJECT_PREVIEW_LIMIT;\n\n  const handleProjectNameChange = useCallback((value: string) => {\n    setProjectName(value);\n  }, []);\n\n  const handleProjectFormSubmit = useCallback(\n    (event: FormEvent<HTMLFormElement>) => {\n      event.preventDefault();\n      const id = createProject({\n        iso,\n        name: projectName,\n        select: setSelectedProjectId,\n      });\n      if (id) {\n        setProjectName(\"\");\n      }\n    },\n    [createProject, iso, projectName, setSelectedProjectId],\n  );\n\n  const handleProjectSelect = useCallback(\n    (projectId: string) => {\n      setSelectedProjectId(projectId);\n    },\n    [setSelectedProjectId],\n  );\n\n  const handleProjectToggle = useCallback(\n    (projectId: string) => {\n      toggleProject(projectId);\n    },\n    [toggleProject],\n  );\n\n  const handleProjectDelete = useCallback(\n    (projectId: string) => {\n      deleteProject(projectId);\n      if (selectedProjectId === projectId) {\n        setSelectedProjectId(\"\");\n      }\n      if (editingProjectId === projectId) {\n        setEditingProjectId(null);\n        setEditingProjectName(\"\");\n      }\n    },\n    [deleteProject, editingProjectId, selectedProjectId, setSelectedProjectId],\n  );\n\n  const openProjectEditor = useCallback((projectId: string, name: string) => {\n    setEditingProjectId(projectId);\n    setEditingProjectName(name);\n  }, []);\n\n  const handleProjectRenameChange = useCallback((value: string) => {\n    setEditingProjectName(value);\n  }, []);\n\n  const commitProjectRename = useCallback(\n    (projectId: string, fallbackName: string) => {\n      const nextName = editingProjectName.trim() || fallbackName;\n      renameProject(projectId, nextName);\n      setEditingProjectId(null);\n    },\n    [editingProjectName, renameProject],\n  );\n\n  const cancelProjectRename = useCallback(() => {\n    setEditingProjectId(null);\n  }, []);\n\n  const toggleShowAllProjects = useCallback(() => {\n    setShowAllProjects((prev) => !prev);\n  }, []);\n\n  useEffect(() => {\n    if (showAllProjects && projects.length <= PROJECT_PREVIEW_LIMIT) {\n      setShowAllProjects(false);\n    }\n  }, [projects.length, showAllProjects]);\n\n  useEffect(() => {\n    if (!selectedProjectId || showAllProjects) return;\n    if (projects.length <= PROJECT_PREVIEW_LIMIT) return;\n\n    const isSelectedVisible = projects\n      .slice(0, PROJECT_PREVIEW_LIMIT)\n      .some((project) => project.id === selectedProjectId);\n\n    if (!isSelectedVisible) {\n      setShowAllProjects(true);\n    }\n  }, [projects, selectedProjectId, showAllProjects]);\n\n  useEffect(() => {\n    if (!editingProjectId) return;\n    const stillExists = projects.some((project) => project.id === editingProjectId);\n    if (!stillExists) {\n      setEditingProjectId(null);\n      setEditingProjectName(\"\");\n    }\n  }, [editingProjectId, projects]);\n\n  return {\n    projectsListId,\n    projectName,\n    editingProjectId,\n    editingProjectName,\n    showAllProjects,\n    visibleProjects,\n    hiddenProjectsCount,\n    shouldShowProjectToggle,\n    handleProjectNameChange,\n    handleProjectFormSubmit,\n    handleProjectSelect,\n    handleProjectToggle,\n    handleProjectDelete,\n    openProjectEditor,\n    handleProjectRenameChange,\n    commitProjectRename,\n    cancelProjectRename,\n    toggleShowAllProjects,\n  };\n}\n","import { uid } from \"@/lib/db\";\nimport {\n  addProject as dayAddProject,\n  renameProject as dayRenameProject,\n  toggleProject as dayToggleProject,\n  removeProject as dayRemoveProject,\n  addTask as dayAddTask,\n  renameTask as dayRenameTask,\n  toggleTask as dayToggleTask,\n  removeTask as dayRemoveTask,\n  addTaskImage as dayAddTaskImage,\n  removeTaskImage as dayRemoveTaskImage,\n  updateTaskReminder as dayUpdateTaskReminder,\n} from \"./dayCrud\";\nimport type { DayRecord, ISODate, TaskReminder } from \"./plannerTypes\";\n\nexport type UpsertDay = (iso: ISODate, fn: (d: DayRecord) => DayRecord) => void;\n\nexport function setNotes(day: DayRecord, notes: string): DayRecord {\n  return { ...day, notes };\n}\n\nexport function setFocus(day: DayRecord, focus: string): DayRecord {\n  return { ...day, focus };\n}\n\nexport function makeCrud(iso: ISODate, upsertDay: UpsertDay) {\n  const addProject = (name: string) => {\n    const trimmed = name.trim();\n    if (!trimmed) return undefined;\n    const id = uid(\"proj\");\n    upsertDay(iso, (d) => dayAddProject(d, id, trimmed));\n    return id;\n  };\n\n  const renameProject = (id: string, name: string) =>\n    upsertDay(iso, (d) => dayRenameProject(d, id, name));\n\n  const toggleProject = (id: string) =>\n    upsertDay(iso, (d) => dayToggleProject(d, id));\n\n  const removeProject = (id: string) =>\n    upsertDay(iso, (d) => dayRemoveProject(d, id));\n\n  const addTask = (title: string, projectId?: string) => {\n    const trimmed = title.trim();\n    if (!trimmed) return undefined;\n    const id = uid(\"task\");\n    upsertDay(iso, (d) => dayAddTask(d, id, trimmed, projectId));\n    return id;\n  };\n\n  const renameTask = (id: string, next: string) =>\n    upsertDay(iso, (d) => dayRenameTask(d, id, next));\n\n  const toggleTask = (id: string) =>\n    upsertDay(iso, (d) => dayToggleTask(d, id));\n\n  const removeTask = (id: string) =>\n    upsertDay(iso, (d) => dayRemoveTask(d, id));\n\n  const addTaskImage = (id: string, url: string) =>\n    upsertDay(iso, (d) => dayAddTaskImage(d, id, url));\n\n  const removeTaskImage = (id: string, url: string, index?: number) =>\n    upsertDay(iso, (d) => dayRemoveTaskImage(d, id, url, index));\n\n  const updateTaskReminder = (\n    id: string,\n    partial: Partial<TaskReminder> | null,\n  ) => upsertDay(iso, (d) => dayUpdateTaskReminder(d, id, partial));\n\n  const setNotesForDay = (notes: string) =>\n    upsertDay(iso, (d) => setNotes(d, notes));\n\n  const setFocusForDay = (focus: string) =>\n    upsertDay(iso, (d) => setFocus(d, focus));\n\n  return {\n    addProject,\n    renameProject,\n    toggleProject,\n    removeProject,\n    addTask,\n    renameTask,\n    toggleTask,\n    removeTask,\n    addTaskImage,\n    removeTaskImage,\n    updateTaskReminder,\n    setNotes: setNotesForDay,\n    setFocus: setFocusForDay,\n  } as const;\n}\n","// src/lib/date.ts\n// Shared date helpers for planner components\n\nimport { LOCALE } from \"./utils\";\n\nexport const shortDate = new Intl.DateTimeFormat(LOCALE, {\n  month: \"numeric\",\n  day: \"numeric\",\n  year: \"numeric\",\n});\n\nconst weekDayFormatter = new Intl.DateTimeFormat(LOCALE, {\n  day: \"2-digit\",\n  month: \"short\",\n});\n\nconst weekRangeLabelFormatter = new Intl.DateTimeFormat(LOCALE, {\n  month: \"long\",\n  day: \"numeric\",\n});\n\nconst weekRangeMonthFormatter = new Intl.DateTimeFormat(LOCALE, {\n  month: \"long\",\n});\n\nconst weekRangeDayFormatter = new Intl.DateTimeFormat(LOCALE, {\n  day: \"numeric\",\n});\n\nconst isoLabelWeekdayFormatter = new Intl.DateTimeFormat(LOCALE, {\n  weekday: \"long\",\n});\n\nconst isoLabelMonthFormatter = new Intl.DateTimeFormat(LOCALE, {\n  month: \"short\",\n});\n\nconst isoLabelDayFormatter = new Intl.DateTimeFormat(LOCALE, {\n  day: \"2-digit\",\n});\n\n/** Predicate for \"YYYY-MM-DD\" */\nexport function isISODate(v: string): boolean {\n  return /^\\d{4}-\\d{2}-\\d{2}$/.test(v);\n}\n\n/** Parse \"YYYY-MM-DD\" into a Date at local midnight. Returns null if invalid. */\nexport function fromISODate(iso: string): Date | null {\n  if (!isISODate(iso)) return null;\n  const [y, m, d] = iso.split(\"-\").map((x) => parseInt(x, 10));\n  const dt = new Date(y, m - 1, d, 0, 0, 0, 0);\n  if (!Number.isFinite(dt.getTime())) return null;\n  return dt.getFullYear() === y && dt.getMonth() === m - 1 && dt.getDate() === d\n    ? dt\n    : null;\n}\n\nexport function formatWeekDay(iso: string): string {\n  const dt = fromISODate(iso);\n  if (!dt) return iso;\n  return weekDayFormatter.format(dt);\n}\n\nexport function formatIsoLabel(iso: string): string {\n  const dt = fromISODate(iso);\n  if (!dt) return iso;\n  const weekday = isoLabelWeekdayFormatter\n    .format(dt)\n    .toLocaleUpperCase(LOCALE);\n  const month = isoLabelMonthFormatter\n    .format(dt)\n    .toLocaleUpperCase(LOCALE);\n  const day = isoLabelDayFormatter.format(dt);\n  return `${weekday}_${month} :: ${day}`;\n}\n\n/** Normalize various inputs to a valid Date (fallback = now). */\nexport function normalizeDate(src?: Date | number | string): Date {\n  let dt: Date;\n  if (src instanceof Date) {\n    dt = new Date(src);\n  } else if (typeof src === \"number\") {\n    dt = new Date(src);\n  } else if (typeof src === \"string\") {\n    const maybeISO = isISODate(src) ? fromISODate(src) : null;\n    dt = maybeISO ?? new Date(src);\n  } else {\n    dt = new Date();\n  }\n  if (!Number.isFinite(dt.getTime())) dt = new Date();\n  return dt;\n}\n\n/**\n * ts  Normalize various inputs to a numeric timestamp (ms).\n * Returns 0 for invalid values.\n */\nexport function ts(v: unknown): number {\n  if (typeof v === \"number\") return v;\n  if (v instanceof Date) return +v;\n  if (typeof v === \"string\") {\n    const n = Date.parse(v);\n    return Number.isNaN(n) ? 0 : n;\n  }\n  return 0;\n}\n\ntype MmSsUnit = \"seconds\" | \"milliseconds\";\n\ntype FormatMmSsOptions = {\n  unit?: MmSsUnit;\n  padMinutes?: boolean;\n};\n\nexport function formatMmSs(\n  value: number,\n  { unit = \"seconds\", padMinutes = false }: FormatMmSsOptions = {},\n): string {\n  const safeValue = Number.isFinite(value) ? value : 0;\n  const baseSeconds =\n    unit === \"milliseconds\"\n      ? Math.floor(safeValue / 1000)\n      : Math.floor(safeValue);\n  const totalSeconds = Math.max(0, baseSeconds);\n  const minutes = Math.floor(totalSeconds / 60);\n  const seconds = totalSeconds % 60;\n  const mm = padMinutes ? String(minutes).padStart(2, \"0\") : String(minutes);\n  const ss = String(seconds).padStart(2, \"0\");\n  return `${mm}:${ss}`;\n}\n\ntype ParseMmSsOptions = {\n  unit?: MmSsUnit;\n};\n\nexport function parseMmSs(\n  value: string,\n  { unit = \"seconds\" }: ParseMmSsOptions = {},\n): number | null {\n  const match = value.trim().match(/^(\\d{1,3})\\s*:\\s*([0-5]?\\d)$/);\n  if (!match) return null;\n  const minutes = Number(match[1]);\n  const seconds = Number(match[2]);\n  const totalSeconds = minutes * 60 + seconds;\n  return unit === \"milliseconds\" ? totalSeconds * 1000 : totalSeconds;\n}\n\n/** toISODate  Returns local date in \"YYYY-MM-DD\". */\nexport function toISODate(d?: Date | number | string): string {\n  const date = normalizeDate(d);\n  const y = date.getFullYear();\n  const m = `${date.getMonth() + 1}`.padStart(2, \"0\");\n  const day = `${date.getDate()}`.padStart(2, \"0\");\n  return `${y}-${m}-${day}`;\n}\n\nexport function addDays(date: Date, n: number): Date {\n  const d = new Date(date);\n  d.setDate(d.getDate() + n);\n  return d;\n}\n\nexport function mondayStartOfWeek(d: Date): Date {\n  const copy = new Date(d);\n  const day = copy.getDay();\n  const diff = (day + 6) % 7; // shift so Monday=0\n  copy.setHours(0, 0, 0, 0);\n  return addDays(copy, -diff);\n}\n\nexport function sundayEndOfWeek(d: Date): Date {\n  const start = mondayStartOfWeek(d);\n  const end = addDays(start, 6);\n  end.setHours(23, 59, 59, 999);\n  return end;\n}\n\nexport function weekRangeFromISO(iso: string): { start: Date; end: Date } {\n  const d = fromISODate(iso) ?? new Date();\n  return { start: mondayStartOfWeek(d), end: sundayEndOfWeek(d) };\n}\n\nexport function formatWeekRangeLabel(start: Date, end: Date): string {\n  if (typeof weekRangeLabelFormatter.formatRange === \"function\") {\n    try {\n      return `Week of ${weekRangeLabelFormatter.formatRange(start, end)}`;\n    } catch {\n      // Fall through to manual formatting below.\n    }\n  }\n\n  const sameMonth =\n    start.getFullYear() === end.getFullYear() && start.getMonth() === end.getMonth();\n\n  if (sameMonth) {\n    const month = weekRangeMonthFormatter.format(start);\n    const startDay = weekRangeDayFormatter.format(start);\n    const endDay = weekRangeDayFormatter.format(end);\n    return `Week of ${month} ${startDay}${endDay}`;\n  }\n\n  const startLabel = weekRangeLabelFormatter.format(start);\n  const endLabel = weekRangeLabelFormatter.format(end);\n  return `Week of ${startLabel}${endLabel}`;\n}\n","\"use client\";\n\n/**\n * DayCard  day row with single-select (project OR task) shared across app.\n * - Selecting a project clears task selection.\n * - Selecting a task auto-selects its project.\n * - Animated day-progress bar.\n */\n\nimport \"./style.css\";\nimport * as React from \"react\";\nimport { useSelectedProject, useSelectedTask } from \"./useSelection\";\nimport type { ISODate, TaskReminder } from \"./plannerTypes\";\nimport { useDay } from \"./useDay\";\nimport { cn } from \"@/lib/utils\";\nimport { DayCardHeader } from \"./DayCardHeader\";\nimport { ProjectList } from \"./ProjectList\";\nimport { TaskList } from \"./TaskList\";\nimport { usePlannerActions } from \"./usePlannerStore\";\nimport { TaskReminderSettings } from \"./TaskReminderSettings\";\n\ntype Props = { iso: ISODate; isToday?: boolean };\n\nexport function DayCard({ iso, isToday }: Props) {\n  const {\n    projects,\n    renameProject,\n    deleteProject,\n    toggleProject,\n    tasksById,\n    tasksByProject,\n    renameTask,\n    toggleTask,\n    deleteTask,\n    addTaskImage,\n    removeTaskImage: removeTaskImageForDay,\n    doneCount,\n    totalCount,\n    updateTaskReminder,\n  } = useDay(iso);\n\n  const [selectedProjectId, setSelectedProjectId] = useSelectedProject(iso);\n  const [selectedTaskId, setSelectedTaskId] = useSelectedTask(iso);\n  const { createProject, createTask } = usePlannerActions();\n\n  const selectedTask = selectedTaskId ? tasksById[selectedTaskId] : undefined;\n\n  const handleCreateProject = React.useCallback(\n    (name: string) =>\n      createProject({ iso, name, select: setSelectedProjectId }),\n    [createProject, iso, setSelectedProjectId],\n  );\n\n  const handleCreateTask = React.useCallback(\n    (title: string) =>\n      createTask({\n        iso,\n        projectId: selectedProjectId,\n        title,\n        select: setSelectedTaskId,\n      }),\n    [createTask, iso, selectedProjectId, setSelectedTaskId],\n  );\n\n  const handleReminderChange = React.useCallback(\n    (partial: Partial<TaskReminder> | null) => {\n      if (!selectedTaskId) return;\n      updateTaskReminder(selectedTaskId, partial);\n    },\n    [selectedTaskId, updateTaskReminder],\n  );\n\n  return (\n    <section\n      className={cn(\n        \"daycard relative overflow-hidden card-neo-soft rounded-card r-card-lg border card-pad\",\n        \"grid gap-[var(--space-4)] lg:gap-[var(--space-6)]\",\n        \"grid-cols-1 lg:grid-cols-12\",\n        isToday && \"ring-1 ring-ring/65 title-glow\",\n        \"before:pointer-events-none before:absolute before:inset-x-[var(--space-4)] before:top-0 before:h-px before:bg-gradient-to-r\",\n        \"before:from-transparent before:via-ring/45 before:to-transparent\",\n        \"after:pointer-events-none after:absolute after:-inset-px after:[border-radius:var(--radius-card)] after:bg-[radial-gradient(60%_40%_at_100%_0%,hsl(var(--ring)/.12),transparent_60%)]\",\n      )}\n      aria-label={`Planner for ${iso}`}\n    >\n      <div className=\"col-span-1 lg:col-span-12\">\n        <DayCardHeader\n          iso={iso}\n          projectCount={projects.length}\n          doneCount={doneCount}\n          totalCount={totalCount}\n        />\n      </div>\n\n      <div className=\"col-span-1 lg:col-span-3\">\n        <ProjectList\n          projects={projects}\n          selectedProjectId={selectedProjectId}\n          setSelectedProjectId={setSelectedProjectId}\n          setSelectedTaskId={setSelectedTaskId}\n          toggleProject={toggleProject}\n          renameProject={renameProject}\n          deleteProject={deleteProject}\n          createProject={handleCreateProject}\n        />\n      </div>\n      {selectedProjectId && (\n        <React.Fragment>\n          <div\n            className=\"hidden lg:block lg:col-span-1 w-px mx-auto bg-card-hairline-90 rounded-full self-stretch\"\n            aria-hidden\n          />\n\n          <div className=\"col-span-1 lg:col-span-8\">\n            <TaskList\n              tasksById={tasksById}\n              tasksByProject={tasksByProject}\n              selectedProjectId={selectedProjectId}\n              selectedTaskId={selectedTaskId}\n              createTask={handleCreateTask}\n              renameTask={renameTask}\n              toggleTask={toggleTask}\n              deleteTask={deleteTask}\n              addTaskImage={addTaskImage}\n              removeTaskImage={(id, url, index) =>\n                removeTaskImageForDay(id, url, index)\n              }\n              setSelectedTaskId={setSelectedTaskId}\n            />\n          </div>\n        </React.Fragment>\n      )}\n\n      <div className=\"col-span-full\">\n        <TaskReminderSettings task={selectedTask} onChange={handleReminderChange} />\n      </div>\n    </section>\n  );\n}\n","\"use client\";\n\nimport * as React from \"react\";\nimport { Label } from \"@/components/ui/Label\";\nimport { Input } from \"@/components/ui/primitives/Input\";\nimport { EmptyRow } from \"./EmptyRow\";\nimport { PlannerListPanel } from \"./PlannerListPanel\";\nimport { TaskRow } from \"./TaskRow\";\nimport type { DayTask } from \"./plannerTypes\";\n\ntype Props = {\n  tasksById: Record<string, DayTask>;\n  tasksByProject: Record<string, string[]>;\n  selectedProjectId: string;\n  selectedTaskId: string;\n  createTask: (title: string) => string | undefined;\n  renameTask: (id: string, title: string) => void;\n  toggleTask: (id: string) => void;\n  deleteTask: (id: string) => void;\n  addTaskImage: (id: string, url: string) => void;\n  removeTaskImage: (id: string, url: string, index: number) => void;\n  setSelectedTaskId: (id: string) => void;\n};\n\nexport function TaskList({\n  tasksById,\n  tasksByProject,\n  selectedProjectId,\n  selectedTaskId,\n  createTask,\n  renameTask,\n  toggleTask,\n  deleteTask,\n  addTaskImage,\n  removeTaskImage,\n  setSelectedTaskId,\n}: Props) {\n  const [draftTask, setDraftTask] = React.useState(\"\");\n  const newTaskInputId = React.useId();\n  const tasksForSelected = React.useMemo(\n    () => {\n      if (!selectedProjectId) return [] as DayTask[];\n      const ids = tasksByProject[selectedProjectId] ?? [];\n      return ids\n        .map((taskId) => tasksById[taskId])\n        .filter((task): task is DayTask => Boolean(task));\n    },\n    [selectedProjectId, tasksByProject, tasksById],\n  );\n  const hasSelectedProject = Boolean(selectedProjectId);\n  const isEmpty = !hasSelectedProject || tasksForSelected.length === 0;\n\n  const onSubmit = React.useCallback(\n    (e: React.FormEvent<HTMLFormElement>) => {\n      e.preventDefault();\n      const id = createTask(draftTask);\n      if (id) {\n        setDraftTask(\"\");\n      }\n    },\n    [createTask, draftTask],\n  );\n\n  return (\n    <PlannerListPanel\n      renderComposer={\n        hasSelectedProject\n          ? () => (\n              <form onSubmit={onSubmit} className=\"grid gap-[var(--space-2)]\">\n                <Label htmlFor={newTaskInputId} className=\"mb-0\">\n                  New task\n                </Label>\n                <Input\n                  id={newTaskInputId}\n                  className=\"w-full\"\n                  placeholder=\"> add task\"\n                  value={draftTask}\n                  onChange={(e) => setDraftTask(e.target.value)}\n                />\n              </form>\n            )\n          : undefined\n      }\n      isEmpty={isEmpty}\n      renderEmpty={() => (\n        <EmptyRow\n          text={hasSelectedProject ? \"No tasks yet\" : \"Select a project to view tasks\"}\n          tone={hasSelectedProject ? \"default\" : \"muted\"}\n          variant={hasSelectedProject ? \"rotate\" : \"default\"}\n        />\n      )}\n      renderList={() => (\n        <ul\n          className=\"space-y-[var(--space-2)]\"\n          aria-label=\"Tasks\"\n        >\n          {tasksForSelected.map((t) => (\n            <TaskRow\n              key={t.id}\n              task={t}\n              toggleTask={() => {\n                toggleTask(t.id);\n                setSelectedTaskId(t.id);\n              }}\n              deleteTask={() => {\n                deleteTask(t.id);\n                if (selectedTaskId === t.id) {\n                  setSelectedTaskId(\"\");\n                }\n              }}\n              renameTask={(title) => renameTask(t.id, title)}\n              selectTask={() => setSelectedTaskId(t.id)}\n              addImage={(url) => addTaskImage(t.id, url)}\n              removeImage={(url, index) => removeTaskImage(t.id, url, index)}\n            />\n          ))}\n        </ul>\n      )}\n      viewportSize={[\"minHTasks\", \"maxHTasks\"]}\n    />\n  );\n}\n","// src/components/planner/PlannerIslandBoundary.tsx\n\"use client\";\n\nimport * as React from \"react\";\n\nimport { ClientErrorBoundary } from \"@/components/error/ClientErrorBoundary\";\nimport { Button, SectionCard } from \"@/components/ui\";\nimport { cn } from \"@/lib/utils\";\nimport { reportPlannerIslandError } from \"@/lib/telemetry\";\n\ntype BoundaryError = Error & { digest?: string };\n\ntype PlannerIslandBoundaryProps = {\n  readonly name: string;\n  readonly title: string;\n  readonly description: string;\n  readonly retryLabel?: string;\n  readonly variant?: \"card\" | \"plain\";\n  readonly fallbackClassName?: string;\n  readonly children: React.ReactNode;\n};\n\ntype PlannerIslandFallbackProps = {\n  readonly name: string;\n  readonly title: string;\n  readonly description: string;\n  readonly retryLabel: string;\n  readonly variant: \"card\" | \"plain\";\n  readonly className?: string;\n  readonly error: BoundaryError;\n  readonly onRetry: () => void;\n};\n\nfunction PlannerIslandFallback({\n  name,\n  title,\n  description,\n  retryLabel,\n  variant,\n  className,\n  error,\n  onRetry,\n}: PlannerIslandFallbackProps) {\n  React.useEffect(() => {\n    reportPlannerIslandError({\n      island: name,\n      digest: error.digest ?? null,\n      message: error.message ?? null,\n    });\n  }, [error.digest, error.message, name]);\n\n  if (variant === \"plain\") {\n    return (\n      <div\n        role=\"alert\"\n        aria-live=\"assertive\"\n        className={cn(\n          \"rounded-card border border-border/40 bg-card/80 p-[var(--space-4)] shadow-xs\",\n          \"space-y-[var(--space-2)]\",\n          className,\n        )}\n      >\n        <p className=\"text-label font-semibold text-foreground\">{title}</p>\n        <p className=\"text-body text-muted-foreground\">{description}</p>\n        <div>\n          <Button size=\"sm\" variant=\"default\" onClick={onRetry}>\n            {retryLabel}\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <SectionCard role=\"alert\" aria-live=\"assertive\" className={className}>\n      <SectionCard.Body className=\"space-y-[var(--space-2)]\">\n        <p className=\"text-label font-semibold text-foreground\">{title}</p>\n        <p className=\"text-body text-muted-foreground\">{description}</p>\n        <div>\n          <Button size=\"sm\" variant=\"default\" onClick={onRetry}>\n            {retryLabel}\n          </Button>\n        </div>\n      </SectionCard.Body>\n    </SectionCard>\n  );\n}\n\nexport function PlannerIslandBoundary({\n  name,\n  title,\n  description,\n  retryLabel = \"Retry\",\n  variant = \"card\",\n  fallbackClassName,\n  children,\n}: PlannerIslandBoundaryProps) {\n  return (\n    <ClientErrorBoundary\n      name={name}\n      renderFallback={({ error, reset }) => (\n        <PlannerIslandFallback\n          name={name}\n          title={title}\n          description={description}\n          retryLabel={retryLabel}\n          variant={variant}\n          className={fallbackClassName}\n          error={error}\n          onRetry={reset}\n        />\n      )}\n    >\n      {children}\n    </ClientErrorBoundary>\n  );\n}\n\n","\"use client\";\n\nimport * as React from \"react\";\nimport { PageShell } from \"@/components/ui/layout/PageShell\";\nimport { LOCALE, cn } from \"@/lib/utils\";\nimport {\n  addDays,\n  fromISODate,\n  mondayStartOfWeek,\n  toISODate,\n} from \"@/lib/date\";\nimport { useFocusDate } from \"../useFocusDate\";\nimport { usePlannerStore } from \"../usePlannerStore\";\nimport { ensureDay } from \"../plannerSerialization\";\n\nconst weekdayFormatter = new Intl.DateTimeFormat(LOCALE, { weekday: \"short\" });\n\nexport function MonthView() {\n  const { iso } = useFocusDate();\n  const { days: map } = usePlannerStore();\n\n  const focusDate = React.useMemo(() => fromISODate(iso) ?? new Date(), [iso]);\n  const focusMonth = focusDate.getMonth();\n\n  const calendar = React.useMemo(() => {\n    const firstOfMonth = new Date(\n      focusDate.getFullYear(),\n      focusDate.getMonth(),\n      1,\n    );\n    const start = mondayStartOfWeek(firstOfMonth);\n    const weeks: string[][] = [];\n    let cursor = start;\n    for (let weekIndex = 0; weekIndex < 6; weekIndex += 1) {\n      const week: string[] = [];\n      for (let dayIndex = 0; dayIndex < 7; dayIndex += 1) {\n        week.push(toISODate(cursor));\n        cursor = addDays(cursor, 1);\n      }\n      weeks.push(week);\n    }\n    return weeks;\n  }, [focusDate]);\n\n  const headerId = React.useId();\n\n  const weekdayLabels = React.useMemo(() => {\n    const base = mondayStartOfWeek(new Date());\n    return Array.from({ length: 7 }, (_, index) =>\n      weekdayFormatter.format(addDays(base, index)),\n    );\n  }, []);\n\n  return (\n    <PageShell\n      as=\"section\"\n      grid\n      className=\"py-[var(--space-6)]\"\n      contentClassName=\"gap-y-[var(--space-6)]\"\n      aria-labelledby={headerId}\n    >\n      <header className=\"col-span-full flex flex-col gap-[var(--space-3)]\">\n        <h2 id={headerId} className=\"text-title font-semibold tracking-tight\">\n          Month planner\n        </h2>\n        <p className=\"text-body text-muted-foreground max-w-prose\">\n          Preview six weeks around the focused date. Counts pull directly from\n          your planner data, so edits elsewhere remain visible when you switch\n          back.\n        </p>\n      </header>\n\n      <div className=\"col-span-full overflow-x-auto\">\n        <table className=\"w-full border-separate border-spacing-[var(--space-1)] sm:border-spacing-[var(--space-2)] text-body\">\n          <thead>\n            <tr>\n              {weekdayLabels.map((label) => (\n                <th\n                  key={label}\n                  scope=\"col\"\n                  className=\"px-[var(--space-2)] py-[var(--space-2)] text-left text-label font-semibold text-muted-foreground\"\n                >\n                  {label}\n                </th>\n              ))}\n            </tr>\n          </thead>\n          <tbody>\n            {calendar.map((week) => (\n              <tr key={week.join(\"-\")}>\n                {week.map((dayIso) => {\n                  const dayDate = fromISODate(dayIso) ?? new Date(dayIso);\n                  const record = ensureDay(map, dayIso);\n                  const inMonth = dayDate.getMonth() === focusMonth;\n                  return (\n                    <td\n                      key={dayIso}\n                      className=\"align-top px-[var(--space-2)] py-[var(--space-2)]\"\n                    >\n                      <div\n                        className={cn(\n                          \"rounded-card border border-border/40 bg-card/70 p-[var(--space-2)] shadow-xs\",\n                          \"flex flex-col gap-[var(--space-2)]\",\n                          inMonth ? \"text-foreground\" : \"text-muted-foreground/70\",\n                        )}\n                      >\n                        <div className=\"flex items-baseline justify-between gap-[var(--space-2)]\">\n                          <span className=\"text-label font-semibold uppercase tracking-[0.08em]\">\n                            {dayDate.getDate()}\n                          </span>\n                          <span className=\"text-micro text-muted-foreground tabular-nums\">\n                            {record.doneCount}/{record.totalCount}\n                          </span>\n                        </div>\n                        {record.projects.length ? (\n                          <p className=\"text-micro text-muted-foreground/80\">\n                            {record.projects.length} projects  {record.tasks.length} tasks\n                          </p>\n                        ) : (\n                          <p className=\"text-micro text-muted-foreground/60\">\n                            No plans yet\n                          </p>\n                        )}\n                      </div>\n                    </td>\n                  );\n                })}\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n    </PageShell>\n  );\n}\n"],"names":["heroPanel","heroContent","heroText","heroEyebrow","heroHeading","heroSubtitle","heroDial","heroRing","heroRingReduced","heroRingValue","heroRingCaption","heroSliderLabel","heroSlider","heroFeedback","heroActions","heroPortrait","styles","LazyDayView","React","default","DayView","LazyWeekView","WeekView","LazyMonthView","MonthView","LazyAgendaView","AgendaView","VIEW_MODE_OPTIONS","value","label","VIEW_TAB_ID_BASE","VIEW_COMPONENTS","day","week","month","agenda","VIEW_FALLBACK_CONTENT","title","description","PlannerViewFallback","mode","copy","div","role","aria-live","className","span","p","Inner","themeContext","iso","today","useFocusDate","viewMode","setViewMode","usePlanner","start","end","useWeek","hydrating","FOCUS_PLACEHOLDER","useOptionalTheme","themeVariant","variant","prefersReducedMotion","usePrefersReducedMotion","planningEnergy","setPlanningEnergy","weekAnnouncement","formatWeekRangeLabel","labelId","sliderId","handleViewModeChange","heroPose","PageShell","as","grid","section","aria-labelledby","cn","h2","id","ProgressRingIcon","pct","size","htmlFor","input","type","min","max","step","onChange","Number","event","target","aria-valuemin","aria-valuemax","aria-valuenow","aria-describedby","Button","tone","PortraitFrame","pose","transparentBackground","PageHeader","containerClassName","header","tabIndex","eyebrow","heading","subtitle","icon","CalendarDays","sticky","hero","children","PlannerIslandBoundary","name","retryLabel","WeekPicker","GlitchSegmentedGroup","ariaLabelledby","map","option","tabId","panelId","GlitchSegmentedButton","aria-controls","isActive","ViewComponent","hidden","fallback","PlannerPage","RemindersProvider","PlannerProvider","EMPTY_TASK_MAP","useSelectionState","getCurrentId","produceSelection","selected","setSelected","usePlannerSelection","previousSelection","prev","nextSelection","projectId","taskId","getProjectId","selection","produceProjectSelection","useSelectedProject","days","useDays","selectedProjectId","setSelectedProjectId","dayProjects","projects","some","project","getTaskId","useSelectedTask","tasksById","isoTasksById","isoDay","produceTaskSelection","task","tasks","find","candidate","FocusPanel","setValue","saving","isDirty","lastSavedRef","commit","useDayFocus","headerId","SectionCard","Header","titleAs","titleClassName","Body","form","onSubmit","e","preventDefault","Input","placeholder","onBlur","autoComplete","disabled","aria-disabled","current","useDay","upsertDay","usePlannerStore","rec","ensureDay","tasksByProject","crud","makeCrud","doneCount","totalCount","addProject","renameProject","deleteProject","removeProject","toggleProject","addTask","renameTask","deleteTask","removeTask","toggleTask","addTaskImage","removeTaskImage","updateTaskReminder","DayRow","isToday","li","aria-label","DayCard","a","b","finalizeDay","updates","hasTaskUpdate","Object","prototype","hasOwnProperty","call","lookups","buildTaskLookups","computeDayCounts","trim","createdAt","Date","now","done","wasDone","t","filter","images","next","partial","changed","reminder","rest","base","nextReminder","sanitizeTaskReminder","taskRemindersEqual","url","u","imageIndex","indexToRemove","undefined","indexOf","slice","splice","createReminder","body","tags","source","group","pinned","domain","uid","updatedAt","SEEDS","GROUPS","key","hint","s","normalizeTitle","toLowerCase","RemindersContext","filterRemindersByDomain","reminders","inferDomain","useRemindersState","items","setItems","usePersistentState","STORE_KEY","query","setQuery","onlyPinned","setOnlyPinned","setDomain","setGroup","setSource","quickAdd","setQuickAdd","quickAddError","setQuickAddErrorState","showFilters","setShowFilters","showGroups","domainItems","clearQuickAddError","reportQuickAddError","message","counts","reduce","acc","quick","pregame","laning","trading","tempo","review","filtered","q","join","includes","sort","addReminder","added","baseTitle","initialTitle","domainScoped","hasDuplicate","prevValue","makeUniqueTitle","suffix","updateReminder","removeReminder","toggleFilters","togglePinned","neonClass","groupTabs","groupItem","badge","setQuickAddError","sourceTabs","SOURCE_TABS","groups","Provider","useReminders","context","TIME_24H_REGEX","rawReminderId","reminderId","length","rawTime","time","test","rawLead","leadMinutes","isFinite","Math","round","enabled","Boolean","isRecord","Array","isArray","decodeImages","result","item","push","decodeProject","loading","decodeTask","rawReminder","decodePlannerDays","rawDay","entries","decoded","decodeDayRecord","rawProjects","rawTasks","focusValue","notesValue","hasFocus","hasNotes","focus","notes","decodePlannerFocus","fromISODate","pruneOldDays","reference","pruned","options","maxAgeDays","DEFAULT_MAX_DAY_AGE_DAYS","normalizedMaxAge","floor","isNaN","getTime","cutoff","setDate","getDate","setHours","cutoffTime","ceiling","ceilingTime","keys","parsed","hasValid","oldestTime","newestTime","POSITIVE_INFINITY","NEGATIVE_INFINITY","isoDate","mutated","todayISO","toISODate","date","existing","tasksChanged","i","nextTask","mutatedTask","rawImages","hasValidImages","every","image","normalizedImages","normalizedReminder","nextTasksById","nextTasksByProject","baseTasksByProject","baseTasksById","tasksByProjectChanged","projectMapsEqual","aKeys","bKeys","arrA","arrB","tasksByIdChanged","taskMapsEqual","countsChanged","sanitizeDayRecord","ensured","PILLAR_SET","Set","SIDE_SET","ROLE_SET","ROLE_VALUES","isPillar","has","isSide","isRole","taskImageSize","spacingTokens","taskImageSpacingToken","entryOffset","bounceDistance","DEFAULT_EASE_OUT","DEFAULT_MOTION_EASE_GLITCH","DEFAULT_EASE_OUT_CURVE","DEFAULT_MOTION_EASE_GLITCH_CURVE","readStringToken","token","document","getComputedStyle","documentElement","getPropertyValue","parseCubicBezier","match","parts","split","parseFloat","segment","TaskRow","selectTask","addImage","removeImage","reduceMotionPreference","forcedReduceMotion","setForcedReduceMotion","classList","contains","motionTokens","setMotionTokens","easeOut","motionEaseGlitch","easeOutCurve","motionEaseGlitchCurve","durationMd","DEFAULT_MOTION_DURATION_MD","durationLg","DEFAULT_MOTION_DURATION_LG","bounceControls","useAnimation","reduceMotion","editing","setEditing","setTitle","imageUrl","setImageUrl","inputRef","hasFocusWithin","setHasFocusWithin","imageError","setImageError","trimmedImageUrl","canAttachImage","accessibleTaskTitle","root","syncForcedReduceMotion","MutationObserver","observer","observe","attributes","attributeFilter","disconnect","readNumberToken","set","y","scale","previousDoneRef","offset","transition","duration","ease","imageEntriesRef","imageEntries","previousEntries","used","nextEntries","matchIndex","index","add","validateImageUrl","URL","protocol","useAutoFocus","ref","when","handleFocusWithin","handleBlurWithin","relatedTarget","currentTarget","handleRowClick","Element","closest","TASK_ROW_GUARD_SELECTOR","handleRowKeyDown","handleRowKeyUp","v","motion","initial","opacity","animate","onFocusCapture","onBlurCapture","button","onClick","onKeyDown","onKeyUp","data-focus-within","layoutClasses","data-task-row-guard","onPointerDown","stopPropagation","CheckCircle","checked","cancel","renameTaskLabel","onDoubleClick","aria-pressed","IconButton","iconSize","Pencil","Trash2","ul","entry","Image","src","alt","width","height","commitImage","error","nextValue","trimmedValue","nextError","aria-invalid","cachedSegmenter","TIME_REGEX","INTENT_PREFIX_REGEX","MONTHS","january","february","march","april","may","june","july","august","september","october","november","december","WEEKDAYS","sunday","sun","monday","mon","tuesday","tue","tues","wednesday","wed","thursday","thu","thur","thurs","friday","fri","saturday","sat","RELATIVE_DATE_TOKENS","tonight","tomorrow","clampConfidence","order","addSpan","spans","nextWeekday","weekday","includeToday","delta","getDay","addDays","parsePlannerPhrase","phrase","nextMatch","thisMatch","projectCue","weekdayMatch","weekendMatch","everyMatch","intervalMatch","dailyMatch","weeklyMatch","monthlyMatch","yearlyMatch","startDate","eventTime","raw","intent","recurrence","confidence","matched","lower","timeRegex","exec","normalized","normaliseTimeToken","hour","parseInt","rawMinutes","hasSuffix","hasMinutes","minutes","normalizedHour","lowerSuffix","hh","String","padStart","mm","computeRelativeDate","explicitMatch","parseMonthDate","trimmed","descriptor","replace","head","monthMatch","monthIndex","yearToken","year","getFullYear","setFullYear","getMonth","words","maybeMonth","dayValue","yearValue","tokenWords","removalLength","recurrenceMatches","registerRecurrence","rule","priority","frequency","interval","weekdays","normaliseWeekdays","lowerToken","matches","mapped","from","unit","stripSpans","merged","mergeSpans","sorted","cursor","output","summariseParse","CONTROL_CHAR_PATTERN","INVISIBLE_CHAR_PATTERN","COLLAPSE_SPACES_PATTERN","SAFE_MODE_RESPONSE_RESERVE","resolveNumericEnv","integer","SAFE_MODE_TEMPERATURE_CEILING","SAFE_MODE_MAX_TOOL_CALLS","warnedMessages","normalizeIssuePath","path","toString","normalizeIssueMessage","issue","code","z","invalid_type","warnOnce","console","warn","reportTokenEstimateIssue","reason","printable","JSON","stringify","formatIssuePath","getUnicodeSegments","intlApi","Intl","segmenterCtor","Segmenter","granularity","segmenter","ENABLED_FLAG_VALUES","reportNumericEnvIssue","names","process","candidates","env","trunc","getDefaultMaxInputLength","FALLBACK_MAX_INPUT_LENGTH","defaultTokenEstimator","content","tokensPerCharacter","getDefaultTokensPerCharacter","FALLBACK_TOKENS_PER_CHARACTER","EPSILON","characterCount","unicodeLength","ceil","enforceTokenBudgetInternal","messages","estimator","estimateTokens","incomingReserved","reservedForResponse","reserved","clientSafeMode","isSafeModeEnabled","serverSafeMode","isServerSafeModeExplicitlyEnabled","SAFE_MODE","safeMode","safeReserved","incomingMaxTokens","maxTokens","availableTokens","safeMaxTokens","getSafeModeTokenCeiling","SAFE_MODE_TOKEN_CEILING_FALLBACK","kept","removed","tokens","estimate","isInteger","reverse","removedCount","totalTokens","agent","recordLlmTokenUsage","MIN_TOP_P","SYSTEM_PROMPT","AGENT_METADATA","kind","plannerAssistantSuggestionSchema","summary","nullable","schedule","optional","plannerAssistantPlanSchema","sanitizedPrompt","prompt","suggestions","safety","temperature","toolChoice","maxToolCalls","int","nonnegative","topP","tokenBudget","PlannerAssistantError","Error","toSuggestionId","DISABLED_FLAG_VALUES","normalizeFlag","resolveFlag","primary","secondary","SAFE_MODE_FALLBACK","plannerAssistantRequestSchema","focusDate","suggestionLimit","positive","planWithAssistantAction","resolvePlannerAssistantSafeMode","server","NEXT_PUBLIC_SAFE_MODE","client","active","ok","safeParse","success","issues","formatValidationIssues","data","plan","planWithAssistant","sanitizePrompt","maxLength","allowMarkup","resolvedMaxLength","line","trimEnd","truncated","unicodeTruncate","segments","sanitizeText","applyModelSafety","toolChoiceConfig","config","normalizeTemperature","DEFAULT_TEMPERATURE","clamped","MIN_TEMPERATURE","MAX_TEMPERATURE","normalizeTopP","MAX_TOP_P","normalizeToolChoice","normalizedMode","normalizedMax","normalizeMaxToolCalls","rounded","safeTemperature","safeToolMax","safeModeEnabled","isSafeModeFlagEnabled","budget","enforceTokenBudget","restOptions","DEFAULT_MAX_TOKENS","finalPrompt","DEFAULT_RESPONSE_RESERVE","userMessage","splitSegments","candidateLines","requestedLimit","limit","SAFE_MODE_SUGGESTION_LIMIT","deduplicateSuggestions","DEFAULT_SUGGESTION_LIMIT","seen","rawSuggestions","suggestion","synthesiseSuggestion","text","toSchedule","validation","guardResponse","schema","parse","reportSchemaValidationFailure","pathText","cause","PlannerCreationDialog","open","onClose","titleId","descriptionId","summaryId","mountedRef","dialogRef","useDialogTrap","createPortal","aria-hidden","NeoCard","aria-modal","aria-details","Plus","SEGMENT_OPTIONS","PlannerFab","createProject","createTask","usePlannerActions","setOpen","setMode","inputValue","setInputValue","setError","assistantPlan","setAssistantPlan","assistantError","setAssistantError","assistantSafeMode","setAssistantSafeMode","assistantLoading","startAssistantTransition","textareaRef","assistantRequestIdRef","aiHeadingId","aiDisclosureId","targetIso","focusProjects","frame","window","requestAnimationFrame","preventScroll","cancelAnimationFrame","recurringSuggestions","buildRecurringOccurrences","count","toSafeDate","occurrences","dayCursor","iterations","maxIterations","searchWeeks","intervalsNeeded","occurrencesPerInterval","addMonths","months","originalDay","setMonth","daysInMonth","addYears","years","summaryText","openSheet","closeSheet","handle","metaKey","ctrlKey","shiftKey","addEventListener","removeEventListener","handleSubmit","isoOverride","sourceProject","clonedId","createdTaskId","handleSubmitEvent","handleKeyDown","handleAskAssistant","requestId","describeAssistantError","projectItems","hasRecurringSuggestions","showAiSuggestions","fieldset","legend","Label","Textarea","resize","rows","textareaClassName","Select","CalendarClock","Sparkles","Bot","scheduleText","formatSchedule","letter","toUpperCase","Loader2","useWeekData","weekDone","weekTotal","per","record","total","parseSampleRate","sentryLog","observabilityLogger","child","captureLog","rawDsn","NEXT_PUBLIC_SENTRY_DSN","SENTRY_DSN","rawEnvironment","NEXT_PUBLIC_SENTRY_ENVIRONMENT","SENTRY_ENVIRONMENT","rawSampleRate","NEXT_PUBLIC_SENTRY_TRACES_SAMPLE_RATE","SENTRY_TRACES_SAMPLE_RATE","sentryEnabled","hasInitialized","initializationPromise","isTestEnv","cachedSentry","tracesSampleRate","loadSentry","then","sentry","init","dsn","environment","replaysSessionSampleRate","replaysOnErrorSampleRate","profilesSampleRate","catch","finally","captureException","captureError","boundaryLog","reportBoundaryError","boundary","info","extra","boundaryTags","boundaryExtra","WeekSummary","showLabel","bleed","weekDays","stats","doneAll","totalAll","rangeLabel","formatWeekDay","completionDescription","completionContent","completionBadge","inlineHeader","tiles","empty","friendlyDay","countsLabel","data-today","actions","isPlainObject","normalizeChangedList","DaysContext","FocusContext","SelectionContext","PlannerStateContext","PlannerRemindersContext","PlannerProviderInner","rawDays","setRawDays","decode","setFocus","selectedState","setSelectedState","setToday","goalList","setGoalList","decodeGoals","goalErr","setGoalErr","lastDeletedGoal","setLastDeletedGoal","goalUndoTimer","hydrated","setHydrated","setTasksById","tasksByIdRef","rawDaysRef","localToday","HYDRATION_TODAY","markHydrated","clearTimeout","addGoal","metric","pillar","trimmedTitle","normalizedTitle","goal","ACTIVE_CAP","nextGoal","toggleGoalDone","activeCount","found","targetWasDone","nextDone","removeGoal","setTimeout","clearGoals","updateGoal","updated","findIndex","hasTitleUpdate","duplicate","goalIndex","didChange","trimmedMetric","trimmedNotes","undoRemoveGoal","cancelled","scheduleNextTick","updateForNewDay","nextToday","prevFocus","prevToday","timeoutId","delay","cleanupSelections","is","setDays","explicitChanges","currentTasksById","extractDaysUpdate","update","resolved","action","prunedDays","impactedIsos","newIsos","removedIsos","hadPrev","hasNext","prevRecord","nextRecord","isNewIso","pointerChanged","explicitlyChanged","nextUpdates","nextTasks","nextRemovals","nextMap","prevMap","mutatedMap","daysValue","selectionValue","normalizedIso","weekRangeFromISO","getDayFocus","updateDayFocus","applyFocusToDay","getNote","updateNote","applyNotesToDay","goalsValue","goals","err","setErr","lastDeleted","toggleDone","undoRemove","plannerValue","setIso","getFocus","updateFocus","ctx","useFocus","useSelection","usePlannerReminders","list","dateIso","pending","shownTasks","contentClassName","fallbackClassName","ol","article","h3","TodayHero","isoActive","viewIso","useEffect","selProjectId","setSelProjectId","setSelTaskId","selectedProjectName","useMemo","scopedTasks","heroProgressLabel","projectState","useTodayHeroProjects","taskState","useTodayHeroTasks","projectName","setSelectedTaskId","TodayHeroHeader","GlitchProgress","showPercentage","trackClassName","percentageClassName","TOKEN_WIDTH_CLASS","TodayHeroProjects","projectsListId","editingProjectId","editingProjectName","showAllProjects","visibleProjects","hiddenProjectsCount","shouldShowProjectToggle","onProjectNameChange","handleProjectNameChange","onProjectFormSubmit","handleProjectFormSubmit","onProjectSelect","handleProjectSelect","onProjectToggle","handleProjectToggle","onProjectDelete","handleProjectDelete","onProjectEditOpen","openProjectEditor","onProjectRenameChange","handleProjectRenameChange","onProjectRenameCommit","commitProjectRename","onProjectRenameCancel","cancelProjectRename","onToggleShowAllProjects","toggleShowAllProjects","TodayHeroTasks","tasksListId","taskInputName","visibleTasks","totalTaskCount","showAllTasks","shouldShowTaskToggle","editingTaskId","editingTaskText","taskAnnouncementText","onTaskFormSubmit","handleTaskFormSubmit","onTaskSelect","handleTaskSelect","onTaskToggle","handleTaskToggle","onTaskDelete","handleTaskDelete","onTaskEditOpen","openTaskEditor","onTaskRenameChange","handleTaskRenameChange","onTaskRenameCommit","commitTaskRename","onTaskRenameCancel","cancelTaskRename","onToggleShowAllTasks","toggleShowAllTasks","heroId","aside","WeekNotes","dayIso","WeekPickerShellTotals","displayName","WeekPickerShellChips","WeekPickerShellControls","WeekPickerShellBase","WeekPickerShell","props","totals","chips","controls","remainder","forEach","hasTopRow","slot","slotId","assign","Totals","Chips","Controls","useDayNotes","createDayTextFieldHook","selectValue","applyValue","applyNotes","scheduleSavingReset","colorTokens","diameter","stroke","ringTokenMap","ringEntries","ringFallbacks","inset","getRingMetrics","overrides","diameterFallback","strokeFallback","insetFallback","radiusEntries","radiusTokens","startIndex","depth","char","endIndex","resolveCssNumber","computedStyle","numeric","startsWith","endsWith","extracted","extractBalancedSubstring","openIndex","inner","hasFallback","variable","nextSeen","referenced","sanitized","lowerBody","varOpen","extractedVar","resolvedVar","rawVar","calcOpen","extractedCalc","nestedValue","cleaned","Function","LEGACY_PROJECTS_KEY","LEGACY_TASKS_KEY","activeFocus","legacyMigratedRef","applyDaysUpdate","updater","readLocal","migrateLegacy","legacy","removeLocal","fn","setDay","setDayFocus","restCrud","select","LEAD_OPTIONS","VALID_LEAD_MINUTES","DEFAULT_TIME","TaskReminderSettings","availableReminders","activeReminder","defaultReminderId","setDefaultReminderId","defaultTime","setDefaultTime","defaultLeadMinutes","setDefaultLeadMinutes","localeCompare","isEnabled","advancedDisclosureButtonId","advancedDisclosurePanelId","previousAdvancedState","previousIsEnabled","suppressNextCloseSync","previousTaskId","areAdvancedOptionsOpen","setAreAdvancedOptionsOpen","reminderTime","leadMinutesRaw","selectedTaskLabel","previous","nextOpen","fallbackLead","handleToggle","fallbackId","fallbackTime","enable","side","handleAdvancedDisclosureToggle","handleReminderSelect","handleTimeChange","handleLeadChange","noReminders","Toggle","leftLabel","rightLabel","aria-expanded","AnimatedSelect","ariaLabel","currentIso","d","showAllTasksState","setShowAllTasksState","useState","setEditingTaskId","setEditingTaskText","taskAnnouncement","setTaskAnnouncement","toggleMarker","prevProjectIdRef","useRef","prevTasksRef","Map","TASK_PREVIEW_LIMIT","useCallback","elements","namedItem","rawValue","fallbackTitle","currentTasksMap","prevTasksMap","projectSuffix","prevTask","get","callback","queueMicrotask","isEditing","defaultPrevented","TASK_OPTION_GUARD_SELECTOR","data-task-option-guard","autoFocus","uniqueId","noiseFilterId","ringSize","metrics","DEFAULT_RING_SIZE","resolvedSize","strokeWidth","radius","trackInset","circumference","PI","svg","viewBox","focusable","defs","RingNoiseDefs","circle","cx","cy","r","fill","strokeLinecap","strokeDasharray","strokeDashoffset","DayCardHeader","projectCount","formattedIsoLabel","formatIsoLabel","headerText","pctNum","data-text","poseConfigs","duo","angel","demon","stageClassName","figureId","angelId","demonId","AvatarFrame","innerClassName","ScrollTopFloatingButton","watchRef","forceVisible","visible","setVisible","setTarget","watchedElement","supportsIntersectionObserver","obs","IntersectionObserver","isIntersecting","unobserve","scrollTop","scrollTo","top","behavior","ArrowUp","newProjectInputId","newProjectHelpId","activeProjectOptionId","aria-activedescendant","isSelected","optionId","aria-selected","PROJECT_OPTION_GUARD_SELECTOR","data-project-option-guard","ClientErrorBoundary","getDerivedStateFromError","componentDidCatch","componentStack","render","renderFallback","resetKey","state","reset","handleReset","setState","fallbackIso","dateRef","openPicker","el","showPicker","handleChange","HEADER_TITLE","Calendar","dmy","DateTimeFormat","chipDisplayFormatter","chipAccessibleFormatter","CHIP_SURFACE_CARD","DayChip","onNavigate","onFocus","displayLabel","formatChipDisplayLabel","dt","format","accessibleLabel","formatChipAccessibleLabel","completionRatio","ratio","surface","completionSurfaceClass","completionTextClass","CHIP_SURFACE_SUCCESS","CHIP_SURFACE_ACCENT_MED","CHIP_SURFACE_ACCENT_LIGHT","instructionsId","countsId","instructionsText","describedBy","data-active","data-chip-label","aria-atomic","accessibleRange","chipRefs","findSelectedIndex","selectedIndex","focusIndex","setFocusIndex","initialIndex","focusChip","nextIso","handleNavigate","currentIndex","direction","nextIndex","showTop","setShowTop","frameId","onScroll","atTop","scrollY","passive","selectOnly","jumpToDay","getElementById","HTMLElement","scrollIntoView","block","inline","jumpToTop","focusTarget","prevWeek","nextWeek","jumpToday","isTodayFocused","topAction","ArrowUpToLine","Hero","rail","dividerTint","ChevronLeft","ChevronRight","VIEWPORT_SIZE_CLASS_NAMES","minHTasks","maxHTasks","maxHProjects","PlannerListPanel","renderComposer","renderEmpty","renderList","isEmpty","viewportClassName","viewportInsetClassName","viewportSize","viewportProps","viewportPropsClassName","restViewportProps","viewportSizeClasses","viewportSizeTokens","composer","gradientNoiseOpacity","numberPattern","parsedGradientNoiseOpacity","defaultSlope","defaultTable","freeze","clampNumber","parseNumbers","parseNumber","first","getComputedValue","tokensToFilter","slope","numericSlope","FILTER_SLOPE_TOKEN","table","numericTable","FILTER_TABLE_TOKEN","stdDeviation","numericStdDeviation","FILTER_STD_DEVIATION_TOKEN","gradientNoiseOpacityToken","gradientNoiseOpacityCssFallback","themeBackground","bg","filterValues","setFilterValues","svgNumericFilters","slopeValue","x","filterUnits","colorInterpolationFilters","feTurbulence","baseFrequency","numOctaves","seed","feColorMatrix","in","values","feComponentTransfer","feFuncA","feBlend","in2","ProjectList","setEditingProjectId","setEditingProjectName","draftProject","setDraftProject","projectRefs","projectsScrollable","multiple","projectListEmpty","registerProjectRef","node","delete","focusProjectRadio","addProjectCommit","commitRename","fallbackName","nextName","editingProject","onRowKey","idx","nextId","prevId","EmptyRow","isDisabled","isLoading","isRowInactive","blockInteraction","handleRowKey","projectLabel","aria-checked","data-disabled","data-loading","PROJECT_ROW_GUARD_SELECTOR","data-project-row-guard","was","usageStore","aggregateTokens","normalizeText","metadata","normalizedMetadata","normalizeMetadata","normalizedId","normalizedLabel","normalizedKind","normalizedTokens","normalizeTokenCount","previousTokens","mergedMetadata","incoming","mergeMetadata","PLANNER_SCROLL_STORAGE_KEY","stored","sessionStorage","getItem","handleScroll","setItem","handlePageHide","dayItems","heroRef","layoutGridClassName","DEFAULT_DESCRIPTOR","ROTATING_DESCRIPTORS","componentId","charCodeAt","secondaryText","isRotating","primaryClassName","toneClassName","data-placeholder-tone","data-placeholder-variant","data-placeholder-layer","data-placeholder-size","data-placeholder-primary","data-placeholder-descriptor","data-placeholder-layer-secondary","applyFocus","defaultScheduleSavingReset","useDayTextField","persistedValue","applyForIso","setSaving","scheduleSavingResetRef","decodeGoal","setProjectName","setShowAllProjects","PROJECT_PREVIEW_LIMIT","isSelectedVisible","setNotes","dayAddProject","dayRenameProject","dayToggleProject","dayRemoveProject","dayAddTask","dayRenameTask","dayToggleTask","dayRemoveTask","dayAddTaskImage","dayRemoveTaskImage","dayUpdateTaskReminder","setNotesForDay","setFocusForDay","shortDate","LOCALE","weekDayFormatter","weekRangeLabelFormatter","weekRangeMonthFormatter","weekRangeDayFormatter","isoLabelWeekdayFormatter","isoLabelMonthFormatter","isoLabelDayFormatter","isISODate","m","toLocaleUpperCase","ts","n","formatMmSs","padMinutes","safeValue","totalSeconds","baseSeconds","ss","seconds","parseMmSs","normalizeDate","maybeISO","mondayStartOfWeek","diff","sundayEndOfWeek","formatRange","sameMonth","startDay","endDay","startLabel","endLabel","removeTaskImageForDay","selectedTaskId","selectedTask","handleCreateProject","handleCreateTask","handleReminderChange","TaskList","draftTask","setDraftTask","newTaskInputId","tasksForSelected","ids","hasSelectedProject","PlannerIslandFallback","onRetry","reportPlannerIslandError","island","digest","weekdayFormatter","focusMonth","calendar","firstOfMonth","weeks","weekIndex","dayIndex","weekdayLabels","_","thead","tr","th","scope","tbody","dayDate","inMonth","td"],"sourceRoot":"","ignoreList":[]}