/* =========================================================
   Theme tokens + per-theme glitch backdrops
   ========================================================= */

/* ---------- Tokens (dark base) ---------- */
:root {
  --background: 267 82% 2%;
  --foreground: 240 100% 98%;
  --card: 259 44% 7%;
  --border: 256 44% 22%;
  --input: 258 45% 10%;
  --ring: 267 100% 65%;
  --primary: 267 100% 65%;
  --primary-foreground: 0 0% 100%;
  --primary-soft: 267 100% 23%;
  --accent: 314 100% 61%;
  --accent-2: 186 100% 50%;
  --accent-foreground: 0 0% 100%;
  --accent-soft: 314 100% 21%;
  --glow: 292 84% 61%;
  --ring-muted: 256 44% 22%;
  --danger: 355 100% 59%;
  --muted: 264 36% 15%;
  --muted-foreground: 249 47% 77%;
  --surface: 259 44% 9%;
  --surface-2: 259 44% 13%;
  --shadow-color: 267 100% 65%;
  --lav-deep: 292 84% 61%;
  --success: 153 100% 50%;
  --success-glow: 153 100% 32% / 0.6;
  --accent-overlay: hsl(var(--accent));
  --ring-contrast: hsl(var(--ring));
  --glow-active: hsl(var(--glow));
  --text-on-accent: hsl(var(--foreground));

  /* Default button tones */
  --neon: var(--glow);
  --neon-soft: hsl(var(--neon));
  --btn-bg: transparent;
  --btn-fg: hsl(var(--foreground));

  /* Hairlines, radii, motion, control geometry, gradients */
  /* Fallback (works everywhere) */
  --card-hairline: hsl(var(--border));

  --hairline-w: 1px;
  --radius-1: 8px; --radius-2: 12px; --radius-3: 16px;
  --radius-card: var(--radius-3);
  --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
  --ease-snap: cubic-bezier(0.2, 0.8, 0.2, 1);
  --dur-quick: 140ms; --dur-chill: 220ms; --dur-slow: 420ms;
  --control-h: 42px; --control-radius: var(--radius-3);
  --control-fs: 0.9rem; --control-px: 1rem;

  --edge-iris: conic-gradient(
    from 180deg,
    hsl(267 100% 65% / 0),
    hsl(267 100% 65% / 0.7),
    hsl(186 100% 50% / 0.7),
    hsl(292 84% 61% / 0.7),
    hsl(267 100% 65% / 0)
  );
  --seg-active-grad: linear-gradient(
    90deg,
    hsl(267 100% 65% / 0.95),
    hsl(314 100% 61% / 0.95),
    hsl(186 100% 50% / 0.95)
  );
  --shadow: 0 10px 30px hsl(267 30% 2% / 0.35);
}

/* Upgrade tokens when color-mix(oklab) is supported */
@supports (color: color-mix(in oklab, white, black)) {
  :root {
    --accent-overlay: color-mix(in oklab, hsl(var(--accent)) 60%, transparent);
    --ring-contrast: color-mix(in oklab, hsl(var(--ring)) 70%, hsl(var(--background)) 30%);
    --glow-active: color-mix(in oklab, hsl(var(--glow)) 50%, transparent);
    --neon-soft: color-mix(in oklab, hsl(var(--neon)) 50%, transparent);
    --card-hairline: color-mix(
      in oklab,
      hsl(var(--border)) 82%,
      hsl(var(--accent)) 18%
    );
  }
}

/* Upgrade contrast token when color-contrast is supported */
@supports (color: color-contrast(white vs black)) {
  :root {
    --text-on-accent: color-contrast(var(--accent-overlay) vs hsl(var(--foreground)), hsl(var(--background)));
  }
}

/* Retina half-pixel hairlines when available */
@supports (border: 0.5px solid transparent) {
  :root { --hairline-w: 0.5px; }
}

/* ---------- Light ---------- */
html.light {
  --background: 0 0% 100%;
  --foreground: 240 10% 10%;
  --card: 0 0% 100%;
  --border: 240 9% 90%;
  --input: 240 9% 97%;
  --ring: 267 100% 65%;
  --primary: 267 100% 65%;
  --primary-foreground: 0 0% 100%;
  --primary-soft: 267 100% 99%;
  --accent: 314 100% 46%;
  --accent-2: 186 100% 50%;
  --accent-foreground: 0 0% 100%;
  --accent-soft: 314 100% 94%;
  --glow: 292 84% 46%;
  --ring-muted: 240 9% 90%;
  --danger: 355 100% 54%;
  --muted: 240 6% 96%;
  --muted-foreground: 240 4% 35%;
  --surface: 240 7% 98%;
  --surface-2: 240 6% 96%;
  --shadow-color: 267 100% 65%;
  --lav-deep: 292 84% 61%;
  --success: 153 100% 42%;
  --success-glow: 153 100% 30% / 0.55;
}

/* ---------- Glitch v2 ---------- */
html.theme-glitch2 {
  --background: 251 100% 4%;
  --foreground: 240 47% 97%;
  --card: 254 64% 8%;
  --border: 252 41% 28%;
  --input: 255 66% 10%;
  --ring: 170 100% 50%;
  --primary: 170 100% 50%;
  --primary-foreground: 0 0% 100%;
  --primary-soft: 170 100% 8%;
  --accent: 300 100% 58%;
  --accent-2: 267 100% 58%;
  --accent-soft: 300 100% 18%;
  --muted: 256 42% 18%;
  --muted-foreground: 264 71% 80%;
  --ring-muted: 252 41% 28%;
  --danger: 337 100% 56%;
  --shadow-color: 170 100% 50%;
  --lav-deep: 170 100% 50%;
  --success: 165 100% 50%;
  --success-glow: 165 100% 32% / 0.6;
  --glow: 170 100% 50%;
  --edge-iris: conic-gradient(
    from 180deg,
    hsl(170 100% 50% / 0),
    hsl(170 100% 50% / 0.7),
    hsl(267 100% 58% / 0.7),
    hsl(170 100% 50% / 0.7),
    hsl(170 100% 50% / 0)
  );
  --seg-active-grad: linear-gradient(
    90deg,
    hsl(170 100% 50% / 0.95),
    hsl(300 100% 58% / 0.95),
    hsl(267 100% 58% / 0.95)
  );
  --shadow: 0 10px 30px hsl(251 30% 2% / 0.3);
}

/* ---------- Citrus ---------- */
html.theme-citrus {
  /* Dark Citrus palette */
  --background: 30 100% 2%;
  --foreground: 49 100% 96%;
  --card: 23 100% 5%;
  --border: 30 100% 13%;
  --input: 28 100% 7%;
  --ring: 41 100% 50%;
  --primary: 41 100% 50%;
  --primary-foreground: 0 0% 100%;
  --primary-soft: 41 100% 8%;
  --accent: 22 100% 50%;
  --accent-2: 50 100% 50%;
  --accent-soft: 22 100% 10%;
  --muted: 35 100% 9%;
  --muted-foreground: 36 100% 80%;
  --ring-muted: 30 100% 13%;
  --danger: 12 100% 50%;
  --shadow-color: 41 100% 50%;
  --lav-deep: 22 100% 50%;
  --success: 144 100% 50%;
  --success-glow: 144 100% 32% / 0.6;
  --glow: 22 100% 50%;
}

/* ---------- Noir ---------- */
html.theme-noir {
  --background: 0 0% 4%;
  --foreground: 0 0% 93%;
  --card: 0 0% 7%;
  --border: 0 0% 16%;
  --input: 0 0% 8%;
  --ring: 0 100% 59%;
  --primary: 0 100% 59%;
  --primary-foreground: 0 0% 100%;
  --primary-soft: 0 100% 17%;
  --accent: 0 100% 55%;
  --accent-2: 0 0% 90%;
  --accent-soft: 0 100% 15%;
  --muted: 0 0% 10%;
  --muted-foreground: 0 0% 61%;
  --ring-muted: 0 0% 16%;
  --danger: 3 100% 59%;
  --shadow-color: 0 100% 59%;
  --lav-deep: 349 100% 36%;
  --success: 144 64% 50%;
  --success-glow: 144 64% 32% / 0.6;
  --glow: 349 100% 36%;
}

/* ---------- Oceanic ---------- */
html.theme-ocean {
  --background: 218 93% 6%;
  --foreground: 204 100% 97%;
  --card: 211 81% 15%;
  --border: 204 60% 27%;
  --input: 216 72% 18%;
  --ring: 195 100% 50%;
  --primary: 195 100% 50%;
  --primary-foreground: 0 0% 100%;
  --primary-soft: 195 100% 8%;
  --accent: 167 100% 50%;
  --accent-2: 350 100% 63%;
  --accent-soft: 167 100% 10%;
  --muted: 208 68% 21%;
  --muted-foreground: 197 58% 71%;
  --ring-muted: 204 60% 27%;
  --danger: 350 100% 63%;
  --shadow-color: 195 100% 50%;
  --lav-deep: 195 100% 50%;
  --success: 158 100% 50%;
  --success-glow: 158 100% 32% / 0.6;
  --glow: 195 100% 50%;
}

/* ---------- Rose Quartz ---------- */
html.theme-rose {
  --background: 327 100% 4%;
  --foreground: 341 100% 96%;
  --card: 324 100% 8%;
  --border: 326 100% 16%;
  --input: 328 100% 9%;
  --ring: 337 100% 55%;
  --primary: 337 100% 55%;
  --primary-foreground: 0 0% 100%;
  --primary-soft: 337 100% 13%;
  --accent: 338 100% 45%;
  --accent-2: 330 100% 65%;
  --accent-soft: 338 100% 5%;
  --muted: 330 49% 17%;
  --muted-foreground: 339 100% 88%;
  --ring-muted: 326 100% 16%;
  --danger: 346 100% 58%;
  --shadow-color: 337 100% 55%;
  --lav-deep: 337 100% 55%;
  --success: 160 100% 50%;
  --success-glow: 160 100% 32% / 0.6;
  --glow: 337 100% 55%;
}

/* =========================================================
   Per-theme glitch backdrops
   ========================================================= */

/* Default Lavender-Glitch backdrop:
   Applies if youâ€™re on theme-lg (both light & dark) OR no theme class. */
html.theme-lg body,
html.theme-lg-dark body,
html.theme-lg-light body,
html:not(.theme-citrus):not(.theme-noir):not(.theme-ocean):not(.theme-rose):not(.theme-glitch2) body {
  background-image:
    radial-gradient(1200px 700px at 18% -10%, hsl(262 83% 58% / 0.16), transparent 60%),
    radial-gradient(1100px 600px at 110% 18%, hsl(192 90% 50% / 0.14), transparent 60%),
    radial-gradient(900px 480px at 50% 120%, hsl(320 85% 60% / 0.1), transparent 65%);
  background-attachment: fixed, fixed, fixed;
}
html.theme-lg body::before,
html.theme-lg-dark body::before,
html.theme-lg-light body::before,
html:not(.theme-citrus):not(.theme-noir):not(.theme-ocean):not(.theme-rose):not(.theme-glitch2) body::before {
  content: ""; position: fixed; inset: 0; pointer-events: none; z-index: 0; opacity: 0.1;
  background:
    repeating-linear-gradient(90deg, hsl(var(--accent)) 0 1px, transparent 1px 26px),
    repeating-linear-gradient(0deg,  hsl(var(--accent)) 0 1px, transparent 1px 26px);
  mix-blend-mode: screen; animation: lg-grid-drift 18s linear infinite;
}
html.theme-lg body::after,
html.theme-lg-dark body::after,
html.theme-lg-light body::after,
html:not(.theme-citrus):not(.theme-noir):not(.theme-ocean):not(.theme-rose):not(.theme-glitch2) body::after {
  content: ""; position: fixed; inset: -10%; pointer-events: none; z-index: 0;
  background:
    radial-gradient(60% 40% at 10% 0%,   hsl(262 83% 58% / 0.2), transparent 60%),
    radial-gradient(50% 35% at 100% 5%,  hsl(192 90% 50% / 0.18), transparent 60%),
    radial-gradient(55% 35% at 50% 120%, hsl(320 85% 60% / 0.14), transparent 65%),
    radial-gradient(120% 100% at 50% 100%, hsl(0 0% 0% / 0.35), transparent 70%);
  filter: blur(2px) saturate(110%);
  animation: lg-aurora-pan 24s ease-in-out infinite alternate;
}

/* Glitch v2 backdrop */
html.theme-glitch2 body {
  background-image:
    radial-gradient(1000px 600px at 20% -10%, hsl(268 70% 66% / 0.2), transparent 60%),
    linear-gradient(180deg, hsl(var(--card)), hsl(var(--background)));
  background-attachment: fixed, fixed;
}
html.theme-glitch2 body::before,
html.theme-glitch2 body::after {
  content: none;
}

/* Citrus backdrop */
html.theme-citrus body {
  background-image:
    radial-gradient(1200px 700px at 20% -10%, hsl(33 92% 58% / 0.22), transparent 60%),
    radial-gradient(1200px 600px at 120% 10%, hsl(188 75% 55% / 0.18), transparent 60%),
    linear-gradient(180deg, hsl(var(--card)), hsl(var(--background)));
  background-attachment: fixed, fixed, fixed;
}
html.theme-citrus body::before {
  content: ""; position: fixed; inset: 0; pointer-events: none; z-index: 0; opacity: 0.08;
  background:
    repeating-linear-gradient(90deg, hsl(33 92% 58% / 0.25) 0 1px, transparent 1px 26px),
    repeating-linear-gradient(0deg,  hsl(188 75% 55% / 0.25) 0 1px, transparent 1px 26px);
  mix-blend-mode: screen; animation: citrus-grid 20s linear infinite;
}
html.theme-citrus body::after {
  content: ""; position: fixed; inset: -8%; pointer-events: none; z-index: 0;
  background:
    radial-gradient(60% 40% at 12% -5%,  hsl(33 92% 58% / 0.18), transparent 60%),
    radial-gradient(50% 35% at 105% 10%, hsl(188 75% 55% / 0.16), transparent 60%),
    radial-gradient(55% 35% at 50% 110%, hsl(150 70% 45% / 0.12), transparent 65%);
  filter: blur(2px) saturate(110%); animation: citrus-pan 28s ease-in-out infinite alternate;
}
@keyframes citrus-grid { to { transform: translate3d(26px, 26px, 0); } }
@keyframes citrus-pan {
  0%   { transform: translate3d(-1%, -1%, 0) scale(1.01); opacity: .95; }
  50%  { transform: translate3d( 1%,  0%, 0) scale(1.00); opacity: 1; }
  100% { transform: translate3d( 2%,  1%, 0) scale(1.01); opacity: .95; }
}

/* Noir backdrop */
html.theme-noir body {
  background-image:
    radial-gradient(1000px 520px at 15% -10%, hsl(0 0% 100% / 0.06), transparent 60%),
    radial-gradient(900px 520px at 110% 15%, hsl(0 0% 100% / 0.05), transparent 60%),
    linear-gradient(180deg, hsl(var(--card) / 0.9), hsl(var(--background)));
  background-attachment: fixed, fixed, fixed;
}
html.theme-noir body::before {
  content: ""; position: fixed; inset: 0; pointer-events: none; z-index: 0;
  background: repeating-linear-gradient(0deg, hsl(0 0% 100% / 0.045) 0 1px, transparent 1px 3px);
  mix-blend-mode: soft-light; opacity: 0.25; animation: noir-scan 14s linear infinite;
}
html.theme-noir body::after {
  content: ""; position: fixed; inset: -12%; pointer-events: none; z-index: 0;
  background:
    radial-gradient(80% 60% at 50% 120%, hsl(0 0% 0% / 0.4), transparent 70%),
    radial-gradient(40% 25% at 6% 4%,  hsl(260 60% 60% / 0.12), transparent 60%),
    radial-gradient(40% 25% at 94% 10%, hsl(320 60% 55% / 0.10), transparent 60%);
  filter: blur(1.5px) saturate(105%); opacity: 0.9; animation: noir-drift 26s ease-in-out infinite alternate;
}
@keyframes noir-scan { 0%{background-position-y:0} 100%{background-position-y:100%} }
@keyframes noir-drift { 0%{transform:translate3d(-1%,0,0)} 100%{transform:translate3d(1%,0,0)} }

/* Oceanic backdrop */
html.theme-ocean body {
  background-image:
    radial-gradient(1200px 700px at 12% -12%, hsl(195 85% 55% / 0.20), transparent 60%),
    radial-gradient(1100px 600px at 108% 16%, hsl(190 90% 55% / 0.16), transparent 60%),
    linear-gradient(180deg, hsl(var(--card) / 0.9), hsl(var(--background)));
  background-attachment: fixed, fixed, fixed;
}
html.theme-ocean body::before {
  content:""; position:fixed; inset:0; z-index:0; pointer-events:none;
  background:
    repeating-linear-gradient(90deg, hsl(195 85% 55% / 0.28) 0 1px, transparent 1px 26px),
    repeating-linear-gradient(0deg,  hsl(225 85% 60% / 0.22) 0 1px, transparent 1px 26px);
  mix-blend-mode: screen; opacity:.10; animation: lg-grid-drift 20s linear infinite;
}
html.theme-ocean body::after {
  content:""; position:fixed; inset:-10%; z-index:0; pointer-events:none;
  background:
    radial-gradient(60% 40% at 14% -6%, hsl(195 85% 55% / 0.18), transparent 60%),
    radial-gradient(55% 35% at 50% 114%, hsl(225 85% 60% / 0.12), transparent 65%),
    radial-gradient(50% 35% at 102% 8%,  hsl(160 70% 45% / 0.10), transparent 60%);
  filter: blur(2px) saturate(112%); animation: ocean-pan 26s ease-in-out infinite alternate;
}
@keyframes ocean-pan {
  0% { transform: translate3d(-1%, -1%, 0) scale(1.01); opacity:.95; }
  50%{ transform: translate3d( 1%,  0%, 0) scale(1.00); opacity:1; }
 100% { transform: translate3d( 2%,  1%, 0) scale(1.01); opacity:.95; }
}

/* Rose Quartz backdrop */
html.theme-rose body {
  background-image:
    radial-gradient(1100px 620px at 16% -8%,  hsl(325 80% 62% / 0.20), transparent 60%),
    radial-gradient(1000px 560px at 106% 14%, hsl(280 70% 60% / 0.16), transparent 60%),
    linear-gradient(180deg, hsl(var(--card) / 0.92), hsl(var(--background)));
  background-attachment: fixed, fixed, fixed;
}
html.theme-rose body::before {
  content:""; position:fixed; inset:0; z-index:0; pointer-events:none;
  background:
    repeating-linear-gradient(90deg, hsl(325 80% 62% / 0.30) 0 1px, transparent 1px 26px),
    repeating-linear-gradient(0deg,  hsl(280 70% 60% / 0.26) 0 1px, transparent 1px 26px);
  mix-blend-mode: screen; opacity:.10; animation: lg-grid-drift 18s linear infinite;
}
html.theme-rose body::after {
  content:""; position:fixed; inset:-10%; z-index:0; pointer-events:none;
  background:
    radial-gradient(60% 40% at 12% -6%, hsl(325 80% 62% / 0.18), transparent 60%),
    radial-gradient(55% 35% at 50% 116%, hsl(280 70% 60% / 0.12), transparent 65%),
    radial-gradient(50% 35% at 100% 8%,   hsl(200 80% 58% / 0.10), transparent 60%);
  filter: blur(2px) saturate(112%); animation: rose-pan 27s ease-in-out infinite alternate;
}
@keyframes rose-pan { 0% { transform: translate3d(-1%,-1%,0) } 100% { transform: translate3d(1%,1%,0) } }

/* Additional background options */
html.bg-alt1 body {
  background-image:
    radial-gradient(1000px 600px at 10% -10%, hsl(var(--accent) / 0.20), transparent 60%),
    radial-gradient(900px 500px at 110% 20%, hsl(var(--accent-2) / 0.18), transparent 60%),
    linear-gradient(180deg, hsl(var(--card)), hsl(var(--background)));
  background-attachment: fixed, fixed, fixed;
}
html.bg-alt1 body::before,
html.bg-alt1 body::after {
  content: none;
}

html.bg-alt2 body {
  background-image:
    radial-gradient(1000px 600px at 50% 0%, hsl(var(--primary) / 0.18), transparent 60%),
    radial-gradient(900px 500px at 50% 120%, hsl(var(--accent) / 0.16), transparent 60%),
    linear-gradient(180deg, hsl(var(--card)), hsl(var(--background)));
  background-attachment: fixed, fixed, fixed;
}
html.bg-alt2 body::before,
html.bg-alt2 body::after {
  content: none;
}

html.bg-light body {
  background-image:
    radial-gradient(1200px 700px at 50% -10%, hsl(var(--foreground) / 0.08), transparent 60%),
    radial-gradient(1000px 600px at 50% 120%, hsl(var(--accent) / 0.06), transparent 60%),
    linear-gradient(180deg, hsl(var(--card)), hsl(var(--background)));
  background-attachment: fixed, fixed, fixed;
}
html.bg-light body::before,
html.bg-light body::after {
  content: none;
}

html.bg-vhs body {
  background-color: #0b0f13;
  background-image:
    radial-gradient(circle at 20% 30%, rgba(70, 230, 255, 0.15), transparent 60%),
    repeating-linear-gradient(
      to bottom,
      rgba(150, 210, 225, 0.15),
      rgba(150, 210, 225, 0.15) 1px,
      transparent 1px,
      transparent 3px
    );
  background-blend-mode: screen;
}
html.bg-vhs body::before,
html.bg-vhs body::after {
  content: none;
}

html.bg-streak body {
  background-color: #1a1a24;
  background-image:
    radial-gradient(circle at 70% 40%, rgba(180, 100, 255, 0.25), transparent 40%),
    repeating-linear-gradient(
      to right,
      rgba(160, 60, 255, 0.2),
      rgba(160, 60, 255, 0.2) 6px,
      transparent 6px,
      transparent 20px
    );
  background-blend-mode: lighten;
}
html.bg-streak body::before,
html.bg-streak body::after {
  content: none;
}

/* ---------- Shared backdrop animations ---------- */
@keyframes lg-grid-drift { 0%{transform:translate3d(0,0,0)} 100%{transform:translate3d(26px,26px,0)} }
@keyframes lg-aurora-pan {
  0% { transform: translate3d(-2%,-1%,0) scale(1.02); opacity:.95; }
 50% { transform: translate3d( 1%, 0%,0) scale(1.01); opacity:1; }
100% { transform: translate3d( 2%, 1%,0) scale(1.02); opacity:.95; }
}

/* ---------- Intensity toggles (all themes) ---------- */
html.bg-intense body::before { opacity: 0.05; }
html.bg-intense body::after  { filter: blur(2px) saturate(120%); }

/* =========================================================
   Pretty Chroma Hairline (utility)
   =========================================================
   Usage: add class="pretty-border" to any container that should
   have a tinted, animated hairline that respects --card-hairline.
   No literal white is used for the border color itself.
*/
.pretty-border {
  position: relative;
  border-radius: var(--radius-card, 1rem);
  background-clip: padding-box;
  border: 1px solid hsl(var(--card-hairline));
  isolation: isolate;
}

/* Outer chroma ring (masked to the border box) */
.pretty-border::before {
  content: "";
  position: absolute;
  inset: -1px;
  padding: 1px;
  border-radius: inherit;
  pointer-events: none;
  background: conic-gradient(
    from 180deg,
    hsl(262 83% 58% / 0),
    hsl(262 83% 58% /.65),
    hsl(192 90% 50% /.65),
    hsl(320 85% 60% /.65),
    hsl(262 83% 58% / 0)
  );
  /* mask to only show the ring, not fill the card */
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite: xor;
          mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
          mask-composite: exclude;
  opacity: .55;
  animation:
    pb-hue 8s linear infinite,
    pb-jitter 2.4s steps(6,end) infinite;
}

/* Soft CRT scan overlay (uses foreground tint, not white) */
.pretty-border::after {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  pointer-events: none;
  background: repeating-linear-gradient(
    to bottom,
    hsl(var(--foreground) / .05) 0 1px,
    transparent 2px 3px
  );
  mix-blend-mode: soft-light;
  opacity: .18;
}

@keyframes pb-hue { to { filter: hue-rotate(360deg); } }
@keyframes pb-jitter {
  0%,100% { transform: translate(0,0); }
  25% { transform: translate(.25px,-.2px); }
  50% { transform: translate(-.2px,.25px); }
  75% { transform: translate(.15px,.15px); }
}
