/* =========================================================
   Per-theme glitch backdrops
   ========================================================= */

/* Default Lavender-Glitch backdrop:
   Applies if youâ€™re on theme-lg (both light & dark) OR no theme class. */
html.theme-lg body,
html.theme-lg-dark body,
html:not(.theme-citrus):not(.theme-noir):not(.theme-ocean):not(
    .theme-kitten
  ):not(.theme-aurora):not(.theme-hardstuck)
  body {
  background-image:
    radial-gradient(
      1200px 700px at 18% -10%,
      hsl(var(--backdrop-blob-1) / 0.16),
      transparent 60%
    ),
    radial-gradient(
      1100px 600px at 110% 18%,
      hsl(var(--backdrop-blob-2) / 0.14),
      transparent 60%
    ),
    radial-gradient(
      900px 480px at 50% 120%,
      hsl(var(--backdrop-blob-3) / 0.1),
      transparent 65%
    );
  background-attachment: fixed, fixed, fixed;
}

.page-backdrop__layer[data-variant="grid"] {
  --grid-line: max(var(--hairline-w), 1px);
  background-color: hsl(var(--grid-color) / var(--grid-alpha));
  mix-blend-mode: screen;
  opacity: 1;
  transform: translate3d(0, 0, 0);
  will-change: transform;
  -webkit-mask-image:
    repeating-linear-gradient(
      0deg,
      rgb(0 0 0 / 0.9) 0 var(--grid-line),
      transparent var(--grid-line) var(--grid-size)
    ),
    repeating-linear-gradient(
      90deg,
      rgb(0 0 0 / 0.9) 0 var(--grid-line),
      transparent var(--grid-line) var(--grid-size)
    );
  -webkit-mask-size:
    var(--grid-size) var(--grid-size),
    var(--grid-size) var(--grid-size);
  -webkit-mask-position: center;
  -webkit-mask-repeat: repeat;
  mask-image:
    repeating-linear-gradient(
      0deg,
      rgb(0 0 0 / 0.9) 0 var(--grid-line),
      transparent var(--grid-line) var(--grid-size)
    ),
    repeating-linear-gradient(
      90deg,
      rgb(0 0 0 / 0.9) 0 var(--grid-line),
      transparent var(--grid-line) var(--grid-size)
    );
  mask-size:
    var(--grid-size) var(--grid-size),
    var(--grid-size) var(--grid-size);
  mask-position: center;
  mask-repeat: repeat;
  mask-mode: alpha;
}

@supports not (mask-image: repeating-linear-gradient(0deg, #000 0 1px, transparent 1px 10px)) {
  .page-backdrop__layer[data-variant="grid"] {
    background-color: transparent;
    background-image:
      repeating-linear-gradient(
        0deg,
        hsl(var(--grid-color) / var(--grid-alpha)) 0 var(--grid-line),
        transparent var(--grid-line) var(--grid-size)
      ),
      repeating-linear-gradient(
        90deg,
        hsl(var(--grid-color) / var(--grid-alpha)) 0 var(--grid-line),
        transparent var(--grid-line) var(--grid-size)
      );
    background-size:
      var(--grid-size) var(--grid-size),
      var(--grid-size) var(--grid-size);
    background-position: center;
    background-repeat: repeat;
  }
}

@media (prefers-reduced-motion: no-preference) {
  .page-backdrop__layer[data-variant="grid"] {
    animation: decor-grid-drift 28s ease-in-out infinite alternate;
  }
}

@media (prefers-reduced-motion: reduce) {
  .page-backdrop__layer[data-variant="grid"] {
    animation: none;
  }
}

@keyframes decor-grid-drift {
  from {
    transform: translate3d(0, 0, 0);
  }

  to {
    transform: translate3d(
      calc(var(--grid-size) * 0.35),
      calc(var(--grid-size) * -0.2),
      0
    );
  }
}
html.theme-lg body::after,
html.theme-lg-dark body::after,
html:not(.theme-citrus):not(.theme-noir):not(.theme-ocean):not(
    .theme-kitten
  ):not(.theme-aurora):not(.theme-hardstuck)
  body::after {
  content: "";
  position: fixed;
  inset: -10%;
  pointer-events: none;
  z-index: 0;
  background:
    radial-gradient(
      60% 40% at 10% 0%,
      hsl(var(--backdrop-drip-1) / 0.2),
      transparent 60%
    ),
    radial-gradient(
      50% 35% at 100% 5%,
      hsl(var(--backdrop-drip-2) / 0.18),
      transparent 60%
    ),
    radial-gradient(
      55% 35% at 50% 120%,
      hsl(var(--backdrop-drip-3) / 0.14),
      transparent 65%
    ),
    radial-gradient(
      120% 100% at 50% 100%,
      hsl(var(--backdrop-drip-shadow) / 0.35),
      transparent 70%
    );
  filter: blur(2px) saturate(110%);
  animation: lg-aurora-pan 24s ease-in-out infinite alternate;
}

/* Aurora backdrop */
html.theme-aurora body {
  background-image:
    radial-gradient(
      1000px 600px at 20% -10%,
      hsl(var(--backdrop-blob-1) / 0.2),
      transparent 60%
    ),
    linear-gradient(180deg, hsl(var(--card)), hsl(var(--background)));
  background-attachment: fixed, fixed;
}
html.theme-aurora body::after {
  content: none;
}


/* Citrus backdrop */
html.theme-citrus body {
  background-image:
    radial-gradient(
      1200px 700px at 20% -10%,
      hsl(var(--backdrop-blob-1) / 0.22),
      transparent 60%
    ),
    radial-gradient(
      1200px 600px at 120% 10%,
      hsl(var(--backdrop-blob-2) / 0.18),
      transparent 60%
    ),
    linear-gradient(180deg, hsl(var(--card)), hsl(var(--background)));
  background-attachment: fixed, fixed, fixed;
}
html.theme-citrus body::after {
  content: "";
  position: fixed;
  inset: -8%;
  pointer-events: none;
  z-index: 0;
  background:
    radial-gradient(
      60% 40% at 12% -5%,
      hsl(var(--backdrop-drip-1) / 0.18),
      transparent 60%
    ),
    radial-gradient(
      50% 35% at 105% 10%,
      hsl(var(--backdrop-drip-2) / 0.16),
      transparent 60%
    ),
    radial-gradient(
      55% 35% at 50% 110%,
      hsl(var(--backdrop-drip-3) / 0.12),
      transparent 65%
    );
  filter: blur(2px) saturate(110%);
  animation: citrus-pan 28s ease-in-out infinite alternate;
}
@keyframes citrus-pan {
  0% {
    transform: translate3d(-1%, -1%, 0) scale(1.01);
    opacity: 0.95;
  }
  50% {
    transform: translate3d(1%, 0%, 0) scale(1);
    opacity: 1;
  }
  100% {
    transform: translate3d(2%, 1%, 0) scale(1.01);
    opacity: 0.95;
  }
}

/* Noir backdrop */
html.theme-noir body {
  background-image:
    radial-gradient(
      1000px 520px at 15% -10%,
      hsl(var(--backdrop-blob-1) / 0.15),
      transparent 60%
    ),
    radial-gradient(
      900px 520px at 110% 15%,
      hsl(var(--backdrop-blob-2) / 0.12),
      transparent 60%
    ),
    linear-gradient(180deg, hsl(var(--card) / 0.9), hsl(var(--background)));
  background-attachment: fixed, fixed, fixed;
}
html.theme-noir body::after {
  content: "";
  position: fixed;
  inset: -12%;
  pointer-events: none;
  z-index: 0;
  background:
    radial-gradient(
      80% 60% at 50% 120%,
      hsl(var(--backdrop-drip-1) / 0.45),
      transparent 70%
    ),
    radial-gradient(
      40% 25% at 6% 4%,
      hsl(var(--backdrop-drip-2) / 0.15),
      transparent 60%
    ),
    radial-gradient(
      40% 25% at 94% 10%,
      hsl(var(--backdrop-drip-3) / 0.12),
      transparent 60%
    );
  filter: blur(1.5px) saturate(110%);
  opacity: 0.9;
  animation: noir-drift 26s ease-in-out infinite alternate;
}
@keyframes noir-drift {
  0% {
    transform: translate3d(-1%, 0, 0);
  }
  100% {
    transform: translate3d(1%, 0, 0);
  }
}

/* Oceanic backdrop */
html.theme-ocean body {
  background-image:
    radial-gradient(
      1200px 700px at 12% -12%,
      hsl(var(--backdrop-blob-1) / 0.2),
      transparent 60%
    ),
    radial-gradient(
      1100px 600px at 108% 16%,
      hsl(var(--backdrop-blob-2) / 0.16),
      transparent 60%
    ),
    linear-gradient(180deg, hsl(var(--card) / 0.9), hsl(var(--background)));
  background-attachment: fixed, fixed, fixed;
}
html.theme-ocean body::after {
  content: "";
  position: fixed;
  inset: -10%;
  z-index: 0;
  pointer-events: none;
  background:
    radial-gradient(
      60% 40% at 14% -6%,
      hsl(var(--backdrop-drip-1) / 0.18),
      transparent 60%
    ),
    radial-gradient(
      55% 35% at 50% 114%,
      hsl(var(--backdrop-drip-2) / 0.12),
      transparent 65%
    ),
    radial-gradient(
      50% 35% at 102% 8%,
      hsl(var(--backdrop-drip-3) / 0.1),
      transparent 60%
    );
  filter: blur(2px) saturate(112%);
  animation: ocean-pan 26s ease-in-out infinite alternate;
}
@keyframes ocean-pan {
  0% {
    transform: translate3d(-1%, -1%, 0) scale(1.01);
    opacity: 0.95;
  }
  50% {
    transform: translate3d(1%, 0%, 0) scale(1);
    opacity: 1;
  }
  100% {
    transform: translate3d(2%, 1%, 0) scale(1.01);
    opacity: 0.95;
  }
}

/* Kitten backdrop */
html.theme-kitten body {
  background-image:
    radial-gradient(
      1100px 620px at 16% -8%,
      hsl(var(--backdrop-blob-1) / 0.2),
      transparent 60%
    ),
    radial-gradient(
      1000px 560px at 106% 14%,
      hsl(var(--backdrop-blob-2) / 0.16),
      transparent 60%
    ),
    linear-gradient(180deg, hsl(var(--card) / 0.92), hsl(var(--background)));
  background-attachment: fixed, fixed, fixed;
}
html.theme-kitten body::after {
  content: "";
  position: fixed;
  inset: -10%;
  z-index: 0;
  pointer-events: none;
  background:
    radial-gradient(
      60% 40% at 12% -6%,
      hsl(var(--backdrop-drip-1) / 0.18),
      transparent 60%
    ),
    radial-gradient(
      55% 35% at 50% 116%,
      hsl(var(--backdrop-drip-2) / 0.12),
      transparent 65%
    ),
    radial-gradient(
      50% 35% at 100% 8%,
      hsl(var(--backdrop-drip-3) / 0.1),
      transparent 60%
    );
  filter: blur(2px) saturate(112%);
  animation: kitten-pan 27s ease-in-out infinite alternate;
}
@keyframes kitten-pan {
  0% {
    transform: translate3d(-1%, -1%, 0);
  }
  100% {
    transform: translate3d(1%, 1%, 0);
  }
}

/* Hardstuck backdrop */
html.theme-hardstuck body {
  background-image:
    radial-gradient(
      1000px 520px at 20% -10%,
      hsl(var(--backdrop-blob-1) / 0.15),
      transparent 60%
    ),
    radial-gradient(
      900px 520px at 110% 15%,
      hsl(var(--backdrop-blob-2) / 0.12),
      transparent 60%
    ),
    linear-gradient(180deg, hsl(var(--card) / 0.9), hsl(var(--background)));
  background-attachment: fixed, fixed, fixed;
}
html.theme-hardstuck body::after {
  content: "";
  position: fixed;
  inset: -12%;
  pointer-events: none;
  z-index: 0;
  background:
    radial-gradient(
      80% 60% at 50% 120%,
      hsl(var(--backdrop-drip-1) / 0.45),
      transparent 70%
    ),
    radial-gradient(
      40% 25% at 6% 4%,
      hsl(var(--backdrop-drip-2) / 0.15),
      transparent 60%
    ),
    radial-gradient(
      40% 25% at 94% 10%,
      hsl(var(--backdrop-drip-3) / 0.12),
      transparent 60%
    );
  filter: blur(1.5px) saturate(110%);
  opacity: 0.9;
  animation: hardstuck-drift 26s ease-in-out infinite alternate;
}

/* Retro backdrop */
html.theme-retro body {
  background-image:
    radial-gradient(
      1100px 640px at 18% -12%,
      hsl(var(--backdrop-blob-1) / 0.22),
      transparent 62%
    ),
    radial-gradient(
      1000px 560px at 108% 10%,
      hsl(var(--backdrop-blob-2) / 0.18),
      transparent 60%
    ),
    radial-gradient(
      1200px 760px at 50% 120%,
      hsl(var(--backdrop-blob-3) / 0.14),
      transparent 70%
    ),
    linear-gradient(180deg, hsl(var(--card)), hsl(var(--background)));
  background-attachment: fixed, fixed, fixed, fixed;
}


html.theme-retro body::after {
  content: "";
  position: fixed;
  inset: -10%;
  pointer-events: none;
  z-index: 0;
  background:
    var(--scan-lines),
    radial-gradient(
      65% 45% at 12% 0%,
      hsl(var(--backdrop-drip-1) / 0.28),
      transparent 62%
    ),
    radial-gradient(
      55% 38% at 88% 8%,
      hsl(var(--backdrop-drip-2) / 0.24),
      transparent 60%
    ),
    radial-gradient(
      70% 48% at 50% 115%,
      hsl(var(--backdrop-drip-3) / 0.2),
      transparent 72%
    );
  filter: blur(1.5px) saturate(115%);
  opacity: 0.9;
}

@media (prefers-reduced-motion: no-preference) {
  html.theme-retro body::after {
    animation: retro-pan 38s linear infinite reverse;
  }
}
@keyframes hardstuck-drift {
  0% {
    transform: translate3d(-1%, 0, 0);
  }
  100% {
    transform: translate3d(1%, 0, 0);
  }
}

@keyframes retro-pan {
  0% {
    transform: translate3d(0, 0, 0);
  }
  100% {
    transform: translate3d(28px, 18px, 0);
  }
}

/* Additional background options */
html.bg-alt1 body {
  background-image:
    radial-gradient(
      1000px 600px at 10% -10%,
      hsl(var(--backdrop-blob-1) / 0.2),
      transparent 60%
    ),
    radial-gradient(
      900px 500px at 110% 20%,
      hsl(var(--backdrop-blob-2) / 0.18),
      transparent 60%
    ),
    linear-gradient(180deg, hsl(var(--card)), hsl(var(--background)));
  background-attachment: fixed, fixed, fixed;
}
html.bg-alt1 body::before,
html.bg-alt1 body::after {
  content: none;
}

html.bg-alt1 body .page-backdrop__layer[data-variant="grid"],
html.bg-alt1 body .page-backdrop__layer[data-variant="drip"] {
  display: none;
}

html.bg-alt2 body {
  background-image:
    radial-gradient(
      1000px 600px at 50% 0%,
      hsl(var(--backdrop-blob-1) / 0.18),
      transparent 60%
    ),
    radial-gradient(
      900px 500px at 50% 120%,
      hsl(var(--backdrop-blob-3) / 0.16),
      transparent 60%
    ),
    linear-gradient(180deg, hsl(var(--card)), hsl(var(--background)));
  background-attachment: fixed, fixed, fixed;
}
html.bg-alt2 body::before,
html.bg-alt2 body::after {
  content: none;
}

html.bg-alt2 body .page-backdrop__layer[data-variant="grid"],
html.bg-alt2 body .page-backdrop__layer[data-variant="drip"] {
  display: none;
}

html.bg-vhs body {
  background-color: hsl(var(--surface-vhs));
  background-image:
    radial-gradient(
      circle at 20% 30%,
      hsl(var(--backdrop-blob-2) / 0.15),
      transparent 60%
    ),
    repeating-linear-gradient(
      to bottom,
      hsl(var(--backdrop-blob-2) / 0.15),
      hsl(var(--backdrop-blob-2) / 0.15) 1px,
      transparent 1px,
      transparent 3px
    );
  background-blend-mode: screen;
}
html.bg-vhs body::before,
html.bg-vhs body::after {
  content: none;
}

html.bg-vhs body .page-backdrop__layer[data-variant="grid"],
html.bg-vhs body .page-backdrop__layer[data-variant="drip"] {
  display: none;
}

html.bg-streak body {
  background-color: hsl(var(--surface-streak));
  background-image:
    radial-gradient(
      circle at 70% 40%,
      hsl(var(--backdrop-blob-3) / 0.25),
      transparent 40%
    ),
    repeating-linear-gradient(
      to right,
      hsl(var(--backdrop-blob-3) / 0.2),
      hsl(var(--backdrop-blob-3) / 0.2) 6px,
      transparent 6px,
      transparent 20px
    );
  background-blend-mode: lighten;
}
html.bg-streak body::before,
html.bg-streak body::after {
  content: none;
}

html.bg-streak body .page-backdrop__layer[data-variant="grid"],
html.bg-streak body .page-backdrop__layer[data-variant="drip"] {
  display: none;
}

/* ---------- Shared backdrop animations ---------- */
@keyframes lg-aurora-pan {
  0% {
    transform: translate3d(-2%, -1%, 0) scale(1.02);
    opacity: 0.95;
  }
  50% {
    transform: translate3d(1%, 0%, 0) scale(1.01);
    opacity: 1;
  }
  100% {
    transform: translate3d(2%, 1%, 0) scale(1.02);
    opacity: 0.95;
  }
}

/* ---------- Intensity toggles (all themes) ---------- */
html.bg-intense body .page-backdrop__layer[data-variant="grid"] {
  opacity: 0.05;
}
html.bg-intense body .page-backdrop__layer[data-variant="drip"] {
  filter: blur(2px) saturate(120%);
}

/* =========================================================
   Pretty Chroma Hairline (utility)
   =========================================================
   Usage: add class="pretty-border" to any container that should
   have a tinted, animated hairline that respects --card-hairline.
   No literal white is used for the border color itself.
*/
.pretty-border {
  position: relative;
  border-radius: var(--radius-card, 1rem);
  background-clip: padding-box;
  border: 1px solid hsl(var(--card-hairline));
  isolation: isolate;
}

/* Outer chroma ring (masked to the border box) */
.pretty-border::before {
  content: "";
  position: absolute;
  inset: -1px;
  padding: 1px;
  border-radius: inherit;
  pointer-events: none;
  background: conic-gradient(
    from 180deg,
    hsl(var(--backdrop-blob-1) / 0),
    hsl(var(--backdrop-blob-1) / 0.65),
    hsl(var(--backdrop-blob-2) / 0.65),
    hsl(var(--backdrop-blob-3) / 0.65),
    hsl(var(--backdrop-blob-1) / 0)
  );
  /* mask to only show the ring, not fill the card */
  -webkit-mask:
    linear-gradient(hsl(var(--foreground)) 0 0) content-box,
    linear-gradient(hsl(var(--foreground)) 0 0);
  -webkit-mask-composite: xor;
  mask:
    linear-gradient(hsl(var(--foreground)) 0 0) content-box,
    linear-gradient(hsl(var(--foreground)) 0 0);
  mask-composite: exclude;
  opacity: 0.55;
  animation:
    pb-hue 8s linear infinite,
    pb-jitter 2.4s steps(6, end) infinite;
}

/* Soft CRT scan overlay (uses foreground tint, not white) */
.pretty-border::after {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  pointer-events: none;
  background: repeating-linear-gradient(
    to bottom,
    hsl(var(--foreground) / 0.05) 0 1px,
    transparent 2px 3px
  );
  mix-blend-mode: soft-light;
  opacity: 0.18;
}

@keyframes pb-hue {
  to {
    filter: hue-rotate(360deg);
  }
}
@keyframes pb-jitter {
  0%,
  100% {
    transform: translate(0, 0);
  }
  25% {
    transform: translate(0.25px, -0.2px);
  }
  50% {
    transform: translate(-0.2px, 0.25px);
  }
  75% {
    transform: translate(0.15px, 0.15px);
  }
}
